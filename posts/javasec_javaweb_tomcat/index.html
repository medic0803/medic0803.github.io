<!DOCTYPE html>
<html lang="en-uk" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='å†™åœ¨å‰é¢ æœ€è¿‘ä¸€ç›´éƒ½è¯´æƒ³å­¦Javaå†…å­˜é©¬ï¼Œä½†ä¹Ÿä¸€ç›´éƒ½åœåœ¨Tomcatå†…å­˜é©¬è¿™é‡Œï¼ŒåŸå› å°±æ˜¯å¾ˆå¤šçš„æ•™ç¨‹éƒ½å»ºè®®è¦æŒæ¡ä¸€ä¸‹Tomcatçš„æ¡†æ¶ï¼Œä½†æ˜¯è¿«äº'><title>JavaSec - JavaWeb - Tomcat æ¡†æ¶ä»¥åŠä¸Servletä¹‹é—´çš„è”ç³»</title>

<link rel='canonical' href='https://ginkgo.org.cn/posts/javasec_javaweb_tomcat/'>

<link rel="stylesheet" href="/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css"><meta property='og:title' content='JavaSec - JavaWeb - Tomcat æ¡†æ¶ä»¥åŠä¸Servletä¹‹é—´çš„è”ç³»'>
<meta property='og:description' content='å†™åœ¨å‰é¢ æœ€è¿‘ä¸€ç›´éƒ½è¯´æƒ³å­¦Javaå†…å­˜é©¬ï¼Œä½†ä¹Ÿä¸€ç›´éƒ½åœåœ¨Tomcatå†…å­˜é©¬è¿™é‡Œï¼ŒåŸå› å°±æ˜¯å¾ˆå¤šçš„æ•™ç¨‹éƒ½å»ºè®®è¦æŒæ¡ä¸€ä¸‹Tomcatçš„æ¡†æ¶ï¼Œä½†æ˜¯è¿«äº'>
<meta property='og:url' content='https://ginkgo.org.cn/posts/javasec_javaweb_tomcat/'>
<meta property='og:site_name' content='Under The Ginkgo'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='tomcat' /><meta property='article:tag' content='servlet' /><meta property='article:tag' content='JavaEE' /><meta property='article:published_time' content='2022-10-20T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2022-11-01T18:17:41&#43;08:00'/>
<meta name="twitter:title" content="JavaSec - JavaWeb - Tomcat æ¡†æ¶ä»¥åŠä¸Servletä¹‹é—´çš„è”ç³»">
<meta name="twitter:description" content="å†™åœ¨å‰é¢ æœ€è¿‘ä¸€ç›´éƒ½è¯´æƒ³å­¦Javaå†…å­˜é©¬ï¼Œä½†ä¹Ÿä¸€ç›´éƒ½åœåœ¨Tomcatå†…å­˜é©¬è¿™é‡Œï¼ŒåŸå› å°±æ˜¯å¾ˆå¤šçš„æ•™ç¨‹éƒ½å»ºè®®è¦æŒæ¡ä¸€ä¸‹Tomcatçš„æ¡†æ¶ï¼Œä½†æ˜¯è¿«äº">
    <link rel="shortcut icon" href="/img/favicon.ico" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZKEXSTS2N4"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-ZKEXSTS2N4', { 'anonymize_ip': false });
}
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/Ginkgo_hu5438825b9b6d1014226d20d231e650c2_69187_300x0_resize_q75_box.JPG" width="300"
                            height="237" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ§</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Under The Ginkgo</a></h1>
            <h2 class="site-description">BOYS FIGHT FOR YOUR LIBERTY</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/medic0803'
                        target="_blank"
                        title="A_GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:medicwrf@gmail.com'
                        target="_blank"
                        title="B_E-mail"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1647773061437" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2742" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M937.593333 257.073333A148.353333 148.353333 0 0 0 832 213.333333H384v-42.666666h85.333333a85.333333 85.333333 0 0 0 0-170.666667H362.666667a21.333333 21.333333 0 0 0-21.333334 21.333333v192H212.26A53.426667 53.426667 0 0 0 160 170.666667h-64a53.393333 53.393333 0 0 0-53.333333 53.333333v533.333333a53.393333 53.393333 0 0 0 53.333333 53.333334h64a53.426667 53.426667 0 0 0 52.26-42.666667H384v192a21.333333 21.333333 0 0 0 21.333333 21.333333h170.666667a21.333333 21.333333 0 0 0 21.333333-21.333333v-192h362.666667a21.333333 21.333333 0 0 0 21.333333-21.333333V362.666667a148.353333 148.353333 0 0 0-43.74-105.593334zM512 85.333333a42.713333 42.713333 0 0 1-42.666667 42.666667H384V42.666667h85.333333a42.713333 42.713333 0 0 1 42.666667 42.666666zM170.666667 757.333333a10.666667 10.666667 0 0 1-10.666667 10.666667h-64a10.666667 10.666667 0 0 1-10.666667-10.666667V224a10.666667 10.666667 0 0 1 10.666667-10.666667h64a10.666667 10.666667 0 0 1 10.666667 10.666667z m384 181.333334H426.666667v-170.666667h128z m384-213.333334H213.333333V256h128v149.333333a21.333333 21.333333 0 0 0 21.333334 21.333334h85.333333a21.333333 21.333333 0 0 0 0-42.666667h-64V256h448c58.813333 0 106.666667 47.853333 106.666667 106.666667z" fill="#bababa" p-id="2743"></path></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/web/" >
                web
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/javasec_javaweb_tomcat/">JavaSec - JavaWeb - Tomcat æ¡†æ¶ä»¥åŠä¸Servletä¹‹é—´çš„è”ç³»</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Oct 20, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    28 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ä¸€ç›´éƒ½è¯´æƒ³å­¦Javaå†…å­˜é©¬ï¼Œä½†ä¹Ÿä¸€ç›´éƒ½åœåœ¨Tomcatå†…å­˜é©¬è¿™é‡Œï¼ŒåŸå› å°±æ˜¯å¾ˆå¤šçš„æ•™ç¨‹éƒ½å»ºè®®è¦æŒæ¡ä¸€ä¸‹Tomcatçš„æ¡†æ¶ï¼Œä½†æ˜¯è¿«äºä¸€ç›´éƒ½æ²¡æœ‰æ‰¾åˆ°å¥½çš„æ•™ç¨‹å’Œæ–‡ç« æ¥çœ‹ï¼Œå¦‚æœåªæ˜¯å•çº¯åœ°ç»™æ¯ä¸ªæ¨¡å—ä¸‹ä¸€ä¸ªå®šä¹‰ï¼Œæ„Ÿè§‰å¾ˆéš¾è¯´æœè‡ªå·±æ‡‚äº†ã€‚ <!-- raw HTML omitted --></p>
<p>è™½ç„¶å¾ˆæƒ³ä»å¤´çœ‹ä¸€éã€ŠHow Tomcat Worksã€‹ä½†æ˜¯ç¡®å®ä¹Ÿä¸ç°å®ï¼Œå¶ç„¶ä¸€ä¸ªæœºä¼šéœ€è¦æ‰¾ä¸€ä¸‹Tomcatçš„ <code>server.xml</code> é…ç½®æ–‡ä»¶æ¥çœ‹ä¸€ä¸‹ï¼Œåˆç¢°å·§æ‰¾åˆ°äº†ä¸€ç¯‡è§£è¯» <code>server.xml</code> çš„æ–‡ç« ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« æˆ–è€…è¯´å­¦ä¹ ç¬”è®°ã€‚ <!-- raw HTML omitted --></p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€èµ·å­¦ä¹ ä»¥ä¸‹å†…å®¹ï¼š <!-- raw HTML omitted --></p>
<ol>
<li>é€šè¿‡è§£è¯»ä¸€ä¸ªåŸºç¡€çš„Tomcat <strong>server.xml</strong> é…ç½®æ–‡ä»¶ï¼Œäº†è§£Tomcatä¸‹é¢çš„ç»„ä»¶æ˜¯å¦‚ä½•åˆ†å·¥å¤„ç†ä¸€ä¸ªHTTPè¯·æ±‚çš„ï¼› <!-- raw HTML omitted --></li>
<li>è¿›è€Œäº†è§£Tomcatä¸‹å„ä¸ªç»„ä»¶çš„ä½œç”¨ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼› <!-- raw HTML omitted --></li>
<li>é€šè¿‡Tomcatä»¥åŠJava EEæºç æ¥äº†è§£ä¸€ä¸‹Tomcatæ˜¯å¦‚ä½•ä¸Java EEä¸­çš„ä¸‰å¤§ç»„ä»¶ï¼ˆServletï¼ŒFilterï¼ŒListenerï¼‰æ˜¯å¦‚ä½•å…³è”èµ·æ¥çš„ï¼› <!-- raw HTML omitted --></li>
<li>æœ€åé€šè¿‡äº†è§£Tomcat Pipeline-Valveè´£ä»»é“¾æœºåˆ¶äº†è§£Tomcatä¸Java Webå…·ä½“åœ¨ä»£ç ä¸­æ˜¯å¦‚ä½•å¤„ç†ä¸€ä¸ªHTTPè¯·æ±‚çš„ï¼› <!-- raw HTML omitted --></li>
</ol>
<p>å¦‚æœå¯¹äºJava Webä¸­ä¸‰å¤§ç»„ä»¶æœ‰ç–‘é—®çš„è¯ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘æ€»ç»“çš„å†…å®¹ï¼š <!-- raw HTML omitted -->
<a class="link" href="https://ginkgo.org.cn/posts/javasec_javaweb_servlet/"  target="_blank" rel="noopener"
    >JavaSec - Java Web - ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ - Servlet</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://ginkgo.org.cn/posts/javasec_javaweb_listener_and_filter/"  target="_blank" rel="noopener"
    >JavaSec - Java Web - ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ - Listener &amp; Filter</a> <!-- raw HTML omitted --></p>
<h2 id="tomcatåŸºç¡€æ¡†æ¶">TomcatåŸºç¡€æ¡†æ¶</h2>
<p>Tomcatä½œä¸ºä¸€ä¸ªWebåº”ç”¨æœåŠ¡å™¨ï¼Œå…¶æœ€æ ¸å¿ƒçš„åŠŸèƒ½è‡ªç„¶å°±æ˜¯ï¼š <!-- raw HTML omitted --></p>
<ol>
<li>æ¥å—æ¥è‡ªç”¨æˆ·çš„HTTP requestè¯·æ±‚; <!-- raw HTML omitted --></li>
<li>æ ¹æ®ç”¨æˆ·çš„HTTPè¯·æ±‚è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼› <!-- raw HTML omitted --></li>
<li>æœ€åè¿”å›Responseå“åº”ç»™ç”¨æˆ·ï¼› <!-- raw HTML omitted --></li>
</ol>
<p>åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œè®°ä½è¿™ä¸ªæœ€åŸºæœ¬çš„åŠŸèƒ½å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½çš„ç†è§£Tomcatåˆ°åº•æ˜¯æ€ä¹ˆæ¥å¯¹HTTPè¯·æ±‚è¿›è¡Œå¤„ç†çš„ã€‚ <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-09-28_11-31-48_screenshot.png"
         alt="Figure 1: Tomcatæ¡†æ¶" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 1: <!-- raw HTML omitted -->Tomcatæ¡†æ¶</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬å…ˆæ¥æ ¹æ®ä¸Šå›¾çœ‹ä¸€ä¸‹æœ€ç®€å•çš„Tomcat serveræ¡†æ¶ï¼Œå…¶ä¸­åŒ…å«äº†å¾ˆå¤šé™Œç”Ÿçš„æŠ½è±¡åè¯ï¼Œå¤§å®¶ä¸è¦ç€æ€¥ï¼Œåé¢æˆ‘ä»¬ä¼šå…·ä½“å±•å¼€æ¥è®²ï¼š <!-- raw HTML omitted --></p>
<ol>
<li>ä¸€ä¸ªTomcatæœåŠ¡å™¨åŒ…å«å¤šä¸ªService; <!-- raw HTML omitted --></li>
<li>ä¸€ä¸ªServiceå¯ä»¥ç»‘å®š <strong>å¤šä¸ª</strong> Connectorï¼Œå¹¶åŒæ—¶ä¸ <strong>å”¯ä¸€</strong> ä¸€ä¸ªContainerç»‘å®š; <!-- raw HTML omitted --></li>
<li><strong>Connector</strong> è´Ÿè´£å¤„ç†ç”±å®¢æˆ·ç«¯å‘å‡ºçš„HTTPè¯·æ±‚ï¼Œå¹¶å°è£…æˆServletRequestå¯¹è±¡å‘é€ç»™Containerè¿›è¡Œå¤„ç†; <!-- raw HTML omitted --></li>
<li><strong>Container</strong> è´Ÿè´£å¯¹æ”¶åˆ°çš„è¯·æ±‚ï¼ˆServletRequestå¯¹è±¡ï¼‰è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å“åº”Responseå°è£…æˆServletResponseå¯¹è±¡å‘å›Connector; <!-- raw HTML omitted --></li>
<li>æœ€åç”±Connectorå‘é€HTTPå“åº”è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè‡³æ­¤å®Œæˆä¸€æ¬¡HTTPè¯·æ±‚ä¸å“åº”ã€‚ <!-- raw HTML omitted --></li>
</ol>
<h2 id="ä»tomcaté…ç½®æ–‡ä»¶server-dot-xmläº†è§£tomcat">ä»Tomcaté…ç½®æ–‡ä»¶server.xmläº†è§£Tomcat</h2>
<p>server.xmlæ˜¯TomcatæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªxmlå…ƒç´ éƒ½ä»£è¡¨äº†tomcatä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶éƒ½åœ¨å¤„ç†è¯·æ±‚ä¸­æ‹¥æœ‰è‡ªå·±çš„èŒè´£ï¼Œæˆ‘ä»¬é€šè¿‡å¯¹é…ç½®æ–‡ä»¶çš„è§£è¯»å­¦ä¹ ï¼Œå¯ä»¥å¤§è‡´äº†è§£TomcatæœåŠ¡å™¨çš„æ•´ä½“æ¶æ„ç»„æˆï¼Œæœ‰åŠ©äºæˆ‘ä»¬è¿›ä¸€æ­¥çš„æºç é˜…è¯»ï¼› <!-- raw HTML omitted --></p>
<p>Tomcatçš„é…ç½®æ–‡ä»¶server.xmlçš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Server&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Service&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;Connector</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;Connector</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;Engine&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;Host&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Context</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/Host&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/Engine&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Service&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Server&gt;</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬è®²ä¸€ä¸ªä¸ªå…ƒç´ æ¥è¿›è¡Œç†è§£ï¼Œå¹¶äº†è§£è¿™äº›å…ƒç´ æ‰€é…ç½®çš„Tomcatç»„ä»¶çš„åŠŸèƒ½ï¼› <!-- raw HTML omitted --></p>
<h2 id="server">Server</h2>
<p>&lt;Server&gt;å…ƒç´ æ˜¯é…ç½®æ–‡ä»¶çš„æ ¹å…ƒç´ ï¼Œç”¨æ¥ä»£è¡¨ç€æˆ‘ä»¬æ•´ä¸€ä¸ªTomcatæœåŠ¡å™¨ï¼› <!-- raw HTML omitted --></p>
<p>æ ¹æ®ä¸Šé¢çš„æ¡†æ¶å›¾æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªTomcat Serverå¯ä»¥åŒ…å«å¤šä¸ªServiceï¼Œè€ŒServerçš„ä¸»è¦ä»»åŠ¡ï¼Œå°±æ˜¯ä¸ºå®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªèƒ½å¤Ÿè®¿é—®æ‰€æœ‰è¿™äº›Serviceçš„æ¥å£ï¼ŒåŒæ—¶ç»´æŠ¤æ‰€æœ‰Serviceçš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å¦‚ä½•æ‰¾åˆ°å®¢æˆ·ç«¯æƒ³è¦è®¿é—®çš„Serviceï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Server</span> <span class="na">port=</span><span class="s">&#34;8005&#34;</span> <span class="na">shutdown=</span><span class="s">&#34;SHUTDOWN&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Server&gt;</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„è¿™ä¸ªå®ä¾‹åŒ…å«äº†ä¸¤ä¸ªå±æ€§ï¼Œportä»¥åŠshutdownï¼Œè¿™ä¸¤ä¸ªå±æ€§ç»„åˆåœ¨ä¸€èµ·è¡¨ç¤ºï¼Œå½“æˆ‘ä»¬å‘8005ç«¯å£å‘é€&quot;SHUTDOWN&quot;è¿™ä¸ªä¿¡æ¯æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šå…³é—­ï¼ˆå½“shutdownçš„å±æ€§è®¾ä¸º-1æ—¶å°±å¯ä»¥ç¦ç”¨è¿™ä¸ªåŠŸèƒ½ï¼‰ <!-- raw HTML omitted --></p>
<p>å¦‚æœå¤§å®¶ç”¨è¿‡ncæˆ–è€…ncatçš„è¯ï¼Œå°±ä¸éš¾æƒ³åˆ°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ncæ¥åˆ›å»ºä¸€ä¸ªclient socketå»è¿æ¥8005ç«¯å£å¹¶å‘å‡ºæŒ‡ä»¤å…³é—­ç«¯å£ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc localhost <span class="m">8005</span>
</span></span><span class="line"><span class="cl">SHUTDOWN
</span></span></code></pre></div><h2 id="service">Service</h2>
<p>Tomcatæ¡†æ¶ä¸­çš„è¿™ä¸ªServiceï¼Œæˆ‘è®¤ä¸ºæ˜¯å’Œæˆ‘ä»¬ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„Serviceæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå³ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ¥è¿›è¡Œé€šä¿¡äº¤äº’ï¼› <!-- raw HTML omitted --></p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œé»˜è®¤åªå¼€å¯ä¸€ä¸ªåå«Catalinaçš„Serviceï¼Œä¹Ÿå°±æ˜¯æœ€æ ¸å¿ƒçš„Webå®¹å™¨ï¼Œå½“ç„¶Tomcatä¹Ÿå¯ä»¥æä¾›å¤šä¸ªServiceï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ç”¨ä¸ä¸Šï¼Œæˆ‘ä»¬åªè¦çŸ¥é“æ ¹æ®nameå±æ€§ï¼ŒCatalinaå°±æ˜¯Tomcat serverä¸‹é¢çš„ä¸€ä¸ªServiceå°±å¯ä»¥äº†ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Service</span> <span class="na">name=</span><span class="s">&#34;Catalina&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">&#34;8080&#34;</span> <span class="na">protocol=</span><span class="s">&#34;HTTP/1.1&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">connectionTimeout=</span><span class="s">&#34;20000&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">redirectPort=</span><span class="s">&#34;8443&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Engine</span> <span class="na">name=</span><span class="s">&#34;Catalina&#34;</span> <span class="na">defaultHost=</span><span class="s">&#34;localhost&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Host</span> <span class="na">name=</span><span class="s">&#34;localhost&#34;</span>  <span class="na">appBase=</span><span class="s">&#34;webapps&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">unpackWARs=</span><span class="s">&#34;true&#34;</span> <span class="na">autoDeploy=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Host&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Engine&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Service&gt;</span>
</span></span></code></pre></div><h2 id="connector">Connector</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">&#34;8080&#34;</span> <span class="na">protocol=</span><span class="s">&#34;HTTP/1.1&#34;</span>
</span></span><span class="line"><span class="cl">             <span class="na">connectionTimeout=</span><span class="s">&#34;20000&#34;</span>
</span></span><span class="line"><span class="cl">             <span class="na">redirectPort=</span><span class="s">&#34;8443&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">&#34;8009&#34;</span> <span class="na">protocol=</span><span class="s">&#34;AJP/1.3&#34;</span> <span class="na">redirectPort=</span><span class="s">&#34;8443&#34;</span> <span class="nt">/&gt;</span>
</span></span></code></pre></div><p>æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ServiceåŒ…å«å¤šä¸ªConnectorå’Œå”¯ä¸€çš„Containerï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œå‘ç°äº†ä¸¤ä¸ªConnectorå…ƒç´ ç›‘å¬äº†ä¸åŒçš„ç«¯å£ï¼Œå¯è¿™å°±è®©Serviceçš„æ¦‚å¿µä¸æ˜¯ä¸åŒäº†å—ï¼Ÿ <!-- raw HTML omitted --></p>
<p>å…¶å®ä»”ç»†çœ‹ï¼Œå¯ä»¥å‘ç°ä¸¤ä¸ªConnectoréƒ½ä½¿ç”¨äº†ä¸åŒçš„åè®®ï¼ŒHTTP/1.1 ä»¥åŠ AJP/1.3ï¼› <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬æ¥ç€çœ‹çœ‹å…ƒç´ å†…çš„å±æ€§ï¼Œportï¼Œprotocolå°±æ˜¯Connectoræ‰€ç›‘å¬çš„ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨äº†8080ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„80ç«¯å£ï¼Œè¿™æ˜¯å› ä¸ºï¼š <!-- raw HTML omitted --></p>
<blockquote>
<p>â€œåœ¨æ­£å¼çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒTomcatä¹Ÿå¸¸å¸¸ç›‘å¬8080ç«¯å£ï¼Œè€Œä¸æ˜¯80ç«¯å£ã€‚è¿™æ˜¯å› ä¸ºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¾ˆå°‘å°†Tomcatç›´æ¥å¯¹å¤–å¼€æ”¾æ¥æ”¶è¯·æ±‚ï¼Œè€Œæ˜¯åœ¨Tomcatå’Œå®¢æˆ·ç«¯ä¹‹é—´åŠ ä¸€å±‚ä»£ç†æœåŠ¡å™¨(å¦‚nginx)ï¼Œç”¨äºè¯·æ±‚çš„è½¬å‘ã€è´Ÿè½½å‡è¡¡ã€å¤„ç†é™æ€æ–‡ä»¶ç­‰ï¼›é€šè¿‡ä»£ç†æœåŠ¡å™¨è®¿é—®Tomcatæ—¶ï¼Œæ˜¯åœ¨å±€åŸŸç½‘ä¸­ï¼Œå› æ­¤ä¸€èˆ¬ä»ä½¿ç”¨8080ç«¯å£ã€‚â€ <!-- raw HTML omitted --></p>
</blockquote>
<p>è€Œé…ç½®äº†ç¬¬äºŒä¸ªAJPåè®®çš„Connectorè¿æ¥å™¨æ˜¯å› ä¸ºTomcatä½œä¸ºServletå®¹å™¨ï¼Œå¯¹äºé™æ€èµ„æºå¤„ç†é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œå› æ­¤å¯ä»¥ç”¨AJPåè®®ä¸Apacheç­‰æœåŠ¡å™¨è¿æ¥ï¼Œè®©Apacheç­‰æœåŠ¡å™¨æ¥å¤„ç†é™æ€èµ„æºï¼› <!-- raw HTML omitted --></p>
<dl>
<dt>é™æ€èµ„æº</dt>
<dd><ul>
<li>é™æ€èµ„æºå°±æ˜¯æœåŠ¡å™¨ä¸éœ€è¦ç»è¿‡ä»»ä½•å¤„ç†å°±å¯ä»¥ç›´æ¥è¿”å›ç»™ç”¨æˆ·çš„å†…å®¹ï¼Œä¾‹å¦‚HTMLé¡µé¢ï¼ŒFlashï¼ŒJavaScriptå›¾ç‰‡ç­‰å†…å®¹ï¼› <!-- raw HTML omitted --></li>
<li>ç›¸å¯¹çš„ï¼ŒåŠ¨æ€èµ„æºå°±æ˜¯ä¾‹å¦‚ASPã€PHPã€JSPç­‰æ–‡ä»¶ï¼Œéœ€è¦ç»è¿‡æœåŠ¡å™¨å¤„ç†ä¹‹åï¼Œç„¶åå†è¿”å›ç»™ç”¨æˆ·ï¼› <!-- raw HTML omitted --></li>
</ul>
</dd>
<dt>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”¨Apacheç­‰HTTPæœåŠ¡å™¨æ¥å¤„ç†é™æ€èµ„æºï¼Ÿ</dt>
<dd><ul>
<li>æˆ‘ä»¬çŸ¥é“Tomcatä¼šä½¿ç”¨Connectorè¿æ¥å™¨å¯¹å®¢æˆ·ç«¯å‘æ¥çš„HTTPè¯·æ±‚è¿›è¡Œè§£æï¼Œç„¶åè½¬æ¢æˆRequestä»¥åŠResponseå¯¹è±¡è¿›è¡Œå¤„ç†ä¹‹åå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼› <!-- raw HTML omitted --></li>
<li>ä½†å¦‚æœæ˜¯é™æ€èµ„æºï¼Œæ ¹æœ¬ä¸éœ€è¦æœåŠ¡å™¨è¿›è¡Œä»»ä½•å¤„ç†ï¼Œå¦‚æœæ¯æ¬¡ç¢°åˆ°é™æ€èµ„æºï¼Œä¾‹å¦‚å›¾ç‰‡å•Šï¼ŒJSè¿™æ ·çš„èµ„æºå¦‚æœè¿˜é—®Tomcatæ¥è¦ï¼Œé‚£å°±ä¼šæµªè´¹æ—¶é—´åœ¨å¯¹äºæ‰€æœ‰è¿™äº›HTTPè¯·æ±‚çš„æ— ç”¨çš„è§£æå’Œæ„é€ å¯¹è±¡ä¸Šäº†ï¼› <!-- raw HTML omitted --></li>
<li>è€ŒAJP(Apache JServ Protocol) æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„åè®®ï¼Œå¹¶ä¸”ä¸TomcatæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªæ°¸ä¹…çš„è¿æ¥ï¼Œè¿™ä¸¤ç‚¹éƒ½æå¤§åœ°æé«˜äº†é€šä¿¡çš„æ•ˆç‡; <!-- raw HTML omitted --></li>
</ul>
</dd>
</dl>
<blockquote>
<p><figure><img src="/ox-hugo/2022-10-21_09-09-22_screenshot.png"
         alt="Figure 2: Tomcatä¸Apacheé›†æˆ" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 2: <!-- raw HTML omitted -->Tomcatä¸Apacheé›†æˆ</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
</blockquote>
<p>æ€»ç»“ä¸€ä¸‹ï¼ŒConnectorçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯æä¾›ä¸€ä¸ªæ¥å£ï¼Œæ¥æ¥æ”¶æ‰€æœ‰æ¥è‡ªå®¢æˆ·ç«¯çš„HTTPè¯·æ±‚ï¼Œå¹¶å°†HTTP Requestä»¥åŠResponseå°è£…æˆServletRequestå¯¹è±¡å‘é€ç»™Containerè¿›è¡Œå¤„ç†; <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬åœ¨å¼€å¤´è¯´è¿‡ï¼Œæˆ‘ä»¬è¦å…³æ³¨Tomcatæœ¬è´¨ä¸Šæ˜¯æ¥å¤„ç†å®¢æˆ·ç«¯ä¼ æ¥çš„HTTPè¯·æ±‚ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ‹¿ä¸€ä¸ªä¾‹å­æ¥å…·ä½“ä»‹ç»ï¼š <!-- raw HTML omitted --></p>
<p>URLï¼š <!-- raw HTML omitted --></p>
<blockquote>
<p><a class="link" href="http://localhost:8080/LearnFilter_war/admin/a.jsp"  target="_blank" rel="noopener"
    >http://localhost:8080/LearnFilter_war/admin/a.jsp</a> <!-- raw HTML omitted --></p>
</blockquote>
<p>HTTPè¯·æ±‚ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/LearnFilter_war/admin/a.jsp</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost:8080</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:107.0) Gecko/20100101 Firefox/107.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.5</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
</span></span><span class="line"><span class="cl"><span class="n">DNT</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">close</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">none</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
</span></span></code></pre></div><p>ç›´åˆ°Connectorè¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬çš„è¯·æ±‚é¦–å…ˆå·²ç»ç»å†è¿™äº›å¤„ç†ï¼ˆæš‚æ—¶ä¸è€ƒè™‘nginxåå‘ä»£ç†ï¼‰ï¼š <!-- raw HTML omitted --></p>
<ol>
<li>localhostç»è¿‡äº†æœ¬æœºé»˜è®¤çš„DNSæœåŠ¡å™¨ï¼Œè¢«è§£ææˆäº†127.0.0.1ï¼Œç„¶åå»ºç«‹äº†ä¸€ä¸ªclient socketå¹¶å°è¯•ä¸æœåŠ¡å™¨çš„8080ç«¯å£å»ºç«‹è¿æ¥ï¼› <!-- raw HTML omitted --></li>
<li>Tomcatçš„HTTP Connectorè¿æ¥å™¨æ¥æ”¶åˆ°äº†HTTPè¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬æ¢ä¸ºServletRequestä»¥åŠå¯¹åº”çš„ServletResponseå¯¹è±¡ä¼ é€’ç»™Containerã€‚ <!-- raw HTML omitted --></li>
</ol>
<h2 id="container">Container</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Engine</span> <span class="na">name=</span><span class="s">&#34;Catalina&#34;</span> <span class="na">defaultHost=</span><span class="s">&#34;localhost&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Host</span> <span class="na">name=</span><span class="s">&#34;localhost&#34;</span>  <span class="na">appBase=</span><span class="s">&#34;webapps&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">unpackWARs=</span><span class="s">&#34;true&#34;</span> <span class="na">autoDeploy=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Host&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Engine&gt;</span>
</span></span></code></pre></div><p>Container? è°æ˜¯Containerï¼Ÿå“ªé‡Œæœ‰Containerï¼Œé…ç½®æ–‡ä»¶é‡Œæ²¡çœ‹åˆ°å•Šï¼Ÿ <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„Containerå®¹å™¨å…¶å®éƒ½æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå…¶å®çœŸæ­£åœ¨ä½¿ç”¨çš„éƒ½æ˜¯ç»§æ‰¿äº†Containeræ¥å£çš„æ‰€æœ‰å­ç±»ï¼ŒåŒ…æ‹¬Engineï¼ŒHostï¼ŒContextä»¥åŠWrapperï¼› <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-09-28_11-59-42_screenshot.png"
         alt="Figure 3: Container ç±»å±‚æ¬¡" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 3: <!-- raw HTML omitted -->Container ç±»å±‚æ¬¡</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä¾æ¬¡ä»‹ç»ä»–ä»¬çš„ä½œç”¨ï¼Œä¸è¿‡å°±å’Œä¹‹å‰ä»‹ç»çš„é‚£æ ·ï¼Œæ•´ä¸€ä¸ªContaineræ¨¡å—çš„åŠŸèƒ½å°±æ˜¯å¤„ç†è¯·æ±‚ä»¥åŠæ„é€ å“åº”ã€‚ <!-- raw HTML omitted --></p>
<h3 id="engineä¸host">Engineä¸Host</h3>
<p>ä¸€ä¸ªServiceåªåŒ…å«ä¸€ä¸ªEngineï¼›ä¸€ä¸ªEngineä¸Serviceä¸­çš„å¤šä¸ªConnectorè¿›è¡Œç»‘å®šï¼›åŒæ—¶ä¸€ä¸ªEngineå¯ä»¥å†…åµŒä¸€ä¸ªæˆ–å¤šä¸ªHostï¼ˆå³Hostæ˜¯Engineçš„å­å®¹å™¨ï¼‰ï¼› <!-- raw HTML omitted --></p>
<p>Engineæ˜¯æœ€é¡¶å±‚çš„Containerï¼ˆå®¹å™¨ï¼‰ï¼Œè€ŒHostä½œä¸ºå­å®¹å™¨ï¼Œè¡¨ç¤ºEngineä¸­çš„ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå¯¹åº”äº†æœåŠ¡å™¨ä¸­çš„ç½‘ç»œå®ä½“åï¼ˆä¾‹å¦‚åŸŸåæˆ–è€…IPåœ°å€ï¼‰ï¼› <!-- raw HTML omitted --></p>
<p>å®¢æˆ·ç«¯é€šè¿‡ä¸»æœºåæ¥æ ‡è¯†ä»–ä»¬æƒ³è¦è¿æ¥çš„ä¸»æœºï¼Œä¸»æœºåä¼šä½œä¸º <strong>HOST</strong> Headerè¢«æ”¾åœ¨HTTPè¯·æ±‚ä¸­ï¼ŒEngineä¼šæ ¹æ®HTTP Headerä¸­Hostçš„å€¼å†³å®šç”±å“ªä¸€ä¸ªHOSTæ¥ç»§ç»­å¤„ç†è¯·æ±‚ã€‚ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Engine</span> <span class="na">name=</span><span class="s">&#34;Catalina&#34;</span> <span class="na">defaultHost=</span><span class="s">&#34;localhost&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Host</span> <span class="na">name=</span><span class="s">&#34;localhost&#34;</span>  <span class="na">appBase=</span><span class="s">&#34;webapps&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">unpackWARs=</span><span class="s">&#34;true&#34;</span> <span class="na">autoDeploy=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Host&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Host</span> <span class="na">name=</span><span class="s">&#34;anotherHost&#34;</span> <span class="na">appbase=</span><span class="s">&#34;otherApps&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Host&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Engine&gt;</span>
</span></span></code></pre></div><p>åœ¨Engineå…ƒç´ çš„å±æ€§ä¸­: <!-- raw HTML omitted --></p>
<ol>
<li>nameå±æ€§ç”¨äºç”¨æˆ·æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯ï¼Œåœ¨æ•´ä¸ªServerä¸­åº”è¯¥ä¿æŒå”¯ä¸€ï¼› <!-- raw HTML omitted --></li>
<li>defaultHostè¡¨ç¤ºå¦‚æœHTTPè¯·æ±‚ä¸­çš„HOST Headerçš„å€¼ä¸æ‰€æœ‰çš„Hostå…ƒç´ éƒ½ä¸åŒ¹é…ï¼Œé»˜è®¤äº¤ç”±defaultHostæ‰€è®¾å®šçš„Hostå¤„ç†ï¼› <!-- raw HTML omitted --></li>
</ol>
<p>æœ€åå†è¯´æ˜ä¸€ä¸‹Hostçš„é…ç½®å±æ€§ï¼š <!-- raw HTML omitted --></p>
<ol>
<li>nameè¡¨ç¤ºTomcatä¸Šè™šæ‹Ÿä¸»æœºçš„ä¸»æœºåï¼Œä¸€èˆ¬æ¥è¯´ä¸»æœºåæ˜¯DNSæœåŠ¡å™¨ä¸­å·²ç»æ³¨å†Œçš„åŸŸåï¼ˆå½“ç„¶defaultHostä¸éœ€è¦ï¼Œåªè¦ä¿è¯èƒ½æ¥å—åˆ°å°±å¥½äº†ï¼‰ï¼› <!-- raw HTML omitted --></li>
<li>unpackWARsæŒ‡ç¤ºäº†æ˜¯å¦è¦å°†ä»£è¡¨Webåº”ç”¨çš„WARæ–‡ä»¶è§£å‹ï¼š <!-- raw HTML omitted -->
<ul>
<li>å¦‚æœä¸ºtrueï¼Œåˆ™è§£å‹ä¹‹åå†è¿è¡Œwebåº”ç”¨ <!-- raw HTML omitted --></li>
<li>å¦‚æœä¸ºfalseï¼Œåˆ™ç›´æ¥ä½¿ç”¨WARæ–‡ä»¶è¿è¡ŒWebåº”ç”¨ <!-- raw HTML omitted --></li>
</ul>
</li>
<li>autoDeployä»¥åŠappBaseå±æ€§æˆ‘ä»¬æ”¾åˆ°åé¢Webåº”ç”¨è‡ªåŠ¨éƒ¨ç½²å†ä»‹ç»ï¼Œå…ˆçŸ¥é“appBaseå°±è¡¨ç¤ºå­˜æ”¾Webåº”ç”¨çš„ç›®å½•å°±å¯ä»¥äº† <!-- raw HTML omitted --></li>
</ol>
<p>æœ€åå›åˆ°æˆ‘ä»¬çš„HTTPè¯·æ±‚çš„ä¾‹å­ï¼ˆå½“ç„¶è¿™æ—¶å€™è¿™äº›æ•°æ®éƒ½æ˜¯ä»Connectoræ•´åˆçš„ServletRequestå¯¹è±¡ä¸­è·å–äº†ï¼‰ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/LearnFilter_war/admin/a.jsp</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost:8080</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span> <span class="l">...</span>
</span></span></code></pre></div><p>è‡³æ­¤æˆ‘ä»¬å°±çŸ¥é“äº†ä¸€ä¸ªTomcatæœåŠ¡å™¨å¯ä»¥æœ‰å”¯ä¸€ä¸€ä¸ªå…¬ç½‘IPï¼Œè€Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å¤šä¸ªåŸŸåï¼ˆlocalhost, anotherHostï¼‰æ¥è®¿é—®æœåŠ¡å™¨ï¼ˆåªè¦DNSèƒ½å¤Ÿè§£æåˆ°å¯¹åº”çš„IPåœ°å€å³å¯ï¼‰ï¼Œç„¶åEngineä¼šæ ¹æ®HTTPè¯·æ±‚ä¸­çš„HOSTå¤´å°†è¯·æ±‚åˆ†é…ç»™å¯¹åº”çš„HOSTç»„ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ä¾‹å­ä¸­çš„localhostè¿™ä¸ªHOSTã€‚ <!-- raw HTML omitted --></p>
<h3 id="context">Context</h3>
<p>æˆ‘ä»¬ç»§ç»­å¥—å¨ƒï¼Œä¸€ä¸ªServiceæœ‰å”¯ä¸€ä¸€ä¸ªEngineï¼Œä¸€ä¸ªEngineå†…åµŒä¸€ä¸ªæˆ–è€…å¤šä¸ªHostï¼Œè€Œä¸€ä¸ªHoståˆ™å¯ä»¥å†…åµŒä¸€ä¸ªå¤šä¸ªContextï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿä¸»æœºHOSTä¸‹æ‰€è¿è¡Œçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªWebåº”ç”¨ç¨‹åºï¼ˆåŒæ ·ä¹Ÿæ˜¯å­å®¹å™¨ï¼‰ï¼› <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬çŸ¥é“Hostå…·ä½“çš„è¡¨ç°å½¢å¼å°±æ˜¯HOST Headerï¼Œè€ŒContextçš„å…·ä½“è¡¨ç°å½¢å¼å°±æ˜¯æˆ‘ä»¬åœ¨HTTPè¯·æ±‚ä¸­çš„URIï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å°±æ˜¯ <code>LearnFilter_war</code>; <!-- raw HTML omitted --></p>
<p>è¿™ä¸ªURIå…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨IDEAå¼€å‘çš„æ—¶å€™ï¼Œåˆ›å»ºçš„é¡¹ç›®åï¼Œè®°å¾—æˆ‘ä»¬åœ¨Servletçš„ä»‹ç»ä¸­ï¼Œæ›¾ç»è¯´è¿‡ä¸€ä¸ªwebé¡¹ç›®ï¼Œåªæœ‰ä¸€ä¸ªServletContextå¯¹è±¡å—ï¼Œè®°ä½è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨å°†Wrapperçš„æ—¶å€™è¿˜ä¼šå†æåˆ°ï¼ˆå…¶å®Wrapperå°±æ˜¯æˆ‘ä»¬æ‰€å¼€å‘çš„ä¸€ä¸ªä¸ªServletï¼‰ï¼› <!-- raw HTML omitted --></p>
<p>åœ¨çŸ¥é“äº†è¿™äº›å†…å®¹ä¹‹åï¼Œä½ å¯èƒ½æœ€æƒ³é—®çš„è¿˜æ˜¯ï¼Œä¸ºä»€ä¹ˆæˆ‘æ²¡æœ‰åœ¨server.xmlä¸­çœ‹åˆ°Contextå…ƒç´ å•Šï¼Ÿ <!-- raw HTML omitted --></p>
<p>åŸå› å°±æ˜¯æˆ‘ä»¬åœ¨Hostçš„é…ç½®ä¸­å¼€å¯äº†è‡ªåŠ¨éƒ¨ç½²ï¼ˆautoDeploy=trueï¼‰ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼ŒTomcatä¼šè‡ªåŠ¨åŒ¹é…URIçš„pathä¸ <code>appBase</code> å±æ€§ä¸­çš„ç›®å½•åç§°è¿›è¡ŒåŒ¹é…ï¼Œä¸€æ—¦åŒ¹é…ä¸Šåˆ™é»˜è®¤è¿™ä¸ªç›®å½•å°±æ˜¯è¦ç»§ç»­å¤„ç†è¯·æ±‚çš„Contextï¼Œä¹Ÿå°±ä¸éœ€è¦å†è¿›è¡Œé¢å¤–é…ç½®çš„ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Host</span> <span class="na">name=</span><span class="s">&#34;localhost&#34;</span>  <span class="na">appBase=</span><span class="s">&#34;webapps&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">unpackWARs=</span><span class="s">&#34;true&#34;</span> <span class="na">autoDeploy=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">deployOnstartup=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Host&gt;</span>
</span></span></code></pre></div><blockquote>
<p>å¦‚æœdeployOnStartupå’ŒautoDeployè®¾ç½®ä¸ºtrueï¼Œåˆ™tomcatå¯åŠ¨è‡ªåŠ¨éƒ¨ç½²ï¼š <!-- raw HTML omitted --></p>
<ul>
<li>å½“æ£€æµ‹åˆ°æ–°çš„Webåº”ç”¨æˆ–Webåº”ç”¨çš„æ›´æ–°æ—¶ï¼Œä¼šè§¦å‘åº”ç”¨çš„éƒ¨ç½²(æˆ–é‡æ–°éƒ¨ç½²)ã€‚ <!-- raw HTML omitted --></li>
<li>äºŒè€…çš„ä¸»è¦åŒºåˆ«åœ¨äº: <!-- raw HTML omitted -->
<ul>
<li>deployOnStartupä¸ºtrueæ—¶ï¼ŒTomcatåœ¨å¯åŠ¨æ—¶æ£€æŸ¥Webåº”ç”¨ï¼Œä¸”æ£€æµ‹åˆ°çš„æ‰€æœ‰Webåº”ç”¨è§†ä½œæ–°åº”ç”¨ï¼› <!-- raw HTML omitted --></li>
<li>autoDeployä¸ºtrueæ—¶ï¼ŒTomcatåœ¨è¿è¡Œæ—¶å®šæœŸæ£€æŸ¥æ–°çš„Webåº”ç”¨æˆ–Webåº”ç”¨çš„æ›´æ–°ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒäºŒè€…çš„å¤„ç†ç›¸ä¼¼ã€‚ <!-- raw HTML omitted --></li>
</ul>
</li>
</ul>
</blockquote>
<p>ä¸‹é¢çš„è¿™äº›Webåº”ç”¨éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨localhost:8080/xxxè¿›è¡Œè®¿é—®ï¼š <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-21_11-20-02_screenshot.png"
         alt="Figure 4: webpasç›®å½•ä¸‹çš„Context Webåº”ç”¨" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 4: <!-- raw HTML omitted -->webpasç›®å½•ä¸‹çš„Context Webåº”ç”¨</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®é™æ€Contextå…ƒç´ ï¼Œå…¶ä¸­ <code>path</code> è¡¨ç¤ºURIï¼Œ <code>docBase</code> è¡¨ç¤ºWebåº”ç”¨çš„waræ–‡ä»¶æˆ–è€…ç›®å½•çš„ä½ç½®ï¼Œè€Œ <code>reloadable</code> å±æ€§åˆ™è¡¨ç¤ºå½“classæ–‡ä»¶å‘ç”Ÿæ”¹åŠ¨æ—¶ï¼Œæ˜¯å¦è¦è§¦å‘æ•´ä¸ªWebåº”ç”¨çš„é‡æ–°åŠ è½½ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Context</span> <span class="na">path=</span><span class="s">&#34;/&#34;</span> <span class="na">docBase=</span><span class="s">&#34;other_directory_absolute_path/app1.war&#34;</span> <span class="na">reloadable=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></div><p>ä½†æ˜¯ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨é™æ€é…ç½®ï¼Œå› ä¸º <code>server.xml</code> è¿™ä¸ªæ–‡ä»¶åœ¨ä¿®æ”¹åéœ€è¦é‡æ–°å¯åŠ¨æœåŠ¡å™¨æ‰èƒ½åŠ è½½ï¼Œå› æ­¤ä¸€æ—¦éœ€è¦ä¿®æ”¹Pathçš„ä¿¡æ¯ï¼Œå°±éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œè€Œåœ¨è‡ªåŠ¨éƒ¨ç½²çš„æ—¶å€™Tomcatå°±å¯ä»¥é€šè¿‡å®šæœŸçš„æ‰«æäº†æ£€æŸ¥Webåº”ç”¨çš„è·¯å¾„æ˜¯å¦å‘ç”Ÿäº†ä¿®æ”¹ï¼› <!-- raw HTML omitted --></p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬æƒ³è¦æ ¹æ® <strong>server.xml</strong> æ‰€è·å–çš„ç»„ä»¶å…ƒç´ ä¿¡æ¯å·²ç»å…¨éƒ¨ä»‹ç»å®Œæ¯•ï¼Œä½†æ˜¯Containerä½œä¸ºå¤„ç†HTTPè¯·æ±‚çš„å®¹å™¨ï¼Œè‚¯å®šå’Œæˆ‘ä»¬åœ¨Java Webç¼–ç¨‹ä¸­çš„æ ¸å¿ƒç»„ä»¶Servletæ—¶åˆ†ä¸å¼€çš„ï¼Œè€ŒServletå…¶å®æ˜¯è¢«Containerçš„æœ€åº•å±‚å­ç±»Wrapperæ‰€åŒ…è£¹ä½¿ç”¨ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­ä»‹ç»ã€‚ <!-- raw HTML omitted --></p>
<h3 id="wrapper">Wrapper</h3>
<p>Wrapperæ˜¯Contextçš„å­å®¹å™¨ï¼Œä¹Ÿæ˜¯Tomcatçš„æœ€åº•å±‚å®¹å™¨äº†ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªContextä»£è¡¨ä¸€ä¸ªWebåº”ç”¨ï¼Œé‚£ä¹ˆä¸€ä¸ªWrapperå°±ä»£è¡¨ä¸€ä¸ªWebåº”ç”¨ä¸‹çš„ä¸€ä¸ªä¸ªåŠŸèƒ½ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä»‹ç»è¿‡çš„Servletï¼šä¸€ä¸ªWrapperå°±æ˜¯ä¸€ä¸ªServletçš„å°è£…ã€‚ <!-- raw HTML omitted --></p>
<p>åœ¨æˆ‘ä»¬ä»‹ç»Tomcatä¸‰å¤§ç»„ä»¶ï¼šServletï¼ŒFilterä»¥åŠLisntenerçš„æ—¶å€™æˆ‘ä»¬éƒ½ä»‹ç»äº†è¿™äº›ç»„ä»¶çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬init(), destroy()æ–¹æ³•ï¼Œè€ŒWrapperå°±æ˜¯æ¥ç®¡ç†Servletçš„ç”Ÿå‘½å‘¨æœŸçš„ï¼š <!-- raw HTML omitted --></p>
<blockquote>
<p>voidÂ load() throws ServletException <!-- raw HTML omitted --></p>
<p>Load and initialize an instance of this Servlet, if there is not already at least one initialized instance. This can be used, for example, to load Servlets that are marked in the deployment descriptor to be loaded at server startup time. <!-- raw HTML omitted --></p>
</blockquote>
<p>åœ¨StandardWrapperçš„load()æ–¹æ³•ä¸­ä½¿ç”¨loadServletæ¥åˆå§‹åŒ–ä¸€ä¸ªServletï¼Œæ¥ç€å†ç”¨initServletæ¥åˆå§‹åŒ–è¿™ä¸ªServlet: <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"> <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">this</span><span class="o">.</span><span class="na">instance</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">loadServlet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">instanceInitialized</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">         <span class="k">this</span><span class="o">.</span><span class="na">initServlet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">     <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span> 
</span></span><span class="line"><span class="cl"> <span class="o">}</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å…·ä½“æ¥çœ‹è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š <!-- raw HTML omitted --></p>
<blockquote>
<p>publicÂ ServletÂ loadServlet() throws ServletException <!-- raw HTML omitted --></p>
<p>Load and initialize an instance of this servlet, if there is not already at least one initialized instance. This can be used, for example, to load servlets that are marked in the deployment descriptor to be loaded at server startup time. <!-- raw HTML omitted --></p>
<p>Returns: <!-- raw HTML omitted -->
the loaded Servlet instance <!-- raw HTML omitted --></p>
</blockquote>
<p>StandardWrapperå¯¹è±¡çš„loadServlet()å…ˆæ˜¯è·å–äº†å…¶çˆ¶å®¹å™¨StandardContextæ¥åŠ è½½è¿™ä¸ªServletç±»ï¼Œå†åˆ©ç”¨initServetlet()æ¥è¿›è¡Œåˆå§‹åŒ–ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">synchronized</span> <span class="n">Servlet</span> <span class="nf">loadServlet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span> <span class="o">...</span> 
</span></span><span class="line"><span class="cl">            <span class="n">InstanceManager</span> <span class="n">instanceManager</span> <span class="o">=</span> <span class="o">((</span><span class="n">StandardContext</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">getParent</span><span class="o">()).</span><span class="na">getInstanceManager</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">servlet</span> <span class="o">=</span> <span class="o">(</span><span class="n">Servlet</span><span class="o">)</span><span class="n">instanceManager</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">servletClass</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">initServlet</span><span class="o">(</span><span class="n">servlet</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">fireContainerEvent</span><span class="o">(</span><span class="s">&#34;load&#34;</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">loadTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">t1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">var12</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">servlet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>è€ŒinitServlet(Servlet servlet)åšçš„æœ€é‡è¦çš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯è°ƒç”¨äº†servletçš„init()æ–¹æ³•ï¼Œå¼€å¯äº†å…¶ç”Ÿå‘½å‘¨æœŸï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">initServlet</span><span class="o">(</span><span class="n">Servlet</span> <span class="n">servlet</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">instanceInitialized</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="na">singleThreadModel</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="kt">boolean</span> <span class="n">success</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="k">this</span><span class="o">.</span><span class="na">facade</span><span class="o">};</span>
</span></span><span class="line"><span class="cl">                        <span class="n">SecurityUtil</span><span class="o">.</span><span class="na">doAsPrivilege</span><span class="o">(</span><span class="s">&#34;init&#34;</span><span class="o">,</span> <span class="n">servlet</span><span class="o">,</span> <span class="n">classType</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                        <span class="n">success</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="o">(!</span><span class="n">success</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                            <span class="n">SecurityUtil</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">servlet</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">servlet</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">facade</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">this</span><span class="o">.</span><span class="na">instanceInitialized</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span> 
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>è‡³æ­¤ï¼ŒTomcatæœåŠ¡å™¨ä¹Ÿå°±å’Œæˆ‘ä»¬ä½¿ç”¨Java EEå®šä¹‰å’Œåˆ›å»ºçš„Servletè”ç³»èµ·æ¥äº†ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç»˜åˆ¶å‡ºæ•´ä¸€ä¸ªcontainerçš„å­å®¹å™¨ä¹‹é—´çš„å…³ç³»äº†ï¼š <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/Tomcat_Container.drawio.png"
         alt="Figure 5: Tomcat Containerå­å®¹å™¨ç»“æ„" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 5: <!-- raw HTML omitted -->Tomcat Containerå­å®¹å™¨ç»“æ„</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h2 id="tomcatä¸­çš„ä¸‰ç§contextè¾¨æ">Tomcatä¸­çš„ä¸‰ç§Contextè¾¨æ</h2>
<p>æ—¢ç„¶æˆ‘ä»¬è¯´åˆ°äº†Servletæ˜¯å¦‚ä½•ä¸TomcatæœåŠ¡å™¨ç»“åˆèµ·æ¥ä½¿ç”¨çš„ï¼Œé‚£è‡ªç„¶å½“ç„¶ä¹Ÿå°‘ä¸äº†Filterä»¥åŠListenerï¼Œæˆ‘ä»¬å°±å€Ÿæ­¤æœºä¼šï¼Œæ¥å¥½å¥½è¯´é“è¯´é“Contextï¼› <!-- raw HTML omitted --></p>
<p>å¦‚æœå¤§å®¶äº†è§£è¿‡Servletçš„å¼€å‘ï¼Œé‚£å°±ä¸€å®šçŸ¥é“ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯ServletContextï¼Œè¿™å’ŒTomcatç»„ä»¶ä¸­çš„Contextä¼šä¸ä¼šæœ‰ä»€ä¹ˆè”ç³»å‘¢ï¼Ÿ <!-- raw HTML omitted --></p>
<blockquote>
<p>org.apache.catalina.Context <!-- raw HTML omitted --></p>
<p>org.apache.catalina.core.StandardContext <!-- raw HTML omitted --></p>
<p>jakarta.servlet.ServletContext <!-- raw HTML omitted --></p>
<p>org.apache.catalina.core.ApplicationContext <!-- raw HTML omitted --></p>
<p>org.apache.catalina.core.ApplicationContextFacade <!-- raw HTML omitted --></p>
</blockquote>
<p>ä¸Šé¢æˆ‘ä»¬ä¸€å…±æåˆ°äº†5ä¸­Contextï¼Œæˆ‘ä»¬ä¾æ¬¡å…ˆæ¥ç®€å•è®¤è¯†ä¸€ä¸‹ï¼Œä¹‹åå†å±•å¼€è®²ä»–ä»¬çš„å…·ä½“å…³ç³»ï¼š <!-- raw HTML omitted --></p>
<ol>
<li>org.apache.catalina.Contextæ¥å£ï¼š <!-- raw HTML omitted -->
<ul>
<li>å®šä¹‰äº†Tomcatä¸­çš„Contextå®¹å™¨ï¼Œå…¶çˆ¶å®¹å™¨ä¸ºHostï¼Œå…¶å­å®¹å™¨ä¸ºWrapperï¼› <!-- raw HTML omitted --></li>
<li>ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªWebåº”ç”¨ <!-- raw HTML omitted --></li>
</ul>
</li>
<li>org.apache.catalina.core.StandardContextç±»ï¼š <!-- raw HTML omitted -->
<ul>
<li>æ˜¯org.apache.catalina.Contextæ¥å£çš„æ ‡å‡†å®ç° <!-- raw HTML omitted --></li>
<li>ä¹‹åæ–¹ä¾¿è¾¨è®¤ï¼Œæˆ‘ä»¬ç»Ÿä¸€ç”¨StandardContextæ¥è¡¨ç¤ºContextæ¥å£ä»¥åŠå®ç°ç±» <!-- raw HTML omitted --></li>
</ul>
</li>
<li>jakarta.servlet.ServletContextæ¥å£ <!-- raw HTML omitted -->
<ul>
<li>å®šä¹‰äº†ä¸€ç³»åˆ—servletå¯ä»¥ç”¨æ¥ä¸servletå®¹å™¨é€šä¿¡çš„æ–¹æ³•ï¼› <!-- raw HTML omitted --></li>
<li>æ¯ä¸€ä¸ªJVMä¸­çš„æ¯ä¸€ä¸ªwebåº”ç”¨éƒ½æœ‰å”¯ä¸€ä¸€ä¸ªServletContextï¼ˆwebåº”ç”¨ç›´è§‚çš„æ¥è¯´å°±æ˜¯è¡¨ç¤ºè®¿é—®æœåŠ¡å™¨æ‰€ç”¨çš„URLä¸­æ‰€è·Ÿç€çš„URIä¾‹å¦‚/catalogï¼Œå¹¶ä¸”æ•´ä¸ªåº”ç”¨å¯èƒ½å°±æ˜¯ä¸€ä¸ª <strong>.war</strong> æ–‡ä»¶ï¼‰ï¼› <!-- raw HTML omitted --></li>
<li>ç»†å¿ƒçš„å¸ˆå‚…åº”è¯¥å‘ç°äº†è¿™ä¸ªæ¥å£æ˜¯åœ¨JAVA EEçš„åŒ…é‡Œå®šä¹‰äº†ï¼Œå’Œå…¶ä»–åœ¨org.apache.catalinaä¸­å®šä¹‰çš„ä¸åŒï¼Œè¿™æ˜¯Java EEå…ˆæä¾›çš„æ¥å£ï¼Œæ¥å¸®åŠ©webåº”ç”¨ä¸­çš„Servletå­˜å‚¨æ•°æ®ï¼Œè¿›è¡Œé€šä¿¡ï¼› <!-- raw HTML omitted --></li>
</ul>
</li>
<li>org.apache.catalina.core.ApplicationContextç±»ï¼š <!-- raw HTML omitted -->
<ul>
<li>è¿™ä¸ªç±»å°±æ˜¯Tomcatå¯¹äºServletContextçš„å…·ä½“å®ç°ï¼› <!-- raw HTML omitted --></li>
</ul>
</li>
<li>org.apache.catalina.core.ApplicationContextFacadeç±»ï¼š <!-- raw HTML omitted -->
<ul>
<li>è¿™ä¸ªç±»æ˜¯ApplicationContextçš„ä¸€ä¸ªé—¨é¢ç±»ï¼Œå¯ä»¥ç†è§£ä¸ºè®²ApplicationContextçš„å±æ€§å’Œæ–¹æ³•å°è£…åœ¨è¿™ä¸ªFacadeé—¨é¢ç±»é‡Œé¢ï¼Œå¯¹å¤–å°±è°ƒç”¨Facadeä¸­çš„æ–¹æ³•å°±å¯ä»¥äº†ï¼ˆå…·ä½“å¯ä»¥å‚è€ƒï¼š<a class="link" href="https://www.runoob.com/w3cnote/facade-pattern-3.html"  target="_blank" rel="noopener"
    >JAVAè®¾è®¡æ¨¡å¼ä¹‹é—¨é¢æ¨¡å¼ï¼ˆå¤–è§‚æ¨¡å¼ï¼‰</a>ï¼‰ <!-- raw HTML omitted --></li>
</ul>
</li>
</ol>
<p>è¿™æ ·è®²å…¶å®è¿˜æŒºå‰²è£‚çš„ï¼Œå¥½åƒä¸¤ä¸ªå®ç°ç±»StandardContextä»¥åŠApplicationContextæ²¡æœ‰ä»€ä¹ˆç›´æ¥çš„è”ç³»ï¼Œä½†æ˜¯äº‹å®ä¸Šä»–ä»¬å´æœ‰ç€åƒä¸ä¸‡ç¼•çš„è”ç³»ï¼š <!-- raw HTML omitted --></p>
<p>StandardContextä¸­å°±æœ‰ä¸€ä¸ª <strong>getServletContext()</strong> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œå…¶ä¸­ç”Ÿæˆçš„å°±æ˜¯ServletContextçš„å®ç°ç±» <strong>ApplicationContext</strong>, åŒæ—¶è¿”å›å€¼å°±æ˜¯ApplicationContextçš„é—¨é¢ç±»çš„å¯¹è±¡ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StandardContext</span> <span class="kd">extends</span> <span class="n">ContainerBase</span> <span class="kd">implements</span> <span class="n">Context</span><span class="o">,</span> <span class="n">NotificationEmitter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ServletContext</span> <span class="nf">getServletContext</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationContext</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">altDDName</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">this</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;org.apache.catalina.deploy.alt_dd&#34;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">altDDName</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">getFacade</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„ä»£ç è¿˜æœ‰å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹ï¼Œå°±æ˜¯ApplicationContextçš„æ„é€ å™¨ä½¿ç”¨äº†StandardContextçš„å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥ç€å»çœ‹çœ‹ApplicationContextçš„æºç ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContext</span> <span class="kd">implements</span> <span class="n">ServletContext</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ApplicationContext</span><span class="o">(</span><span class="n">StandardContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">service</span> <span class="o">=</span> <span class="o">((</span><span class="n">Engine</span><span class="o">)</span><span class="n">context</span><span class="o">.</span><span class="na">getParent</span><span class="o">().</span><span class="na">getParent</span><span class="o">()).</span><span class="na">getService</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">sessionCookieConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationSessionCookieConfig</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">populateSessionTrackingModes</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å‘ç°åœ¨ApplicationContextä¸­ï¼Œ <code>this.context</code> ç«Ÿç„¶æ˜¯StandardContextçš„å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥ç€æŸ¥æ‰¾ <code>this.context</code> çš„ä½¿ç”¨æƒ…å†µï¼Œå‘ç°äº†æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„æ–¹æ³•ä¸­éƒ½åœ¨ä½¿ç”¨äº†è¿™ä¸ª <strong>StandardContext</strong> çš„å¯¹è±¡ï¼š <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-21_15-32-52_screenshot.png"
         alt="Figure 6: this.contextåœ¨ApplicationContextä¸­çš„ä½¿ç”¨æƒ…å†µ" width="200px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 6: <!-- raw HTML omitted -->this.contextåœ¨ApplicationContextä¸­çš„ä½¿ç”¨æƒ…å†µ</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-21_15-42-46_screenshot.png"
         alt="Figure 7: 76å¤„ä½¿ç”¨context" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 7: <!-- raw HTML omitted -->76å¤„ä½¿ç”¨context</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-21_15-42-59_screenshot.png"
         alt="Figure 8: 47å¤„è°ƒç”¨äº†StandardContextçš„getæ–¹æ³•" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 8: <!-- raw HTML omitted -->47å¤„è°ƒç”¨äº†StandardContextçš„getæ–¹æ³•</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/2022-10-21_15-44-20_screenshot.png"
         alt="Figure 9: è°ƒç”¨StandardContextçš„äº‹ä»¶è§¦å‘æ–¹æ³•" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 9: <!-- raw HTML omitted -->è°ƒç”¨StandardContextçš„äº‹ä»¶è§¦å‘æ–¹æ³•</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬éšçº¦å¯ä»¥æ„Ÿè§‰åˆ°ServletContextå°±åƒæ˜¯StandaardContextä¸‹å±çš„ä¸€ä¸ªéƒ¨é—¨ï¼Œè´Ÿè´£ç®¡ç†Servletçš„ä¸€äº›äº‹åŠ¡ï¼Œä½†æ˜¯éƒ½è¦å‘StandardContextè¿›è¡Œæ±‡æŠ¥ä»¥åŠè·å–ç‰©èµ„çš„æ„Ÿè§‰ã€‚ <!-- raw HTML omitted --></p>
<h2 id="tomcatå¦‚ä½•å¯åŠ¨ä¸‰å¤§ç»„ä»¶">Tomcatå¦‚ä½•å¯åŠ¨ä¸‰å¤§ç»„ä»¶</h2>
<p>æ¥ç€æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹StandardContextæ˜¯å¯åŠ¨Tomcatçš„ä¸‰å¤§ç»„ä»¶ï¼Œå€Ÿæ­¤è¿›ä¸€æ­¥äº†è§£Tomcatæ‰€å®šä¹‰çš„Contextä¸Java EEè‡ªå¸¦çš„è¿™ä¸‰å¤§ç»„ä»¶æ˜¯å¦‚ä½•åè°ƒå·¥ä½œçš„ï¼š <!-- raw HTML omitted --></p>
<h3 id="contextconfig-configurecontext-ä¸-standardcontext-startinternal">ContextConfig#configureContext() ä¸ StandardContext#startInternal()</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦é—®ç¬¬ä¸€ä¸ªé—®é¢˜: <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">StandardContextæ˜¯æ€ä¹ˆçŸ¥é“åº”è¯¥åŠ è½½å“ªäº›Servlet, Filterä»¥åŠListenerçš„ï¼Ÿ
</span></span></code></pre></div><p>ç­”æ¡ˆå…¶å®å¾ˆå®¹æ˜“å°±å¯ä»¥çŒœåˆ°ï¼Œå°±æ˜¯ä»web.xmlæˆ–è€…annotationä¸­è¯»å–ï¼š <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬çœ‹åˆ°ä¸‹é¢çš„è¿™ä¸ª <code>configureContext()</code> æ–¹æ³•ä¸­ï¼Œé€šè¿‡è·å–ä¸€ä¸ªwebxmlå¯¹è±¡ï¼Œç„¶åä»ä¸­åˆ†åˆ«è¯»å–äº†è¿™ä¸‰å¤§ç»„ä»¶çš„ç›¸å…³é…ç½®å†…å®¹ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">configureContext</span><span class="o">(</span><span class="n">WebXml</span> <span class="n">webxml</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getContextParams</span><span class="o">().</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åŠ è½½Filterçš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">FilterDef</span> <span class="n">filter</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getFilters</span><span class="o">().</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">filter</span><span class="o">.</span><span class="na">getAsyncSupported</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">filter</span><span class="o">.</span><span class="na">setAsyncSupported</span><span class="o">(</span><span class="s">&#34;false&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addFilterDef</span><span class="o">(</span><span class="n">filter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">FilterMap</span> <span class="n">filterMap</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getFilterMappings</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addFilterMap</span><span class="o">(</span><span class="n">filterMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åŠ è½½Listnerçš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">listener</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getListeners</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addApplicationListener</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åŠ è½½Servletçš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">ServletDef</span> <span class="n">servlet</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getServlets</span><span class="o">().</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Wrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">createWrapper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getLoadOnStartup</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">wrapper</span><span class="o">.</span><span class="na">setLoadOnStartup</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getLoadOnStartup</span><span class="o">().</span><span class="na">intValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getEnabled</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">wrapper</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getEnabled</span><span class="o">().</span><span class="na">booleanValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrapper</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getServletName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">servlet</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">params</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">wrapper</span><span class="o">.</span><span class="na">addInitParameter</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrapper</span><span class="o">.</span><span class="na">setRunAs</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getRunAs</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">Set</span><span class="o">&lt;</span><span class="n">SecurityRoleRef</span><span class="o">&gt;</span> <span class="n">roleRefs</span> <span class="o">=</span> <span class="n">servlet</span><span class="o">.</span><span class="na">getSecurityRoleRefs</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">SecurityRoleRef</span> <span class="n">roleRef</span> <span class="o">:</span> <span class="n">roleRefs</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">wrapper</span><span class="o">.</span><span class="na">addSecurityReference</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">roleRef</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">roleRef</span><span class="o">.</span><span class="na">getLink</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrapper</span><span class="o">.</span><span class="na">setServletClass</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getServletClass</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrapper</span><span class="o">.</span><span class="na">setOverridable</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">isOverridable</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">wrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">webxml</span><span class="o">.</span><span class="na">getServletMappings</span><span class="o">().</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addServletMappingDecoded</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åŠ è½½é…ç½®å®Œæ¯•ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬åœ¨ä»‹ç»Filterä»¥åŠListenerä¸­çš„æ–‡ç« ä¸­æ›¾ç»ä»‹ç»è¿‡ï¼ŒStandardContexté€šè¿‡ <code>startInternal()</code> è¿™ä¸ªæ–¹æ³•æ¥ä¾æ¬¡å¯åŠ¨åŠ è½½ <strong>Listener</strong>, <strong>Filter</strong> ä»¥åŠ <strong>Servlet</strong>: <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">startInternal</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">LifecycleException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 1. ListenerStart(), å¯åŠ¨åŠ è½½Listener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">ok</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">listenerStart</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardContext.listenerFail&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="n">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// 2. filterStart(), å¯åŠ¨åŠ è½½Filter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">ok</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">filterStart</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardContext.filterFail&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="n">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 3. loadOnStartup(), å¯åŠ¨åŠ è½½Servlet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">ok</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">loadOnStartup</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">findChildren</span><span class="o">()))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardContext.servletFail&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="n">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="kd">super</span><span class="o">.</span><span class="na">threadStart</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥é’ˆå¯¹æ¯ä¸€ä¸ªç»„ä»¶æ¥çœ‹StandardContextæ˜¯å¦‚ä½•è¯»å–é…ç½®ï¼Œå¦‚ä½•åˆå§‹åŒ–å’ŒåŠ è½½å¯¹è±¡çš„ï¼š <!-- raw HTML omitted --></p>
<h3 id="listener">Listener</h3>
<h4 id="åŠ è½½listeneré…ç½®">åŠ è½½Listeneré…ç½®</h4>
<p>é€šè¿‡ContextConfig.configureContextä» <strong>web.xml</strong> ä¸­å‘StandardContextåŠ è½½listeneré…ç½®ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">configureContext</span><span class="o">(</span><span class="n">WebXml</span> <span class="n">webxml</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åŠ è½½Listnerçš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">listener</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getListeners</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addApplicationListener</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼ŒStandardContext.addApplicationListener() æ–¹æ³•æ¥å°†Listenerçš„ç±»ååˆ°StandardContextä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ <strong>applicationListeners</strong> ä¸­ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">String</span> <span class="n">applicationListeners</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">0</span><span class="o">];</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">addApplicationListener</span><span class="o">(</span><span class="n">String</span> <span class="n">listener</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">applicationListenersLock</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">results</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">applicationListeners</span><span class="o">.</span><span class="na">length</span> <span class="o">+</span> <span class="n">1</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">applicationListeners</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">listener</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">applicationListeners</span><span class="o">[</span><span class="n">i</span><span class="o">]))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardContext.duplicateListener&#34;</span><span class="o">,</span><span class="n">listener</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">results</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">applicationListeners</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="o">[</span><span class="n">applicationListeners</span><span class="o">.</span><span class="na">length</span><span class="o">]</span> <span class="o">=</span> <span class="n">listener</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">applicationListeners</span> <span class="o">=</span> <span class="n">results</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">fireContainerEvent</span><span class="o">(</span><span class="s">&#34;addApplicationListener&#34;</span><span class="o">,</span> <span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="åˆå§‹åŒ–å’ŒåŠ è½½listener">åˆå§‹åŒ–å’ŒåŠ è½½Listener</h4>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹åœ¨StandardContext.startInternal()ä¸­æ˜¯å¦‚ä½•åˆå§‹åŒ–Listenerçš„ï¼š <!-- raw HTML omitted --></p>
<p>listenerStart()æ˜¯ç”¨æ¥å°†æ‰€æœ‰æˆ‘ä»¬åœ¨Webå·¥ç¨‹ä¸­æ‰€å®šä¹‰çš„Listenersè¿›è¡Œåˆå§‹åŒ–çš„æ–¹æ³•ï¼Œå®ƒå…ˆæ˜¯ä»StandardContextçš„privateå±æ€§applicationListenersè¿™æ ·ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ä¸­æ‹¿åˆ°æ‰€æœ‰éœ€è¦åŠ è½½çš„Listenersçš„åå­—ï¼Œæ¥ç€ç”¨ <strong>this.getInstanceManager().newInstance(listener)</strong> çš„å½¢å¼æ¥è¿›è¡ŒåŠ è½½ã€‚ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Configure the set of instantiated application event listeners
</span></span></span><span class="line"><span class="cl"><span class="cm">     * for this Context.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return &lt;code&gt;true&lt;/code&gt; if all listeners wre
</span></span></span><span class="line"><span class="cl"><span class="cm">     * initialized successfully, or &lt;code&gt;false&lt;/code&gt; otherwise.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">applicationListeners</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">0</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">listenerStart</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">String</span><span class="o">[]</span> <span class="n">listeners</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">findApplicationListeners</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span><span class="o">[]</span> <span class="n">results</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">listeners</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">results</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span> <span class="o">...</span> 
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">listener</span> <span class="o">=</span> <span class="n">listeners</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">                <span class="n">results</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getInstanceManager</span><span class="o">().</span><span class="na">newInstance</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">...</span> <span class="o">...</span>        
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬æœ€åæ¥çœ‹è¿™ä¸ª <code>newInstance()</code> æ˜¯å¦‚ä½•æ¥åŠ è½½listenerçš„ï¼Œå¦‚æœçœ‹è¿‡æˆ‘ä»¬æœ‰å…³Javaåå°„çš„æ–‡ç« æˆ–è€…äº†è§£åå°„çš„å¸ˆå‚…åº”è¯¥å¾ˆå¿«å°±èƒ½ååº”è¿‡æ¥ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯é€šè¿‡Javaåå°„æœºåˆ¶æ¥æ ¹æ®Listenerçš„ç±»åæ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„Listenerå¯¹è±¡ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">newInstance</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">className</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ClassLoader</span> <span class="n">classLoader</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">throws</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">NamingException</span><span class="o">,</span> <span class="n">InvocationTargetException</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">InstantiationException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">IllegalArgumentException</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">NoSuchMethodException</span><span class="o">,</span> <span class="n">SecurityException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">classLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="n">className</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">newInstance</span><span class="o">(</span><span class="n">clazz</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">().</span><span class="na">newInstance</span><span class="o">(),</span> <span class="n">clazz</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>å…¶å®é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç†è§£åˆ°ä½¿ç”¨åå°„çš„å¦™å¤„äº†ï¼Œå°±æ˜¯æ— è®ºä½ åˆ›å»ºçš„Listenerå«ä»€ä¹ˆåå­—ï¼Œåªè¦ä½ å¾€é…ç½®é‡Œå†™å¥½ï¼Œå°±å¯ä»¥è‡ªåŠ¨è¿›è¡ŒåŠ è½½ä»¥åŠåˆ©ç”¨ï¼› <!-- raw HTML omitted --></p>
<p>åŒæ—¶ï¼Œå¦‚æœä½ ä¿®æ”¹äº†è¿™ä¸ªç±»çš„åå­—ï¼Œé‚£ä¹Ÿåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶é‡Œä¿®æ”¹ä¸€ä¸‹å°±å¥½äº†ï¼Œä¸éœ€è¦å»ä¸€ä¸ªä¸ªæ”¹æºç ã€‚ <!-- raw HTML omitted --></p>
<h3 id="filter">Filter</h3>
<h4 id="åŠ è½½filterç›¸å…³é…ç½®">åŠ è½½Filterç›¸å…³é…ç½®</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">configureContext</span><span class="o">(</span><span class="n">WebXml</span> <span class="n">webxml</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åŠ è½½Filterçš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">FilterDef</span> <span class="n">filter</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getFilters</span><span class="o">().</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">filter</span><span class="o">.</span><span class="na">getAsyncSupported</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">filter</span><span class="o">.</span><span class="na">setAsyncSupported</span><span class="o">(</span><span class="s">&#34;false&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addFilterDef</span><span class="o">(</span><span class="n">filter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">FilterMap</span> <span class="n">filterMap</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getFilterMappings</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addFilterMap</span><span class="o">(</span><span class="n">filterMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <strong>configureContext()</strong> åœ¨å¯¹filterè¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œæ·»åŠ äº†ä¸¤ä¸ªå†…å®¹ï¼šFilterDefä»¥åŠFilterMapï¼Œè¿™ä¹Ÿå°±å¯¹åº”äº†æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­æ³¨å†Œä¸€ä¸ªfilteréœ€è¦åœ¨ <strong>web.xml</strong> ä¸­å®Œæˆçš„é…ç½®ï¼š&lt;filter&gt;ä»¥åŠ&lt;filter-mapping&gt; <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;filter&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;filter-name&gt;</span>HelloFilter<span class="nt">&lt;/filter-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;filter-class&gt;</span>pers.javasec.javafilter.HelloFilter<span class="nt">&lt;/filter-class&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/filter&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;filter-mapping&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;filter-name&gt;</span>HelloFilter<span class="nt">&lt;/filter-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;url-pattern&gt;</span>/admin/*<span class="nt">&lt;/url-pattern&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/filter-mapping&gt;</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å¯ä»¥æ ¹æ®StandardContextä¸­ä¸¤ä¸ªå…·ä½“çš„addæ–¹æ³•çœ‹åˆ°ï¼Œä»–ä»¬éƒ½æ˜¯å°†å¾—åˆ°é…ç½®ä¿¡æ¯åˆ†åˆ«å­˜å…¥HashMapå½“ä¸­ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Add a filter definition to this Context.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param filterDef The filter definition to be added
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addFilterDef</span><span class="o">(</span><span class="n">FilterDef</span> <span class="n">filterDef</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">filterDefs</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">filterDefs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">filterDef</span><span class="o">.</span><span class="na">getFilterName</span><span class="o">(),</span> <span class="n">filterDef</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p><figure><img src="/ox-hugo/2022-10-24_17-37-29_screenshot.png"
         alt="Figure 10: å•ä¸ªFilterDefä¸­æ‰€å­˜æ”¾çš„ä¿¡æ¯ï¼š" width="400px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 10: <!-- raw HTML omitted -->å•ä¸ªFilterDefä¸­æ‰€å­˜æ”¾çš„ä¿¡æ¯ï¼š</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Add a filter mapping to this Context at the end of the current set
</span></span></span><span class="line"><span class="cl"><span class="cm">     * of filter mappings.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param filterMap The filter mapping to be added
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @exception IllegalArgumentException if the specified filter name
</span></span></span><span class="line"><span class="cl"><span class="cm">     *  does not match an existing filter definition, or the filter mapping
</span></span></span><span class="line"><span class="cl"><span class="cm">     *  is malformed
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addFilterMap</span><span class="o">(</span><span class="n">FilterMap</span> <span class="n">filterMap</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">validateFilterMap</span><span class="o">(</span><span class="n">filterMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Add this filter mapping to our registered set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">filterMaps</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">filterMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fireContainerEvent</span><span class="o">(</span><span class="s">&#34;addFilterMap&#34;</span><span class="o">,</span> <span class="n">filterMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p><figure><img src="/ox-hugo/2022-10-24_17-42-01_screenshot.png"
         alt="Figure 11: å•ä¸ªFilterMapä¸­å­˜æ”¾çš„å†…å®¹" width="400px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 11: <!-- raw HTML omitted -->å•ä¸ªFilterMapä¸­å­˜æ”¾çš„å†…å®¹</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h4 id="åˆå§‹åŒ–å’ŒåŠ è½½filter">åˆå§‹åŒ–å’ŒåŠ è½½Filter</h4>
<p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„filteré…ç½®åŠ è½½ä¸­çœ‹åˆ°äº†StandardContextä¼šå­˜æ”¾æ¯ä¸€ä¸ªfilterçš„åŸºæœ¬ä¿¡æ¯åœ¨ <strong>filterDefs</strong> ä¸­ã€‚ <!-- raw HTML omitted --></p>
<p>é‚£ä¹ˆåœ¨æ¥ç€æ¥çœ‹StandardContextåœ¨åˆå§‹åŒ–å’ŒåŠ è½½Filterçš„è¿‡ç¨‹ä¸­ï¼Œå°±æ˜¯é€šè¿‡è¯»å– <code>filterDefs</code> ä¸­çš„filterä¿¡æ¯ï¼Œæ¥ç€ä¸ºæ¯ä¸€ä¸ªfilteréƒ½åˆ›å»ºä¸€ä¸ªfilterconfigå¯¹è±¡ï¼Œå¹¶å­˜å…¥hashmap <code>filterConfigs</code> ä¸­ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * The set of filter configurations (and associated filter instances) we
</span></span></span><span class="line"><span class="cl"><span class="cm"> * have initialized, keyed by filter name.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ApplicationFilterConfig</span><span class="o">&gt;</span> <span class="n">filterConfigs</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * The set of filter definitions for this application, keyed by
</span></span></span><span class="line"><span class="cl"><span class="cm"> * filter name.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">FilterDef</span><span class="o">&gt;</span> <span class="n">filterDefs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span></code></pre></div><p>filterStart(): <!-- raw HTML omitted --></p>
<ul>
<li>å¯¹äºæ¯ä¸€ä¸ªä¿å­˜çš„FilterDefå¯¹è±¡éƒ½åˆ›å»ºä¸€ä¸ªFilterConfigæ¥è¿›è¡Œå°è£…ä¿å­˜ï¼› <!-- raw HTML omitted -->
<ul>
<li>ç›®çš„æ˜¯ä¸ºäº†åœ¨ä¹‹åå¿«é€Ÿåˆ›å»ºå®ä¾‹ï¼› <!-- raw HTML omitted --></li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filterStart</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Instantiate and record a FilterConfig for each defined filter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">filterConfigs</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">filterConfigs</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">FilterDef</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">filterDefs</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">getLogger</span><span class="o">().</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">getLogger</span><span class="o">().</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34; Starting filter &#39;&#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// ä¸ºæ¯ä¸€ä¸ªfilterDeféƒ½åˆ›å»ºä¸€ä¸ªfilterConfig
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                        <span class="k">new</span> <span class="n">ApplicationFilterConfig</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// å°†åˆ›å»ºçš„filterConfigå­˜å…¥filterConfigsä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">filterConfigs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">filterConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">t</span> <span class="o">=</span> <span class="n">ExceptionUtils</span><span class="o">.</span><span class="na">unwrapInvocationTargetException</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ExceptionUtils</span><span class="o">.</span><span class="na">handleThrowable</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">getLogger</span><span class="o">().</span><span class="na">error</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#34;standardContext.filterStart&#34;</span><span class="o">,</span> <span class="n">name</span><span class="o">),</span> <span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ok</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><figure><img src="/ox-hugo/2022-10-24_17-43-51_screenshot.png"
         alt="Figure 12: å•ä¸ªfilterConfigå­˜æ”¾çš„å†…å®¹" width="400px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 12: <!-- raw HTML omitted -->å•ä¸ªfilterConfigå­˜æ”¾çš„å†…å®¹</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h3 id="servlet">Servlet</h3>
<h4 id="åŠ è½½servletç›¸å…³é…ç½®">åŠ è½½Servletç›¸å…³é…ç½®</h4>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹Servletï¼Œå¤„ç†çš„è¯­å¥æ˜æ˜¾å˜å¤šäº†ï¼› <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;servlet&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet-name&gt;</span>MyServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet-class&gt;</span>pers.medic.jsplearn.MyServlet<span class="nt">&lt;/servlet-class&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;init-param&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;param-name&gt;</span>username<span class="nt">&lt;/param-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;param-value&gt;</span>root<span class="nt">&lt;/param-value&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/init-param&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/servlet&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;servlet-mapping&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet-name&gt;</span>MyServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;url-pattern&gt;</span>/my<span class="nt">&lt;/url-pattern&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/servlet-mapping&gt;</span>
</span></span></code></pre></div><p>å¯¹äºæ‰€æœ‰Servletçš„é…ç½®ï¼ŒconfigureContextéƒ½ä¼šä¸ºå…¶å•ç‹¬å»ºç«‹ä¸€ä¸ªWrapperæ¥è¿›è¡Œå°è£…ï¼› <!-- raw HTML omitted --></p>
<p>å¹¶ä¸”è¿™äº›Wrapperä¼šè¢«å½“ä½œå­å®¹å™¨é€šè¿‡ <code>addChild()</code> è¢«åµŒå…¥ <strong>StandardContext</strong> å½“ä¸­ï¼› <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">configureContext</span><span class="o">(</span><span class="n">WebXml</span> <span class="n">webxml</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åŠ è½½Servletçš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">ServletDef</span> <span class="n">servlet</span> <span class="o">:</span> <span class="n">webxml</span><span class="o">.</span><span class="na">getServlets</span><span class="o">().</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å°†æ¯ä¸€ä¸ª&lt;servlet&gt;é…ç½®éƒ½å°è£…åˆ°Wrapperä¸­å»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Wrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">createWrapper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrapper</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getServletName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// å°†å½“å‰&lt;servlet&gt;ä¸‹çš„æ‰€æœ‰å­˜å‚¨çš„paramså˜é‡ä¿¡æ¯è¿›è¡ŒåŠ è½½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">servlet</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">params</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">wrapper</span><span class="o">.</span><span class="na">addInitParameter</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrapper</span><span class="o">.</span><span class="na">setRunAs</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getRunAs</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">wrapper</span><span class="o">.</span><span class="na">setServletClass</span><span class="o">(</span><span class="n">servlet</span><span class="o">.</span><span class="na">getServletClass</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">wrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¢åŠ &lt;servlet-mapping&gt;ä¸­çš„ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">webxml</span><span class="o">.</span><span class="na">getServletMappings</span><span class="o">().</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="o">.</span><span class="na">addServletMappingDecoded</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="åˆå§‹åŒ–å’ŒåŠ è½½servlet">åˆå§‹åŒ–å’ŒåŠ è½½Servlet</h4>
<p>loadOnStartupæ˜¯StandardContextä¸­ç”¨æ¥å¯åŠ¨æ‰€æœ‰æ³¨å†Œçš„Servletï¼ˆWrapperï¼‰çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸‹åŠéƒ¨åˆ†çš„forå¾ªç¯ä¸­ï¼Œå¯ä»¥çœ‹åˆ° <strong>wrapper.load()</strong> å°±æ˜¯ç”¨æ¥å¯åŠ¨Wrapperçš„ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Load and initialize all servlets marked &#34;load on startup&#34; in the
</span></span></span><span class="line"><span class="cl"><span class="cm"> * web application deployment descriptor.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param children Array of wrappers for all currently defined
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  servlets (including those not declared load on startup)
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @return &lt;code&gt;true&lt;/code&gt; if load on startup was considered successful
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">loadOnStartup</span><span class="o">(</span><span class="n">Container</span> <span class="n">children</span><span class="o">[])</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Collect &#34;load on startup&#34; servlets that need to be initialized
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Wrapper</span><span class="o">&gt;&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">Container</span> <span class="n">child</span> <span class="o">:</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Wrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="o">(</span><span class="n">Wrapper</span><span class="o">)</span> <span class="n">child</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">loadOnStartup</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">getLoadOnStartup</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">loadOnStartup</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">loadOnStartup</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Wrapper</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">list</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">wrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Load the collected &#34;load on startup&#34; servlets
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Wrapper</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Wrapper</span> <span class="n">wrapper</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">wrapper</span><span class="o">.</span><span class="na">load</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ServletException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">getLogger</span><span class="o">().</span><span class="na">error</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;standardContext.loadOnStartup.loadException&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">getName</span><span class="o">(),</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">getName</span><span class="o">()),</span> <span class="n">StandardWrapper</span><span class="o">.</span><span class="na">getRootCause</span><span class="o">(</span><span class="n">e</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// NOTE: load errors (including a servlet that throws
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// UnavailableException from the init() method) are NOT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// fatal to application startup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// unless failCtxIfServletStartFails=&#34;true&#34; is specified
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span><span class="o">(</span><span class="n">getComputedFailCtxIfServletStartFails</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å†å‡‘è¿‘ç‚¹çœ‹çœ‹è¿™ä¸ª <strong>wrapper.load()</strong> æ–¹æ³•ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">instance</span> <span class="o">=</span> <span class="n">loadServlet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">instanceInitialized</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">initServlet</span><span class="o">(</span><span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡è°ƒç”¨initServlet()æ–¹æ³•è¿›è€Œæœ€ç»ˆè°ƒç”¨ <code>servlet.init()</code> æ¥æœ€ç»ˆå¼€å¯servletçš„ç”Ÿå‘½å‘¨æœŸ <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">initServlet</span><span class="o">(</span><span class="n">Servlet</span> <span class="n">servlet</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Call the initialization method of this servlet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="o">(</span> <span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="kt">boolean</span> <span class="n">success</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">facade</span> <span class="o">};</span>
</span></span><span class="line"><span class="cl">                    <span class="n">SecurityUtil</span><span class="o">.</span><span class="na">doAsPrivilege</span><span class="o">(</span><span class="s">&#34;init&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                               <span class="n">servlet</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                               <span class="n">classType</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                               <span class="n">args</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">success</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="o">(!</span><span class="n">success</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// destroy() will not be called, thus clear the reference now
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="n">SecurityUtil</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">servlet</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// å¼€å¯servletçš„ç”Ÿå‘½å‘¨æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">servlet</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">facade</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">instanceInitialized</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><h3 id="å°ç»“">å°ç»“</h3>
<p>é€šè¿‡ä¸Šé¢å¯¹äºJava EEä¸­çš„ä¸‰å¤§ç»„ä»¶ä¸Tomcatä¹‹é—´çš„è”ç³»ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥çš„äº†è§£Tomcatæ˜¯å¦‚ä½•é€šè¿‡web.xmlæ¥è¯»å–ç”±å¼€å‘è€…å®šä¹‰çš„Servlet, Listenerä»¥åŠFilterçš„ï¼Œè¯»å–ä¹‹åä¼šä»¥å„ç§å½¢å¼è¢«ä¿å­˜åœ¨ StandardContext å®ä¾‹å½“ä¸­ï¼Œåœ¨ StandardContext å¯åŠ¨çš„æ—¶å€™å°±ä¼šå†è¢«æ‹¿å‡ºæ¥è¿›è¡Œåˆå§‹åŒ–å’ŒåŠ è½½ã€‚ <!-- raw HTML omitted --></p>
<p><figure><img src="/ox-hugo/Tomcat_and_Servlet.drawio.png"
         alt="Figure 13: Tomcatä¸ä¸‰å¤§ç»„ä»¶çš„å…³ç³»" width="500px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 13: <!-- raw HTML omitted -->Tomcatä¸ä¸‰å¤§ç»„ä»¶çš„å…³ç³»</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h2 id="tomcatå’Œservletå¤„ç†httpè¯·æ±‚">Tomcatå’ŒServletå¤„ç†HTTPè¯·æ±‚</h2>
<h3 id="pipeline-valveè´£ä»»é“¾">Pipeline-Valveè´£ä»»é“¾</h3>
<p>ç›®å‰æˆ‘ä»¬å·²ç»äº†è§£äº†Containerä¸­æ‰€æœ‰å­å®¹å™¨çš„ä½œç”¨ä»¥åŠç»“æ„ï¼Œä¹Ÿé€šè¿‡ä»£ç æ¥å­¦ä¹ äº†Tomcatä¸Java Webä¸‰å¤§ç»„ä»¶æ˜¯å¦‚ä½•å…±åŒä½¿ç”¨çš„äº†ï¼› <!-- raw HTML omitted --></p>
<p>æœ€åå°±è®©æˆ‘ä»¬å†ä¸€æ¬¡æ·±å…¥ä»£ç ï¼Œçœ‹çœ‹Tomcatçš„Containerå®¹å™¨å’ŒJava EEçš„ä¸‰å¤§ç»„ä»¶æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥å¤„ç†ä¸€æ¬¡æ¥è‡ªå®¢æˆ·ç«¯çš„HTTPè¯·æ±‚çš„ï¼› <!-- raw HTML omitted --></p>
<p>æˆ‘ä»¬çŸ¥é“Tomcatçš„Connectorè¿æ¥å™¨ä¼šè´Ÿè´£æ¥å—å®¢æˆ·ç«¯å‘æ¥çš„HTTPè¯·æ±‚ï¼Œå¹¶å°†Requestä»¥åŠResponseå°è£…å¥½äº¤ç”±Containerè¿›è¡Œå¤„ç†ï¼š <!-- raw HTML omitted --></p>
<p>è€Œè¿™å››ä¸ªContainerå­å®¹å™¨ç±»çš„å®ç°ç±»éƒ½ä»¥StandardXXXå‘½å(e.g., StandardContext), è€Œè¿™äº›å®ç°ç±»éƒ½æ— ä¸€ä¾‹å¤–çš„ç»§æ‰¿äº† <code>ContainerBase</code> æŠ½è±¡ç±»ï¼Œè€Œè¿™ä¸ªæŠ½è±¡ç±»çš„å®šä¹‰å°±åº”ç”¨äº†ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼š<a class="link" href="https://www.runoob.com/design-pattern/chain-of-responsibility-pattern.html"  target="_blank" rel="noopener"
    >è´£ä»»é“¾æ¨¡å¼ï¼ˆèœé¸Ÿæ•™ç¨‹ï¼‰</a>ï¼Œå…¶æ€æƒ³ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å°†å¯¹äºä¸€ä¸ªè¯·æ±‚çš„å¤„ç†ä»»åŠ¡æ‹†åˆ†å¼€ï¼Œå°†è´£ä»»åˆ†é…åˆ°ä¸€æ¡è´£ä»»é“¾çš„æ¯ä¸€ç¯ä¸Šï¼Œä»è€Œè¿›è¡Œåˆ†æ­¥å¤„ç†ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ContainerBase</span> <span class="kd">extends</span> <span class="n">LifecycleMBeanBase</span> <span class="kd">implements</span> <span class="n">Container</span>
</span></span></code></pre></div><p>æ ¹æ®è¿™ä¸ªè®¾è®¡æ¨¡å¼ï¼Œæ¯ä¸€ä¸ªContainerå­å®¹å™¨éƒ½ä¼šç®¡ç†ä¸€ä¸ª <strong>Pipeline</strong> ç±»å®ä¾‹ï¼Œç”¨â€œç®¡é“â€æ¥è¡¨ç¤ºä¸€æ¡â€œè´£ä»»é“¾â€ï¼Œè€Œä¸€ä¸ªæˆ–è€…å¤šä¸ª <strong>Valve</strong> é˜€é—¨å®ä¾‹å°†ä¼šè¢«æ·»åŠ åˆ° <strong>Pipeline</strong> å½“ä¸­æ¥åˆ†åˆ«å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚ <!-- raw HTML omitted --></p>
<p>ä¸‹é¢æ˜¯ä¸¤ä¸ªContainerBaseæ‰€å®šä¹‰çš„éœ€è¦è¢«å®ç°çš„abstractæ–¹æ³•ï¼š <!-- raw HTML omitted --></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Type</th>
<th>Data</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>addChild</td>
<td>Container</td>
<td>æ·»åŠ å­å®¹å™¨ï¼ˆe.g, Engine.addChild(Host)ï¼‰</td>
</tr>
<tr>
<td>pipeline.addValve</td>
<td>Valve</td>
<td>å°†ä¸€ä¸ªValveæ·»åŠ åˆ°Pipelineä¸­</td>
</tr>
</tbody>
</table></div>
<p>æ¯ä¸€ä¸ªContaineréƒ½ä¼šç”¨ <code>setBasic()</code> æ–¹æ³•åœ¨æ„é€ å™¨ä¸­ä¼šå‘pipepleä¸­æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„ <code>Valve</code>, æ¯”å¦‚ä¸‹é¢çš„ <strong>StandardEngine</strong>: <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The Pipeline object with which this Container is associated.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">final</span> <span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardPipeline</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Create a new StandardEngine component with the default basic Valve.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">StandardEngine</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// setBasic(): å‘pipelineä¸­æ·»åŠ é»˜è®¤çš„Valve
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">pipeline</span><span class="o">.</span><span class="na">setBasic</span><span class="o">(</span><span class="k">new</span> <span class="n">StandardEngineValve</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Set the jmvRoute using the system property jvmRoute */</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬è¯´è¿‡Pipelineä¸­çš„æ‰€æœ‰Valveéƒ½æ˜¯ç”¨æ¥åˆ†æ‰¹å¤„ç†è¯·æ±‚çš„ï¼Œé‚£ä¹ˆä»–ä»¬å°†ä¼šè¢«è‡ªå¸¦çš„ <strong>invoke()</strong> æ–¹æ³•æ‰€ä¾æ¬¡è°ƒç”¨ï¼Œé»˜è®¤çš„Valveä¸€èˆ¬å«åšStandardXXXValveï¼Œä¼šè¢«æ”¾åœ¨è´£ä»»é“¾çš„æœ€åä¸€ä¸ªæ‰§è¡Œï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰vavleï¼Œéœ€è¦æ·»åŠ é…ç½®åˆ° <strong>server.xml</strong> ä¸­ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªvavleéƒ½ä¼šæŒ‡å‘åä¸€ä¸ªvalveï¼Œæœ€ç»ˆå°†ç”±StandardXXXValveå¤„ç†ï¼Œä¹‹åå†ä¼ é€’ç»™ç›¸å¯¹åº”çš„å­å®¹å™¨ï¼š <!-- raw HTML omitted --></p>
<p>StandardEngineValve.invoke()ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰çš„è¯´çš„ï¼Œé»˜è®¤çš„Valveä¼šç»§ç»­è°ƒç”¨å¯¹åº”å­å®¹å™¨çš„pipelineä¸­çš„vavleç»§ç»­å¤„ç†è¯·æ±‚ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Select the Host to be used for this Request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è°ƒç”¨Request#getHost()æ–¹æ³•æ¥æ ¹æ®HTTPè¯·æ±‚è·å–å¯¹åº”çš„Host
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Host</span> <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHost</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">host</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// HTTP 0.9 or HTTP 1.0 request without a host when no default host
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// is defined.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Don&#39;t overwrite an existing error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">response</span><span class="o">.</span><span class="na">isError</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="n">404</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isAsyncSupported</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="na">setAsyncSupported</span><span class="o">(</span><span class="n">host</span><span class="o">.</span><span class="na">getPipeline</span><span class="o">().</span><span class="na">isAsyncSupported</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Ask this Host to process this request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">host</span><span class="o">.</span><span class="na">getPipeline</span><span class="o">().</span><span class="na">getFirst</span><span class="o">().</span><span class="na">invoke</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å°±è¿™æ ·æŒ‰ç…§é¡ºåºä¸€ç›´æ‰§è¡Œä¸‹å»ï¼šEngine-&gt;Host-&gt;Context-&gt;Wrapper: <!-- raw HTML omitted --></p>
<ol>
<li>æ ¹æ®HTTPè¯·æ±‚è°ƒç”¨Requestç±»ä¸­çš„getHost(), getContext(), getWrapper()æ–¹æ³•æ¥è·å–å¯¹åº”çš„å­å®¹å™¨ï¼› <!-- raw HTML omitted --></li>
<li>ç„¶åæ‰§è¡Œå­å®¹å™¨ä¸­çš„Pipleline-Valveè´£ä»»é“¾ï¼Œç›´åˆ°æœ€åWrapperValve#invoke()æ–¹æ³•ï¼› <!-- raw HTML omitted --></li>
</ol>
<p><figure><img src="/ox-hugo/2022-10-24_21-12-28_screenshot.png"
         alt="Figure 14: Pipleline-Valveè´£ä»»é“¾" width="700px"/><figcaption>
            <p><!-- raw HTML omitted -->Figure 14: <!-- raw HTML omitted -->Pipleline-Valveè´£ä»»é“¾</p>
        </figcaption>
</figure>
 <!-- raw HTML omitted --></p>
<h3 id="tomcat-containerå®¹å™¨å¤„ç†httpè¯·æ±‚çš„ç»ˆç‚¹">Tomcat Containerå®¹å™¨å¤„ç†HTTPè¯·æ±‚çš„ç»ˆç‚¹</h3>
<p>æˆ‘ä»¬æ¥çœ‹æœ€åçš„StandardWrappeValveçš„invoke()æ–¹æ³•ï¼š <!-- raw HTML omitted --></p>
<ol>
<li>åˆ›å»ºServletå®ä¾‹ï¼› <!-- raw HTML omitted --></li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„FilterChainå®ä¾‹ï¼ˆFilterChainä¹Ÿæ˜¯ä¸€ä¸ªè´£ä»»é“¾ï¼Œå°†å¯¹äºè¯·æ±‚çš„è¿‡æ»¤è¡Œä¸ºåˆ†æ•£åˆ°äº†å¤šä¸ªFilterä¸Šï¼‰ï¼› <!-- raw HTML omitted --></li>
<li>è°ƒç”¨æ–°åˆ›å»ºçš„FilterChainå®ä¾‹çš„doFilter()æ–¹æ³•æ¥ç»§ç»­å¤„ç†è¯·æ±‚ï¼› <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Initialize local variables we may need
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="n">StandardWrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardWrapper</span><span class="o">)</span> <span class="n">getContainer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Servlet</span> <span class="n">servlet</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Context</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">Context</span><span class="o">)</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">getParent</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Allocate a servlet instance to process this request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 1. åˆ†é…ä¸€ä¸ªServletå®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(!</span><span class="n">unavailable</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">servlet</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="na">allocate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Create the filter chain for this request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 2. ä½¿ç”¨Factoryå·¥å‚ç±»åˆ›å»ºä¸€ä¸ªfilterChainå®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ApplicationFilterChain</span> <span class="n">filterChain</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                <span class="n">ApplicationFilterFactory</span><span class="o">.</span><span class="na">createFilterChain</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">wrapper</span><span class="o">,</span> <span class="n">servlet</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Call the filter chain for this request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// NOTE: This also calls the servlet&#39;s service() method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Container</span> <span class="n">container</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">container</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">((</span><span class="n">servlet</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">filterChain</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Swallow output if needed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getSwallowOutput</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">SystemLogHandler</span><span class="o">.</span><span class="na">startCapture</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isAsyncDispatching</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                            <span class="n">request</span><span class="o">.</span><span class="na">getAsyncContextInternal</span><span class="o">().</span><span class="na">doInternalDispatch</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                            <span class="c1">// 3. è°ƒç”¨åˆ›å»ºçš„filterChainçš„doFilteræ–¹æ³•æ¥å¤„ç†è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequest</span><span class="o">(),</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">response</span><span class="o">.</span><span class="na">getResponse</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isAsyncDispatching</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">request</span><span class="o">.</span><span class="na">getAsyncContextInternal</span><span class="o">().</span><span class="na">doInternalDispatch</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// 3. è°ƒç”¨åˆ›å»ºçš„filterChainçš„doFilteræ–¹æ³•æ¥å¤„ç†è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span>
</span></span><span class="line"><span class="cl">                            <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequest</span><span class="o">(),</span> <span class="n">response</span><span class="o">.</span><span class="na">getResponse</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>ApplicationFilterChainæ˜¯FilterChainçš„å®ç°ç±»ï¼ŒdoFilteræ–¹æ³•å°†ç»§ç»­è°ƒç”¨ <strong>ApplicationFilterChain</strong> ä¸­çš„ <code>internalDoFilter()</code> æ–¹æ³•å¤„ç†è¯·æ±‚ï¼š <!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="o">(</span> <span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span> <span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">final</span> <span class="n">ServletRequest</span> <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="kd">final</span> <span class="n">ServletResponse</span> <span class="n">res</span> <span class="o">=</span> <span class="n">response</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">java</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">AccessController</span><span class="o">.</span><span class="na">doPrivileged</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">PrivilegedExceptionAction</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">                        <span class="kd">public</span> <span class="n">Void</span> <span class="nf">run</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                            <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                            <span class="n">internalDoFilter</span><span class="o">(</span><span class="n">req</span><span class="o">,</span><span class="n">res</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">internalDoFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p><strong>ApplicationFilterChain.internalDoFilter()</strong>: <!-- raw HTML omitted --></p>
<ol>
<li>æ ¹æ®FilterConfigæ¥åˆ›å»ºä¸€ä¸ªFilterå®ä¾‹ï¼› <!-- raw HTML omitted -->
<ul>
<li>è¿™æ—¶å€™æˆ‘ä»¬ç»ˆäºçŸ¥é“ä¹‹å‰åœ¨åŠ è½½Filterçš„æ—¶å€™ä¸ºä»€ä¹ˆè¦ä¿å­˜FilterConfigsäº†ï¼Œå°±æ˜¯ä¸ºäº†å°è£…Filterå¯¹è±¡ï¼Œå¹¶ä¿å­˜æ›´å¤šçš„ä¿¡æ¯å’ŒåŠŸèƒ½ï¼› <!-- raw HTML omitted --></li>
</ul>
</li>
<li>è°ƒç”¨Filterä¸­çš„è¿‡æ»¤æ–¹æ³•ï¼› <!-- raw HTML omitted -->
<ul>
<li>è¿‡æ»¤æ“ä½œç»“æŸä¹‹åï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ <strong>ApplicationFilterChain#doFilter()</strong> æ¥æ‰§è¡Œä¸‹ä¸€ä¸ªFilterçš„doFilter()ï¼› <!-- raw HTML omitted --></li>
</ul>
</li>
<li>æœ€ååœ¨æ‰€æœ‰çš„Filterçš„è¿‡æ»¤æ“ä½œéƒ½ç»“æŸåï¼Œæ­£å¼è°ƒç”¨Servletçš„service()æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼› <!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">internalDoFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Call the next filter if there is one
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ApplicationFilterConfig</span> <span class="n">filterConfig</span> <span class="o">=</span> <span class="n">filters</span><span class="o">[</span><span class="n">pos</span><span class="o">++];</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 1. æ ¹æ®FilterConfigæ¥è·å–Filterå®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Filter</span> <span class="n">filter</span> <span class="o">=</span> <span class="n">filterConfig</span><span class="o">.</span><span class="na">getFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="o">(</span> <span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span> <span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>      
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// 2. è°ƒç”¨Filterä¸­çš„è¿‡æ»¤æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">filter</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// We fell off the end of the chain -- call the servlet instance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Use potentially wrapped request from this point
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">((</span><span class="n">request</span> <span class="k">instanceof</span> <span class="n">HttpServletRequest</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">response</span> <span class="k">instanceof</span> <span class="n">HttpServletResponse</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Globals</span><span class="o">.</span><span class="na">IS_SECURITY_ENABLED</span> <span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 3. æ‰€æœ‰çš„Filterçš„è¿‡æ»¤æ“ä½œéƒ½ç»“æŸåï¼Œæ­£å¼è°ƒç”¨Servletçš„service()æ–¹æ³•æ¥å¤„ç†è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">servlet</span><span class="o">.</span><span class="na">service</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">     <span class="o">}</span>
</span></span></code></pre></div><h3 id="å°ç»“">å°ç»“</h3>
<p>Tomcatçš„Containerå®¹å™¨é€šè¿‡Pipeline-Valveè´£ä»»é“¾æœºåˆ¶ï¼Œå¯¹äºHTTPè¯·æ±‚ä¸­ä¸åŒä¿¡æ¯é€æ¸é€‰æ‹©å¯¹åº”çš„å­å®¹å™¨ï¼Œæœ€ç»ˆåˆ°è¾¾StandardWrapperValveä¸­ï¼› <!-- raw HTML omitted --></p>
<p>æ¥ç€ï¼ŒStandardWrapperValveä¼šæ¯ä¸ªè¯·æ±‚çš„å¤„ç†éƒ½åˆ›å»ºä¸€ä¸ªApplicaitonFilterChainè¿‡æ»¤é“¾ï¼Œå¹¶æ ¹æ®FilterConfigä¸­å°è£…çš„Filterè¿›è¡ŒdoFilterè¿‡æ»¤æ“ä½œï¼Œæ‰€æœ‰å®šä¹‰çš„Filteréƒ½å®Œæˆè¿‡æ»¤æ“ä½œä¹‹åï¼Œæ‰§è¡ŒWrapperæ‰€å®šä¹‰Servletçš„service()æ–¹æ³•ï¼Œå®Œæˆå¯¹äºHTTPè¯·æ±‚çš„å¤„ç†ã€‚ <!-- raw HTML omitted --></p>
<h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</h2>
<p>å¾ˆé•¿çš„ä¸€ç¯‡æ–‡ç« ï¼Œæˆ–è€…è¯´è¿™ä¸ªé•¿åº¦å·²ç»ä¸é…å«åšæ–‡ç« äº†ï¼ˆä¸ªäººæ„Ÿè§‰æ–‡ç« è¿˜æ˜¯åº”è¯¥æ›´ä¸ºç®€æ´å¹²ç»ƒä¸€äº›ï¼‰ï¼Œæ›´åƒæ˜¯ä¸€ç¯‡å­¦ä¹ ç¬”è®°ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†ä¸€å¼€å§‹çš„ç›®æ ‡å¹¶ä¸æ˜ç¡®ï¼Œä¸çŸ¥é“è¿™æ ·ä¸€ç¯‡å†…å®¹éœ€è¦æ”¾å¤šå°‘ä¸œè¥¿è¿›æ¥ï¼Œå¾ˆå¤šçŸ¥è¯†åº”è¯¥å­¦ä¹ åˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œè¿™ä¹Ÿæå¤§åœ°æ‰“å‡»äº†æ•ˆç‡ï¼Œåº”è¯¥å¸å–æ•™è®­ï¼Œç²¾ç®€æ¯ç¯‡æ–‡ç« ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥åˆ†æ‰¹æ¬¡æé«˜æˆå°±æ„Ÿã€‚ <!-- raw HTML omitted --></p>
<p>å¦‚æœè¯»è€…å¯¹äºå†…å®¹æœ‰ä»»ä½•çš„ç–‘é—®æˆ–è€…å¯¹äºå†™ä½œæœ‰ä»»ä½•çš„æ„è§ï¼Œè¯·æ‚¨åŠ¡å¿…é€šè¿‡é‚®ä»¶å‘Šè¯‰æˆ‘ï¼Œæå‰æ„Ÿè°¢ï¼ <!-- raw HTML omitted --></p>
<h2 id="reference">Reference</h2>
<blockquote>
<p><a class="link" href="https://www.jianshu.com/p/1a2d2f868143"  target="_blank" rel="noopener"
    >æ·±å…¥ç†è§£Tomcatï¼ˆå…«ï¼‰Container</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://goodapple.top/archives/1359"  target="_blank" rel="noopener"
    >Javaå®‰å…¨å­¦ä¹ â€”â€”Tomcatæ¶æ„æµ…æ</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://www.ramkitech.com/2012/02/understanding-virtual-host-concept-in.html"  target="_blank" rel="noopener"
    >Understanding Virtual Host Concept in Tomcat</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://tomcat.apache.org/tomcat-10.0-doc/architecture/overview.html"  target="_blank" rel="noopener"
    >Apache Tomcat 10 Architecture</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://www.cnblogs.com/kismetv/p/7228274.html"  target="_blank" rel="noopener"
    >è¯¦è§£Tomcat é…ç½®æ–‡ä»¶server.xml</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="http://www.shouhuola.com/q-36247.html"  target="_blank" rel="noopener"
    >ä»€ä¹ˆæ˜¯é™æ€èµ„æºï¼Œä»€ä¹ˆæ˜¯åŠ¨æ€èµ„æº</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://www.stackpath.com/edge-academy/what-is-static-content/"  target="_blank" rel="noopener"
    >What is Static Content?</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://www.techwalla.com/articles/what-is-the-ajp-protocol"  target="_blank" rel="noopener"
    >What Is the AJP Protocol?</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://en.wikipedia.org/wiki/Apache_JServ_Protocol"  target="_blank" rel="noopener"
    >Apache JServ Protocol</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://stackoverflow.com/questions/21757694/what-is-ajp-protocol-used-for"  target="_blank" rel="noopener"
    >What is AJP protocol used for?</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://www.jianshu.com/p/1a2d2f868143"  target="_blank" rel="noopener"
    >æ·±å…¥ç†è§£Tomcatï¼ˆå…«ï¼‰Container</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://www.runoob.com/w3cnote/facade-pattern-3.html"  target="_blank" rel="noopener"
    >JAVAè®¾è®¡æ¨¡å¼ä¹‹é—¨é¢æ¨¡å¼ï¼ˆå¤–è§‚æ¨¡å¼ï¼‰</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://www.runoob.com/design-pattern/chain-of-responsibility-pattern.html"  target="_blank" rel="noopener"
    >è´£ä»»é“¾æ¨¡å¼ï¼ˆèœé¸Ÿæ•™ç¨‹ï¼‰</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="http://t.zoukankan.com/bolang100-p-6041426.html"  target="_blank" rel="noopener"
    >tomcatæ¶æ„åˆ†æ(valveæœºåˆ¶)</a> <!-- raw HTML omitted --></p>
<p><a class="link" href="https://www.anquanke.com/post/id/266240"  target="_blank" rel="noopener"
    >ã€æŠ€æœ¯åˆ†äº«ã€‘Tomcat å†…å­˜é©¬æŠ€æœ¯åˆ†æï¼ˆä¸€ï¼‰â€”â€” Filterå‹</a>  <!-- raw HTML omitted --></p>
</blockquote>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/tomcat/">tomcat</a>
        
            <a href="/tags/servlet/">servlet</a>
        
            <a href="/tags/javaee/">JavaEE</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            Last updated on Nov 01, 2022 18:17 CST
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-contents--wrapper">
    <h2 class="section-title">Related contents</h2>
    <div class="related-contents">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/posts/how_browsers_work/">
        
        

        <div class="article-details">
            <h2 class="article-title">æµè§ˆå™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/posts/uri_url_urn/">
        
        

        <div class="article-details">
            <h2 class="article-title">URI &amp; URL &amp; URN çš„å…³ç³»</h2>
        </div>
    </a>
</article>
            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "medicwrf" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy;
        
        2022 Under The Ginkgo
    </section>

    <section class="powerby">
        
            Cogito, ergo sum <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.11.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <section class="powerby">
      <span id="busuanzi_container_site_pv" style='display:none'>
        Viwe <span id="busuanzi_value_site_pv"></span> times
      </span>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</a></li>
    <li><a href="#tomcatåŸºç¡€æ¡†æ¶">TomcatåŸºç¡€æ¡†æ¶</a></li>
    <li><a href="#ä»tomcaté…ç½®æ–‡ä»¶server-dot-xmläº†è§£tomcat">ä»Tomcaté…ç½®æ–‡ä»¶server.xmläº†è§£Tomcat</a></li>
    <li><a href="#server">Server</a></li>
    <li><a href="#service">Service</a></li>
    <li><a href="#connector">Connector</a></li>
    <li><a href="#container">Container</a>
      <ul>
        <li><a href="#engineä¸host">Engineä¸Host</a></li>
        <li><a href="#context">Context</a></li>
        <li><a href="#wrapper">Wrapper</a></li>
      </ul>
    </li>
    <li><a href="#tomcatä¸­çš„ä¸‰ç§contextè¾¨æ">Tomcatä¸­çš„ä¸‰ç§Contextè¾¨æ</a></li>
    <li><a href="#tomcatå¦‚ä½•å¯åŠ¨ä¸‰å¤§ç»„ä»¶">Tomcatå¦‚ä½•å¯åŠ¨ä¸‰å¤§ç»„ä»¶</a>
      <ul>
        <li><a href="#contextconfig-configurecontext-ä¸-standardcontext-startinternal">ContextConfig#configureContext() ä¸ StandardContext#startInternal()</a></li>
        <li><a href="#listener">Listener</a>
          <ul>
            <li><a href="#åŠ è½½listeneré…ç½®">åŠ è½½Listeneré…ç½®</a></li>
            <li><a href="#åˆå§‹åŒ–å’ŒåŠ è½½listener">åˆå§‹åŒ–å’ŒåŠ è½½Listener</a></li>
          </ul>
        </li>
        <li><a href="#filter">Filter</a>
          <ul>
            <li><a href="#åŠ è½½filterç›¸å…³é…ç½®">åŠ è½½Filterç›¸å…³é…ç½®</a></li>
            <li><a href="#åˆå§‹åŒ–å’ŒåŠ è½½filter">åˆå§‹åŒ–å’ŒåŠ è½½Filter</a></li>
          </ul>
        </li>
        <li><a href="#servlet">Servlet</a>
          <ul>
            <li><a href="#åŠ è½½servletç›¸å…³é…ç½®">åŠ è½½Servletç›¸å…³é…ç½®</a></li>
            <li><a href="#åˆå§‹åŒ–å’ŒåŠ è½½servlet">åˆå§‹åŒ–å’ŒåŠ è½½Servlet</a></li>
          </ul>
        </li>
        <li><a href="#å°ç»“">å°ç»“</a></li>
      </ul>
    </li>
    <li><a href="#tomcatå’Œservletå¤„ç†httpè¯·æ±‚">Tomcatå’ŒServletå¤„ç†HTTPè¯·æ±‚</a>
      <ul>
        <li><a href="#pipeline-valveè´£ä»»é“¾">Pipeline-Valveè´£ä»»é“¾</a></li>
        <li><a href="#tomcat-containerå®¹å™¨å¤„ç†httpè¯·æ±‚çš„ç»ˆç‚¹">Tomcat Containerå®¹å™¨å¤„ç†HTTPè¯·æ±‚çš„ç»ˆç‚¹</a></li>
        <li><a href="#å°ç»“">å°ç»“</a></li>
      </ul>
    </li>
    <li><a href="#å†™åœ¨æœ€å">å†™åœ¨æœ€å</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
